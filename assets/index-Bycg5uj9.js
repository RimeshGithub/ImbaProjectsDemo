(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const __init__$=Symbol.for("#__init__"),__initor__$=Symbol.for("#__initor__"),__meta__$=Symbol.for("#meta"),__imba__$=Symbol.for("imba"),matcher=Symbol.for("#matcher"),ClassFlags={HasSuperCalls:8,HasConstructor:16,HasMixins:64,IsObjectExtension:512},mmap=new Map,state=globalThis[__imba__$]||(globalThis[__imba__$]={counter:0,classes:mmap});function meta$(t,e={}){var r;return mmap.has(t)||mmap.set(t,{symbol:Symbol(t.name),parent:(r=Object.getPrototypeOf(t.prototype))==null?void 0:r.constructor,for:t,uses:null,inits:null,id:state.counter++,...e}),mmap.get(t)}function is$(t,e){var r;return t===e||((r=e==null?void 0:e[matcher])==null?void 0:r.call(e,t))}function iterable$(t){var e;return((e=t==null?void 0:t.toIterable)==null?void 0:e.call(t))||t}function isSameDesc(t,e){if(!t||!e)return!1;if(t.get)return e.get===t.get;if(t.set)return e.set===t.set;if(t.value)return t.value===e.value}function extend$(t,e,r,i={}){const n=t.constructor;!r&&e&&(r=Object.getOwnPropertyDescriptors(e),delete r.constructor,r[__init__$]&&(console.warn(`Cannot define plain fields when extending class ${n.name}`),delete r[__init__$]));let s=meta$(n);if(s&&s.augments){const a=new Map;for(let l of Object.keys(r)){let u=Object.getOwnPropertyDescriptor(t,l);for(let p of s.augments){let f=a.get(p);f||a.set(p,f={});let c=Object.getOwnPropertyDescriptor(p.prototype,l);c&&!isSameDesc(u,c)?console.warn("wont extend",l,c,u):f[l]=r[l]}}for(let[l,u]of a)Object.keys(u).length&&extend$(l.prototype,null,u)}return Object.defineProperties(t,r),t}function augment$(t,e){let r=meta$(t),i=meta$(e);if(i.parent&&!(t.prototype instanceof i.parent))throw new Error(`Mixin ${e.name} has superclass not present in target class`);if(!i.augments){i.augments=new Set;const s=i.ref=Symbol(e.name),a=Object[Symbol.hasInstance];e.prototype[s]=!0,Object.defineProperty(e,Symbol.hasInstance,{value:function(l){return this===e?l&&!!l[s]:a.call(this,l)}})}if(t.prototype[i.ref])return t;if(i.uses)for(let s of i.uses)augment$(t,s);i.augments.add(t),r.uses||(r.uses=[]),r.uses.push(e);let n=Object.getOwnPropertyDescriptors(e.prototype);return delete n.constructor,n[__init__$]&&(r.inits||(r.inits=[]),r.inits.push(e.prototype[__init__$]),delete n[__init__$]),Object.defineProperties(t.prototype,n),(e==null?void 0:e.mixed)instanceof Function&&e.mixed(t),t}let sup={cache:{},self:null,target:null,proxy:new Proxy({},{apply:(t,e,...r)=>sup.target[e].apply(sup.self,r),get:(t,e)=>Reflect.get(sup.target,e,sup.self),set:(t,e,r,i)=>Reflect.set(sup.target,e,r,sup.self)})};function register$(t,e,r,i,n=null){var p;let s=Object.getPrototypeOf(t.prototype),a=i&ClassFlags.HasMixins,l;if(a&&(mmap.set(t,mmap.get(s.constructor)),s=Object.getPrototypeOf(s)),n){let f=i&ClassFlags.IsObjectExtension?n:n.prototype,c=meta$(t);if(c.uses){n===f&&console.warn("Cannot extend object with mixins");for(let h of c.uses)augment$(n,h)}return i&ClassFlags.HasSuperCalls&&(sup.cache[e]=Object.create(Object.getPrototypeOf(f),Object.getOwnPropertyDescriptors(f))),extend$(f,t.prototype),n}let u=s==null?void 0:s.constructor;if(l=meta$(t,{symbol:e}),Object.defineProperty(t,__meta__$,{value:l,enumerable:!1,configurable:!0}),r&&t.name!==r&&Object.defineProperty(t,"name",{value:r,configurable:!0}),l.flags=i,i&ClassFlags.HasConstructor&&(t.prototype[__initor__$]=e),l.uses)for(let f of l.uses)(p=f.mixes)==null||p.call(f,t);return(u==null?void 0:u.inherited)instanceof Function&&u.inherited(t),t}const $__listeners__$=Symbol.for("#__listeners__");let c$0$J=Symbol();const St=class St{static for(e){return new Proxy({},new this(e))}constructor(e){this.getter=e}get target(){return this.getter()}get(e,r){return this.target[r]}set(e,r,i){return this.target[r]=i,!0}};register$(St,c$0$J,"LazyProxy",16);let LazyProxy=St;function proxy(t,e={}){return new Proxy(e,new LazyProxy(t))}function parseTime(t){let e=typeof t;if(e=="number")return t;if(e=="string"){if(/^\d+fps$/.test(t))return 1e3/parseFloat(t);if(/^([-+]?[\d\.]+)s$/.test(t))return parseFloat(t)*1e3;if(/^([-+]?[\d\.]+)ms$/.test(t))return parseFloat(t)}return null}function getDeepPropertyDescriptor(t,e,r){if(!t)return;let i=Object.getOwnPropertyDescriptor(t,e);return i||t==r?i||void 0:getDeepPropertyDescriptor(Reflect.getPrototypeOf(t),e,r)}const emit__=function(t,e,r){let i,n;for(;(i=r)&&(r=r.next);)(n=r.listener)&&(r.path&&n[r.path]?e?n[r.path].apply(n,e):n[r.path]():e?n.apply(r,e):n.call(r)),r.times&&--r.times<=0&&(i.next=r.next,r.listener=null)};function listen(t,e,r,i){let n,s,a;return n=t[$__listeners__$]||(t[$__listeners__$]={}),s=n[e]||(n[e]={}),a=s.tail||(s.tail=s.next={}),a.listener=r,a.path=i,s.tail=a.next={},a}function once(t,e,r){let i=listen(t,e,r);return i.times=1,i}function unlisten(t,e,r,i){if(!r)return;let n,s,a=t[$__listeners__$];if(a&&(n=a[e])){for(;(s=n)&&(n=n.next);)if(n==r||n.listener==r){s.next=n.next,n.listener=null;break}}}function emit(t,e,r=null){let i;(i=t[$__listeners__$])&&(i[e]&&emit__(e,r,i[e]),i.all&&emit__(e,[e,r],i.all))}let c$1$h=Symbol();const At=class At{emit(e,...r){return emit(this,e,r)}on(e,...r){return listen(this,e,...r)}once(e,...r){return once(this,e,...r)}un(e,...r){return unlisten(this,e,...r)}};register$(At,c$1$h,"Emitter",0);let Emitter=At;function isa$$c(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}function iter$__$8(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}const $__init__$$4=Symbol.for("#__init__"),$schedule$=Symbol.for("#schedule"),$frames$=Symbol.for("#frames"),$interval$=Symbol.for("#interval"),$stage$=Symbol.for("#stage"),$scheduled$=Symbol.for("#scheduled"),$version$$1=Symbol.for("#version"),$fps$=Symbol.for("#fps"),$ticker$=Symbol.for("#ticker");let rAF=globalThis.requestAnimationFrame||function(t){return globalThis.setTimeout(t,1e3/60)},c$0$I=Symbol();const Tt=class Tt{constructor(e=null){this[$__init__$$4](e)}[$__init__$$4](e=null,r=!0,i=!0){var n;this.owner=e&&(n=e.owner)!==void 0?n:null,this.target=e&&(n=e.target)!==void 0?n:null,this.active=e&&(n=e.active)!==void 0?n:!1,this.value=e&&(n=e.value)!==void 0?n:void 0,this.skip=e&&(n=e.skip)!==void 0?n:0,this.last=e&&(n=e.last)!==void 0?n:0}tick(e,r){return this.last=this.owner[$frames$],this.target.tick(this,r),1}update(e,r){let i=this.active,n=e.value;return this.value!=n&&(this.deactivate(),this.value=n),(this.value||i||r)&&this.activate(),this}queue(){this.owner.add(this)}activate(){return this.value===!0?this.owner.on("commit",this):this.value===!1||typeof this.value=="number"&&(this.value/16.666666666666668<=2?this.owner.on("raf",this):this[$interval$]=globalThis.setInterval(this.queue.bind(this),this.value)),this.active=!0,this}deactivate(){return this.value===!0&&this.owner.un("commit",this),this.owner.un("raf",this),this[$interval$]&&(globalThis.clearInterval(this[$interval$]),this[$interval$]=null),this.active=!1,this}};register$(Tt,c$0$I,"Scheduled",16);let Scheduled=Tt,c$1$g=Symbol();const wt=class wt{constructor(){var e=this;this.id=Symbol(),this.queue=[],this.stage=-1,this[$stage$]=-1,this[$frames$]=0,this[$scheduled$]=!1,this[$version$$1]=0,this.listeners={},this.intervals={},this.commit=function(){return e.add("commit"),e},this[$fps$]=0,this.$promise=null,this.$resolve=null,this[$ticker$]=function(r){return e[$scheduled$]=!1,e.tick(r)}}touch(){return this[$version$$1]++}get version(){return this[$version$$1]}add(e,r=!1){return(r||this.queue.indexOf(e)==-1)&&this.queue.push(e),this[$scheduled$]||this[$schedule$](),this}get committingΦ(){return this.queue.indexOf("commit")>=0}get syncingΦ(){return this[$stage$]==1}listen(e,r){let i=this.listeners[e],n=!i;return i||(i=this.listeners[e]=new Set),i.add(r),e=="raf"&&n&&this.add("raf"),this}unlisten(e,r){let i=this.listeners[e];return i&&i.delete(r),e=="raf"&&i&&i.size==0&&(this.listeners.raf,delete this.listeners.raf),this}on(e,r){return this.listen(e,r)}un(e,r){return this.unlisten(e,r)}get promise(){var e=this;return this.$promise||(this.$promise=new Promise(function(r){return e.$resolve=r}))}tick(e){var r=this;let i=this.queue;if(this[$frames$]++,this.ts||(this.ts=e),this.dt=e-this.ts,this.ts=e,this.queue=[],this[$stage$]=1,this[$version$$1]++,i.length)for(let n=0,s=iter$__$8(i),a=s.length;n<a;n++){let l=s[n];typeof l=="string"&&this.listeners[l]?this.listeners[l].forEach(function(u){if(isa$$c(u.tick,Function))return u.tick(r,l);if(isa$$c(u,Function))return u(r,l)}):isa$$c(l,Function)?l(this.dt,this):l.tick&&l.tick(this.dt,this)}return this[$stage$]=this[$scheduled$]?0:-1,this.$promise&&(this.$resolve(this),this.$promise=this.$resolve=null),this.listeners.raf&&this.add("raf"),this}[$schedule$](){return this[$scheduled$]||(this[$scheduled$]=!0,this[$stage$]==-1&&(this[$stage$]=0),rAF(this[$ticker$])),this}schedule(e,r){var n,s;return r||(r=e[n=this.id]||(e[n]={value:!0})),(r[s=this.id]||(r[s]=new Scheduled({owner:this,target:e}))).update(r,!0)}unschedule(e,r={}){r||(r=e[this.id]);let i=r&&r[this.id];return i&&i.active&&i.deactivate(),this}};register$(wt,c$1$g,"Scheduler",16);let Scheduler=wt;const scheduler=new Scheduler;function commit(){return scheduler.add("commit").promise}function setTimeout$1(t,e){return globalThis.setTimeout(function(){t(),commit()},e)}function setInterval$1(t,e){return globalThis.setInterval(function(){t(),commit()},e)}const clearInterval$1=globalThis.clearInterval,clearTimeout$1=globalThis.clearTimeout;let instance$2=globalThis.imba||(globalThis.imba={});instance$2.commit=commit;instance$2.setTimeout=setTimeout$1;instance$2.setInterval=setInterval$1;instance$2.clearInterval=clearInterval$1;instance$2.clearTimeout=clearTimeout$1;function isa$$b(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}const $idler$=Symbol.for("#idler"),$resolve$=Symbol.for("#resolve");let c$0$H=Symbol();const It=class It extends Set{constructor(){super(),this[$idler$]=Promise.resolve(this)}emit(e,...r){return emit(this,e,r)}on(e,...r){return listen(this,e,...r)}once(e,...r){return once(this,e,...r)}un(e,...r){return unlisten(this,e,...r)}add(e){var r=this;if(isa$$b(e,Function)&&(e=e()),!this.has(e)){let i=this.size==0;super.add(e),i&&(this[$idler$]=this[$resolve$]=null,this.emit("busy",this)),this.emit("add",e,this);let n=function(){return r.delete(e)};e.then(n,n)}return e}delete(e){return super.delete(e)?(this.emit("delete",e,this),this.size==0&&(this[$resolve$]&&(this[$resolve$](!0),this[$resolve$]=null),this.emit("idle",this)),!0):!1}get idle(){var e=this;return this[$idler$]||(this[$idler$]=new Promise(function(r){return e.size==0?r(!0):e[$resolve$]=r}))}get idleΦ(){return this.size==0}then(e,r){return this.idle.then(e,r)}};register$(It,c$0$H,"Queue",24);let Queue=It;const $toStringDeopt$=Symbol.for("#toStringDeopt"),$symbols$=Symbol.for("#symbols"),$batches$=Symbol.for("#batches"),$extras$=Symbol.for("#extras"),$stacks$=Symbol.for("#stacks");let c$0$G=Symbol();const Ot=class Ot{constructor(e){this.dom=e,this.string=""}contains(e){return this.dom.classList.contains(e)}has(e){return this.dom.classList.contains(e)}add(e){return this.contains(e)?this:(this.string+=(this.string?" ":"")+e,this.dom.classList.add(e),this)}remove(e){if(!this.contains(e))return this;let r=new RegExp("(^|\\s)"+e+"(?=\\s|$)","g");return this.string=this.string.replace(r,""),this.dom.classList.remove(e),this}toggle(e,r){return r===void 0&&(r=!this.contains(e)),r?this.add(e):this.remove(e)}incr(e,r=0){var i=this;let n=this.stacks,s=n[e]||0;return s<1&&this.add(e),r>0&&setTimeout(function(){return i.decr(e)},r),n[e]=Math.max(s,0)+1}decr(e){let r=this.stacks,i=r[e]||0;return i==1&&this.remove(e),r[e]=Math.max(i,1)-1}reconcile(e,r){let i=this[$symbols$],n=this[$batches$],s=!0;if(!i)i=this[$symbols$]=[e],n=this[$batches$]=[r||""],this.toString=this.valueOf=this[$toStringDeopt$];else{let a=i.indexOf(e),l=r||"";a==-1?(i.push(e),n.push(l)):n[a]!=l?n[a]=l:s=!1}s&&(this[$extras$]=" "+n.join(" "),this.sync())}valueOf(){return this.string}toString(){return this.string}[$toStringDeopt$](){return this.string+(this[$extras$]||"")}sync(){return this.dom.flagSync$()}get stacks(){return this[$stacks$]||(this[$stacks$]={})}};register$(Ot,c$0$G,"Flags",16);let Flags=Ot;const $__init__$$3=Symbol.for("#__init__"),$getRenderContext$$5=Symbol.for("#getRenderContext"),$getDynamicContext$$1=Symbol.for("#getDynamicContext"),renderContext={context:null};let c$0$F=Symbol();const kt=class kt{constructor(e=null){this[$__init__$$3](e)}[$__init__$$3](e=null,r=!0,i=!0){var n;this.stack=e&&(n=e.stack)!==void 0?n:[]}push(e){return this.stack.push(e)}pop(e){return this.stack.pop()}};register$(kt,c$0$F,"Renderer",16);let Renderer=kt;const renderer=new Renderer;let c$1$f=Symbol();const Ue=class Ue extends Map{constructor(e,r=null){super(),this._=e,this.sym=r}pop(){return renderContext.context=null}[$getRenderContext$$5](e){let r=this.get(e);return r||this.set(e,r=new Ue(this._,e)),renderContext.context=r}[$getDynamicContext$$1](e,r){return this[$getRenderContext$$5](e)[$getRenderContext$$5](r)}run(e){return this.value=e,renderContext.context==this&&(renderContext.context=null),this.get(e)}cache(e){return this.set(this.value,e),e}};register$(Ue,c$1$f,"RenderContext",16);let RenderContext=Ue;function createRenderContext(t,e=Symbol(),r=t){return renderContext.context=t[e]||(t[e]=new RenderContext(r,e))}function getRenderContext(){let t=renderContext.context,e=t||new RenderContext(null);return globalThis.DEBUG_IMBA&&!t&&renderer.stack.length>0&&console.trace("detected unmemoized nodes in",renderer.stack.slice(0),"see https://imba.io",e),t&&(renderContext.context=null),e}function isa$$a(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}function iter$__$7(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}const $parent$$1=Symbol.for("#parent"),$closestNode$$1=Symbol.for("#closestNode"),$parentNode$$1=Symbol.for("#parentNode"),$context$$2=Symbol.for("#context"),$$inited$$1=Symbol.for("##inited"),$getRenderContext$$4=Symbol.for("#getRenderContext"),$getDynamicContext$=Symbol.for("#getDynamicContext"),$insertChild$$3=Symbol.for("#insertChild"),$appendChild$$b=Symbol.for("#appendChild"),$replaceChild$$1=Symbol.for("#replaceChild"),$removeChild$$3=Symbol.for("#removeChild"),$insertInto$$5=Symbol.for("#insertInto"),$insertIntoDeopt$=Symbol.for("#insertIntoDeopt"),$removeFrom$$4=Symbol.for("#removeFrom"),$removeFromDeopt$=Symbol.for("#removeFromDeopt"),$replaceWith$$4=Symbol.for("#replaceWith"),$replaceWithDeopt$=Symbol.for("#replaceWithDeopt"),$placeholderNode$=Symbol.for("#placeholderNode"),$attachToParent$$1=Symbol.for("#attachToParent"),$detachFromParent$$1=Symbol.for("#detachFromParent"),$placeChild$$k=Symbol.for("#placeChild"),$beforeReconcile$$q=Symbol.for("#beforeReconcile"),$afterReconcile$$q=Symbol.for("#afterReconcile"),$afterVisit$$r=Symbol.for("#afterVisit"),$visitContext$$1=Symbol.for("#visitContext"),$__init__$$2=Symbol.for("#__init__"),$$parent$$3=Symbol.for("##parent"),$$up$$n=Symbol.for("##up"),$$context$=Symbol.for("##context"),$domNode$=Symbol.for("#domNode"),$$placeholderNode$=Symbol.for("##placeholderNode"),$forNode$=Symbol.for("#forNode"),$domDeopt$=Symbol.for("#domDeopt"),$$visitContext$$3=Symbol.for("##visitContext"),$isRichElement$$2=Symbol.for("#isRichElement"),$src$=Symbol.for("#src"),$htmlNodeName$=Symbol.for("#htmlNodeName"),$cssns$=Symbol.for("#cssns"),$cssid$=Symbol.for("#cssid"),IMouseEvent=window.MouseEvent,IKeyboardEvent=window.KeyboardEvent,INode=window.Node,IComment=window.Comment,IText=window.Text,IElement=window.Element,IHTMLSelectElement=window.HTMLSelectElement,IHTMLInputElement=window.HTMLInputElement,IHTMLTextAreaElement=window.HTMLTextAreaElement,IHTMLButtonElement=window.HTMLButtonElement,IHTMLOptionElement=window.HTMLOptionElement,descriptorCache={};function getDescriptor(t,e,r){if(!t)return r[e]=null;if(r[e]!==void 0)return r[e];let i=Object.getOwnPropertyDescriptor(t,e);return i!==void 0||t==SVGElement?r[e]=i||null:getDescriptor(Reflect.getPrototypeOf(t),e,r)}const CustomTagConstructors={},CustomTagToElementNames={},TYPES={},CUSTOM_TYPES={},contextHandler={get(t,e){let r=t,i;for(;r&&i==null;)(r=r[$parent$$1])&&(i=r[e]);return i},set(t,e,r){let i=t,n;for(;i&&n==null;){if(getDeepPropertyDescriptor(i,e,Element))return i[e]=r,!0;i=i[$parent$$1]}return!0}};let c$0$E=Symbol();var Re;let ΩDocument$1=(Re=class{get flags(){return this.documentElement.flags}emit(...e){return this.documentElement.emit(...e)}},register$(Re,c$0$E,"Document",1,Document),Re);Node.prototype[$__init__$$2]=function(){return this};let c$1$e=Symbol();var Pe;let ΩNode$2=(Pe=class{get[$parent$$1](){return this[$$parent$$3]||this.parentNode||this[$$up$$n]}get[$closestNode$$1](){return this}get[$parentNode$$1](){var e;return(e=this[$parent$$1])==null?void 0:e[$closestNode$$1]}get[$context$$2](){return this[$$context$]||(this[$$context$]=new Proxy(this,contextHandler))}[$$inited$$1](){return this}[$getRenderContext$$4](e){return createRenderContext(this,e)}[$getDynamicContext$](e,r){return this[$getRenderContext$$4](e)[$getRenderContext$$4](r)}[$insertChild$$3](e,r){return e[$insertInto$$5](this,r)}[$appendChild$$b](e){return e[$insertInto$$5](this,null)}[$replaceChild$$1](e,r){let i=this[$insertChild$$3](e,r);return this[$removeChild$$3](r),i}[$removeChild$$3](e){return e[$removeFrom$$4](this)}[$insertInto$$5](e,r=null){return r?e.insertBefore(this,r):e.appendChild(this),this}[$insertIntoDeopt$](e,r){return r?e.insertBefore(this[$domNode$]||this,r):e.appendChild(this[$domNode$]||this),this}[$removeFrom$$4](e){return e.removeChild(this)}[$removeFromDeopt$](e){return e.removeChild(this[$domNode$]||this)}[$replaceWith$$4](e,r){return r[$replaceChild$$1](e,this)}[$replaceWithDeopt$](e,r){return r[$replaceChild$$1](e,this[$domNode$]||this)}get[$placeholderNode$](){let e;return this[$$placeholderNode$]||(this[$$placeholderNode$]=(e=globalThis.document.createComment("placeholder"),e[$forNode$]=this,e))}set[$placeholderNode$](e){let r=this[$$placeholderNode$];this[$$placeholderNode$]=e,e[$forNode$]=this,r&&r!=e&&r.parentNode&&r[$replaceWith$$4](e)}[$attachToParent$$1](){let e=this[$domNode$],r=e&&e.parentNode;return e&&r&&e!=this&&(this[$domNode$]=null,this[$insertInto$$5](r,e),e[$removeFrom$$4](r)),this}[$detachFromParent$$1](){this[$domDeopt$]!=!0&&(this[$domDeopt$]=!0,!0)&&(this[$replaceWith$$4]=this[$replaceWithDeopt$],this[$removeFrom$$4]=this[$removeFromDeopt$],this[$insertInto$$5]=this[$insertIntoDeopt$],this[$$up$$n]||(this[$$up$$n]=this[$parent$$1]));let e=this[$placeholderNode$];return this.parentNode&&e!=this&&(e[$insertInto$$5](this.parentNode,this),this[$removeFrom$$4](this.parentNode)),this[$domNode$]=e,this}[$placeChild$$k](e,r,i){let n=typeof e;if(n==="undefined"||e===null){if(i&&isa$$a(i,Comment))return i;let s=globalThis.document.createComment("");return i?i[$replaceWith$$4](s,this):s[$insertInto$$5](this,null)}if(e===i)return e;if(n!=="object"){let s,a=e;return i?isa$$a(i,Text)?(i.textContent=a,i):(s=globalThis.document.createTextNode(a),i[$replaceWith$$4](s,this),s):(this.appendChild(s=globalThis.document.createTextNode(a)),s)}else return e[$insertInto$$5]?i?i[$replaceWith$$4](e,this):e[$insertInto$$5](this,null):this[$placeChild$$k](String(e),r,i)}},register$(Pe,c$1$e,"Node",1,Node),Pe),c$2$7=Symbol();var Ce;let ΩElement$4=(Ce=class{log(...e){return console.log(...e)}get hiddenΦ(){var r,i;let e=globalThis.getComputedStyle(this);return e.display=="none"||e.visibility=="hidden"?!0:this.offsetParent||this===globalThis.document.body?!1:(i=(r=this.parentElement)==null?void 0:r.hiddenΦ)!=null?i:!0}get detachedΦ(){return!globalThis.document.documentElement.contains(this)}get unobstructedΦ(){let e=this.getBoundingClientRect(),r=window.visualViewport,i=e.left+e.width*.5,n=e.top+e.height*.5;if(r.width>i&&i>0&&r.height>n&&n>0){let s=globalThis.document.elementFromPoint(i,n);return!!(s&&(s.contains(this)||this.contains(s)))}return!1}get focusΦ(){return globalThis.document.activeElement==this}get focinΦ(){return this.contains(globalThis.document.activeElement)}emit(e,r,i={}){var s,a,l;r!=null&&((s=i.detail)!=null||(i.detail=r)),(a=i.bubbles)!=null||(i.bubbles=!0),(l=i.cancelable)!=null||(i.cancelable=!0);let n=new CustomEvent(e,i);return i.original&&(n.originalEvent=i.original),this.dispatchEvent(n),n}text$(e){return this.textContent=e,this}[$beforeReconcile$$q](){return this}[$afterReconcile$$q](){return this}[$afterVisit$$r](){this[$$visitContext$$3]&&(this[$$visitContext$$3]=null)}get[$visitContext$$1](){return this[$$visitContext$$3]||(this[$$visitContext$$3]={})}get flags(){return this.$flags||(this.$flags=new Flags(this),this.flag$==Element.prototype.flag$&&(this.flags$ext=this.className),this.flagDeopt$()),this.$flags}flag$(e){let r=this.flags$ns;this.className=r?r+(this.flags$ext=e):this.flags$ext=e}flagDeopt$(){var e=this;this.flag$=this.flagExt$,this.flagSelf$=function(r){return e.flagSync$(e.flags$own=r)}}flagExt$(e){return this.flagSync$(this.flags$ext=e)}flagSelf$(e){return this.flagDeopt$(),this.flagSelf$(e)}flagSync$(){return this.className=(this.flags$ns||"")+(this.flags$ext||"")+" "+(this.flags$own||"")+" "+(this.$flags||"")}set$(e,r){let i=getDeepPropertyDescriptor(this,e,Element);!i||!i.set?this.setAttribute(e,r):this[e]=r}get richValue(){return this.value}set richValue(e){this.value=e}},register$(Ce,c$2$7,"Element",1,Element),Ce);Element.prototype.setns$=Element.prototype.setAttributeNS;Element.prototype[$isRichElement$$2]=!0;function createElement(t,e,r,i){let n=globalThis.document.createElement(t);return r&&(n.className=r),i!==null&&n.text$(i),e&&e[$appendChild$$b]&&e[$appendChild$$b](n),n}let c$3$3=Symbol();const Mt=class Mt{set$(e,r){var s;let i=descriptorCache[s=this.nodeName]||(descriptorCache[s]={}),n=getDescriptor(this,e,i);!n||!n.set?this.setAttribute(e,r):this[e]=r}flag$(e){let r=this.flags$ns;this.setAttribute("class",r?r+(this.flags$ext=e):this.flags$ext=e)}flagSelf$(e){var r=this;return this.flag$=function(i){return r.flagSync$(r.flags$ext=i)},this.flagSelf$=function(i){return r.flagSync$(r.flags$own=i)},this.flagSelf$(e)}flagSync$(){return this.setAttribute("class",(this.flags$ns||"")+(this.flags$ext||"")+" "+(this.flags$own||"")+" "+(this.$flags||""))}};register$(Mt,c$3$3,"SVGElement",1,SVGElement);let ΩSVGElement=Mt,c$4$3=Symbol();const Rt=class Rt{set src(e){if(this[$src$]!=e&&(this[$src$]=e,!0)){if(e&&e.adoptNode)e.adoptNode(this);else if(e&&e.type=="svg"){if(e.attributes)for(let r=e.attributes,i=0,n=Object.keys(r),s=n.length,a,l;i<s;i++)a=n[i],l=r[a],this.setAttribute(a,l);this.innerHTML=e.content}}}};register$(Rt,c$4$3,"SVGSVGElement",1,SVGSVGElement);let ΩSVGSVGElement=Rt;function createComment(t){return globalThis.document.createComment(t)}function createTextNode(t){return globalThis.document.createTextNode(t)}const navigator=globalThis.navigator,vendor=navigator&&navigator.vendor||"",ua=navigator&&navigator.userAgent||"",isSafari=vendor.indexOf("Apple")>-1||ua.indexOf("CriOS")>=0||ua.indexOf("FxiOS")>=0,supportsCustomizedBuiltInElements=!isSafari,CustomDescriptorCache=new Map;let c$5$2=Symbol();const Pt=class Pt extends HTMLElement{connectedCallback(){return supportsCustomizedBuiltInElements?this.parentNode.removeChild(this):this.parentNode.connectedCallback()}disconnectedCallback(){if(!supportsCustomizedBuiltInElements)return this.parentNode.disconnectedCallback()}};register$(Pt,c$5$2,"CustomHook",0);let CustomHook=Pt;window.customElements.define("i-hook",CustomHook);function getCustomDescriptors(t,e){let r=CustomDescriptorCache.get(e);if(!r){r={};let i=e.prototype,n=[i];for(;(i=i&&Object.getPrototypeOf(i))&&i.constructor!=t.constructor;)n.unshift(i);for(let s=0,a=iter$__$7(n),l=a.length;s<l;s++){let u=a[s],p=Object.getOwnPropertyDescriptors(u);Object.assign(r,p)}CustomDescriptorCache.set(e,r)}return r}function createComponent(t,e,r,i,n){let s;typeof t!="string"&&t&&t.nodeName&&(t=t.nodeName);let a=CustomTagToElementNames[t]||t;if(CustomTagConstructors[t]){let l=CustomTagConstructors[t],u=l.prototype[$htmlNodeName$];if(u&&supportsCustomizedBuiltInElements)s=globalThis.document.createElement(u,{is:a});else if(l.create$&&u){s=globalThis.document.createElement(u),s.setAttribute("is",a);let p=getCustomDescriptors(s,l);Object.defineProperties(s,p),s.__slots={},s.appendChild(globalThis.document.createElement("i-hook"))}else l.create$?(s=l.create$(s),s.__slots={}):console.warn("could not create tag "+t)}else s=globalThis.document.createElement(CustomTagToElementNames[t]||t);return s[$$parent$$3]=e,s[$__init__$$2](),s[$$inited$$1](),(r||s.flags$ns)&&s.flag$(r||""),s}function createDynamic(t,e,r,i){return t==null||t==null?createComment(""):isa$$a(t,Node)||t[$isRichElement$$2]?t:createComponent(t,e,r)}function defineTag(t,e,r={}){TYPES[t]=CUSTOM_TYPES[t]=e,e.nodeName=t;let i=t,n=e.prototype;if(t.indexOf("-")==-1&&(i=""+t+"-tag",CustomTagToElementNames[t]=i),r.cssns){let s=(n._ns_||n[$cssns$]||"")+" "+(r.cssns||"");n._ns_=s.trim()+" ",n[$cssns$]=r.cssns}if(r.cssid){let s=(n.flags$ns||"")+" "+r.cssid;n[$cssid$]=r.cssid,n.flags$ns=s.trim()+" "}return n[$htmlNodeName$]&&!r.extends&&(r.extends=n[$htmlNodeName$]),r.extends?(n[$htmlNodeName$]=r.extends,CustomTagConstructors[t]=e,supportsCustomizedBuiltInElements&&window.customElements.define(i,e,{extends:r.extends})):window.customElements.define(i,e),e}let instance$1=globalThis.imba||(globalThis.imba={});instance$1.document=globalThis.document;function isa$$9(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}function iter$__$6(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}const $parent$=Symbol.for("#parent"),$closestNode$=Symbol.for("#closestNode"),$isRichElement$$1=Symbol.for("#isRichElement"),$afterVisit$$q=Symbol.for("#afterVisit"),$getRenderContext$$3=Symbol.for("#getRenderContext"),$appendChild$$a=Symbol.for("#appendChild"),$removeChild$$2=Symbol.for("#removeChild"),$replaceChild$=Symbol.for("#replaceChild"),$insertInto$$4=Symbol.for("#insertInto"),$replaceWith$$3=Symbol.for("#replaceWith"),$insertChild$$2=Symbol.for("#insertChild"),$removeFrom$$3=Symbol.for("#removeFrom"),$placeChild$$j=Symbol.for("#placeChild"),$registerFunctionalSlot$=Symbol.for("#registerFunctionalSlot"),$getFunctionalSlot$=Symbol.for("#getFunctionalSlot"),$getSlot$=Symbol.for("#getSlot"),$$parent$$2=Symbol.for("##parent"),$$up$$m=Symbol.for("##up"),$$flags$=Symbol.for("##flags"),$domFlags$$2=Symbol.for("#domFlags"),$end$$2=Symbol.for("#end"),$textContent$=Symbol.for("#textContent"),$textNode$=Symbol.for("#textNode"),$functionalSlots$=Symbol.for("#functionalSlots");let c$0$D=Symbol();const Ct=class Ct{constructor(){this.childNodes=[]}log(...e){}hasChildNodes(){return!1}set[$parent$](e){this[$$parent$$2]=e}get[$parent$](){return this[$$parent$$2]||this[$$up$$m]}get[$closestNode$](){return this[$parent$][$closestNode$]}get[$isRichElement$$1](){return!0}get flags(){return this[$$flags$]||(this[$$flags$]=new Flags(this))}flagSync$(){return this}[$afterVisit$$q](){return this}[$getRenderContext$$3](e){return createRenderContext(this,e)}};register$(Ct,c$0$D,"Fragment",16);let Fragment=Ct,counter=0,c$1$d=Symbol();const Nt=class Nt extends Fragment{constructor(e,r){super(...arguments),this[$$up$$m]=r,this.parentNode=null,this[$domFlags$$2]=e,this.childNodes=[],this[$end$$2]=createComment("slot"+counter++),r&&r[$appendChild$$a](this)}get[$parent$](){return this[$$parent$$2]||this.parentNode||this[$$up$$m]}set textContent(e){this[$textContent$]=e}get textContent(){return this[$textContent$]}hasChildNodes(){for(let e=0,r=iter$__$6(this.childNodes),i=r.length;e<i;e++){let n=r[e];if(isa$$9(n,Fragment)&&n.hasChildNodes())return!0;if(!isa$$9(n,IComment)){if(isa$$9(n,INode))return!0}}return!1}text$(e){return this[$textNode$]?this[$textNode$].textContent=e:this[$textNode$]=this[$placeChild$$j](e),this[$textNode$]}appendChild(e){return this.parentNode&&e[$insertInto$$4](this.parentNode,this[$end$$2]),this.childNodes.push(e)}[$appendChild$$a](e){var r;return this.parentNode?e[$insertInto$$4](this.parentNode,this[$end$$2]):(r=e[$$up$$m])!=null||(e[$$up$$m]=this[$$up$$m]||this),this.childNodes.push(e)}insertBefore(e,r){this.parentNode&&this.parentNode[$insertChild$$2](e,r);let i=this.childNodes.indexOf(r);return i>=0&&this.childNodes.splice(i,0,e),e}[$removeChild$$2](e){this.parentNode&&this.parentNode[$removeChild$$2](e);let r=this.childNodes.indexOf(e);r>=0&&this.childNodes.splice(r,1)}[$replaceChild$](e,r){this.parentNode&&this.parentNode[$replaceChild$](e,r);let i=this.childNodes.indexOf(r);return this.childNodes[i]=e,e}[$insertInto$$4](e,r){if(this.parentNode,this.parentNode!=e&&(this.parentNode=e,!0)){this[$end$$2]&&(r=this[$end$$2][$insertInto$$4](e,r));for(let i=0,n=iter$__$6(this.childNodes),s=n.length;i<s;i++)n[i][$insertInto$$4](e,r)}return this}[$replaceWith$$3](e,r){let i=e[$insertInto$$4](r,this[$end$$2]);return this[$removeFrom$$3](r),i}[$insertChild$$2](e,r){if(this.parentNode&&this.insertBefore(e,r||this[$end$$2]),r){let i=this.childNodes.indexOf(r);i>=0&&this.childNodes.splice(i,0,e)}else this.childNodes.push(e);return e}[$removeFrom$$3](e){for(let r=0,i=iter$__$6(this.childNodes),n=i.length;r<n;r++)i[r][$removeFrom$$3](e);return this[$end$$2]&&this[$end$$2][$removeFrom$$3](e),this.parentNode=null,this}[$placeChild$$j](e,r,i){let n=this.parentNode,s=typeof e;if(s==="undefined"||e===null){if(i&&isa$$9(i,IComment))return i;let a=createComment("");if(i){let l=this.childNodes.indexOf(i);return this.childNodes.splice(l,1,a),n&&i[$replaceWith$$3](a,n),a}return this.childNodes.push(a),n&&a[$insertInto$$4](n,this[$end$$2]),a}if(e===i)return e;if(s!=="object"){let a,l=e;if(i){if(isa$$9(i,IText))return i.textContent=l,i;{a=createTextNode(l);let u=this.childNodes.indexOf(i);return this.childNodes.splice(u,1,a),n&&i[$replaceWith$$3](a,n),a}}else return this.childNodes.push(a=createTextNode(l)),n&&a[$insertInto$$4](n,this[$end$$2]),a}else if(i){let a=this.childNodes.indexOf(i);return this.childNodes.splice(a,1,e),n&&i[$replaceWith$$3](e,n),e}else return this.childNodes.push(e),n&&e[$insertInto$$4](n,this[$end$$2]),e}};register$(Nt,c$1$d,"VirtualFragment",16);let VirtualFragment=Nt;function createSlot(t,e){const r=new VirtualFragment(t,null);return r[$$up$$m]=e,r}let c$2$6=Symbol();var Ne;let ΩNode$1=(Ne=class{[$registerFunctionalSlot$](e){let r=this[$functionalSlots$]||(this[$functionalSlots$]={});return r[e]||(r[e]=createSlot(0,this))}[$getFunctionalSlot$](e,r){let i=this[$functionalSlots$];return i&&i[e]||this[$getSlot$](e,r)}[$getSlot$](e,r){var i;return e=="__"&&!this.render||!this.__slots?this:(i=this.__slots)[e]||(i[e]=createSlot(0,this))}},register$(Ne,c$2$6,"Node",1,INode),Ne);function iter$__$5(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}const $afterVisit$$p=Symbol.for("#afterVisit"),$insertInto$$3=Symbol.for("#insertInto"),$appendChild$$9=Symbol.for("#appendChild"),$replaceWith$$2=Symbol.for("#replaceWith"),$removeFrom$$2=Symbol.for("#removeFrom"),$domFlags$$1=Symbol.for("#domFlags"),$$parent$$1=Symbol.for("##parent"),$end$$1=Symbol.for("#end"),$removeChild$$1=Symbol.for("#removeChild"),$insertChild$$1=Symbol.for("#insertChild");let c$0$C=Symbol();const Lt=class Lt extends Fragment{constructor(e,r){super(...arguments),this[$domFlags$$1]=e,this[$$parent$$1]=r,e&256||(this[$end$$1]=createComment("list")),this.$=this.childNodes,this.length=0,r&&r[$appendChild$$9](this)}hasChildNodes(){return this.length!=0}[$afterVisit$$p](e){let r=this.length;if(this.length=e,r==e)return;let i=this.parentNode;if(!i)return;let n=this.childNodes,s=this[$end$$1];if(r>e)for(;r>e;)i[$removeChild$$1](n[--r]);else if(e>r)for(;e>r;)i[$insertChild$$1](n[r++],s);this.length=e}[$insertInto$$3](e,r){this.parentNode=e,this[$end$$1]&&this[$end$$1][$insertInto$$3](e,r),r=this[$end$$1];for(let i=0,n=iter$__$5(this.childNodes),s=n.length;i<s;i++){let a=n[i];if(i==this.length)break;a[$insertInto$$3](e,r)}return this}[$appendChild$$9](e){}[$replaceWith$$2](e,r){let i=e[$insertInto$$3](r,this[$end$$1]);return this[$removeFrom$$2](r),i}[$removeFrom$$2](e){let r=this.length;for(;r>0;)this.childNodes[--r][$removeFrom$$2](e);this[$end$$1]&&e.removeChild(this[$end$$1]),this.parentNode=null}};register$(Lt,c$0$C,"IndexedTagFragment",16);let IndexedTagFragment=Lt;function createIndexedList(t,e){return new IndexedTagFragment(t,e)}function iter$__$4(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}const $appendChild$$8=Symbol.for("#appendChild"),$insertChild$=Symbol.for("#insertChild"),$replaceWith$$1=Symbol.for("#replaceWith"),$insertInto$$2=Symbol.for("#insertInto"),$removeFrom$$1=Symbol.for("#removeFrom"),$afterVisit$$o=Symbol.for("#afterVisit"),$domFlags$=Symbol.for("#domFlags"),$$parent$=Symbol.for("##parent"),$end$=Symbol.for("#end"),$removeChild$=Symbol.for("#removeChild");let c$0$B=Symbol();const Dt=class Dt extends Fragment{constructor(e,r){super(...arguments),this[$domFlags$]=e,this[$$parent$]=r,this.changes=new Map,this.dirty=!1,this.array=this.childNodes,this.$=new RenderContext(this,Symbol()),e&256||(this[$end$]=createComment("map")),r&&r[$appendChild$$8](this)}[$appendChild$$8](e){if(this.parentNode)return this.parentNode[$insertChild$](e,this[$end$])}hasChildNodes(){return this.childNodes.length!=0}push(e,r){if(!(this[$domFlags$]&1)){this.array.push(e),this[$appendChild$$8](e);return}let i=this.array[r];if(i!==e){this.dirty=!0;let n=this.array.indexOf(e),s=this.changes.get(e);n===-1?(this.array.splice(r,0,e),this.insertChild(e,r,n)):n===r+1?(i&&this.changes.set(i,-1),this.array.splice(r,1)):(n>=0&&this.array.splice(n,1),this.array.splice(r,0,e),this.moveChild(e,r,n)),s==-1&&this.changes.delete(e)}}insertChild(e,r,i){let n=this.parentNode;if(n)if(r>0){let s=this.array[r-1];n[$insertChild$](e,s.nextSibling)}else n[$insertChild$](e,this.childNodes[r+1]||this[$end$])}moveChild(e,r,i){return this.insertChild(e,r,i)}removeChild(e,r){e.parentNode&&e[$removeFrom$$1](e.parentNode)}[$insertChild$](e,r){}[$replaceWith$$1](e,r){let i=e[$insertInto$$2](r,this[$end$]);return this[$removeFrom$$1](r),i}[$insertInto$$2](e,r){this[$$parent$]=e;let i=this.parentNode;if(e!=i){this.parentNode=e;for(let n=0,s=iter$__$4(this.array),a=s.length;n<a;n++)s[n][$insertInto$$2](e,r);this[$end$]&&this[$end$][$insertInto$$2](e,r)}return this}[$removeFrom$$1](e){for(let r=0,i=iter$__$4(this.array),n=i.length;r<n;r++){let s=i[r];e[$removeChild$](s)}return this[$end$]&&e[$removeChild$](this[$end$]),this.parentNode=null}[$afterVisit$$o](e){var r=this;if(!(this[$domFlags$]&1)){this[$domFlags$]|=1;return}if(this.dirty&&(this.changes.forEach(function(i,n){if(i==-1)return r.removeChild(n)}),this.changes.clear(),this.dirty=!1),this.array.length>e)for(;this.array.length>e;){let i=this.array.pop();this.removeChild(i)}}};register$(Dt,c$0$B,"KeyedTagFragment",16);let KeyedTagFragment=Dt;function createKeyedList(t,e){return new KeyedTagFragment(t,e)}function isa$$8(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}const $__init__$$1=Symbol.for("#__init__"),$$inited$=Symbol.for("##inited"),$afterVisit$$n=Symbol.for("#afterVisit"),$beforeReconcile$$p=Symbol.for("#beforeReconcile"),$afterReconcile$$p=Symbol.for("#afterReconcile"),$__hooks__$=Symbol.for("#__hooks__"),$autorender$=Symbol.for("#autorender"),$$visitContext$$2=Symbol.for("##visitContext");let c$0$A=Symbol();var Le;const hydrator=new(Le=class{constructor(e=null){this[$__init__$$1](e)}[$__init__$$1](e=null,r=!0,i=!0){var n;this.items=e&&(n=e.items)!==void 0?n:[],this.current=e&&(n=e.current)!==void 0?n:null,this.lastQueued=e&&(n=e.lastQueued)!==void 0?n:null,this.tests=e&&(n=e.tests)!==void 0?n:0}flush(){let e=null;for(;e=this.items.shift();){if(!e.parentNode||e.hydratedΦ)continue;let r=this.current;this.current=e,e.__F|=1024,e.connectedCallback(),this.current=r}}queue(e){var r=this;let i=this.items.length,n=this.lastQueued;this.lastQueued=e;let s=Node.DOCUMENT_POSITION_PRECEDING,a=Node.DOCUMENT_POSITION_FOLLOWING;if(i){let l=this.items.indexOf(n),u=l,p=function(c,h){return r.tests++,c.compareDocumentPosition(h)};(l==-1||n.nodeName!=e.nodeName)&&(u=l=0);let f=this.items[u];for(;f&&p(f,e)&a;)f=this.items[++u];if(u!=l)f?this.items.splice(u,0,e):this.items.push(e);else{for(;f&&p(f,e)&s;)f=this.items[--u];u!=l&&(f?this.items.splice(u+1,0,e):this.items.unshift(e))}}else this.items.push(e),this.current||globalThis.queueMicrotask(this.flush.bind(this))}},register$(Le,c$0$A,null,16),Le);let c$1$c=Symbol();const Bt=class Bt extends HTMLElement{constructor(){super(),this.flags$ns&&(this.flag$=this.flagExt$),this.setup$(),this.build()}setup$(){return this.__slots={},this.__F=0}[$__init__$$1](){return this.__F|=3,this}[$$inited$](){if(this[$__hooks__$])return this[$__hooks__$].inited(this)}flag$(e){this.className=this.flags$ext=e}build(){return this}awaken(){return this}mount(){return this}unmount(){return this}rendered(){return this}dehydrate(){return this}hydrate(){return this.autoschedule=!0,this}tick(e,r){return this.commit()}visit(){return this.commit()}commit(){return this.renderΦ?(this.__F|=256,this.render&&this.render(),this.rendered(),this.__F=(this.__F|512)&-257&-8193):(this.__F|=8192,this)}get autoschedule(){return(this.__F&64)!=0}set autoschedule(e){e?this.__F|=64:this.__F&=-65}set autorender(e){let r=this[$autorender$]||(this[$autorender$]={});r.value=e,this.mountedΦ&&scheduler.schedule(this,r)}get renderΦ(){return!this.suspendedΦ}get mountingΦ(){return(this.__F&16)!=0}get mountedΦ(){return(this.__F&32)!=0}get awakenedΦ(){return(this.__F&8)!=0}get renderedΦ(){return(this.__F&512)!=0}get suspendedΦ(){return(this.__F&4096)!=0}get renderingΦ(){return(this.__F&256)!=0}get scheduledΦ(){return(this.__F&128)!=0}get hydratedΦ(){return(this.__F&2)!=0}get ssrΦ(){return(this.__F&1024)!=0}get scheduler(){return scheduler}schedule(){return scheduler.on("commit",this),this.__F|=128,this}unschedule(){return scheduler.un("commit",this),this.__F&=-129,this}async suspend(e=null){return this.flags.incr("@suspended"),this.__F|=4096,isa$$8(e,Function)&&(await e(),this.unsuspend()),this}unsuspend(){return this.flags.decr("@suspended")==0&&(this.__F&=-4097,this.commit()),this}[$afterVisit$$n](){if(this.visit(),this[$$visitContext$$2])return this[$$visitContext$$2]=null}[$beforeReconcile$$p](){return this.__F&1024&&(this.__F=this.__F&-1025,this.classList.remove("_ssr_"),this.flags$ext&&this.flags$ext.indexOf("_ssr_")==0&&(this.flags$ext=this.flags$ext.slice(5)),this.__F&512||(this.innerHTML="")),globalThis.DEBUG_IMBA&&renderer.push(this),this[$$visitContext$$2]&&(this[$$visitContext$$2]=null),this}[$afterReconcile$$p](){return globalThis.DEBUG_IMBA&&renderer.pop(this),this}connectedCallback(){let e=this.__F,r=e&1,i=e&8;if(!r&&!(e&1024)){hydrator.queue(this);return}if(e&48)return;this.__F|=16,r||this[$__init__$$1](),e&2||(this.flags$ext=this.className,this.__F|=2,this.hydrate(),this.commit()),i||(this.awaken(),this.__F|=8),emit(this,"mount",[this]);let n=this.mount();return n&&isa$$8(n.then,Function)&&n.then(scheduler.commit),e=this.__F=(this.__F|32)&-17,e&64&&this.schedule(),this[$autorender$]&&scheduler.schedule(this,this[$autorender$]),this}disconnectedCallback(){if(this.__F=this.__F&-49,this.__F&128&&this.unschedule(),emit(this,"unmount",[this]),this.unmount(),this[$autorender$])return scheduler.unschedule(this,this[$autorender$])}};register$(Bt,c$1$c,"Component",16);let Component=Bt;function isa$$7(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}const $__init__$=Symbol.for("#__init__"),VALID_CSS_UNITS={cm:1,mm:1,Q:1,pc:1,pt:1,px:1,em:1,ex:1,ch:1,rem:1,vw:1,vh:1,vmin:1,vmax:1,s:1,ms:1,fr:1,"%":1,in:1,turn:1,grad:1,rad:1,deg:1,Hz:1,kHz:1},CSS_STR_PROPS={prefix:1,suffix:1,content:1},CSS_COLORS={rose:[[356,100,97],[356,100,95],[353,96,90],[353,96,82],[351,95,71],[350,89,60],[347,77,50],[345,83,41],[343,80,35],[342,75,30]],pink:[[327,73,97],[326,78,95],[326,85,90],[327,87,82],[329,86,70],[330,81,60],[333,71,51],[335,78,42],[336,74,35],[336,69,30]],fuchsia:[[289,100,98],[287,100,95],[288,96,91],[291,93,83],[292,91,73],[292,84,61],[293,69,49],[295,72,40],[295,70,33],[297,64,28]],purple:[[270,100,98],[269,100,95],[269,100,92],[269,97,85],[270,95,75],[271,91,65],[271,81,56],[272,72,47],[273,67,39],[274,66,32]],violet:[[250,100,98],[251,91,95],[251,95,92],[252,95,85],[255,92,76],[258,90,66],[262,83,58],[263,70,50],[263,69,42],[264,67,35]],indigo:[[226,100,97],[226,100,94],[228,96,89],[230,94,82],[234,89,74],[239,84,67],[243,75,59],[245,58,51],[244,55,41],[242,47,34]],blue:[[214,100,97],[214,95,93],[213,97,87],[212,96,78],[213,94,68],[217,91,60],[221,83,53],[224,76,48],[226,71,40],[224,64,33]],sky:[[204,100,97],[204,94,94],[201,94,86],[199,95,74],[198,93,60],[199,89,48],[200,98,39],[201,96,32],[201,90,27],[202,80,24]],cyan:[[183,100,96],[185,96,90],[186,94,82],[187,92,69],[188,86,53],[189,94,43],[192,91,36],[193,82,31],[194,70,27],[196,64,24]],teal:[[166,76,97],[167,85,89],[168,84,78],[171,77,64],[172,66,50],[173,80,40],[175,84,32],[175,77,26],[176,69,22],[176,61,19]],emerald:[[152,81,96],[149,80,90],[152,76,80],[156,72,67],[158,64,52],[160,84,39],[161,94,30],[163,94,24],[163,88,20],[164,86,16]],green:[[138,76,97],[141,84,93],[141,79,85],[142,77,73],[142,69,58],[142,71,45],[142,76,36],[142,72,29],[143,64,24],[144,61,20]],lime:[[78,92,95],[80,89,89],[81,88,80],[82,85,67],[83,78,55],[84,81,44],[85,85,35],[86,78,27],[86,69,23],[88,61,20]],yellow:[[55,92,95],[55,97,88],[53,98,77],[50,98,64],[48,96,53],[45,93,47],[41,96,40],[35,92,33],[32,81,29],[28,73,26]],amber:[[48,100,96],[48,96,89],[48,97,77],[46,97,65],[43,96,56],[38,92,50],[32,95,44],[26,90,37],[23,83,31],[22,78,26]],orange:[[33,100,96],[34,100,92],[32,98,83],[31,97,72],[27,96,61],[25,95,53],[21,90,48],[17,88,40],[15,79,34],[15,75,28]],red:[[0,86,97],[0,93,94],[0,96,89],[0,94,82],[0,91,71],[0,84,60],[0,72,51],[0,74,42],[0,70,35],[0,63,31]],warmer:[[60,9,98],[60,5,96],[20,6,90],[24,6,83],[24,5,64],[25,5,45],[33,5,32],[30,6,25],[12,6,15],[24,10,10]],warm:[[0,0,98],[0,0,96],[0,0,90],[0,0,83],[0,0,64],[0,0,45],[0,0,32],[0,0,25],[0,0,15],[0,0,9]],gray:[[0,0,98],[240,5,96],[240,6,90],[240,5,84],[240,5,65],[240,4,46],[240,5,34],[240,5,26],[240,4,16],[240,6,10]],cool:[[210,20,98],[220,14,96],[220,13,91],[216,12,84],[218,11,65],[220,9,46],[215,14,34],[217,19,27],[215,28,17],[221,39,11]],cooler:[[210,40,98],[210,40,96],[214,32,91],[213,27,84],[215,20,65],[215,16,47],[215,19,35],[215,25,27],[217,33,17],[222,47,11]]},CSS_COLORS_REGEX=new RegExp("^("+Object.keys(CSS_COLORS).join("|")+")(\\d+(?:\\.\\d+)?)$"),CSS_PX_PROPS=/^([xyz])$/,CSS_DIM_PROPS=/^([tlbr]|size|[whtlbr]|[mps][tlbrxy]?|[rcxy]?[gs])$/,resets=`*,::before,::after {
box-sizing: border-box;
border-width: 0;
border-style: solid;
border-color: currentColor;
}`;let c$0$z=Symbol();const Ft=class Ft{constructor(e=null){this[$__init__$](e)}[$__init__$](e=null,r=!0,i=!0){var n;this.entries=e&&(n=e.entries)!==void 0?n:{}}register(e,r){let i=this.entries[e];i?i&&(i.css=r,i.node&&(i.node.textContent=r)):(i=this.entries[e]={sourceId:e,css:r},this.entries.resets||this.register("resets",resets),i.node=globalThis.document.createElement("style"),i.node.setAttribute("data-id",e),i.node.textContent=i.css,globalThis.document.head.appendChild(i.node))}toString(){return Object.values(this.entries).map(function(e){return e.css}).join(`

`)}toValue(e,r,i,n=null){let s;CSS_STR_PROPS[i]&&(e=String(e));let a=typeof e;if(a=="number"){if(r||(CSS_PX_PROPS.test(i)?r="px":CSS_DIM_PROPS.test(i)?r="u":i=="rotate"&&(r="turn",e=(e%1).toFixed(4))),r)return VALID_CSS_UNITS[r]?e+r:r=="u"?e*4+"px":"calc(var(--u_"+r+",1px) * "+e+")"}else if(a=="string"){if(i&&CSS_STR_PROPS[i]&&e[0]!='"'&&e[0]!="'"&&(e.indexOf('"')>=0?e.indexOf("'")==-1&&(e="'"+e+"'"):e='"'+e+'"'),s=e.match(CSS_COLORS_REGEX)){let u=CSS_COLORS[s[1]][parseInt(s[2])],p="100%";if(typeof n=="number"?p=n+"%":typeof n=="string"&&(p=n),u)return"hsla("+u[0]+","+u[1]+"%,"+u[2]+"%,"+p+")"}}else if(e&&isa$$7(e.toStyleString,Function))return e.toStyleString();return e}parseDimension(e){if(typeof e=="string"){let[r,i,n]=e.match(/^([-+]?[\d\.]+)(%|\w+)$/);return[parseFloat(i),n]}else if(typeof e=="number")return[e]}};register$(Ft,c$0$z,"Styles",16);let Styles=Ft;const styles=new Styles;function use_styles(){return globalThis.imba.uses_styles=!0,!0}let c$1$b=Symbol();var De;let ΩElement$3=(De=class{css$(e,r,i){return this.style[e]=r}css$var(e,r,i,n,s=null){let a=styles.toValue(r,i,n,s);this.style.setProperty(e,a)}},register$(De,c$1$b,"Element",1,IElement),De);function isa$$6(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}const $insertInto$$1=Symbol.for("#insertInto"),$removeFrom$=Symbol.for("#removeFrom");function mount(t,e,r={}){let i=e||globalThis.document.body,n=t;if(isa$$6(t,Function)){let s=r.tick||(r.tick=function(){let a=r.context||(r.context=new RenderContext(i,null)),l=renderContext.context;renderContext.context=a;let u=t(a,r);return renderContext.context==a&&(renderContext.context=l),r.node!=u&&(r.node&&globalThis.imba.unmount(r.node),u?((r.node=u)[$insertInto$$1](i),u.tick==Component.prototype.tick&&(u.tick=r.tick,u.scheduledΦ),once(u,"unmount",function(){if(r.node==u)return r.node=null,scheduler.unlisten("commit",r.tick)})):(r.node=u,scheduler.unlisten("commit",r.tick))),u});return scheduler.listen("commit",s),s()}else n.__F|=64;return n[$insertInto$$1](i),n}function unmount(t){return t&&t[$removeFrom$]&&t.parentNode&&t[$removeFrom$](t.parentNode),t}let instance=globalThis.imba||(globalThis.imba={});instance.mount=mount;instance.unmount=unmount;function isa$$5(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}function iter$__$3(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}const $$onchange$=Symbol.for("##onchange"),$afterVisit$$m=Symbol.for("#afterVisit"),$$oninput$=Symbol.for("##oninput"),$$onclick$=Symbol.for("##onclick"),$$bound$=Symbol.for("##bound"),$$visitContext$$1=Symbol.for("##visitContext");function use_dom_bind(){return globalThis.imba.uses_dom_bind=!0,!0}const toBind={INPUT:!0,SELECT:!0,TEXTAREA:!0,BUTTON:!0};let isGroup=function(t){return isa$$5(t,Array)||t&&isa$$5(t.has,Function)},bindHas=function(t,e){return t==e?!0:isa$$5(t,Array)?t.indexOf(e)>=0:t&&isa$$5(t.has,Function)?t.has(e):t&&isa$$5(t.contains,Function)?t.contains(e):!1},bindAdd=function(t,e){if(isa$$5(t,Array))return t.push(e);if(t&&isa$$5(t.add,Function))return t.add(e)},bindRemove=function(t,e){if(isa$$5(t,Array)){let r=t.indexOf(e);if(r>=0)return t.splice(r,1)}else if(t&&isa$$5(t.delete,Function))return t.delete(e)};function createProxyProperty(t){function e(){return t[0]?t[0][t[1]]:void 0}function r(i){return t[0]?t[0][t[1]]=i:null}return{get:e,set:r}}let c$0$y=Symbol();var Be;let ΩElement$2=(Be=class{getRichValue(){return this.value}setRichValue(e){return this.value=e}bind$(e,r){let i=r||[];return e=="data"&&!this[$$bound$]&&toBind[this.nodeName]&&(this[$$bound$]=!0,this[$$onchange$]&&this.addEventListener("change",this[$$onchange$]=this[$$onchange$].bind(this)),this[$$oninput$]&&this.addEventListener("input",this[$$oninput$]=this[$$oninput$].bind(this),{capture:!0}),this[$$onclick$]&&this.addEventListener("click",this[$$onclick$]=this[$$onclick$].bind(this),{capture:!0})),Object.defineProperty(this,e,isa$$5(i,Array)?createProxyProperty(i):i),i}},register$(Be,c$0$y,"Element",1,IElement),Be);Object.defineProperty(IElement.prototype,"richValue",{get:function(){return this.getRichValue()},set:function(t){return this.setRichValue(t)}});let c$1$a=Symbol();const qt=class qt{[$$onchange$](e){let r=this.data,i=this.$$value;this.$$value=void 0;let n=this.getRichValue();if(this.multiple){if(i)for(let s=0,a=iter$__$3(i),l=a.length;s<l;s++){let u=a[s];n.indexOf(u)==-1&&bindRemove(r,u)}for(let s=0,a=iter$__$3(n),l=a.length;s<l;s++){let u=a[s];(!i||i.indexOf(u)==-1)&&bindAdd(r,u)}}else this.data=n[0];return commit(),this}getRichValue(){var e;if(this.$$value)return this.$$value;e=[];for(let r=0,i=iter$__$3(this.selectedOptions),n=i.length;r<n;r++){let s=i[r];e.push(s.richValue)}return this.$$value=e}syncValue(){let e=this.data;if(this.multiple){let r=[];for(let i=0,n=iter$__$3(this.options),s=n.length;i<s;i++){let a=n[i],l=a.richValue,u=bindHas(e,l);a.selected=u,u&&r.push(l)}this.$$value=r}else for(let r=0,i=iter$__$3(this.options),n=i.length;r<n;r++){let a=i[r].richValue;if(a==e){this.$$value=[a],this.selectedIndex=r;break}}}[$afterVisit$$m](){if(this.syncValue(),this[$$visitContext$$1])return this[$$visitContext$$1]=null}};register$(qt,c$1$a,"HTMLSelectElement",1,IHTMLSelectElement);let ΩHTMLSelectElement=qt,c$2$5=Symbol();const Ut=class Ut{setRichValue(e){return this.$$value=e,this.value=e}getRichValue(){return this.$$value!==void 0?this.$$value:this.value}};register$(Ut,c$2$5,"HTMLOptionElement",1,IHTMLOptionElement);let ΩHTMLOptionElement=Ut,c$3$2=Symbol();const Gt=class Gt{setRichValue(e){return this.$$value=e,this.value=e}getRichValue(){return this.$$value!==void 0?this.$$value:this.value}[$$oninput$](e){return this.data=this.value,commit()}[$afterVisit$$m](){let e=this.data;if(e==null&&(e=""),this[$$bound$]&&this.value!=e&&(this.value=e),this[$$visitContext$$1])return this[$$visitContext$$1]=null}};register$(Gt,c$3$2,"HTMLTextAreaElement",1,IHTMLTextAreaElement);let ΩHTMLTextAreaElement=Gt,c$4$2=Symbol();const zt=class zt{[$$oninput$](e){let r=this.type;if(!(r=="checkbox"||r=="radio")&&!(r=="number"&&Number.isNaN(this.valueAsNumber)))return this.$$value=void 0,this.data=this.richValue,commit()}[$$onchange$](e){let r=this.data,i=this.richValue;if(this.type=="checkbox"||this.type=="radio"){let n=this.checked;isGroup(r)?n?bindAdd(r,i):bindRemove(r,i):this.data=n?i:!1}return commit()}setRichValue(e){this.$$value!==e&&(this.$$value=e,this.value!==e&&(this.value=e))}getRichValue(){if(this.$$value!==void 0)return this.$$value;let e=this.value,r=this.type;if(r=="range"||r=="number"){let i=this.valueAsNumber;Number.isNaN(i)&&(i=Number(e.replace(/\,/,".")+0)),Number.isNaN(i)&&(i=null),e=i}else r=="checkbox"&&(e==null||e==="on")&&(e=!0);return e}[$afterVisit$$m](){if(this[$$bound$]){let e=this.type;if(e=="checkbox"||e=="radio"){let r=this.data;r===!0||r===!1||r==null?this.checked=!!r:this.checked=bindHas(r,this.richValue)}else this.richValue=this.data}this[$$visitContext$$1]&&(this[$$visitContext$$1]=null)}};register$(zt,c$4$2,"HTMLInputElement",1,IHTMLInputElement);let ΩHTMLInputElement=zt,c$5$1=Symbol();const Ht=class Ht{get checked(){return this.$checked}set checked(e){e!=this.$checked&&(this.$checked=e,this.flags.toggle("checked",!!e))}setRichValue(e){return this.$$value=e,this.value=e}getRichValue(){return this.$$value!==void 0?this.$$value:this.value}[$$onclick$](e){let r=this.data,i=this.checked,n=this.richValue;return isGroup(r)?i?bindRemove(r,n):bindAdd(r,n):this.$$value==null?this.data=!i:this.data=i?null:n,this[$afterVisit$$m](),commit()}[$afterVisit$$m](){if(this[$$bound$]){let e=this.data,r=this.$$value==null?!0:this.$$value;isGroup(e)?this.checked=bindHas(e,r):this.checked=e==r}this[$$visitContext$$1]&&(this[$$visitContext$$1]=null)}};register$(Ht,c$5$1,"HTMLButtonElement",1,IHTMLButtonElement);let ΩHTMLButtonElement=Ht;function use_events_keyboard(){return globalThis.imba.uses_events_keyboard=!0,!0}let c$0$x=Symbol();const Vt=class Vt{αesc(){return this.keyCode==27}αtab(){return this.keyCode==9}αenter(){return this.keyCode==13}αspace(){return this.keyCode==32}αup(){return this.keyCode==38}αdown(){return this.keyCode==40}αleft(){return this.keyCode==37}αright(){return this.keyCode==39}αdel(){return this.keyCode==8||this.keyCode==46}αkey(e){if(typeof e=="string")return this.key==e;if(typeof e=="number")return this.keyCode==e}αshift(){return!!this.shiftKey}αalt(){return!!this.altKey}αctrl(){return!!this.ctrlKey}αmeta(){return!!this.metaKey}αmod(){let e=globalThis.navigator.platform;return/^(Mac|iPhone|iPad|iPod)/.test(e||"")?!!this.metaKey:!!this.ctrlKey}};register$(Vt,c$0$x,"KeyboardEvent",1,IKeyboardEvent);let ΩKeyboardEvent=Vt;function use_events_mouse(){return globalThis.imba.uses_events_mouse=!0,!0}let c$0$w=Symbol();const jt=class jt{αleft(){return this.button==0}αmiddle(){return this.button==1}αright(){return this.button==2}αshift(){return!!this.shiftKey}αalt(){return!!this.altKey}αctrl(){return!!this.ctrlKey}αmeta(){return!!this.metaKey}αmod(){let e=globalThis.navigator.platform;return/^(Mac|iPhone|iPad|iPod)/.test(e||"")?!!this.metaKey:!!this.ctrlKey}};register$(jt,c$0$w,"MouseEvent",1,IMouseEvent);let ΩMouseEvent=jt;function isa$$4(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}function iter$__$2(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}const $extendType$=Symbol.for("#extendType"),$modifierState$=Symbol.for("#modifierState"),$sharedModifierState$=Symbol.for("#sharedModifierState"),$onceHandlerEnd$=Symbol.for("#onceHandlerEnd"),$extendDescriptors$=Symbol.for("#extendDescriptors"),$context$$1=Symbol.for("#context"),$defaultPrevented$=Symbol.for("#defaultPrevented"),$stopPropagation$=Symbol.for("#stopPropagation"),$self$=Symbol.for("#self"),$target$=Symbol.for("#target"),$teleport$=Symbol.for("#teleport");use_events_keyboard();use_events_mouse();let c$0$v=Symbol();const Wt=class Wt{[$extendType$](e){var r,i;let n=e[$extendDescriptors$]||(e[$extendDescriptors$]=(r=Object.getOwnPropertyDescriptors(e.prototype),i=r.constructor,delete r.constructor,r));return Object.defineProperties(this,n)}};register$(Wt,c$0$v,"CustomEvent",1,CustomEvent);let ΩCustomEvent=Wt,c$1$9=Symbol();const Yt=class Yt{get original(){return this.originalEvent||this}get[$modifierState$](){var e,r;return(e=this[$context$$1])[r=this[$context$$1].step]||(e[r]={})}get[$sharedModifierState$](){var e,r;return(e=this[$context$$1].handler)[r=this[$context$$1].step]||(e[r]={})}[$onceHandlerEnd$](e){return once(this[$context$$1],"end",e)}αsel(e){return!!this.target.matches(String(e))}αclosest(e){return!!this.target.closest(String(e))}αprevent(){return this[$defaultPrevented$]=!0,this.preventDefault(),!0}αtrap(){return this[$stopPropagation$]=!0,this.stopImmediatePropagation(),this[$defaultPrevented$]=!0,this.preventDefault(),!0}αfocin(e){var i;let r=this[$context$$1].element;return r=isa$$4(e,Element)?e:e?r.closest(e):r,(i=r==null?void 0:r.contains)==null?void 0:i.call(r,globalThis.document.activeElement)}αlog(...e){return console.info(...e),!0}αtrusted(){return!!this.isTrusted}αuntrusted(){return!this.isTrusted}αif(e){return!!e}αwait(e=250){return new Promise(function(r){return setTimeout(r,parseTime(e))})}αself(){return this.target==this[$context$$1].element}αcooldown(e=250){let r=this[$sharedModifierState$];return r.active?!1:(r.active=!0,r.target=this[$context$$1].element,r.target.flags.incr("cooldown"),this[$onceHandlerEnd$](function(){return setTimeout(function(){return r.target.flags.decr("cooldown"),r.active=!1},parseTime(e))}),!0)}αthrottle(e=250,r="throttled"){let i=this[$sharedModifierState$];return i.active?(i.next&&i.next(!1),new Promise(function(n){return i.next=function(s){return i.next=null,n(s)}})):(i.active=!0,i.el||(i.el=this[$context$$1].element),r&&i.el.flags.incr(r),once(this[$context$$1],"end",function(){let n=parseTime(e);return i.interval=setInterval(function(){i.next?i.next(!0):(clearInterval(i.interval),r&&i.el.flags.decr(r),i.active=!1)},n)}),!0)}αdebounce(e=250){let r=this[$sharedModifierState$],i=this;return r.queue||(r.queue=[]),r.queue.push(r.last=i),new Promise(function(n){return setTimeout(function(){return r.last==i?(i.debounced=r.queue,r.last=null,r.queue=[],n(!0)):n(!1)},parseTime(e))})}αflag(e,r){const{element:i,step:n,state:s,id:a,current:l}=this[$context$$1];let u=isa$$4(r,Element)?r:r?i.closest(r):i;if(!u)return!0;this[$context$$1].commit=!0,s[n]=a,u.flags.incr(e);let p=Date.now();return once(l,"end",function(){let f=Date.now()-p,c=Math.max(250-f,0);return setTimeout(function(){return u.flags.decr(e)},c)}),!0}αbusy(e){return this.αflag("busy",e)}αoutside(){const{handler:e}=this[$context$$1];if(e&&e[$self$])return!e[$self$].parentNode.contains(this.target)}async αpost(e,r={}){return await globalThis.fetch(e,{method:"POST",...r})}async αfetch(e,r={}){return await globalThis.fetch(e,r)}};register$(Yt,c$1$9,"Event",1,Event);let ΩEvent=Yt,c$2$4=Symbol();const Xt=class Xt{αself(){let e=this[$context$$1].element;return this.type=="focusout"?this.relatedTarget&&!e.contains(this.relatedTarget):this.type=="focusin"?!this.relatedTarget||!e.contains(this.relatedTarget):this.target==e}};register$(Xt,c$2$4,"FocusEvent",1,FocusEvent);let ΩFocusEvent=Xt;function use_events(){return globalThis.imba.uses_events=!0,!0}let c$3$1=Symbol();const Kt=class Kt{constructor(e,r){this.params=e,this.closure=r}getHandlerForMethod(e,r){return e?e[r]?e:this.getHandlerForMethod(e.parentNode,r):null}abortCurrentHandlers(){var e;if(this.currentEvents)for(let r of iter$__$2(this.currentEvents))r.aborted=!0,(e=r==null?void 0:r.resolver)==null||e.call(r,!0);return this}emit(e,...r){return emit(this,e,r)}on(e,...r){return listen(this,e,...r)}once(e,...r){return once(this,e,...r)}un(e,...r){return unlisten(this,e,...r)}get passiveΦ(){return this.params.passive}get captureΦ(){return this.params.capture}get silentΦ(){return this.params.silent}get globalΦ(){return this.params.global}async handleEvent(e){if(this.disabled)return;let r=this[$target$]||e.currentTarget,i=this.params,n=null,s=i.silence||i.silent;this.count||(this.count=0),this.state||(this.state={});let a=this.lastState={element:r,event:e,modifiers:i,handler:this,id:++this.count,step:-1,state:this.state,commit:null,called:!1,current:null,aborted:!1};if(a.current=a,e.handle$mod&&e.handle$mod.apply(a,i.options||[])==!1)return;let l=Event[this.type+"$handle"]||Event[e.type+"$handle"]||this.guard;if(!(l&&l.apply(a,i.options||[])==!1)){this.currentEvents||(this.currentEvents=new Set),this.currentEvents.add(a);for(let u=0,p=Object.keys(i),f=p.length,c,h;u<f&&(c=p[u],h=i[c],!a.aborted);u++){if(a.step++,c[0]=="_")continue;c.indexOf("~")>0&&(c=c.split("~")[0]);let d=null,m=[e,a],_,g=null,b,x=!1;if(c[0]=="$"&&c[1]=="_"&&isa$$4(h[0],Function))e[$context$$1]=a,c=h[0],a.called=!0,c.passive||(a.commit=!0),m=[e,a].concat(h.slice(1)),g=r;else if(isa$$4(h,Array)){m=h.slice(),d=m;for(let S=0,T=iter$__$2(m),I=T.length;S<I;S++){let O=T[S];if(typeof O=="string"&&O[0]=="~"&&O[1]=="$"){let P=O.slice(2).split("."),C=a[P.shift()]||e;for(let G=0,B=iter$__$2(P),H=B.length;G<H;G++){let ee=B[G];C=C?C[ee]:void 0}m[S]=C}}}if(typeof c=="string"&&(b=c.match(/^(emit|flag|mod|moved|pin|fit|refit|map|remap|css)-(.+)$/))&&(d||(d=m=[]),m.unshift(b[2]),c=b[1]),c=="trap")e[$stopPropagation$]=!0,e.stopImmediatePropagation(),e[$defaultPrevented$]=!0,e.preventDefault();else if(c=="stop")e[$stopPropagation$]=!0,e.stopImmediatePropagation();else if(c=="prevent")e[$defaultPrevented$]=!0,e.preventDefault();else if(c=="commit")a.commit=!0;else if(c=="once")r.removeEventListener(e.type,this);else{if(c=="options"||c=="silence"||c=="silent")continue;if(c=="emit"){let S=m[0],T=m[1];a.called=!0;let I=new CustomEvent(S,{bubbles:!0,detail:T});I.originalEvent=e,(this[$teleport$]||r).dispatchEvent(I)}else if(typeof c=="string"){c[0]=="!"&&(x=!0,c=c.slice(1));let S="α"+c,T=e[S];T||(T=this.type&&Event[this.type+"$"+c+"$mod"]),T||(T=e[c+"$mod"]||Event[e.type+"$"+c]||Event[c+"$mod"]),isa$$4(T,Function)?(c=T,g=a,m=d||[],e[S]&&(g=e,e[$context$$1]=a)):c[0]=="_"?(c=c.slice(1),g=this.closure):g=this.getHandlerForMethod(r,c)}}try{isa$$4(c,Function)?_=c.apply(g||r,m):g&&(_=g[c].apply(g,m)),_&&isa$$4(_.then,Function)&&_!=scheduler.$promise&&(a.commit&&!s&&scheduler.commit(),_=await _)}catch(S){n=S;break}if(x&&_===!0||!x&&_===!1)break;a.value=_}if(emit(a,"end",a),a.commit&&!s&&scheduler.commit(),this.currentEvents.delete(a),this.currentEvents.size==0&&this.emit("idle"),n!=null){if(this.type!="error"){let u=isa$$4(n,Error)?n.message:n,p=new CustomEvent("error",{detail:u,bubbles:!0,cancelable:!0});if(p.error=n,p.originalEvent=e,r.dispatchEvent(p),p.defaultPrevented)return}throw n}return a}}};register$(Kt,c$3$1,"EventHandler",16);let EventHandler=Kt,c$4$1=Symbol();var Fe;let ΩElement$1=(Fe=class{on$(e,r,i){let n="on$"+e,s=r.capture||!1,a=r.passive,l,u=s;return a&&(u={passive:a,capture:s}),isa$$4(this[n],Function)?(this[n].length>2&&(l=new EventHandler(r,i)),l=this[n](r,i,l,u)):(l=new EventHandler(r,i),this.addEventListener(e,l,u)),l}on$error(e,r,i,n){var s;return(s=e.options)!=null&&s.length&&(i.guard=function(...a){let l=this.event.error;return!!a.find(function(p){return isa$$4(l,p)})}),this.addEventListener("error",i,n),i}},register$(Fe,c$4$1,"Element",1,Element),Fe);var R=typeof Reflect=="object"?Reflect:null,ReflectApply=R&&typeof R.apply=="function"?R.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},ReflectOwnKeys;R&&typeof R.ownKeys=="function"?ReflectOwnKeys=R.ownKeys:Object.getOwnPropertySymbols?ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:ReflectOwnKeys=function(e){return Object.getOwnPropertyNames(e)};function ProcessEmitWarning(t){console&&console.warn&&console.warn(t)}var NumberIsNaN=Number.isNaN||function(e){return e!==e};function EventEmitter(){EventEmitter.init.call(this)}EventEmitter.EventEmitter=EventEmitter;EventEmitter.prototype._events=void 0;EventEmitter.prototype._eventsCount=0;EventEmitter.prototype._maxListeners=void 0;var defaultMaxListeners=10;function checkListener(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(EventEmitter,"defaultMaxListeners",{enumerable:!0,get:function(){return defaultMaxListeners},set:function(t){if(typeof t!="number"||t<0||NumberIsNaN(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");defaultMaxListeners=t}});EventEmitter.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0};EventEmitter.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||NumberIsNaN(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _getMaxListeners(t){return t._maxListeners===void 0?EventEmitter.defaultMaxListeners:t._maxListeners}EventEmitter.prototype.getMaxListeners=function(){return _getMaxListeners(this)};EventEmitter.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var l=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw l.context=a,l}var u=s[e];if(u===void 0)return!1;if(typeof u=="function")ReflectApply(u,this,r);else for(var p=u.length,f=arrayClone(u,p),i=0;i<p;++i)ReflectApply(f[i],this,r);return!0};function _addListener(t,e,r,i){var n,s,a;if(checkListener(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),a=s[e]),a===void 0)a=s[e]=r,++t._eventsCount;else if(typeof a=="function"?a=s[e]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),n=_getMaxListeners(t),n>0&&a.length>n&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=t,l.type=e,l.count=a.length,ProcessEmitWarning(l)}return t}EventEmitter.prototype.addListener=function(e,r){return _addListener(this,e,r,!1)};EventEmitter.prototype.on=EventEmitter.prototype.addListener;EventEmitter.prototype.prependListener=function(e,r){return _addListener(this,e,r,!0)};function onceWrapper(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function _onceWrap(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=onceWrapper.bind(i);return n.listener=r,i.wrapFn=n,n}EventEmitter.prototype.once=function(e,r){return checkListener(r),this.on(e,_onceWrap(this,e,r)),this};EventEmitter.prototype.prependOnceListener=function(e,r){return checkListener(r),this.prependListener(e,_onceWrap(this,e,r)),this};EventEmitter.prototype.removeListener=function(e,r){var i,n,s,a,l;if(checkListener(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,a=i.length-1;a>=0;a--)if(i[a]===r||i[a].listener===r){l=i[a].listener,s=a;break}if(s<0)return this;s===0?i.shift():spliceOne(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,l||r)}return this};EventEmitter.prototype.off=EventEmitter.prototype.removeListener;EventEmitter.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),a;for(n=0;n<s.length;++n)a=s[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function _listeners(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?unwrapListeners(n):arrayClone(n,n.length)}EventEmitter.prototype.listeners=function(e){return _listeners(this,e,!0)};EventEmitter.prototype.rawListeners=function(e){return _listeners(this,e,!1)};EventEmitter.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):listenerCount.call(t,e)};EventEmitter.prototype.listenerCount=listenerCount;function listenerCount(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?ReflectOwnKeys(this._events):[]};function arrayClone(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function spliceOne(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function unwrapListeners(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function isa$$3(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}const $getQueryParam$=Symbol.for("#getQueryParam"),$setQueryParam$=Symbol.for("#setQueryParam"),$query$=Symbol.for("#query");let c$0$u=Symbol();const ke=class ke{static parse(e,r){return isa$$3(e,ke)?e:new ke(e,r)}constructor(e,r){this.router=r,this.parse(e)}parse(e){var i;let r;return isa$$3(e,URL)||(e=new URL(e,this.router.origin)),(r=(i=this.router)==null?void 0:i.aliases[e.pathname])&&(e.pathname=r),this.url=e,this}get activeΦ(){return this.router.location==this}reparse(){return this.parse(this.url)}get searchParams(){return this.url.searchParams}search(){let e=this.searchParams?this.searchParams.toString():"";return e?"?"+e:""}update(e){if(isa$$3(e,Object))for(let r=0,i=Object.keys(e),n=i.length,s,a;r<n;r++)s=i[r],a=e[s],this.searchParams.set(s,a);else typeof e=="string"&&this.parse(e);return this}clone(){return new ke(this.url.href,this.router)}equals(e){return this.toString()==String(e)}get href(){return this.url.href}get path(){return this.url.href.slice(this.url.origin.length)}get pathname(){return this.url.pathname}get query(){return this[$query$]||(this[$query$]=new Proxy({},{get:this[$getQueryParam$].bind(this),set:this[$setQueryParam$].bind(this)}))}toString(){return this.href}[$getQueryParam$](e,r){return this.searchParams.get(r)}[$setQueryParam$](e,r,i){var s;let n=(s=this[$getQueryParam$](e,r))!=null?s:"";return i=i!=null?i:"",n!=i&&(i==null||i==""?this.searchParams.delete(r):this.searchParams.set(r,i),this.activeΦ&&(this.router.history.replaceState({},null,this.path),this.router.touch())),!0}};register$(ke,c$0$u,"Location",16);let Location=ke;function isa$$2(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}function iter$__$1(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}function storetarget(){return function(){return!0}}let c$0$t=Symbol();const Me=class Me{constructor(e,r=""){this.store=e||{},this.cache={raw:{},rich:{}},this.ns=r,this.local=e==globalThis.sessionStorage,this.children=new Map}serialize(e,r){return JSON.stringify(e)}deserialize(e,r){return JSON.parse(e)}getItem(e){let r=String(this.ns)+":"+e;if(isa$$2(this.store,Me))return this.store.getItem(r);if(this.local&&this.cache.rich[r]!=null)return this.cache.rich[r];let i=this.store.getItem(r);if(i!=null)return this.cache.raw[r]==i?this.cache.rich[r]:(this.cache.raw[r]=i,this.cache.rich[r]=this.deserialize(i,r))}setItem(e,r){let i=String(this.ns)+":"+e;if(isa$$2(this.store,Me))return this.store.setItem(i,r);let n=this.cache.rich[i],s=typeof r;if(this.local&&(this.cache.rich[i]=r),n!==r||s=="object"){let a=this.store.getItem(i);if(r==null)return this.store.removeItem(i),this.cache.rich[i],delete this.cache.rich[i],this.cache.raw[i],delete this.cache.raw[i],commit();{let l=this.serialize(r,i);if(this.cache.rich[i]=r,this.cache.raw[i]=l,a!=l)return this.store.setItem(i,l),commit()}}}removeItem(e){let r=String(this.ns)+":"+e;return this.cache[r],delete this.cache[r],this.store.removeItem(r)}get(e,r,i){return this.getItem(r)}set(e,r,i,n){return this.setItem(r,i),!0}apply(e,r,[i]){let n=this.children.get(i);return n||this.children.set(i,n=new Proxy(storetarget(),new Me(this,i))),n}deleteProperty(e,r){return this.removeItem(r),!0}ownKeys(e){let r=["prototype"],i=this.ns+":";for(let n=0,s=iter$__$1(Object.keys(this.store)),a=s.length;n<a;n++){let l=s[n];l.indexOf(i)==0&&r.push(l.slice(i.length))}return r}};register$(Me,c$0$t,"Storage",16);let Storage=Me;new Proxy(storetarget(),new Storage(globalThis.localStorage));const session=new Proxy(storetarget(),new Storage(globalThis.sessionStorage));function isa$$1(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}const $states$=Symbol.for("#states"),map$2=new WeakMap;let c$0$s=Symbol();const Qt=class Qt{static from(e,r){return r?new this(e,r):null}constructor(e,r,i=!1){map$2.set(this,e),this.path=r.path,this.data=r.data||{},this.index=r.index,this.type=r.type,this.local=i}get history(){return map$2.get(this)}get next(){return this.history.at(this.index+1)}get prev(){return this.history.at(this.index-1)}toJSON(){return{path:this.path,data:this.data,index:this.index,type:this.type}}save(){return this.history.cache[this.index]=this,this}toString(){return""+this.history.id+"|"+this.index}};register$(Qt,c$0$s,"State",16);let State=Qt,c$1$8=Symbol();const Zt=class Zt{constructor(e){this.router=e,this.store=session("router"),this[$states$]=[],this.cache={},this.index=-1;let r=globalThis.history.state;if(typeof r=="string"){let i=r.split("|");this.id=parseInt(i[0]),this.index=parseInt(i[1]),this.cache=this.store(this.id)}else this.id=this.store.id=(this.store.id||0)+1,this.cache=this.store(this.id);this.index==-1&&this.replaceState({initial:!0},null,e.path)}get length(){return this.cache.length}get state(){return this.at(this.index)}get states(){let e=this.length,r=0;for(;r<e;)this.at(r++);return this[$states$]}get currentStates(){return this.states.slice(0,this.length)}get next(){return this.state.next}get prev(){return this.state.prev}slice(e,r=this.length){let i=[];for(;e<r;)i.push(this.at(e++));return i}at(e){var r;if(!(e>=this.length))return(r=this[$states$])[e]||(r[e]=State.from(this,this.cache[e]))}buildState(e,r,i=!0){let n={data:e,index:this.index+1,path:r||this.router.path,type:i?"push":"replace"};return new State(this,n,!0)}pushState(e,r,i,n=!0){return isa$$1(e,State)||(e=this.buildState(e,i,n)),this.index=e.index,this.cache[this.index]=e,this[$states$][this.index]=e,this[$states$].length=this.cache.length=Math.max(e.index+1,0),globalThis.history[n?"pushState":"replaceState"](String(e),r||null,e.path),this}replaceState(e,r,i){return this.pushState(e,r,i,!1)}};register$(Zt,c$1$8,"History",16);let History=Zt,c$0$r=Symbol();const Jt=class Jt{constructor(e,r,i,n){this.params=n,this.router=e,r&&(this.location=Location.parse(r),this.original=this.location.clone()),this.referrer=i}get apply(){return this.params.apply||[]}get revert(){return this.params.revert||[]}get state(){return this.params.state}get mode(){return this.params.mode}redirect(e){var r,i;return(i=(r=this.location)==null?void 0:r.update)==null||i.call(r,e),this}get path(){var e;return(e=this.location)==null?void 0:e.path}get url(){var e,r;return(r=(e=this.location)==null?void 0:e.toString)==null?void 0:r.call(e)}set path(e){this.location.path=e}abort(e=!1){return this.aborted=!0,e&&(this.forceAbort=e),this}match(e){return this.location?this.router.route(e).match(this.path):null}};register$(Jt,c$0$r,"Request",16);let Request=Jt;function iter$__(t){let e;return t&&((e=t.toIterable)?e.call(t):t)}const $routes$$1=Symbol.for("#routes"),$match$$1=Symbol.for("#match"),$symbol$=Symbol.for("#symbol"),$matches$=Symbol.for("#matches"),cacheMap=new Map,urlCache={},queryCache={},anyRegex=/.*/;function cacheForMatch(t){if(!cacheMap.has(t)){let e=new Map;return cacheMap.set(t,e),e}return cacheMap.get(t)}function combinedDeepMatch(t,e){let r=cacheForMatch(t);if(!r.has(e)){let i=Object.create(t);return Object.assign(i,e),r.set(e,i),i}return r.get(e)}let c$0$q=Symbol();const er=class er{};register$(er,c$0$q,"Match",0);let Match=er;function parseUrl(t){if(urlCache[t])return urlCache[t];let e=urlCache[t]={url:t},r=t.indexOf("?"),i=t.indexOf("#");if(i>=0&&(e.hash=t.slice(i+1),t=e.url=t.slice(0,i)),r>=0){let n=e.query=t.slice(r+1);t=t.slice(0,r),e.query=queryCache[n]||(queryCache[n]=new URLSearchParams(n))}return e.path=t,e}let c$1$7=Symbol();const tr=class tr{constructor(e){this.router=e,this.fullPath="",this[$routes$$1]={},this[$match$$1]=new Match,this[$match$$1].path=""}route(e){var r;return(r=this[$routes$$1])[e]||(r[e]=new Route(this.router,e,this))}match(){return this[$match$$1]}resolve(e){return"/"}};register$(tr,c$1$7,"RootRoute",16);let RootRoute=tr,c$2$3=Symbol();const Ge=class Ge{constructor(e,r,i){this.parent=i||e.rootRoute,this.router=e,this.status=200,this.path=r,this[$symbol$]=Symbol(),this[$matches$]={},this[$routes$$1]={}}route(e){var r;return(r=this[$routes$$1])[e]||(r[e]=new Ge(this.router,e,this))}get fullPath(){return""+this.parent.fullPath+"/"+this.$path}load(e){return this.router.queue.add(e)}set path(e){var r=this;if(this.$path==e)return;if(this.raw=e,this.$path=e,this.groups=[],this.cache={},this.dynamic=!1,e.indexOf("?")>=0){let n=e.split("?");e=n.shift(),this.query={};for(let s=0,a=iter$__(n.join("?").split("&")),l=a.length;s<l;s++){let u=a[s];if(!u)continue;let[p,f]=u.split("=");p[0]=="!"&&(this.dynamic=!0,p=p.slice(1),f=!1),f===""&&(f=!1),f&&f[0]==":"&&(this.dynamic=!0),this.query[p]=f||f!==!1}}if(e=e.replace(/\:(\w+|\*)(\.)?/g,function(n,s,a){r.dynamic=!0,s!="*"&&r.groups.push(s);let l=r.router.matchers[s]||(a?"([^/#.?]+)":"([^/#?]+)");return a?""+l+".":l}),e==""&&this.query)return;if(e=="*")return this.regex=anyRegex,this;e="^"+e;let i=e[e.length-1];(i=="$"||i=="/")&&(e=e.slice(0,-1)+"(?=/?[#?]|/?$)"),i!="/"&&i!="$"&&e!="^/"&&(e=e+"(?=[/#?]|$)"),this.regex=new RegExp(e)}match(e=this.router.path){var l,u,p;let r,i=this.parent.match(e);if(!i)return null;let n=parseUrl(e),s=n.url,a="";if(i.path&&n.path.indexOf(i.path)==0&&(a=i.path+"/",s=s.slice(a.length)),r=this.regex?s.match(this.regex):[""]){let f=a+r[0],c=[this.$path],h={};if(this.groups.length)for(let _=0,g=iter$__(r),b=g.length,x;_<b;_++){let S=g[_];(x=this.groups[_-1])&&(h[x]=S,c.push(S))}if(this.query)for(let _=this.query,g=0,b=Object.keys(_),x=b.length,S,T;g<x;g++){S=b[g],T=_[S];let I=S,O=(u=(l=n.query)==null?void 0:l.get)==null?void 0:u.call(l,S);if(T===!1){if(O)return null;c.push("1");continue}if(T[0]==":"&&(I=T.slice(1),T=!0),T==!0&&O||T==O)h[I]=O,c.push(O);else return null}let d=c.join("*");h=(p=this[$matches$])[d]||(p[d]=h);let m=combinedDeepMatch(i,h);return m.path=f,m}return null}resolve(e=this.router.path){if(this.raw[0]=="/"&&!this.dynamic)return this.raw.replace(/\$/g,"");this.parent.match(e);let r=this.parent.resolve(e),i;if(this.dynamic){let n=this.match(e);return n?n.path:null}return this.raw[0]=="?"?i=(r||"/")+this.raw:i=r+"/"+this.raw,i.replace(/\$/g,"").replace(/\/\/+/g,"/")}};register$(Ge,c$2$3,"Route",16);let Route=Ge;function isa$(t,e){var r;return typeof e=="string"?typeof t===e:(r=e[Symbol.hasInstance])==null?void 0:r.call(e,t)}const $enter$=Symbol.for("#enter"),$resolved$=Symbol.for("#resolved"),$leave$=Symbol.for("#leave"),$afterVisitRouted$=Symbol.for("#afterVisitRouted"),$afterVisitRouteTo$=Symbol.for("#afterVisitRouteTo"),$doc$=Symbol.for("#doc"),$version$=Symbol.for("#version"),$routes$=Symbol.for("#routes"),$origin$=Symbol.for("#origin"),$request$=Symbol.for("#request"),$hash$=Symbol.for("#hash"),$routeTo$=Symbol.for("#routeTo"),$path$=Symbol.for("#path"),$match$=Symbol.for("#match"),$options$=Symbol.for("#options"),$cache$=Symbol.for("#cache"),$unmatched$=Symbol.for("#unmatched"),$active$=Symbol.for("#active"),$resolvedPath$=Symbol.for("#resolvedPath"),$dataKey$=Symbol.for("#dataKey"),$activeKey$=Symbol.for("#activeKey"),$urlKey$=Symbol.for("#urlKey"),$dataMap$=Symbol.for("#dataMap"),$href$=Symbol.for("#href"),$route$=Symbol.for("#route"),$context$=Symbol.for("#context"),$afterVisit$$l=Symbol.for("#afterVisit"),$routeHandler$=Symbol.for("#routeHandler"),$parentNode$=Symbol.for("#parentNode"),$visitContext$=Symbol.for("#visitContext"),$$visitContext$=Symbol.for("##visitContext"),$attachToParent$=Symbol.for("#attachToParent"),$detachFromParent$=Symbol.for("#detachFromParent"),$router$=Symbol.for("#router");function use_router(){return globalThis.imba.use_router=!0,!0}proxy(function(){return globalThis.document.router});let c$0$p=Symbol();var qe;let Router$1=(qe=class extends EventEmitter{constructor(e,r={}){super(),this[$doc$]=e,this[$version$]=0,this[$routes$]={},this.aliases={},this.redirects={},this.rules={},this.matchers={},this.options=r,this.busy=[],this.queue=new Queue,this.root=new RootRoute(this),this.location=new Location(r.url||e.location.href,this),this.history=new History(this),this.mode=r.mode||"history",this.queue.on("busy",function(){return globalThis.document.flags.incr("_routing_")}),this.queue.on("idle",function(){return globalThis.document.flags.decr("_routing_"),commit()}),this.setup()}get origin(){return this[$origin$]||(this[$origin$]=this[$doc$].location.origin)}get query(){return this.location.query}init(){return this.refresh({mode:"replace"}),this}alias(e,r){return this.aliases[e]=r,this.location.reparse(),this}touch(){return this[$version$]++}option(e,r){return r==null?this.options[e]:(this.options[e]=r,this)}get realpath(){let e=this[$doc$].location;return e.href.slice(e.origin.length)}get state(){return this.history.state}get states(){return this.history.currentStates}set state(e){this.state.data=e,this.state.save()}get ctx(){return this[$request$]}pushState(e,r,i){return this.history.pushState(e,r||null,String(i))}replaceState(e,r,i){return this.history.replaceState(e,r||null,String(i))}refresh(e={}){var r=this;if(this.refreshing)return;this.refreshing=!0;let i=this.location,n=Location.parse(e.location||this.realpath,this),s=e.mode,a=this[$request$];if(!n.equals(i)||!a||e.state){let l=new Request(this,n,i,e);this[$request$]=l,this.emit("beforechange",l),l.aborted&&(!l.forceAbort&&globalThis.window.confirm("Are you sure you want to leave? You might have unsaved changes")?l.aborted=!1:s=="pop"?this.pushState(this.state,null,String(i)):s=="replace"&&this.replaceState(this.state,null,String(i))),l.aborted||(this.location=l.location,s=="push"?this.pushState(l.state,null,String(this.location)):s=="replace"?this.replaceState(l.state,null,String(this.location)):s=="pop"&&(this.history.index=e.index),this.refreshing=!1,this.emit("change",l),this.touch(),commit())}return scheduler.add(function(){let l=r[$doc$].location.hash;if(l!=r[$hash$])return r.emit("hashchange",r[$hash$]=l)}),this.refreshing=!1,this}onpopstate(e){let r=this.history.index,i=r,n={pop:!0,index:0,from:r,mode:"pop"};try{if(typeof e.state=="string"){let[s,a]=e.state.split("|");i=n.index=parseInt(a),i<r?n.revert=this.history.slice(i+1,r+1).reverse():i>r&&(n.apply=this.history.slice(r+1,i+1))}}catch{}return this.refresh(n),this}onbeforeunload(e){let r=new Request(this,null,this.location,{mode:"unload"});if(this.emit("beforechange",r),r.aborted)return!0}onhashchange(e){return this.emit("hashchange",this[$hash$]=this[$doc$].location.hash),commit()}setup(){this.onclick=this.onclick.bind(this),this.onhashchange=this.onhashchange.bind(this);let e=globalThis.window;return this[$hash$]=this[$doc$].location.hash,this.location=Location.parse(this.realpath,this),e.onpopstate=this.onpopstate.bind(this),e.onbeforeunload=this.onbeforeunload.bind(this),e.addEventListener("hashchange",this.onhashchange),e.addEventListener("click",this.onclick,{capture:!0}),e.document.documentElement.emit("routerinit",this),this.refresh,this}onclick(e){if(e.metaKey||e.altKey)return;let r=null,i=null,n=e.target;for(;n&&(!r||!i);)!r&&n.nodeName=="A"&&(r=n),!i&&n[$routeTo$]&&(i=n),n=n.parentNode;if(r&&i!=r&&(!i||i.contains(r))){let s=r.getAttribute("href");s&&!s.match(/\:\/\//)&&(!r.getAttribute("target")||r.getAttribute("target")=="_self")&&!r.classList.contains("external")&&r.addEventListener("click",this.onclicklink.bind(this),{once:!0})}return!0}onclicklink(e){let r=e.currentTarget||e.target;r[$routeTo$]&&r[$routeTo$].resolve(),r.getAttribute("href");let i=new URL(r.href),n=i.href.slice(i.origin.length),s=this.realpath.split("#")[0],a=n.split("#")[0];return s==a?globalThis.document.location.hash=i.hash:r[$routeTo$]?r[$routeTo$].go():this.go(n),e.stopPropagation(),e.preventDefault()}get url(){return this.location.url}get path(){let e=this.location.path;return this.aliases[e]||e}get pathname(){return this.location.pathname}serializeParams(e){var r;if(isa$(e,Object)){r=[];for(let n=0,s=Object.keys(e),a=s.length,l,u;n<a;n++)l=s[n],u=e[l],r.push([l,globalThis.encodeURI(u)].join("="));return r.join("&")}return e||""}get hash(){return this[$hash$]}set hash(e){let r="#"+this.serializeParams(e);globalThis.history.replaceState(this.state,null,r)}match(e){return this.route(e).match(this.path)}route(e){return this.root.route(e)}go(e,r=null){if(typeof e=="object"&&r===null&&(r=e,e=this.path),typeof e=="number")return globalThis.history.go(e),this;let i=this.location.clone().update(e),n=this.history.buildState(r,i.path,!0);return this.refresh({push:!0,mode:"push",location:i,state:n,apply:[n]}),this}replace(e,r=null){typeof e=="object"&&r===null&&(r=e,e=this.path);let i=this.location.clone().update(e),n=this.history.buildState(r,i.path,!1);return this.refresh({replace:!0,mode:"replace",location:i,state:n,apply:[n]})}},register$(qe,c$0$p,"Router",16),qe),c$1$6=Symbol();const rr=class rr{constructor(e,r,i,n={}){this.parent=i,this.node=e,this[$path$]=r,this[$match$]=null,this[$options$]=n,this[$cache$]={},this[$unmatched$]={},this[$active$]=null,this[$resolvedPath$]=null,this[$dataKey$]=Symbol(),this[$activeKey$]=Symbol(),this[$urlKey$]=Symbol()}get router(){return this.node.ownerDocument.router}get route(){return(this.parent?this.parent.route:this.router).route(this[$path$])}get match(){return this[$match$]}get params(){return this[$match$]||this[$unmatched$]}get state(){this[$dataMap$]||(this[$dataMap$]=new Map);let e=this.params,r=this[$dataMap$].get(e);return r||this[$dataMap$].set(e,r={}),r}set state(e){(this[$dataMap$]||(this[$dataMap$]=new Map)).set(this.params,e)}set path(e){this[$path$]!=e&&(this[$path$]=e,!0)&&this.router.touch()}get path(){return this[$path$]}get isActive(){return!!this[$active$]}get activeΦ(){return!!this[$active$]}resolve(){let e=this.router[$version$];if(!(this[$version$]!=e&&(this[$version$]=e,!0)))return;let r=this.route;this[$options$];let i=this.router.path,n=r.match(i),s=this[$active$],a=this[$match$],l=n!=a,u=n&&n[this[$urlKey$]];return n&&(this[$active$]=!0,this[$match$]=n,n[this[$urlKey$]]=i),n&&(l||u!=i||!s)&&this[$resolved$](n,a,u),!s&&n&&this[$enter$](),!n&&(s||s===null)&&(this[$active$]=!1,this[$leave$]()),this[$match$]}[$enter$](){var e,r;return this.node.flags.remove("not-routed"),this.node.flags.add("routed"),(r=(e=this.node)==null?void 0:e.routeDidEnter)==null?void 0:r.call(e,this)}[$resolved$](e,r,i=""){var n,s;return(s=(n=this.node)==null?void 0:n.routeDidResolve)==null?void 0:s.call(n,this,e,r,i)}[$leave$](){var e,r;return this.node.flags.add("not-routed"),this.node.flags.remove("routed"),(r=(e=this.node)==null?void 0:e.routeDidLeave)==null?void 0:r.call(e,this)}};register$(rr,c$1$6,"ElementRoute",16);let ElementRoute=rr,c$2$2=Symbol();const ir=class ir extends ElementRoute{[$enter$](){return this}[$resolved$](){return this}[$leave$](){return this}resolve(){let e=this.router[$version$];if(!(this[$version$]!=e&&(this[$version$]=e,!0)))return;let r=this[$options$];this.route;let i=this.router.path,n=this.route.resolve(i),s=this.route.match(i);s&&(this[$match$]=s,this[$match$][this[$urlKey$]]=i),r.sticky&&this[$match$]&&(n=this[$match$][this[$urlKey$]]),this[$href$]!=n&&(this[$href$]=n,!0)&&this.node.nodeName=="A"&&this.node.setAttribute("href",n),this.node.flags.toggle("active",!!s)}get url(){return this.resolve(),globalThis.location.origin+this[$href$]}go(){return this.resolve(),this[$options$]&&this[$options$].replace?this.router.replace(this[$href$]):this.router.path==this[$href$]?!0:this.router.go(this[$href$])}};register$(ir,c$2$2,"ElementRouteTo",0);let ElementRouteTo=ir,c$3=Symbol();const nr=class nr{get router(){return this.ownerDocument.router}};register$(nr,c$3,"Node",1,Node);let ΩNode=nr,c$4=Symbol();const sr=class sr{set route(e){if(e==null)return;if(this[$route$]){this[$route$].path=e;return}let r=e[0]!="/"?this[$context$].route:null;this[$route$]=new ElementRoute(this,e,r,this.route__),this[$afterVisit$$l]=this[$afterVisitRouted$]}get route(){return this[$route$]}set routeΞto(e){var r=this;if(e==null)return;if(this[$routeTo$]){this[$routeTo$].path=e;return}let i=e[0]!="/"?this[$context$].route:null;this[$route$]=this[$routeTo$]=new ElementRouteTo(this,e,i,this.routeTo__),this[$afterVisit$$l]=this[$afterVisitRouteTo$],this.onclick=function(n){if(!n.altKey&&!n.metaKey&&!n[$routeHandler$])return n.preventDefault(),n[$routeHandler$]=r[$routeTo$],r[$routeTo$].go()}}[$afterVisitRouted$](){if(this[$route$]){let e=this[$parentNode$],r=e&&e[$visitContext$];if(r&&r.matchedRoute&&r.matchedRoute!=this[$route$]){this[$route$][$active$]!=!1&&(this[$route$][$active$]=!1,!0)&&(this[$route$][$leave$](),this[$route$][$version$]=-1);return}if(this[$route$].resolve(),this[$route$].activeΦ)r.matchedRoute=this[$route$];else return}if(this.visit&&this.visit(),this[$$visitContext$])return this[$$visitContext$]=null}[$afterVisitRouteTo$](){if(this[$routeTo$]&&this[$routeTo$].resolve(),this.visit)return this.visit()}routeDidEnter(e){return this[$attachToParent$]()}routeDidLeave(e){return this[$detachFromParent$]()}routeDidResolve(e,r,i){var n=this;isa$(this.routed,Function)&&r!=i&&this.router.queue.add(async function(){return n.suspend(),await n.routed(r,e.state,i),n.unsuspend()})}};register$(sr,c$4,"Element",1,Element);let ΩElement=sr,c$5=Symbol();const or=class or{get router(){return this[$router$]||(this[$router$]=new Router$1(this))}};register$(or,c$5,"Document",1,Document);let ΩDocument=or;use_styles();const $beforeReconcile$$o=Symbol.for("#beforeReconcile"),$placeChild$$i=Symbol.for("#placeChild"),$afterReconcile$$o=Symbol.for("#afterReconcile"),$$up$$l=Symbol.for("##up"),$afterVisit$$k=Symbol.for("#afterVisit");var $4$e=Symbol(),$7$7=Symbol(),$10$8=Symbol(),$13$7=Symbol(),$17$9=Symbol(),$22$b=Symbol(),$24$6=Symbol(),$25$7=Symbol(),$27$6=Symbol(),$28$5=Symbol(),$38$6=Symbol();let c$0$o=Symbol();const ze=class ze extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.value=e&&(n=e.value)!==void 0?n:0}tileColor(e){switch(e){case 0:return"#ccc";case 2:return"#eee4da";case 4:return"#ede0c8";case 8:return"#f2b179";case 16:return"#f59563";case 32:return"#f67c5f";case 64:return"#f65e3b";case 128:return"#edcf72";case 256:return"#edcc61";case 512:return"#edc850";case 1024:return"#edc53f";case 2048:return"#edc22e";default:return"#3c3a32"}}render(){var e,r,i,n=this._ns_||"",s,a;return r=this,r[$beforeReconcile$$o](),i=1,r[$4$e]===1||(i=0,r[$4$e]=1),(s=r[$7$7])||(r[$7$7]=s=createElement("div",r,`z1nx76lu-ag ${n}`,null)),a=this.tileColor(this.value),a===r[$10$8]||s.css$var("--z1nx76lu_ah",r[$10$8]=a,null,"bg"),e=null,this.value>0&&(e=this.value),r[$13$7]=s[$placeChild$$i](e,0,r[$13$7]),r[$afterReconcile$$o](i),r}};register$(ze,c$0$o,"tile",2),defineTag("tile",ze,{});let TileComponent=ze,c$1$5=Symbol();const He=class He extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.size=e&&(n=e.size)!==void 0?n:4,this.grid=e&&(n=e.grid)!==void 0?n:[],this.score=e&&(n=e.score)!==void 0?n:0,this.gameOver=e&&(n=e.gameOver)!==void 0?n:!1}setup(){var e=this;return this.grid=Array(this.size).fill(0).map(function(){return Array(e.size).fill(0)}),this.addRandomTile(),this.addRandomTile(),globalThis.document.addEventListener("keyup",function(r){return e.handleKey(r)})}addRandomTile(){let e=[];for(let n=this.size,s=0,a=n-s;a>0?s<n:s>n;a>0?s++:s--)for(let l=this.size,u=0,p=l-u;p>0?u<l:u>l;p>0?u++:u--)this.grid[s][u]==0&&e.push([s,u]);if(e.length==0)return;let[r,i]=e[Math.floor(Math.random()*e.length)];return this.grid[r][i]=Math.random()<.95?2:4}slide(e){let r=e.filter(function(i){return i!=0});for(let i=r.length-1,n=0,s=i-n;s>0?n<i:n>i;s>0?n++:n--)r[n]==r[n+1]&&r[n]&&(r[n]*=2,this.score+=r[n],r[n+1]=0);for(r=r.filter(function(i){return i!=0});r.length<this.size;)r.push(0);return r}moveLeft(){let e=!1;for(let r=this.size,i=0,n=r-i;n>0?i<r:i>r;n>0?i++:i--){let s=this.slide(this.grid[i]);JSON.stringify(s)!=JSON.stringify(this.grid[i])&&(this.grid[i]=s,e=!0)}if(e&&(this.addRandomTile(),this.isGameOver()))return this.gameOver=!0}moveRight(){let e=!1;for(let r=this.size,i=0,n=r-i;n>0?i<r:i>r;n>0?i++:i--){let s=this.grid[i].slice().reverse(),a=this.slide(s).reverse();JSON.stringify(a)!=JSON.stringify(this.grid[i])&&(this.grid[i]=a,e=!0)}if(e&&(this.addRandomTile(),this.isGameOver()))return this.gameOver=!0}moveUp(){let e=!1;for(let r=this.size,i=0,n=r-i;n>0?i<r:i>r;n>0?i++:i--){let s=[];for(let l=this.size,u=0,p=l-u;p>0?u<l:u>l;p>0?u++:u--)s.push(this.grid[u][i]);let a=this.slide(s);for(let l=this.size,u=0,p=l-u;p>0?u<l:u>l;p>0?u++:u--)this.grid[u][i]!=a[u]&&(this.grid[u][i]=a[u],e=!0)}if(e&&(this.addRandomTile(),this.isGameOver()))return this.gameOver=!0}moveDown(){let e=!1;for(let r=this.size,i=0,n=r-i;n>0?i<r:i>r;n>0?i++:i--){let s=[];for(let u=this.size,p=0,f=u-p;f>0?p<u:p>u;f>0?p++:p--)s.push(this.grid[p][i]);let a=s.slice().reverse(),l=this.slide(a).reverse();for(let u=this.size,p=0,f=u-p;f>0?p<u:p>u;f>0?p++:p--)this.grid[p][i]!=l[p]&&(this.grid[p][i]=l[p],e=!0)}if(e&&(this.addRandomTile(),this.isGameOver()))return this.gameOver=!0}isGameOver(){var e=this;for(let r=this.size,i=0,n=r-i;n>0?i<r:i>r;n>0?i++:i--)for(let s=this.size,a=0,l=s-a;l>0?a<s:a>s;l>0?a++:a--)if(this.grid[i][a]==0||a<this.size-1&&this.grid[i][a]==this.grid[i][a+1]||i<this.size-1&&this.grid[i][a]==this.grid[i+1][a])return!1;return setTimeout(function(){return window.alert("Game Over! Your final score is "+e.score)},1e3),!0}handleKey(e){if(!this.gameOver){switch(e.key){case"ArrowLeft":{this.moveLeft();break}case"ArrowRight":{this.moveRight();break}case"ArrowUp":{this.moveUp();break}case"ArrowDown":{this.moveDown();break}}return commit()}}render(){var e,r,i,n=this._ns_||"",s,a,l,u,p,f,c,h,d,m,_,g,b,x;e=this,e[$beforeReconcile$$o](),r=i=1,e[$17$9]===1||(r=i=0,e[$17$9]=1),r||(s=createElement("div",e,`z1nx76lu-aj ${n}`,null)),r||createElement("div",s,`z1nx76lu-ak ${n}`,"2048 Game"),(a=e[$22$b])||(e[$22$b]=a=createElement("div",s,`z1nx76lu-al ${n}`,null)),r||a[$placeChild$$i]("Score: "),l=this.score,l===e[$25$7]&&r||(e[$24$6]=a[$placeChild$$i](e[$25$7]=l,256,e[$24$6])),(u=e[$27$6])||(e[$27$6]=u=createElement("div",s,`z1nx76lu-am grid ${n}`,null)),(p=e[$28$5])||(e[$28$5]=p=createIndexedList(2432,u)),f=0,c=p.$;for(let S=this.size,T=0,I=S-T;I>0?T<S:T>S;I>0?T++:T--){(h=c[f])||(c[f]=h=createIndexedList(0,p)),d=0,m=h.$;for(let O=this.size,L=0,P=O-L;P>0?L<O:L>O;P>0?L++:L--)g=b=1,(_=m[d])||(g=b=0,m[d]=_=createComponent("tile",h,`${n}`)),g||(_[$$up$$l]=h),x=this.grid[T][L],x===_[$38$6]||(_.value=_[$38$6]=x),g||!_.setup||_.setup(b),_[$afterVisit$$k](b),d++;h[$afterVisit$$k](d),f++}return p[$afterVisit$$k](f),e[$afterReconcile$$o](i),e}};register$(He,c$1$5,"Game2048",2),defineTag("game2048-z1nx76lu-ao",He,{});let Game2048=He;use_styles();const $beforeReconcile$$n=Symbol.for("#beforeReconcile"),$$up$$k=Symbol.for("##up"),$afterVisit$$j=Symbol.for("#afterVisit"),$afterReconcile$$n=Symbol.for("#afterReconcile");var $4$d=Symbol(),$7$6=Symbol(),$10$7=Symbol(),$13$6=Symbol(),$16$4=Symbol(),$19$c=Symbol(),$22$a=Symbol(),$25$6=Symbol(),$27$5=Symbol(),$34$7=Symbol(),$36$2=Symbol(),$37$7=Symbol();let c$0$n=Symbol();const Ve=class Ve extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.time=e&&(n=e.time)!==void 0?n:new Date}setup(){var e=this;return setInterval(function(){return e.time=new Date,commit()},10)}getRotation(e){switch(e){case"second":return this.time.getSeconds()*6+this.time.getMilliseconds()*.006;case"minute":return this.time.getMinutes()*6+this.time.getSeconds()*.1;case"hour":return this.time.getHours()%12*30+this.time.getMinutes()*.5}}render(){var e,r,i,n=this._ns_||"",s,a,l,u,p,f,c,h,d,m,_,g,b;e=this,e[$beforeReconcile$$n](),r=i=1,e[$4$d]===1||(r=i=0,e[$4$d]=1),(s=e[$7$6])||(e[$7$6]=s=createElement("div",e,`z1jg8vov-ah ${n}`,null)),r||createElement("div",s,`z1jg8vov-ai ${n}`,null),(a=e[$10$7])||(e[$10$7]=a=createElement("div",s,`z1jg8vov-aj ${n}`,null)),l=this.getRotation("hour"),l===e[$13$6]||a.css$var("--z1jg8vov_ak",e[$13$6]=l,"deg","transform"),(u=e[$16$4])||(e[$16$4]=u=createElement("div",s,`z1jg8vov-al ${n}`,null)),p=this.getRotation("minute"),p===e[$19$c]||u.css$var("--z1jg8vov_am",e[$19$c]=p,"deg","transform"),(f=e[$22$a])||(e[$22$a]=f=createElement("div",s,`z1jg8vov-an ${n}`,null)),c=this.getRotation("second"),c===e[$25$6]||f.css$var("--z1jg8vov_ao",e[$25$6]=c,"deg","transform"),(h=e[$27$5])||(e[$27$5]=h=createIndexedList(256,s)),d=0,m=h.$;for(let x=1;x<=12;x++)g=1,(_=m[d])||(g=0,m[d]=_=createElement("div",h,`z1jg8vov-ap ${n}`,null)),g||(_[$$up$$k]=h),b=x*30,b===_[$34$7]||_.css$var("--z1jg8vov_aq",_[$34$7]=b,"deg","transform"),b=-x*30,b===_[$36$2]||_.css$var("--z1jg8vov_ar",_[$36$2]=b,"deg","transform"),b=x,b===_[$37$7]||_.text$(String(_[$37$7]=b)),d++;return h[$afterVisit$$j](d),e[$afterReconcile$$n](i),e}};register$(Ve,c$0$n,"AnalogClock",2),defineTag("analog-clock-z1jg8vov-as",Ve,{cssid:"z1jg8vov-af"});let AnalogClock=Ve;use_styles();const $beforeReconcile$$m=Symbol.for("#beforeReconcile"),$$up$$j=Symbol.for("##up"),$afterVisit$$i=Symbol.for("#afterVisit"),$afterReconcile$$m=Symbol.for("#afterReconcile"),$appendChild$$7=Symbol.for("#appendChild");var $4$c=Symbol(),$7$5=Symbol(),$10$6=Symbol(),$12$4=Symbol(),$19$b=Symbol(),$21$5=Symbol(),$22$9=Symbol(),$23$3=Symbol(),$28$4=Symbol(),$30$4=Symbol(),$34$6=Symbol(),$37$6=Symbol(),$40$4=Symbol(),$43$7=Symbol(),$46$2=Symbol(),$49$3=Symbol(),$52$2=Symbol();let c$0$m=Symbol();const je=class je extends Component{[__init__$](e=null,r=!0,i=!0){super[__init__$](...arguments),this.time=e?e.time:void 0,this.unit=e?e.unit:void 0,this.factor=e?e.factor:void 0}getRotation(){switch(this.unit){case"second":return this.time.getSeconds()*6+this.time.getMilliseconds()*.006;case"minute":return this.time.getMinutes()*6+this.time.getSeconds()*.1;case"hour":return this.time.getHours()%12*30+this.time.getMinutes()*.5}}getLimit(){return this.unit=="hour"?12:60}render(){var e,r,i,n=this._ns_||"",s,a,l,u,p,f,c,h,d,m,_;e=this,e[$beforeReconcile$$m](),r=i=1,e[$4$c]===1||(r=i=0,e[$4$c]=1),(s=e[$7$5])||(e[$7$5]=s=createElement("div",e,`eyv8h8-ah ${n}`,null)),a=-this.getRotation(),a===e[$10$6]||s.css$var("--eyv8h8_ai",e[$10$6]=a,"deg","transform"),(l=e[$12$4])||(e[$12$4]=l=createIndexedList(384,s)),u=0,p=l.$;for(let g=this.getLimit(),b=1,x=g-b;x>0?b<=g:b>=g;x>0?b++:b--)c=1,(f=p[u])||(c=0,p[u]=f=createElement("div",l,`eyv8h8-aj ${n}`,null)),c||(f[$$up$$j]=l),h=b*this.factor,h===f[$19$b]||f.css$var("--eyv8h8_ak",f[$19$b]=h,"deg","transform"),h=-b*this.factor,h===f[$21$5]||f.css$var("--eyv8h8_al",f[$21$5]=h,"deg","transform"),h=this.unit=="hour"?20:10,h===f[$22$9]||f.css$var("--eyv8h8_am",f[$22$9]=h,"px","fs"),h=b,h===f[$23$3]||f.text$(String(f[$23$3]=h)),u++;return l[$afterVisit$$i](u),r||createElement("div",e,`eyv8h8-an ${n}`,null),r||createElement("div",e,`eyv8h8-ao ${n}`,null),r||(d=createElement("div",e,`text ${n}`,null)),(m=e[$28$4])||(e[$28$4]=m=createElement("div",d,`eyv8h8-aq ${n}`,null)),_=this.unit.toUpperCase(),_===e[$30$4]||m.text$(String(e[$30$4]=_)),e[$afterReconcile$$m](i),e}};register$(je,c$0$m,"mini-clock",2),defineTag("mini-clock",je,{cssns:"eyv8h8_af",cssid:"eyv8h8-af"});let MiniClockComponent=je,c$1$4=Symbol();const We=class We extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.time=e&&(n=e.time)!==void 0?n:new Date}setup(){var e=this;return setInterval(function(){return e.time=new Date,commit()},10)}render(){var e,r,i,n=this._ns_||"",s,a,l,u,p,f,c,h,d,m,_,g;return e=this,e[$beforeReconcile$$m](),r=i=1,e[$34$6]===1||(r=i=0,e[$34$6]=1),(!r||i&2)&&e.flagSelf$("eyv8h8-as"),a=l=1,(s=e[$37$6])||(a=l=0,e[$37$6]=s=createComponent("mini-clock",e,`${n}`)),u=this.time,u===e[$40$4]||(s.time=e[$40$4]=u),a||(s.unit="hour"),a||(s.factor=30),a||!s.setup||s.setup(l),s[$afterVisit$$i](l),a||e[$appendChild$$7](s),f=c=1,(p=e[$43$7])||(f=c=0,e[$43$7]=p=createComponent("mini-clock",e,`${n}`)),h=this.time,h===e[$46$2]||(p.time=e[$46$2]=h),f||(p.unit="minute"),f||(p.factor=6),f||!p.setup||p.setup(c),p[$afterVisit$$i](c),f||e[$appendChild$$7](p),m=_=1,(d=e[$49$3])||(m=_=0,e[$49$3]=d=createComponent("mini-clock",e,`${n}`)),g=this.time,g===e[$52$2]||(d.time=e[$52$2]=g),m||(d.unit="second"),m||(d.factor=6),m||!d.setup||d.setup(_),d[$afterVisit$$i](_),m||e[$appendChild$$7](d),e[$afterReconcile$$m](i),e}};register$(We,c$1$4,"AnalogClocks",2),defineTag("analog-clocks-eyv8h8-aw",We,{cssid:"eyv8h8-ar"});let AnalogClocks=We;var INUMBER="INUMBER",IOP1="IOP1",IOP2="IOP2",IOP3="IOP3",IVAR="IVAR",IVARNAME="IVARNAME",IFUNCALL="IFUNCALL",IFUNDEF="IFUNDEF",IEXPR="IEXPR",IEXPREVAL="IEXPREVAL",IMEMBER="IMEMBER",IENDSTATEMENT="IENDSTATEMENT",IARRAY="IARRAY";function Instruction(t,e){this.type=t,this.value=e!=null?e:0}Instruction.prototype.toString=function(){switch(this.type){case INUMBER:case IOP1:case IOP2:case IOP3:case IVAR:case IVARNAME:case IENDSTATEMENT:return this.value;case IFUNCALL:return"CALL "+this.value;case IFUNDEF:return"DEF "+this.value;case IARRAY:return"ARRAY "+this.value;case IMEMBER:return"."+this.value;default:return"Invalid Instruction"}};function unaryInstruction(t){return new Instruction(IOP1,t)}function binaryInstruction(t){return new Instruction(IOP2,t)}function ternaryInstruction(t){return new Instruction(IOP3,t)}function simplify(t,e,r,i,n){for(var s=[],a=[],l,u,p,f,c=0;c<t.length;c++){var h=t[c],d=h.type;if(d===INUMBER||d===IVARNAME)Array.isArray(h.value)?s.push.apply(s,simplify(h.value.map(function(m){return new Instruction(INUMBER,m)}).concat(new Instruction(IARRAY,h.value.length)),e,r,i,n)):s.push(h);else if(d===IVAR&&n.hasOwnProperty(h.value))h=new Instruction(INUMBER,n[h.value]),s.push(h);else if(d===IOP2&&s.length>1)u=s.pop(),l=s.pop(),f=r[h.value],h=new Instruction(INUMBER,f(l.value,u.value)),s.push(h);else if(d===IOP3&&s.length>2)p=s.pop(),u=s.pop(),l=s.pop(),h.value==="?"?s.push(l.value?u.value:p.value):(f=i[h.value],h=new Instruction(INUMBER,f(l.value,u.value,p.value)),s.push(h));else if(d===IOP1&&s.length>0)l=s.pop(),f=e[h.value],h=new Instruction(INUMBER,f(l.value)),s.push(h);else if(d===IEXPR){for(;s.length>0;)a.push(s.shift());a.push(new Instruction(IEXPR,simplify(h.value,e,r,i,n)))}else if(d===IMEMBER&&s.length>0)l=s.pop(),s.push(new Instruction(INUMBER,l.value[h.value]));else{for(;s.length>0;)a.push(s.shift());a.push(h)}}for(;s.length>0;)a.push(s.shift());return a}function substitute(t,e,r){for(var i=[],n=0;n<t.length;n++){var s=t[n],a=s.type;if(a===IVAR&&s.value===e)for(var l=0;l<r.tokens.length;l++){var u=r.tokens[l],p;u.type===IOP1?p=unaryInstruction(u.value):u.type===IOP2?p=binaryInstruction(u.value):u.type===IOP3?p=ternaryInstruction(u.value):p=new Instruction(u.type,u.value),i.push(p)}else a===IEXPR?i.push(new Instruction(IEXPR,substitute(s.value,e,r))):i.push(s)}return i}function evaluate(t,e,r){var i=[],n,s,a,l,u,p;if(isExpressionEvaluator(t))return resolveExpression(t,r);for(var f=t.length,c=0;c<f;c++){var h=t[c],d=h.type;if(d===INUMBER||d===IVARNAME)i.push(h.value);else if(d===IOP2)s=i.pop(),n=i.pop(),h.value==="and"?i.push(n?!!evaluate(s,e,r):!1):h.value==="or"?i.push(n?!0:!!evaluate(s,e,r)):h.value==="="?(l=e.binaryOps[h.value],i.push(l(n,evaluate(s,e,r),r))):(l=e.binaryOps[h.value],i.push(l(resolveExpression(n,r),resolveExpression(s,r))));else if(d===IOP3)a=i.pop(),s=i.pop(),n=i.pop(),h.value==="?"?i.push(evaluate(n?s:a,e,r)):(l=e.ternaryOps[h.value],i.push(l(resolveExpression(n,r),resolveExpression(s,r),resolveExpression(a,r))));else if(d===IVAR)if(h.value in e.functions)i.push(e.functions[h.value]);else if(h.value in e.unaryOps&&e.parser.isOperatorEnabled(h.value))i.push(e.unaryOps[h.value]);else{var m=r[h.value];if(m!==void 0)i.push(m);else throw new Error("undefined variable: "+h.value)}else if(d===IOP1)n=i.pop(),l=e.unaryOps[h.value],i.push(l(resolveExpression(n,r)));else if(d===IFUNCALL){for(p=h.value,u=[];p-- >0;)u.unshift(resolveExpression(i.pop(),r));if(l=i.pop(),l.apply&&l.call)i.push(l.apply(void 0,u));else throw new Error(l+" is not a function")}else if(d===IFUNDEF)i.push(function(){for(var _=i.pop(),g=[],b=h.value;b-- >0;)g.unshift(i.pop());var x=i.pop(),S=function(){for(var T=Object.assign({},r),I=0,O=g.length;I<O;I++)T[g[I]]=arguments[I];return evaluate(_,e,T)};return Object.defineProperty(S,"name",{value:x,writable:!1}),r[x]=S,S}());else if(d===IEXPR)i.push(createExpressionEvaluator(h,e));else if(d===IEXPREVAL)i.push(h);else if(d===IMEMBER)n=i.pop(),i.push(n[h.value]);else if(d===IENDSTATEMENT)i.pop();else if(d===IARRAY){for(p=h.value,u=[];p-- >0;)u.unshift(i.pop());i.push(u)}else throw new Error("invalid Expression")}if(i.length>1)throw new Error("invalid Expression (parity)");return i[0]===0?0:resolveExpression(i[0],r)}function createExpressionEvaluator(t,e,r){return isExpressionEvaluator(t)?t:{type:IEXPREVAL,value:function(i){return evaluate(t.value,e,i)}}}function isExpressionEvaluator(t){return t&&t.type===IEXPREVAL}function resolveExpression(t,e){return isExpressionEvaluator(t)?t.value(e):t}function expressionToString(t,e){for(var r=[],i,n,s,a,l,u,p=0;p<t.length;p++){var f=t[p],c=f.type;if(c===INUMBER)typeof f.value=="number"&&f.value<0?r.push("("+f.value+")"):Array.isArray(f.value)?r.push("["+f.value.map(escapeValue).join(", ")+"]"):r.push(escapeValue(f.value));else if(c===IOP2)n=r.pop(),i=r.pop(),a=f.value,e?a==="^"?r.push("Math.pow("+i+", "+n+")"):a==="and"?r.push("(!!"+i+" && !!"+n+")"):a==="or"?r.push("(!!"+i+" || !!"+n+")"):a==="||"?r.push("(function(a,b){ return Array.isArray(a) && Array.isArray(b) ? a.concat(b) : String(a) + String(b); }(("+i+"),("+n+")))"):a==="=="?r.push("("+i+" === "+n+")"):a==="!="?r.push("("+i+" !== "+n+")"):a==="["?r.push(i+"[("+n+") | 0]"):r.push("("+i+" "+a+" "+n+")"):a==="["?r.push(i+"["+n+"]"):r.push("("+i+" "+a+" "+n+")");else if(c===IOP3)if(s=r.pop(),n=r.pop(),i=r.pop(),a=f.value,a==="?")r.push("("+i+" ? "+n+" : "+s+")");else throw new Error("invalid Expression");else if(c===IVAR||c===IVARNAME)r.push(f.value);else if(c===IOP1)i=r.pop(),a=f.value,a==="-"||a==="+"?r.push("("+a+i+")"):e?a==="not"?r.push("(!"+i+")"):a==="!"?r.push("fac("+i+")"):r.push(a+"("+i+")"):a==="!"?r.push("("+i+"!)"):r.push("("+a+" "+i+")");else if(c===IFUNCALL){for(u=f.value,l=[];u-- >0;)l.unshift(r.pop());a=r.pop(),r.push(a+"("+l.join(", ")+")")}else if(c===IFUNDEF){for(n=r.pop(),u=f.value,l=[];u-- >0;)l.unshift(r.pop());i=r.pop(),e?r.push("("+i+" = function("+l.join(", ")+") { return "+n+" })"):r.push("("+i+"("+l.join(", ")+") = "+n+")")}else if(c===IMEMBER)i=r.pop(),r.push(i+"."+f.value);else if(c===IARRAY){for(u=f.value,l=[];u-- >0;)l.unshift(r.pop());r.push("["+l.join(", ")+"]")}else if(c===IEXPR)r.push("("+expressionToString(f.value,e)+")");else if(c!==IENDSTATEMENT)throw new Error("invalid Expression")}return r.length>1&&(e?r=[r.join(",")]:r=[r.join(";")]),String(r[0])}function escapeValue(t){return typeof t=="string"?JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029"):t}function contains(t,e){for(var r=0;r<t.length;r++)if(t[r]===e)return!0;return!1}function getSymbols(t,e,r){r=r||{};for(var i=!!r.withMembers,n=null,s=0;s<t.length;s++){var a=t[s];a.type===IVAR||a.type===IVARNAME?!i&&!contains(e,a.value)?e.push(a.value):(n!==null&&(contains(e,n)||e.push(n)),n=a.value):a.type===IMEMBER&&i&&n!==null?n+="."+a.value:a.type===IEXPR?getSymbols(a.value,e,r):n!==null&&(contains(e,n)||e.push(n),n=null)}n!==null&&!contains(e,n)&&e.push(n)}function Expression(t,e){this.tokens=t,this.parser=e,this.unaryOps=e.unaryOps,this.binaryOps=e.binaryOps,this.ternaryOps=e.ternaryOps,this.functions=e.functions}Expression.prototype.simplify=function(t){return t=t||{},new Expression(simplify(this.tokens,this.unaryOps,this.binaryOps,this.ternaryOps,t),this.parser)};Expression.prototype.substitute=function(t,e){return e instanceof Expression||(e=this.parser.parse(String(e))),new Expression(substitute(this.tokens,t,e),this.parser)};Expression.prototype.evaluate=function(t){return t=t||{},evaluate(this.tokens,this,t)};Expression.prototype.toString=function(){return expressionToString(this.tokens,!1)};Expression.prototype.symbols=function(t){t=t||{};var e=[];return getSymbols(this.tokens,e,t),e};Expression.prototype.variables=function(t){t=t||{};var e=[];getSymbols(this.tokens,e,t);var r=this.functions;return e.filter(function(i){return!(i in r)})};Expression.prototype.toJSFunction=function(t,e){var r=this,i=new Function(t,"with(this.functions) with (this.ternaryOps) with (this.binaryOps) with (this.unaryOps) { return "+expressionToString(this.simplify(e).tokens,!0)+"; }");return function(){return i.apply(r,arguments)}};var TEOF="TEOF",TOP="TOP",TNUMBER="TNUMBER",TSTRING="TSTRING",TPAREN="TPAREN",TBRACKET="TBRACKET",TCOMMA="TCOMMA",TNAME="TNAME",TSEMICOLON="TSEMICOLON";function Token(t,e,r){this.type=t,this.value=e,this.index=r}Token.prototype.toString=function(){return this.type+": "+this.value};function TokenStream(t,e){this.pos=0,this.current=null,this.unaryOps=t.unaryOps,this.binaryOps=t.binaryOps,this.ternaryOps=t.ternaryOps,this.consts=t.consts,this.expression=e,this.savedPosition=0,this.savedCurrent=null,this.options=t.options,this.parser=t}TokenStream.prototype.newToken=function(t,e,r){return new Token(t,e,r!=null?r:this.pos)};TokenStream.prototype.save=function(){this.savedPosition=this.pos,this.savedCurrent=this.current};TokenStream.prototype.restore=function(){this.pos=this.savedPosition,this.current=this.savedCurrent};TokenStream.prototype.next=function(){if(this.pos>=this.expression.length)return this.newToken(TEOF,"EOF");if(this.isWhitespace()||this.isComment())return this.next();if(this.isRadixInteger()||this.isNumber()||this.isOperator()||this.isString()||this.isParen()||this.isBracket()||this.isComma()||this.isSemicolon()||this.isNamedOp()||this.isConst()||this.isName())return this.current;this.parseError('Unknown character "'+this.expression.charAt(this.pos)+'"')};TokenStream.prototype.isString=function(){var t=!1,e=this.pos,r=this.expression.charAt(e);if(r==="'"||r==='"')for(var i=this.expression.indexOf(r,e+1);i>=0&&this.pos<this.expression.length;){if(this.pos=i+1,this.expression.charAt(i-1)!=="\\"){var n=this.expression.substring(e+1,i);this.current=this.newToken(TSTRING,this.unescape(n),e),t=!0;break}i=this.expression.indexOf(r,i+1)}return t};TokenStream.prototype.isParen=function(){var t=this.expression.charAt(this.pos);return t==="("||t===")"?(this.current=this.newToken(TPAREN,t),this.pos++,!0):!1};TokenStream.prototype.isBracket=function(){var t=this.expression.charAt(this.pos);return(t==="["||t==="]")&&this.isOperatorEnabled("[")?(this.current=this.newToken(TBRACKET,t),this.pos++,!0):!1};TokenStream.prototype.isComma=function(){var t=this.expression.charAt(this.pos);return t===","?(this.current=this.newToken(TCOMMA,","),this.pos++,!0):!1};TokenStream.prototype.isSemicolon=function(){var t=this.expression.charAt(this.pos);return t===";"?(this.current=this.newToken(TSEMICOLON,";"),this.pos++,!0):!1};TokenStream.prototype.isConst=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||r!=="_"&&r!=="."&&(r<"0"||r>"9")))break}if(e>t){var i=this.expression.substring(t,e);if(i in this.consts)return this.current=this.newToken(TNUMBER,this.consts[i]),this.pos+=i.length,!0}return!1};TokenStream.prototype.isNamedOp=function(){for(var t=this.pos,e=t;e<this.expression.length;e++){var r=this.expression.charAt(e);if(r.toUpperCase()===r.toLowerCase()&&(e===this.pos||r!=="_"&&(r<"0"||r>"9")))break}if(e>t){var i=this.expression.substring(t,e);if(this.isOperatorEnabled(i)&&(i in this.binaryOps||i in this.unaryOps||i in this.ternaryOps))return this.current=this.newToken(TOP,i),this.pos+=i.length,!0}return!1};TokenStream.prototype.isName=function(){for(var t=this.pos,e=t,r=!1;e<this.expression.length;e++){var i=this.expression.charAt(e);if(i.toUpperCase()===i.toLowerCase()){if(e===this.pos&&(i==="$"||i==="_")){i==="_"&&(r=!0);continue}else if(e===this.pos||!r||i!=="_"&&(i<"0"||i>"9"))break}else r=!0}if(r){var n=this.expression.substring(t,e);return this.current=this.newToken(TNAME,n),this.pos+=n.length,!0}return!1};TokenStream.prototype.isWhitespace=function(){for(var t=!1,e=this.expression.charAt(this.pos);(e===" "||e==="	"||e===`
`||e==="\r")&&(t=!0,this.pos++,!(this.pos>=this.expression.length));)e=this.expression.charAt(this.pos);return t};var codePointPattern=/^[0-9a-f]{4}$/i;TokenStream.prototype.unescape=function(t){var e=t.indexOf("\\");if(e<0)return t;for(var r=t.substring(0,e);e>=0;){var i=t.charAt(++e);switch(i){case"'":r+="'";break;case'"':r+='"';break;case"\\":r+="\\";break;case"/":r+="/";break;case"b":r+="\b";break;case"f":r+="\f";break;case"n":r+=`
`;break;case"r":r+="\r";break;case"t":r+="	";break;case"u":var n=t.substring(e+1,e+5);codePointPattern.test(n)||this.parseError("Illegal escape sequence: \\u"+n),r+=String.fromCharCode(parseInt(n,16)),e+=4;break;default:throw this.parseError('Illegal escape sequence: "\\'+i+'"')}++e;var s=t.indexOf("\\",e);r+=t.substring(e,s<0?t.length:s),e=s}return r};TokenStream.prototype.isComment=function(){var t=this.expression.charAt(this.pos);return t==="/"&&this.expression.charAt(this.pos+1)==="*"?(this.pos=this.expression.indexOf("*/",this.pos)+2,this.pos===1&&(this.pos=this.expression.length),!0):!1};TokenStream.prototype.isRadixInteger=function(){var t=this.pos;if(t>=this.expression.length-2||this.expression.charAt(t)!=="0")return!1;++t;var e,r;if(this.expression.charAt(t)==="x")e=16,r=/^[0-9a-f]$/i,++t;else if(this.expression.charAt(t)==="b")e=2,r=/^[01]$/i,++t;else return!1;for(var i=!1,n=t;t<this.expression.length;){var s=this.expression.charAt(t);if(r.test(s))t++,i=!0;else break}return i&&(this.current=this.newToken(TNUMBER,parseInt(this.expression.substring(n,t),e)),this.pos=t),i};TokenStream.prototype.isNumber=function(){for(var t=!1,e=this.pos,r=e,i=e,n=!1,s=!1,a;e<this.expression.length&&(a=this.expression.charAt(e),a>="0"&&a<="9"||!n&&a===".");)a==="."?n=!0:s=!0,e++,t=s;if(t&&(i=e),a==="e"||a==="E"){e++;for(var l=!0,u=!1;e<this.expression.length;){if(a=this.expression.charAt(e),l&&(a==="+"||a==="-"))l=!1;else if(a>="0"&&a<="9")u=!0,l=!1;else break;e++}u||(e=i)}return t?(this.current=this.newToken(TNUMBER,parseFloat(this.expression.substring(r,e))),this.pos=e):this.pos=i,t};TokenStream.prototype.isOperator=function(){var t=this.pos,e=this.expression.charAt(this.pos);if(e==="+"||e==="-"||e==="*"||e==="/"||e==="%"||e==="^"||e==="?"||e===":"||e===".")this.current=this.newToken(TOP,e);else if(e==="∙"||e==="•")this.current=this.newToken(TOP,"*");else if(e===">")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(TOP,">="),this.pos++):this.current=this.newToken(TOP,">");else if(e==="<")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(TOP,"<="),this.pos++):this.current=this.newToken(TOP,"<");else if(e==="|")if(this.expression.charAt(this.pos+1)==="|")this.current=this.newToken(TOP,"||"),this.pos++;else return!1;else if(e==="=")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(TOP,"=="),this.pos++):this.current=this.newToken(TOP,e);else if(e==="!")this.expression.charAt(this.pos+1)==="="?(this.current=this.newToken(TOP,"!="),this.pos++):this.current=this.newToken(TOP,e);else return!1;return this.pos++,this.isOperatorEnabled(this.current.value)?!0:(this.pos=t,!1)};TokenStream.prototype.isOperatorEnabled=function(t){return this.parser.isOperatorEnabled(t)};TokenStream.prototype.getCoordinates=function(){var t=0,e,r=-1;do t++,e=this.pos-r,r=this.expression.indexOf(`
`,r+1);while(r>=0&&r<this.pos);return{line:t,column:e}};TokenStream.prototype.parseError=function(t){var e=this.getCoordinates();throw new Error("parse error ["+e.line+":"+e.column+"]: "+t)};function ParserState(t,e,r){this.parser=t,this.tokens=e,this.current=null,this.nextToken=null,this.next(),this.savedCurrent=null,this.savedNextToken=null,this.allowMemberAccess=r.allowMemberAccess!==!1}ParserState.prototype.next=function(){return this.current=this.nextToken,this.nextToken=this.tokens.next()};ParserState.prototype.tokenMatches=function(t,e){return typeof e>"u"?!0:Array.isArray(e)?contains(e,t.value):typeof e=="function"?e(t):t.value===e};ParserState.prototype.save=function(){this.savedCurrent=this.current,this.savedNextToken=this.nextToken,this.tokens.save()};ParserState.prototype.restore=function(){this.tokens.restore(),this.current=this.savedCurrent,this.nextToken=this.savedNextToken};ParserState.prototype.accept=function(t,e){return this.nextToken.type===t&&this.tokenMatches(this.nextToken,e)?(this.next(),!0):!1};ParserState.prototype.expect=function(t,e){if(!this.accept(t,e)){var r=this.tokens.getCoordinates();throw new Error("parse error ["+r.line+":"+r.column+"]: Expected "+(e||t))}};ParserState.prototype.parseAtom=function(t){var e=this.tokens.unaryOps;function r(n){return n.value in e}if(this.accept(TNAME)||this.accept(TOP,r))t.push(new Instruction(IVAR,this.current.value));else if(this.accept(TNUMBER))t.push(new Instruction(INUMBER,this.current.value));else if(this.accept(TSTRING))t.push(new Instruction(INUMBER,this.current.value));else if(this.accept(TPAREN,"("))this.parseExpression(t),this.expect(TPAREN,")");else if(this.accept(TBRACKET,"["))if(this.accept(TBRACKET,"]"))t.push(new Instruction(IARRAY,0));else{var i=this.parseArrayList(t);t.push(new Instruction(IARRAY,i))}else throw new Error("unexpected "+this.nextToken)};ParserState.prototype.parseExpression=function(t){var e=[];this.parseUntilEndStatement(t,e)||(this.parseVariableAssignmentExpression(e),!this.parseUntilEndStatement(t,e)&&this.pushExpression(t,e))};ParserState.prototype.pushExpression=function(t,e){for(var r=0,i=e.length;r<i;r++)t.push(e[r])};ParserState.prototype.parseUntilEndStatement=function(t,e){return this.accept(TSEMICOLON)?(this.nextToken&&this.nextToken.type!==TEOF&&!(this.nextToken.type===TPAREN&&this.nextToken.value===")")&&e.push(new Instruction(IENDSTATEMENT)),this.nextToken.type!==TEOF&&this.parseExpression(e),t.push(new Instruction(IEXPR,e)),!0):!1};ParserState.prototype.parseArrayList=function(t){for(var e=0;!this.accept(TBRACKET,"]");)for(this.parseExpression(t),++e;this.accept(TCOMMA);)this.parseExpression(t),++e;return e};ParserState.prototype.parseVariableAssignmentExpression=function(t){for(this.parseConditionalExpression(t);this.accept(TOP,"=");){var e=t.pop(),r=[],i=t.length-1;if(e.type===IFUNCALL){if(!this.tokens.isOperatorEnabled("()="))throw new Error("function definition is not permitted");for(var n=0,s=e.value+1;n<s;n++){var a=i-n;t[a].type===IVAR&&(t[a]=new Instruction(IVARNAME,t[a].value))}this.parseVariableAssignmentExpression(r),t.push(new Instruction(IEXPR,r)),t.push(new Instruction(IFUNDEF,e.value));continue}if(e.type!==IVAR&&e.type!==IMEMBER)throw new Error("expected variable for assignment");this.parseVariableAssignmentExpression(r),t.push(new Instruction(IVARNAME,e.value)),t.push(new Instruction(IEXPR,r)),t.push(binaryInstruction("="))}};ParserState.prototype.parseConditionalExpression=function(t){for(this.parseOrExpression(t);this.accept(TOP,"?");){var e=[],r=[];this.parseConditionalExpression(e),this.expect(TOP,":"),this.parseConditionalExpression(r),t.push(new Instruction(IEXPR,e)),t.push(new Instruction(IEXPR,r)),t.push(ternaryInstruction("?"))}};ParserState.prototype.parseOrExpression=function(t){for(this.parseAndExpression(t);this.accept(TOP,"or");){var e=[];this.parseAndExpression(e),t.push(new Instruction(IEXPR,e)),t.push(binaryInstruction("or"))}};ParserState.prototype.parseAndExpression=function(t){for(this.parseComparison(t);this.accept(TOP,"and");){var e=[];this.parseComparison(e),t.push(new Instruction(IEXPR,e)),t.push(binaryInstruction("and"))}};var COMPARISON_OPERATORS=["==","!=","<","<=",">=",">","in"];ParserState.prototype.parseComparison=function(t){for(this.parseAddSub(t);this.accept(TOP,COMPARISON_OPERATORS);){var e=this.current;this.parseAddSub(t),t.push(binaryInstruction(e.value))}};var ADD_SUB_OPERATORS=["+","-","||"];ParserState.prototype.parseAddSub=function(t){for(this.parseTerm(t);this.accept(TOP,ADD_SUB_OPERATORS);){var e=this.current;this.parseTerm(t),t.push(binaryInstruction(e.value))}};var TERM_OPERATORS=["*","/","%"];ParserState.prototype.parseTerm=function(t){for(this.parseFactor(t);this.accept(TOP,TERM_OPERATORS);){var e=this.current;this.parseFactor(t),t.push(binaryInstruction(e.value))}};ParserState.prototype.parseFactor=function(t){var e=this.tokens.unaryOps;function r(n){return n.value in e}if(this.save(),this.accept(TOP,r)){if(this.current.value!=="-"&&this.current.value!=="+"){if(this.nextToken.type===TPAREN&&this.nextToken.value==="("){this.restore(),this.parseExponential(t);return}else if(this.nextToken.type===TSEMICOLON||this.nextToken.type===TCOMMA||this.nextToken.type===TEOF||this.nextToken.type===TPAREN&&this.nextToken.value===")"){this.restore(),this.parseAtom(t);return}}var i=this.current;this.parseFactor(t),t.push(unaryInstruction(i.value))}else this.parseExponential(t)};ParserState.prototype.parseExponential=function(t){for(this.parsePostfixExpression(t);this.accept(TOP,"^");)this.parseFactor(t),t.push(binaryInstruction("^"))};ParserState.prototype.parsePostfixExpression=function(t){for(this.parseFunctionCall(t);this.accept(TOP,"!");)t.push(unaryInstruction("!"))};ParserState.prototype.parseFunctionCall=function(t){var e=this.tokens.unaryOps;function r(s){return s.value in e}if(this.accept(TOP,r)){var i=this.current;this.parseAtom(t),t.push(unaryInstruction(i.value))}else for(this.parseMemberExpression(t);this.accept(TPAREN,"(");)if(this.accept(TPAREN,")"))t.push(new Instruction(IFUNCALL,0));else{var n=this.parseArgumentList(t);t.push(new Instruction(IFUNCALL,n))}};ParserState.prototype.parseArgumentList=function(t){for(var e=0;!this.accept(TPAREN,")");)for(this.parseExpression(t),++e;this.accept(TCOMMA);)this.parseExpression(t),++e;return e};ParserState.prototype.parseMemberExpression=function(t){for(this.parseAtom(t);this.accept(TOP,".")||this.accept(TBRACKET,"[");){var e=this.current;if(e.value==="."){if(!this.allowMemberAccess)throw new Error('unexpected ".", member access is not permitted');this.expect(TNAME),t.push(new Instruction(IMEMBER,this.current.value))}else if(e.value==="["){if(!this.tokens.isOperatorEnabled("["))throw new Error('unexpected "[]", arrays are disabled');this.parseExpression(t),this.expect(TBRACKET,"]"),t.push(binaryInstruction("["))}else throw new Error("unexpected symbol: "+e.value)}};function add(t,e){return Number(t)+Number(e)}function sub(t,e){return t-e}function mul(t,e){return t*e}function div(t,e){return t/e}function mod(t,e){return t%e}function concat(t,e){return Array.isArray(t)&&Array.isArray(e)?t.concat(e):""+t+e}function equal(t,e){return t===e}function notEqual(t,e){return t!==e}function greaterThan(t,e){return t>e}function lessThan(t,e){return t<e}function greaterThanEqual(t,e){return t>=e}function lessThanEqual(t,e){return t<=e}function andOperator(t,e){return!!(t&&e)}function orOperator(t,e){return!!(t||e)}function inOperator(t,e){return contains(e,t)}function sinh(t){return(Math.exp(t)-Math.exp(-t))/2}function cosh(t){return(Math.exp(t)+Math.exp(-t))/2}function tanh(t){return t===1/0?1:t===-1/0?-1:(Math.exp(t)-Math.exp(-t))/(Math.exp(t)+Math.exp(-t))}function asinh(t){return t===-1/0?t:Math.log(t+Math.sqrt(t*t+1))}function acosh(t){return Math.log(t+Math.sqrt(t*t-1))}function atanh(t){return Math.log((1+t)/(1-t))/2}function log10$1(t){return Math.log(t)*Math.LOG10E}function neg(t){return-t}function not(t){return!t}function trunc(t){return t<0?Math.ceil(t):Math.floor(t)}function random(t){return Math.random()*(t||1)}function factorial(t){return gamma(t+1)}function isInteger(t){return isFinite(t)&&t===Math.round(t)}var GAMMA_G=4.7421875,GAMMA_P=[.9999999999999971,57.15623566586292,-59.59796035547549,14.136097974741746,-.4919138160976202,3399464998481189e-20,4652362892704858e-20,-9837447530487956e-20,.0001580887032249125,-.00021026444172410488,.00021743961811521265,-.0001643181065367639,8441822398385275e-20,-26190838401581408e-21,36899182659531625e-22];function gamma(t){var e,r;if(isInteger(t)){if(t<=0)return isFinite(t)?1/0:NaN;if(t>171)return 1/0;for(var i=t-2,n=t-1;i>1;)n*=i,i--;return n===0&&(n=1),n}if(t<.5)return Math.PI/(Math.sin(Math.PI*t)*gamma(1-t));if(t>=171.35)return 1/0;if(t>85){var s=t*t,a=s*t,l=a*t,u=l*t;return Math.sqrt(2*Math.PI/t)*Math.pow(t/Math.E,t)*(1+1/(12*t)+1/(288*s)-139/(51840*a)-571/(2488320*l)+163879/(209018880*u)+5246819/(75246796800*u*t))}--t,r=GAMMA_P[0];for(var p=1;p<GAMMA_P.length;++p)r+=GAMMA_P[p]/(t+p);return e=t+GAMMA_G+.5,Math.sqrt(2*Math.PI)*Math.pow(e,t+.5)*Math.exp(-e)*r}function stringOrArrayLength(t){return Array.isArray(t)?t.length:String(t).length}function hypot(){for(var t=0,e=0,r=0;r<arguments.length;r++){var i=Math.abs(arguments[r]),n;e<i?(n=e/i,t=t*n*n+1,e=i):i>0?(n=i/e,t+=n*n):t+=i}return e===1/0?1/0:e*Math.sqrt(t)}function condition(t,e,r){return t?e:r}function roundTo(t,e){return typeof e>"u"||+e==0?Math.round(t):(t=+t,e=-+e,isNaN(t)||!(typeof e=="number"&&e%1===0)?NaN:(t=t.toString().split("e"),t=Math.round(+(t[0]+"e"+(t[1]?+t[1]-e:-e))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+e:e))))}function setVar(t,e,r){return r&&(r[t]=e),e}function arrayIndex(t,e){return t[e|0]}function max(t){return arguments.length===1&&Array.isArray(t)?Math.max.apply(Math,t):Math.max.apply(Math,arguments)}function min(t){return arguments.length===1&&Array.isArray(t)?Math.min.apply(Math,t):Math.min.apply(Math,arguments)}function arrayMap(t,e){if(typeof t!="function")throw new Error("First argument to map is not a function");if(!Array.isArray(e))throw new Error("Second argument to map is not an array");return e.map(function(r,i){return t(r,i)})}function arrayFold(t,e,r){if(typeof t!="function")throw new Error("First argument to fold is not a function");if(!Array.isArray(r))throw new Error("Second argument to fold is not an array");return r.reduce(function(i,n,s){return t(i,n,s)},e)}function arrayFilter(t,e){if(typeof t!="function")throw new Error("First argument to filter is not a function");if(!Array.isArray(e))throw new Error("Second argument to filter is not an array");return e.filter(function(r,i){return t(r,i)})}function stringOrArrayIndexOf(t,e){if(!(Array.isArray(e)||typeof e=="string"))throw new Error("Second argument to indexOf is not a string or array");return e.indexOf(t)}function arrayJoin(t,e){if(!Array.isArray(e))throw new Error("Second argument to join is not an array");return e.join(t)}function sign$1(t){return(t>0)-(t<0)||+t}var ONE_THIRD=1/3;function cbrt(t){return t<0?-Math.pow(-t,ONE_THIRD):Math.pow(t,ONE_THIRD)}function expm1(t){return Math.exp(t)-1}function log1p(t){return Math.log(1+t)}function log2(t){return Math.log(t)/Math.LN2}function Parser(t){this.options=t||{},this.unaryOps={sin:Math.sin,cos:Math.cos,tan:Math.tan,asin:Math.asin,acos:Math.acos,atan:Math.atan,sinh:Math.sinh||sinh,cosh:Math.cosh||cosh,tanh:Math.tanh||tanh,asinh:Math.asinh||asinh,acosh:Math.acosh||acosh,atanh:Math.atanh||atanh,sqrt:Math.sqrt,cbrt:Math.cbrt||cbrt,log:Math.log,log2:Math.log2||log2,ln:Math.log,lg:Math.log10||log10$1,log10:Math.log10||log10$1,expm1:Math.expm1||expm1,log1p:Math.log1p||log1p,abs:Math.abs,ceil:Math.ceil,floor:Math.floor,round:Math.round,trunc:Math.trunc||trunc,"-":neg,"+":Number,exp:Math.exp,not,length:stringOrArrayLength,"!":factorial,sign:Math.sign||sign$1},this.binaryOps={"+":add,"-":sub,"*":mul,"/":div,"%":mod,"^":Math.pow,"||":concat,"==":equal,"!=":notEqual,">":greaterThan,"<":lessThan,">=":greaterThanEqual,"<=":lessThanEqual,and:andOperator,or:orOperator,in:inOperator,"=":setVar,"[":arrayIndex},this.ternaryOps={"?":condition},this.functions={random,fac:factorial,min,max,hypot:Math.hypot||hypot,pyt:Math.hypot||hypot,pow:Math.pow,atan2:Math.atan2,if:condition,gamma,roundTo,map:arrayMap,fold:arrayFold,filter:arrayFilter,indexOf:stringOrArrayIndexOf,join:arrayJoin},this.consts={E:Math.E,PI:Math.PI,true:!0,false:!1}}Parser.prototype.parse=function(t){var e=[],r=new ParserState(this,new TokenStream(this,t),{allowMemberAccess:this.options.allowMemberAccess});return r.parseExpression(e),r.expect(TEOF,"EOF"),new Expression(e,this)};Parser.prototype.evaluate=function(t,e){return this.parse(t).evaluate(e)};var sharedParser=new Parser;Parser.parse=function(t){return sharedParser.parse(t)};Parser.evaluate=function(t,e){return sharedParser.parse(t).evaluate(e)};var optionNameMap={"+":"add","-":"subtract","*":"multiply","/":"divide","%":"remainder","^":"power","!":"factorial","<":"comparison",">":"comparison","<=":"comparison",">=":"comparison","==":"comparison","!=":"comparison","||":"concatenate",and:"logical",or:"logical",not:"logical","?":"conditional",":":"conditional","=":"assignment","[":"array","()=":"fndef"};function getOptionName(t){return optionNameMap.hasOwnProperty(t)?optionNameMap[t]:t}Parser.prototype.isOperatorEnabled=function(t){var e=getOptionName(t),r=this.options.operators||{};return!(e in r)||!!r[e]};let urlAlphabet="useandom-26T198340PX75pxJACKVERYMINDBUSHWOLF_GQZbfghjklqvwyzrict",nanoid=(t=21)=>{let e="",r=t|0;for(;r--;)e+=urlAlphabet[Math.random()*64|0];return e};use_events(),use_events_mouse(),use_dom_bind(),use_styles();const $beforeReconcile$$l=Symbol.for("#beforeReconcile"),$afterReconcile$$l=Symbol.for("#afterReconcile"),$afterVisit$$h=Symbol.for("#afterVisit"),$$up$$i=Symbol.for("##up");var $4$b=Symbol(),$7$4=Symbol(),$10$5=Symbol(),$15$8=Symbol(),$19$a=Symbol(),$24$5=Symbol(),$27$4=Symbol(),$52$1=Symbol(),$55$4=Symbol(),$58$4=Symbol(),$59$2=Symbol(),$68$6=Symbol(),$70$3=Symbol(),$71$5=Symbol();let expression="",result="",ans="",originalExpression,history=[],c$0$l=Symbol();const Ye=class Ye extends Component{[__init__$](e=null,r=!0,i=!0){super[__init__$](...arguments),this.expressionH=e?e.expressionH:void 0,this.resultH=e?e.resultH:void 0,this.idH=e?e.idH:void 0}delItem(e){var r=this;return history=history.filter(function(i){return i.id!==r.idH})}insertExp(e){var i,n,s,a;var r=this;return expression=(n=(i=history.find(function(l){return l.id===r.idH}))==null?void 0:i.expression)!=null?n:expression,result=(a=(s=history.find(function(l){return l.id===r.idH}))==null?void 0:s.result)!=null?a:result}render(){var e=this,r,i,n=this._ns_||"",s,a,l;return r=this,r[$beforeReconcile$$l](),i=1,r[$4$b]===1||(i=0,r[$4$b]=1),a=1,(s=r[$7$4])||(a=0,r[$7$4]=s=createElement("input",r,`z5yoiuk-ag ${n}`,null)),l=""+this.expressionH+" = "+this.resultH,l===r[$10$5]||(s.richValue=r[$10$5]=l),a||(s.readOnly="readOnly"),a||s.on$("click",{alt:!0,$_:[function(u,p){return e.delItem(e.id)}]},this),a||s.on$("click",{$_:[function(u,p){return e.insertExp(e.id)}]},this),r[$afterReconcile$$l](i),r}};register$(Ye,c$0$l,"history-adder",2),defineTag("history-adder",Ye,{});let HistoryAdderComponent=Ye,c$1$3=Symbol();const Xe=class Xe extends Component{clear(){return expression="",result=""}append(e){return expression+=e}calculate(){try{return originalExpression=expression.replaceAll("Ans",ans),result=Parser.evaluate(originalExpression).toString(),history.unshift({expression:originalExpression,result,id:nanoid()}),ans=result}catch(e){return result=e.message}}render(){var e=this,r,i,n,s=this._ns_||"",a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le,ce,se,de,fe,X,he;r=this,r[$beforeReconcile$$l](),i=n=1,r[$15$8]===1||(i=n=0,r[$15$8]=1),i||(a=createElement("div",r,`z5yoiuk-aj ${s}`,null)),u=p=1,(l=r[$19$a])||(u=p=0,r[$19$a]=l=createElement("input",a,`z5yoiuk-ak ${s}`,null)),u||l.bind$("data",{get:function(){return expression},set:function(ne){expression=ne}}),u||!l.setup||l.setup(p),l[$afterVisit$$h](p),c=1,(f=r[$24$5])||(c=0,r[$24$5]=f=createElement("input",a,`z5yoiuk-al ${s}`,null)),result===r[$27$4]||(f.richValue=r[$27$4]=result),c||(f.readOnly="readOnly"),i||(h=createElement("div",a,`z5yoiuk-am ${s}`,null)),i||(d=createElement("button",h,`z5yoiuk-an ${s}`,"C")),i||d.on$("click",{$_:[function(ne,ge){return e.clear(ne)}]},this),i||(m=createElement("button",h,`z5yoiuk-ao ${s}`,"(")),i||m.on$("click",{$_:[function(ne,ge){return e.append("(")}]},this),i||(_=createElement("button",h,`z5yoiuk-ap ${s}`,")")),i||_.on$("click",{$_:[function(ne,ge){return e.append(")")}]},this),i||(g=createElement("button",h,`z5yoiuk-aq ${s}`,"÷")),i||g.on$("click",{$_:[function(ne,ge){return e.append("/")}]},this),i||(b=createElement("button",h,`z5yoiuk-ar ${s}`,"7")),i||b.on$("click",{$_:[function(ne,ge){return e.append("7")}]},this),i||(x=createElement("button",h,`z5yoiuk-as ${s}`,"8")),i||x.on$("click",{$_:[function(ne,ge){return e.append("8")}]},this),i||(S=createElement("button",h,`z5yoiuk-at ${s}`,"9")),i||S.on$("click",{$_:[function(ne,ge){return e.append("9")}]},this),i||(T=createElement("button",h,`z5yoiuk-au ${s}`,"×")),i||T.on$("click",{$_:[function(ne,ge){return e.append("*")}]},this),i||(I=createElement("button",h,`z5yoiuk-av ${s}`,"4")),i||I.on$("click",{$_:[function(ne,ge){return e.append("4")}]},this),i||(O=createElement("button",h,`z5yoiuk-aw ${s}`,"5")),i||O.on$("click",{$_:[function(ne,ge){return e.append("5")}]},this),i||(L=createElement("button",h,`z5yoiuk-ax ${s}`,"6")),i||L.on$("click",{$_:[function(ne,ge){return e.append("6")}]},this),i||(P=createElement("button",h,`z5yoiuk-ay ${s}`,"−")),i||P.on$("click",{$_:[function(ne,ge){return e.append("-")}]},this),i||(C=createElement("button",h,`z5yoiuk-az ${s}`,"1")),i||C.on$("click",{$_:[function(ne,ge){return e.append("1")}]},this),i||(G=createElement("button",h,`z5yoiuk-ba ${s}`,"2")),i||G.on$("click",{$_:[function(ne,ge){return e.append("2")}]},this),i||(B=createElement("button",h,`z5yoiuk-bb ${s}`,"3")),i||B.on$("click",{$_:[function(ne,ge){return e.append("3")}]},this),i||(H=createElement("button",h,`z5yoiuk-bc ${s}`,"+")),i||H.on$("click",{$_:[function(ne,ge){return e.append("+")}]},this),i||(ee=createElement("button",h,`z5yoiuk-bd ${s}`,"0")),i||ee.on$("click",{$_:[function(ne,ge){return e.append("0")}]},this),i||(j=createElement("button",h,`z5yoiuk-be ${s}`,".")),i||j.on$("click",{$_:[function(ne,ge){return e.append(".")}]},this),i||(te=createElement("button",h,`z5yoiuk-bf ${s}`,"Ans")),i||te.on$("click",{$_:[function(ne,ge){return e.append("Ans")}]},this),i||(J=createElement("button",h,`z5yoiuk-bg ${s}`,"=")),i||J.on$("click",{$_:[function(ne,ge){return e.calculate(ne)}]},this),i||(Z=createElement("div",a,`z5yoiuk-bh ${s}`,null)),i||createElement("div",Z,`z5yoiuk-bi ${s}`,"History:"),ae=1,(pe=r[$52$1])||(ae=0,r[$52$1]=pe=createElement("div",Z,`z5yoiuk-bj ${s}`,"Clear")),oe=history.length?"block":"none",oe===r[$55$4]||pe.css$var("--z5yoiuk_bk",r[$55$4]=oe,null,"d"),ae||pe.on$("click",{$_:[function(ne,ge){return history=[]}]},this),(me=r[$58$4])||(r[$58$4]=me=createElement("div",a,`z5yoiuk-bl ${s}`,null)),(le=r[$59$2])||(r[$59$2]=le=createIndexedList(384,me)),ce=0,se=le.$;for(let ne=0,ge=iterable$(history),Ee=ge.length;ne<Ee;ne++){let be=ge[ne];fe=X=1,(de=se[ce])||(fe=X=0,se[ce]=de=createComponent("history-adder",le,`${s}`)),fe||(de[$$up$$i]=le),he=be.expression,he===de[$68$6]||(de.expressionH=de[$68$6]=he),he=be.result,he===de[$70$3]||(de.resultH=de[$70$3]=he),he=be.id,he===de[$71$5]||(de.idH=de[$71$5]=he),fe||!de.setup||de.setup(X),de[$afterVisit$$h](X),ce++}return le[$afterVisit$$h](ce),r[$afterReconcile$$l](n),r}};register$(Xe,c$1$3,"Calculator",2),defineTag("calculator-z5yoiuk-bn",Xe,{cssns:"z5yoiuk_ah",cssid:"z5yoiuk-ah"});let Calculator=Xe;use_events(),use_events_mouse();const $beforeReconcile$$k=Symbol.for("#beforeReconcile"),$placeChild$$h=Symbol.for("#placeChild"),$$up$$h=Symbol.for("##up"),$afterVisit$$g=Symbol.for("#afterVisit"),$getRenderContext$$2=Symbol.for("#getRenderContext"),$afterReconcile$$k=Symbol.for("#afterReconcile");var $5=Symbol(),$12$3=Symbol(),$14$6=Symbol(),$15$7=Symbol(),$16$3=Symbol(),$17$8=Symbol(),$18$5=Symbol(),$19$9=Symbol(),$22$8=Symbol(),$23$2=Symbol(),$33$4=Symbol(),$34$5=Symbol(),$37$5=Symbol(),$38$5=Symbol(),$46$1=Symbol(),$50$2=Symbol(),$53$1=Symbol(),$55$3=Symbol(),$57$6=Symbol(),$58$3=Symbol(),$60$5=Symbol(),$61$3=Symbol(),$64$3=Symbol(),$69$2=Symbol(),$72$2=Symbol(),$76$4=Symbol(),$79$2=Symbol(),$83$1=Symbol(),$86$1=Symbol(),$91$2=Symbol(),$95=Symbol(),$96$1=Symbol(),$97=Symbol(),$98=Symbol(),$99=Symbol(),$100$1=Symbol(),$101=Symbol(),$102=Symbol(),$105=Symbol(),$107=Symbol(),$110$1=Symbol(),$111=Symbol(),$112$1=Symbol(),$115$1=Symbol(),$123$1=Symbol(),$126$1=Symbol(),$129=Symbol(),$131=Symbol(),$132=Symbol(),$133=Symbol(),$134=Symbol(),$135=Symbol(),$136=Symbol(),$137=Symbol(),$139=Symbol(),$141=Symbol(),$142=Symbol(),$144=Symbol();let c$0$k=Symbol();const Ke=class Ke extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.current=e&&(n=e.current)!==void 0?n:new Date,this.eventData=e&&(n=e.eventData)!==void 0?n:null,this.selectedDay=e&&(n=e.selectedDay)!==void 0?n:null,this.allEvents=e&&(n=e.allEvents)!==void 0?n:{},this.eventbtnselect=e&&(n=e.eventbtnselect)!==void 0?n:!0}setup(){let e=window.localStorage.getItem("calendar-events");if(e)return this.allEvents=JSON.parse(e)}prevMonth(){return this.current=new Date(this.current.getFullYear(),this.current.getMonth()-1,1),this.selectedDay=null,this.eventData=null}nextMonth(){return this.current=new Date(this.current.getFullYear(),this.current.getMonth()+1,1),this.selectedDay=null,this.eventData=null}formatKey(e){return""+e.year+"-"+(e.month+1)+"-"+e.day}daysInMonth(){let e=this.current.getFullYear(),r=this.current.getMonth(),i=new Date(e,r,1),n=new Date(e,r+1,0),s=i.getDay(),a=n.getDate(),l=[];for(let u=s,p=0,f=u-p;f>0?p<u:p>u;f>0?p++:p--)l.push(null);for(let u=a,p=1,f=u-p;f>0?p<=u:p>=u;f>0?p++:p--){let c=new Date(e,r,p).getDay(),h=""+e+"-"+(r+1)+"-"+p;l.push({day:p,weekday:c,month:r,year:e,event:this.allEvents[h]||""})}return l}monthName(e=null){return["January","February","March","April","May","June","July","August","September","October","November","December"][e!=null?e:this.current.getMonth()]}showEvent(e){return this.selectedDay=e,this.eventData=e.event,this.eventbtnselect=!0}updateEvent(e){let r=e.target.value;if(this.eventData=r,this.selectedDay){let i=this.formatKey(this.selectedDay);return this.allEvents[i]=r,window.localStorage.setItem("calendar-events",JSON.stringify(this.allEvents))}}removeEvent(e){return this.allEvents[e],delete this.allEvents[e],window.localStorage.setItem("calendar-events",JSON.stringify(this.allEvents))}render(){var e=this,r,i,n,s,a,l,u=this._ns_||"",p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le,ce,se,de,fe,X,he,ne,ge,Ee,be,_e,ye,Te,xe,Se,W,ue,w,F,V,K,A,re,y,v;let k=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];s=this,s[$beforeReconcile$$k](),a=l=1,s[$5]===1||(a=l=0,s[$5]=1),a||(p=createElement("div",s,`z1ju1dpa-ah ${u}`,null)),a||(f=createElement("div",p,`z1ju1dpa-ai ${u}`,null)),a||(c=createElement("div",f,`z1ju1dpa-aj ${u}`,null)),a||(h=createElement("button",c,`z1ju1dpa-ak ${u}`,"←")),a||h.on$("click",{$_:[function(D,z){return e.prevMonth(D)}]},this),(d=s[$12$3])||(s[$12$3]=d=createElement("span",c,`${u}`,null)),renderContext.context=s[$15$7]||(s[$15$7]={_:d}),m=this.monthName(),renderContext.context=null,m===s[$16$3]&&a||(s[$14$6]=d[$placeChild$$h](s[$16$3]=m,128,s[$14$6])),a||d[$placeChild$$h](" "),renderContext.context=s[$18$5]||(s[$18$5]={_:d}),m=this.current.getFullYear(),renderContext.context=null,m===s[$19$9]&&a||(s[$17$8]=d[$placeChild$$h](s[$19$9]=m,256,s[$17$8])),a||(_=createElement("button",c,`z1ju1dpa-am ${u}`,"→")),a||_.on$("click",{$_:[function(D,z){return e.nextMonth(D)}]},this),(g=s[$22$8])||(s[$22$8]=g=createElement("div",f,`z1ju1dpa-an ${u}`,null)),(b=s[$23$2])||(s[$23$2]=b=createIndexedList(384,g)),x=0,S=b.$;for(let D=0,z=iterable$(k),q=z.length;D<q;D++){let Y=z[D];I=1,(T=S[x])||(I=0,S[x]=T=createElement("div",b,`z1ju1dpa-ao ${u}`,null)),I||(T[$$up$$h]=b),O=Y,O===T[$34$5]&&I||(T[$33$4]=T[$placeChild$$h](T[$34$5]=O,384,T[$33$4])),x++}b[$afterVisit$$g](x),(L=s[$37$5])||(s[$37$5]=L=createElement("div",f,`z1ju1dpa-ap ${u}`,null)),(P=s[$38$5])||(s[$38$5]=P=createKeyedList(1408,L)),C=0,G=P.$;for(let D=0,z=iterable$(this.daysInMonth()),q=z.length;D<q;D++){let Y=z[D];Y?(H=j=1,(B=(ee=G[$getRenderContext$$2]($46$1)).get(C))||(H=j=0,ee.set(C,B=createElement("div",P,`day ${u}`,null))),H||(B[$$up$$h]=P),te=Y.event||void 0,te===B[$50$2]||(j|=2,B[$50$2]=te),te=Y.weekday==6||void 0,te===B[$53$1]||(j|=2,B[$53$1]=te),te=Y.day==new Date().getDate()&&this.current.getMonth()==new Date().getMonth()||void 0,te===B[$55$3]||(j|=2,B[$55$3]=te),te=this.selectedDay&&this.selectedDay.day==Y.day&&this.selectedDay.month==Y.month&&this.selectedDay.year==Y.year||void 0,te===B[$57$6]||(j|=2,B[$57$6]=te),J=B[$58$3]||(B[$58$3]={$_:[function(Q,ie,$e){return e.showEvent($e)},null]}),J.$_[1]=Y,H||B.on$("click",J,this),j&2&&B.flag$(`day ${u} `+(B[$50$2]?"event":"")+" "+(B[$53$1]?"sat":"")+" "+(B[$55$3]?"today":"")+" "+(B[$57$6]?"active":"")),te=Y.day,te===B[$61$3]&&H||(B[$60$5]=B[$placeChild$$h](B[$61$3]=te,384,B[$60$5])),P.push(B,C++,ee)):(pe=1,(Z=(ae=G[$getRenderContext$$2]($64$3)).get(C))||(pe=0,ae.set(C,Z=createElement("div",P,`${u}`,null))),pe||(Z[$$up$$h]=P),P.push(Z,C++,ae))}if(P[$afterVisit$$g](C),(oe=s[$69$2])||(s[$69$2]=oe=createElement("div",p,`z1ju1dpa-as ${u}`,null)),a||(me=createElement("div",oe,`z1ju1dpa-at ${u}`,null)),ce=se=1,(le=s[$72$2])||(ce=se=0,s[$72$2]=le=createElement("button",me,`z1ju1dpa-au ${u}`,"Event")),de=this.eventbtnselect||void 0,de===s[$76$4]||(se|=2,s[$76$4]=de),ce||le.on$("click",{$_:[function(D,z){return e.eventbtnselect=!0}]},this),se&2&&le.flag$(`z1ju1dpa-au ${u} `+(s[$76$4]?"selected":"")),X=he=1,(fe=s[$79$2])||(X=he=0,s[$79$2]=fe=createElement("button",me,`z1ju1dpa-av ${u}`,"Event List")),ne=!this.eventbtnselect||void 0,ne===s[$83$1]||(he|=2,s[$83$1]=ne),X||fe.on$("click",{$_:[function(D,z){return e.eventbtnselect=!1}]},this),he&2&&fe.flag$(`z1ju1dpa-av ${u} `+(s[$83$1]?"selected":"")),n=null,this.eventbtnselect)ge=1,(n=s[$86$1])||(ge=0,s[$86$1]=n=createElement("div",null,`z1ju1dpa-aw ${u}`,null)),ge||(n[$$up$$h]=oe),r=i=null,!is$(this.eventData,null)&&this.selectedDay?(Ee=1,(r=n[$91$2])||(Ee=0,n[$91$2]=r=createElement("p",null,`z1ju1dpa-ax ${u}`,null)),Ee||(r[$$up$$h]=n),renderContext.context=r[$96$1]||(r[$96$1]={_:r}),be=this.monthName(this.selectedDay.month),renderContext.context=null,be===r[$97]&&Ee||(r[$95]=r[$placeChild$$h](r[$97]=be,128,r[$95])),Ee||r[$placeChild$$h](" "),be=this.selectedDay.day,be===r[$99]&&Ee||(r[$98]=r[$placeChild$$h](r[$99]=be,0,r[$98])),Ee||r[$placeChild$$h](", "),be=this.selectedDay.year,be===r[$101]&&Ee||(r[$100$1]=r[$placeChild$$h](r[$101]=be,256,r[$100$1])),_e=1,(i=n[$102])||(_e=0,n[$102]=i=createElement("textarea",null,`z1ju1dpa-ay ${u}`,null)),_e||(i[$$up$$h]=n),_e||i.set$("spellcheck",!1),_e||(i.placeholder="Add Event"),ye=this.eventData,ye===i[$105]||(i.richValue=i[$105]=ye),_e||i.on$("input",{$_:[function(D,z){return e.updateEvent(D)}]},this)):(Te=1,(r=n[$107])||(Te=0,n[$107]=r=createElement("p",null,`z1ju1dpa-az ${u}`,"Click on a day to view or add event")),Te||(r[$$up$$h]=n)),n[$110$1]=n[$placeChild$$h](r,0,n[$110$1]),n[$111]=n[$placeChild$$h](i,0,n[$111]);else{xe=1,(n=s[$112$1])||(xe=0,s[$112$1]=n=createElement("div",null,`z1ju1dpa-ba ${u}`,null)),xe||(n[$$up$$h]=oe),(Se=n[$115$1])||(n[$115$1]=Se=createKeyedList(1408,n)),W=0,ue=Se.$;for(let D=0,z=iterable$(Object.entries(this.allEvents).sort(function(Y,Q){return new Date(Y[0]).getTime()-new Date(Q[0]).getTime()})),q=z.length;D<q;D++){let Y=z[D];Y[1]&&(F=1,(w=(V=ue[$getRenderContext$$2]($123$1)).get(W))||(F=0,V.set(W,w=createElement("div",Se,`z1ju1dpa-bb ${u}`,null))),F||(w[$$up$$h]=Se),K=w[$126$1]||(w[$126$1]={$_:[function(Q,ie,$e){return e.removeEvent($e[0])},null]}),K.$_[1]=Y,F||w.on$("dblclick",K,this),(A=w[$129])||(w[$129]=A=createElement("p",w,`${u}`,null)),renderContext.context=w[$132]||(w[$132]={_:A}),re=this.monthName(Y[0].split("-")[1]-1),renderContext.context=null,re===w[$133]&&F||(w[$131]=A[$placeChild$$h](w[$133]=re,128,w[$131])),F||A[$placeChild$$h](" "),re=Y[0].split("-")[2],re===w[$135]&&F||(w[$134]=A[$placeChild$$h](w[$135]=re,0,w[$134])),F||A[$placeChild$$h](", "),re=Y[0].split("-")[0],re===w[$137]&&F||(w[$136]=A[$placeChild$$h](w[$137]=re,256,w[$136])),(y=w[$139])||(w[$139]=y=createElement("pre",w,`${u}`,null)),v=Y[1],v===w[$142]&&F||(w[$141]=y[$placeChild$$h](w[$142]=v,384,w[$141])),Se.push(w,W++,V))}Se[$afterVisit$$g](W)}return s[$144]=oe[$placeChild$$h](n,0,s[$144]),s[$afterReconcile$$k](l),s}};register$(Ke,c$0$k,"Calendar",2),defineTag("calendar-z1ju1dpa-be",Ke,{cssns:"z1ju1dpa_af",cssid:"z1ju1dpa-af"});let Calendar=Ke;const $beforeReconcile$$j=Symbol.for("#beforeReconcile"),$afterReconcile$$j=Symbol.for("#afterReconcile");var $4$a=Symbol();let c$0$j=Symbol();const Qe=class Qe extends Component{render(){var e,r,i,n=this._ns_||"";return e=this,e[$beforeReconcile$$j](),r=i=1,e[$4$a]===1||(r=i=0,e[$4$a]=1),r||createElement("h1",e,`${n}`,"Chatbot"),r||createElement("h3",e,`${n}`,"Unfortunately, this page cant be hosted because of security reasons"),e[$afterReconcile$$j](i),e}};register$(Qe,c$0$j,"Chatbot",2),defineTag("chatbot-z1aj1rcz-ai",Qe,{});let Chatbot=Qe;use_events(),use_events_mouse(),use_styles();const $beforeReconcile$$i=Symbol.for("#beforeReconcile"),$placeChild$$g=Symbol.for("#placeChild"),$$up$$g=Symbol.for("##up"),$afterVisit$$f=Symbol.for("#afterVisit"),$afterReconcile$$i=Symbol.for("#afterReconcile");var $15$6=Symbol(),$19$8=Symbol(),$21$4=Symbol(),$23$1=Symbol(),$27$3=Symbol(),$30$3=Symbol(),$31$3=Symbol(),$41$4=Symbol(),$43$6=Symbol(),$45$5=Symbol(),$47$2=Symbol(),$51=Symbol(),$54$6=Symbol(),$55$2=Symbol(),$59$1=Symbol(),$62$2=Symbol(),$63$6=Symbol();let c$0$i=Symbol();const Ze=class Ze extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.board=e&&(n=e.board)!==void 0?n:[],this.selected=e&&(n=e.selected)!==void 0?n:null,this.currentPlayer=e&&(n=e.currentPlayer)!==void 0?n:1,this.moves=e&&(n=e.moves)!==void 0?n:[],this.eatable=e&&(n=e.eatable)!==void 0?n:[],this.winner=e&&(n=e.winner)!==void 0?n:null,this.rotate=e&&(n=e.rotate)!==void 0?n:!1,this.hold=e&&(n=e.hold)!==void 0?n:!1}setup(){var e;this.board=[],e=[];for(let r=0;r<8;r++){let i=[];for(let n=0;n<8;n++)r<3&&(n+r)%2==1?i.push(-1):r>4&&(n+r)%2==1?i.push(1):i.push(0);e.push(this.board.push(i))}return e}isKing(e){return e==2||e==-2}isPlayer(e){return e==this.currentPlayer||e==2*this.currentPlayer}validΞmoves(e,r){let i=[],n=this.board[r][e],s=this.isKing(n)?[[1,-1],[-1,-1],[1,1],[-1,1]]:n==1?[[1,-1],[-1,-1]]:[[1,1],[-1,1]];for(let a=0,l=iterable$(s),u=l.length;a<u;a++){let p=l[a],f=p[0],c=p[1],h=e+f,d=r+c;h>=0&&d>=0&&h<8&&d<8&&this.board[d][h]==0?i.push({x:h,y:d}):h+f>=0&&d+c>=0&&h+f<8&&d+c<8&&this.board[d][h]*this.currentPlayer<0&&this.board[d+c][h+f]==0&&i.push({x:h+f,y:d+c})}return i}isEatable(e,r){var i;this.eatable=[];let n=this.board[r][e],s=this.isKing(n)?[[1,-1],[-1,-1],[1,1],[-1,1]]:n==1?[[1,-1],[-1,-1]]:[[1,1],[-1,1]];i=[];for(let a=0,l=iterable$(s),u=l.length;a<u;a++){let p=l[a],f=p[0],c=p[1],h=e+f,d=r+c,m=e+2*f,_=r+2*c;i.push(h>=0&&d>=0&&m>=0&&_>=0&&h<8&&d<8&&m<8&&_<8&&this.board[d][h]*this.currentPlayer<0&&this.board[_][m]==0&&this.eatable.push({x:h,y:d}))}return i}isEatableBySelected(e,r){return this.eatable.find(function(i){return i.x==e&&i.y==r})}select(e,r){if(!this.winner)return this.selected?this.move(e,r):this.isPlayer(this.board[r][e])?(this.selected={x:e,y:r},this.moves=this.validΞmoves(e,r),this.isEatable(e,r)):(this.selected=null,this.moves=[],this.eatable=[])}move(e,r){var i=this;let n=this.selected.x,s=this.selected.y,a=e-n,l=r-s,u=this.board[s][n];if(Math.abs(a)==1&&Math.abs(l)==1&&(this.isKing(u)||l==-this.currentPlayer)&&this.board[r][e]==0)return this.board[r][e]=u,this.board[s][n]=0,this.checkΞking(e,r),this.selected=null,this.moves=[],this.eatable=[],this.currentPlayer*=-1,this.hold=!0,setTimeout(function(){return i.rotate=!i.rotate,i.hold=!1,commit()},800),this.checkwin();if(Math.abs(a)==2&&Math.abs(l)==2){let p=n+a/2,f=s+l/2;if(this.board[f][p]*this.currentPlayer<0&&this.board[r][e]==0)return this.board[r][e]=u,this.board[s][n]=0,this.board[f][p]=0,this.checkΞking(e,r),this.selected=null,this.moves=[],this.eatable=[],this.checkwin()}else return this.selected=null,this.moves=[],this.eatable=[]}checkΞking(e,r){if(this.currentPlayer==1&&r==0&&this.board[r][e]==1)return this.board[r][e]=2;if(this.currentPlayer==-1&&r==7&&this.board[r][e]==-1)return this.board[r][e]=-2}isSelected(e,r){return this.selected&&this.selected.x==e&&this.selected.y==r}isPossibleMove(e,r){return this.moves.find(function(i){return i.x==e&&i.y==r})}checkwin(){let e=-this.currentPlayer,r=!1;for(let i=0;i<8;i++)for(let n=0;n<8;n++){let s=this.board[i][n];if(s*e>0){let a=this.isKing(s)?[[1,-1],[-1,-1],[1,1],[-1,1]]:s==1?[[1,-1],[-1,-1]]:[[1,1],[-1,1]];for(let l=0,u=iterable$(a),p=u.length;l<p;l++){let f=u[l],c=n+f[0],h=i+f[1],d=n+2*f[0],m=i+2*f[1];(c>=0&&h>=0&&c<8&&h<8&&this.board[h][c]==0||d>=0&&m>=0&&d<8&&m<8&&this.board[h][c]*e<0&&this.board[m][d]==0)&&(r=!0)}}}if(!r)return this.winner=this.currentPlayer}render(){var e=this,r,i,n,s,a,l,u,p=this._ns_||"",f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te;a=this,a[$beforeReconcile$$i](),l=u=1,a[$15$6]===1||(l=u=0,a[$15$6]=1),l||(f=createElement("div",a,`z9wpxhi-ah ${p}`,null)),(c=a[$19$8])||(a[$19$8]=c=createElement("div",f,`z9wpxhi-ai ${p}`,null)),r=null,this.hold?r="  ":this.winner?this.winner==1?r="White Wins!":r="Black Wins!":this.currentPlayer==1?r="White's Turn":r="Black's Turn",a[$21$4]=c[$placeChild$$g](r,0,a[$21$4]),d=1,(h=a[$23$1])||(d=0,a[$23$1]=h=createElement("div",f,`z9wpxhi-aj ${p}`,null)),m=this.rotate||void 0,m===a[$27$3]||(d|=2,a[$27$3]=m),d&2&&h.flag$(`z9wpxhi-aj ${p} `+(a[$27$3]?"rotate":"")),(_=a[$30$3])||(a[$30$3]=_=createElement("div",h,`z9wpxhi-ak ${p}`,null)),(g=a[$31$3])||(a[$31$3]=g=createIndexedList(2432,_)),b=0,x=g.$;for(let J=0;J<8;J++){(S=x[b])||(x[b]=S=createIndexedList(0,g)),T=0,I=S.$;for(let Z=0;Z<8;Z++)L=1,(O=I[T])||(L=0,I[T]=O=createElement("div",S,`z9wpxhi-al ${p}`,null)),L||(O[$$up$$g]=S),P=O[$41$4]||(O[$41$4]={$_:[function(pe,ae,oe,me){return e.select(oe,me)},null,null]}),P.$_[1]=Z,P.$_[2]=J,L||O.on$("click",P,this),C=this.isEatableBySelected(Z,J)?"#FF0000":(Z+J)%2==1?"#8B4513":"#F5DEB3",C===O[$43$6]||O.css$var("--z9wpxhi_am",O[$43$6]=C,null,"bg"),C=this.isSelected(Z,J)?"#FFD700":this.isPossibleMove(Z,J)?"#00FF00":"#333",C===O[$45$5]||O.css$var("--z9wpxhi_an",O[$45$5]=C,null,"bd"),s=null,this.board[J][Z]==1||this.board[J][Z]==2?(G=B=1,(s=O[$47$2])||(G=B=0,O[$47$2]=s=createElement("div",null,`z9wpxhi-ao ${p}`,null)),G||(s[$$up$$g]=O),H=this.rotate||void 0,H===s[$51]||(B|=2,s[$51]=H),B&2&&s.flag$(`z9wpxhi-ao ${p} `+(s[$51]?"rotate":"")),i=null,this.board[J][Z]==2&&(i="♛"),s[$54$6]=s[$placeChild$$g](i,0,s[$54$6])):(this.board[J][Z]==-1||this.board[J][Z]==-2)&&(ee=j=1,(s=O[$55$2])||(ee=j=0,O[$55$2]=s=createElement("div",null,`z9wpxhi-ap ${p}`,null)),ee||(s[$$up$$g]=O),te=this.rotate||void 0,te===s[$59$1]||(j|=2,s[$59$1]=te),j&2&&s.flag$(`z9wpxhi-ap ${p} `+(s[$59$1]?"rotate":"")),n=null,this.board[J][Z]==-2&&(n="♛"),s[$62$2]=s[$placeChild$$g](n,0,s[$62$2])),O[$63$6]=O[$placeChild$$g](s,0,O[$63$6]),T++;S[$afterVisit$$f](T),b++}return g[$afterVisit$$f](b),a[$afterReconcile$$i](u),a}};register$(Ze,c$0$i,"CheckerGame",2),defineTag("checker-game-z9wpxhi-aq",Ze,{cssid:"z9wpxhi-af"});let CheckerGame=Ze;/**
 * @license
 * Copyright (c) 2025, Jeff Hlywa (jhlywa@gmail.com)
 * All rights reserved.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *
 * 1. Redistributions of source code must retain the above copyright notice,
 *    this list of conditions and the following disclaimer.
 * 2. Redistributions in binary form must reproduce the above copyright notice,
 *    this list of conditions and the following disclaimer in the documentation
 *    and/or other materials provided with the distribution.
 *
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS"
 * AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
 * IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE
 * ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT OWNER OR CONTRIBUTORS BE
 * LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR
 * CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF
 * SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS
 * INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN
 * CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE)
 * ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE
 * POSSIBILITY OF SUCH DAMAGE.
 */const WHITE="w",BLACK="b",PAWN="p",KNIGHT="n",BISHOP="b",ROOK="r",QUEEN="q",KING="k",DEFAULT_POSITION="rnbqkbnr/pppppppp/8/8/8/8/PPPPPPPP/RNBQKBNR w KQkq - 0 1";class Move{color;from;to;piece;captured;promotion;flags;san;lan;before;after;constructor(e,r){const{color:i,piece:n,from:s,to:a,flags:l,captured:u,promotion:p}=r,f=algebraic(s),c=algebraic(a);this.color=i,this.piece=n,this.from=f,this.to=c,this.san=e._moveToSan(r,e._moves({legal:!0})),this.lan=f+c,this.before=e.fen(),e._makeMove(r),this.after=e.fen(),e._undoMove(),this.flags="";for(const h in BITS)BITS[h]&l&&(this.flags+=FLAGS[h]);u&&(this.captured=u),p&&(this.promotion=p,this.lan+=p)}isCapture(){return this.flags.indexOf(FLAGS.CAPTURE)>-1}isPromotion(){return this.flags.indexOf(FLAGS.PROMOTION)>-1}isEnPassant(){return this.flags.indexOf(FLAGS.EP_CAPTURE)>-1}isKingsideCastle(){return this.flags.indexOf(FLAGS.KSIDE_CASTLE)>-1}isQueensideCastle(){return this.flags.indexOf(FLAGS.QSIDE_CASTLE)>-1}isBigPawn(){return this.flags.indexOf(FLAGS.BIG_PAWN)>-1}}const EMPTY=-1,FLAGS={NORMAL:"n",CAPTURE:"c",BIG_PAWN:"b",EP_CAPTURE:"e",PROMOTION:"p",KSIDE_CASTLE:"k",QSIDE_CASTLE:"q"},BITS={NORMAL:1,CAPTURE:2,BIG_PAWN:4,EP_CAPTURE:8,PROMOTION:16,KSIDE_CASTLE:32,QSIDE_CASTLE:64},SEVEN_TAG_ROSTER={Event:"?",Site:"?",Date:"????.??.??",Round:"?",White:"?",Black:"?",Result:"*"},SUPLEMENTAL_TAGS={WhiteTitle:null,BlackTitle:null,WhiteElo:null,BlackElo:null,WhiteUSCF:null,BlackUSCF:null,WhiteNA:null,BlackNA:null,WhiteType:null,BlackType:null,EventDate:null,EventSponsor:null,Section:null,Stage:null,Board:null,Opening:null,Variation:null,SubVariation:null,ECO:null,NIC:null,Time:null,UTCTime:null,UTCDate:null,TimeControl:null,SetUp:null,FEN:null,Termination:null,Annotator:null,Mode:null,PlyCount:null},HEADER_TEMPLATE={...SEVEN_TAG_ROSTER,...SUPLEMENTAL_TAGS},Ox88={a8:0,b8:1,c8:2,d8:3,e8:4,f8:5,g8:6,h8:7,a7:16,b7:17,c7:18,d7:19,e7:20,f7:21,g7:22,h7:23,a6:32,b6:33,c6:34,d6:35,e6:36,f6:37,g6:38,h6:39,a5:48,b5:49,c5:50,d5:51,e5:52,f5:53,g5:54,h5:55,a4:64,b4:65,c4:66,d4:67,e4:68,f4:69,g4:70,h4:71,a3:80,b3:81,c3:82,d3:83,e3:84,f3:85,g3:86,h3:87,a2:96,b2:97,c2:98,d2:99,e2:100,f2:101,g2:102,h2:103,a1:112,b1:113,c1:114,d1:115,e1:116,f1:117,g1:118,h1:119},PAWN_OFFSETS={b:[16,32,17,15],w:[-16,-32,-17,-15]},PIECE_OFFSETS={n:[-18,-33,-31,-14,18,33,31,14],b:[-17,-15,17,15],r:[-16,1,16,-1],q:[-17,-16,-15,1,17,16,15,-1],k:[-17,-16,-15,1,17,16,15,-1]},ATTACKS=[20,0,0,0,0,0,0,24,0,0,0,0,0,0,20,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,24,24,24,24,24,24,56,0,56,24,24,24,24,24,24,0,0,0,0,0,0,2,53,56,53,2,0,0,0,0,0,0,0,0,0,0,0,20,2,24,2,20,0,0,0,0,0,0,0,0,0,0,20,0,0,24,0,0,20,0,0,0,0,0,0,0,0,20,0,0,0,24,0,0,0,20,0,0,0,0,0,0,20,0,0,0,0,24,0,0,0,0,20,0,0,0,0,20,0,0,0,0,0,24,0,0,0,0,0,20,0,0,20,0,0,0,0,0,0,24,0,0,0,0,0,0,20],RAYS=[17,0,0,0,0,0,0,16,0,0,0,0,0,0,15,0,0,17,0,0,0,0,0,16,0,0,0,0,0,15,0,0,0,0,17,0,0,0,0,16,0,0,0,0,15,0,0,0,0,0,0,17,0,0,0,16,0,0,0,15,0,0,0,0,0,0,0,0,17,0,0,16,0,0,15,0,0,0,0,0,0,0,0,0,0,17,0,16,0,15,0,0,0,0,0,0,0,0,0,0,0,0,17,16,15,0,0,0,0,0,0,0,1,1,1,1,1,1,1,0,-1,-1,-1,-1,-1,-1,-1,0,0,0,0,0,0,0,-15,-16,-17,0,0,0,0,0,0,0,0,0,0,0,0,-15,0,-16,0,-17,0,0,0,0,0,0,0,0,0,0,-15,0,0,-16,0,0,-17,0,0,0,0,0,0,0,0,-15,0,0,0,-16,0,0,0,-17,0,0,0,0,0,0,-15,0,0,0,0,-16,0,0,0,0,-17,0,0,0,0,-15,0,0,0,0,0,-16,0,0,0,0,0,-17,0,0,-15,0,0,0,0,0,0,-16,0,0,0,0,0,0,-17],PIECE_MASKS={p:1,n:2,b:4,r:8,q:16,k:32},SYMBOLS="pnbrqkPNBRQK",PROMOTIONS=[KNIGHT,BISHOP,ROOK,QUEEN],RANK_1=7,RANK_2=6,RANK_7=1,RANK_8=0,SIDES={[KING]:BITS.KSIDE_CASTLE,[QUEEN]:BITS.QSIDE_CASTLE},ROOKS={w:[{square:Ox88.a1,flag:BITS.QSIDE_CASTLE},{square:Ox88.h1,flag:BITS.KSIDE_CASTLE}],b:[{square:Ox88.a8,flag:BITS.QSIDE_CASTLE},{square:Ox88.h8,flag:BITS.KSIDE_CASTLE}]},SECOND_RANK={b:RANK_7,w:RANK_2},TERMINATION_MARKERS=["1-0","0-1","1/2-1/2","*"];function rank(t){return t>>4}function file(t){return t&15}function isDigit(t){return"0123456789".indexOf(t)!==-1}function algebraic(t){const e=file(t),r=rank(t);return"abcdefgh".substring(e,e+1)+"87654321".substring(r,r+1)}function swapColor(t){return t===WHITE?BLACK:WHITE}function validateFen(t){const e=t.split(/\s+/);if(e.length!==6)return{ok:!1,error:"Invalid FEN: must contain six space-delimited fields"};const r=parseInt(e[5],10);if(isNaN(r)||r<=0)return{ok:!1,error:"Invalid FEN: move number must be a positive integer"};const i=parseInt(e[4],10);if(isNaN(i)||i<0)return{ok:!1,error:"Invalid FEN: half move counter number must be a non-negative integer"};if(!/^(-|[abcdefgh][36])$/.test(e[3]))return{ok:!1,error:"Invalid FEN: en-passant square is invalid"};if(/[^kKqQ-]/.test(e[2]))return{ok:!1,error:"Invalid FEN: castling availability is invalid"};if(!/^(w|b)$/.test(e[1]))return{ok:!1,error:"Invalid FEN: side-to-move is invalid"};const n=e[0].split("/");if(n.length!==8)return{ok:!1,error:"Invalid FEN: piece data does not contain 8 '/'-delimited rows"};for(let a=0;a<n.length;a++){let l=0,u=!1;for(let p=0;p<n[a].length;p++)if(isDigit(n[a][p])){if(u)return{ok:!1,error:"Invalid FEN: piece data is invalid (consecutive number)"};l+=parseInt(n[a][p],10),u=!0}else{if(!/^[prnbqkPRNBQK]$/.test(n[a][p]))return{ok:!1,error:"Invalid FEN: piece data is invalid (invalid piece)"};l+=1,u=!1}if(l!==8)return{ok:!1,error:"Invalid FEN: piece data is invalid (too many squares in rank)"}}if(e[3][1]=="3"&&e[1]=="w"||e[3][1]=="6"&&e[1]=="b")return{ok:!1,error:"Invalid FEN: illegal en-passant square"};const s=[{color:"white",regex:/K/g},{color:"black",regex:/k/g}];for(const{color:a,regex:l}of s){if(!l.test(e[0]))return{ok:!1,error:`Invalid FEN: missing ${a} king`};if((e[0].match(l)||[]).length>1)return{ok:!1,error:`Invalid FEN: too many ${a} kings`}}return Array.from(n[0]+n[7]).some(a=>a.toUpperCase()==="P")?{ok:!1,error:"Invalid FEN: some pawns are on the edge rows"}:{ok:!0}}function getDisambiguator(t,e){const r=t.from,i=t.to,n=t.piece;let s=0,a=0,l=0;for(let u=0,p=e.length;u<p;u++){const f=e[u].from,c=e[u].to,h=e[u].piece;n===h&&r!==f&&i===c&&(s++,rank(r)===rank(f)&&a++,file(r)===file(f)&&l++)}return s>0?a>0&&l>0?algebraic(r):l>0?algebraic(r).charAt(1):algebraic(r).charAt(0):""}function addMove(t,e,r,i,n,s=void 0,a=BITS.NORMAL){const l=rank(i);if(n===PAWN&&(l===RANK_1||l===RANK_8))for(let u=0;u<PROMOTIONS.length;u++){const p=PROMOTIONS[u];t.push({color:e,from:r,to:i,piece:n,captured:s,promotion:p,flags:a|BITS.PROMOTION})}else t.push({color:e,from:r,to:i,piece:n,captured:s,flags:a})}function inferPieceType(t){let e=t.charAt(0);return e>="a"&&e<="h"?t.match(/[a-h]\d.*[a-h]\d/)?void 0:PAWN:(e=e.toLowerCase(),e==="o"?KING:e)}function strippedSan(t){return t.replace(/=/,"").replace(/[+#]?[?!]*$/,"")}function trimFen(t){return t.split(" ").slice(0,4).join(" ")}class Chess{_board=new Array(128);_turn=WHITE;_header={};_kings={w:EMPTY,b:EMPTY};_epSquare=-1;_halfMoves=0;_moveNumber=0;_history=[];_comments={};_castling={w:0,b:0};_positionCount={};constructor(e=DEFAULT_POSITION,{skipValidation:r=!1}={}){this.load(e,{skipValidation:r})}clear({preserveHeaders:e=!1}={}){this._board=new Array(128),this._kings={w:EMPTY,b:EMPTY},this._turn=WHITE,this._castling={w:0,b:0},this._epSquare=EMPTY,this._halfMoves=0,this._moveNumber=1,this._history=[],this._comments={},this._header=e?this._header:{...HEADER_TEMPLATE},this._positionCount={},this._header.SetUp=null,this._header.FEN=null}load(e,{skipValidation:r=!1,preserveHeaders:i=!1}={}){let n=e.split(/\s+/);if(n.length>=2&&n.length<6){const l=["-","-","0","1"];e=n.concat(l.slice(-(6-n.length))).join(" ")}if(n=e.split(/\s+/),!r){const{ok:l,error:u}=validateFen(e);if(!l)throw new Error(u)}const s=n[0];let a=0;this.clear({preserveHeaders:i});for(let l=0;l<s.length;l++){const u=s.charAt(l);if(u==="/")a+=8;else if(isDigit(u))a+=parseInt(u,10);else{const p=u<"a"?WHITE:BLACK;this._put({type:u.toLowerCase(),color:p},algebraic(a)),a++}}this._turn=n[1],n[2].indexOf("K")>-1&&(this._castling.w|=BITS.KSIDE_CASTLE),n[2].indexOf("Q")>-1&&(this._castling.w|=BITS.QSIDE_CASTLE),n[2].indexOf("k")>-1&&(this._castling.b|=BITS.KSIDE_CASTLE),n[2].indexOf("q")>-1&&(this._castling.b|=BITS.QSIDE_CASTLE),this._epSquare=n[3]==="-"?EMPTY:Ox88[n[3]],this._halfMoves=parseInt(n[4],10),this._moveNumber=parseInt(n[5],10),this._updateSetup(e),this._incPositionCount(e)}fen(){var s,a;let e=0,r="";for(let l=Ox88.a8;l<=Ox88.h1;l++){if(this._board[l]){e>0&&(r+=e,e=0);const{color:u,type:p}=this._board[l];r+=u===WHITE?p.toUpperCase():p.toLowerCase()}else e++;l+1&136&&(e>0&&(r+=e),l!==Ox88.h1&&(r+="/"),e=0,l+=8)}let i="";this._castling[WHITE]&BITS.KSIDE_CASTLE&&(i+="K"),this._castling[WHITE]&BITS.QSIDE_CASTLE&&(i+="Q"),this._castling[BLACK]&BITS.KSIDE_CASTLE&&(i+="k"),this._castling[BLACK]&BITS.QSIDE_CASTLE&&(i+="q"),i=i||"-";let n="-";if(this._epSquare!==EMPTY){const l=this._epSquare+(this._turn===WHITE?16:-16),u=[l+1,l-1];for(const p of u){if(p&136)continue;const f=this._turn;if(((s=this._board[p])==null?void 0:s.color)===f&&((a=this._board[p])==null?void 0:a.type)===PAWN){this._makeMove({color:f,from:p,to:this._epSquare,piece:PAWN,captured:PAWN,flags:BITS.EP_CAPTURE});const c=!this._isKingAttacked(f);if(this._undoMove(),c){n=algebraic(this._epSquare);break}}}}return[r,this._turn,i,n,this._halfMoves,this._moveNumber].join(" ")}_updateSetup(e){this._history.length>0||(e!==DEFAULT_POSITION?(this._header.SetUp="1",this._header.FEN=e):(this._header.SetUp=null,this._header.FEN=null))}reset(){this.load(DEFAULT_POSITION)}get(e){return this._board[Ox88[e]]}findPiece(e){var i;const r=[];for(let n=Ox88.a8;n<=Ox88.h1;n++){if(n&136){n+=7;continue}!this._board[n]||((i=this._board[n])==null?void 0:i.color)!==e.color||this._board[n].color===e.color&&this._board[n].type===e.type&&r.push(algebraic(n))}return r}put({type:e,color:r},i){return this._put({type:e,color:r},i)?(this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),!0):!1}_put({type:e,color:r},i){if(SYMBOLS.indexOf(e.toLowerCase())===-1||!(i in Ox88))return!1;const n=Ox88[i];if(e==KING&&!(this._kings[r]==EMPTY||this._kings[r]==n))return!1;const s=this._board[n];return s&&s.type===KING&&(this._kings[s.color]=EMPTY),this._board[n]={type:e,color:r},e===KING&&(this._kings[r]=n),!0}remove(e){const r=this.get(e);return delete this._board[Ox88[e]],r&&r.type===KING&&(this._kings[r.color]=EMPTY),this._updateCastlingRights(),this._updateEnPassantSquare(),this._updateSetup(this.fen()),r}_updateCastlingRights(){var i,n,s,a,l,u,p,f,c,h,d,m;const e=((i=this._board[Ox88.e1])==null?void 0:i.type)===KING&&((n=this._board[Ox88.e1])==null?void 0:n.color)===WHITE,r=((s=this._board[Ox88.e8])==null?void 0:s.type)===KING&&((a=this._board[Ox88.e8])==null?void 0:a.color)===BLACK;(!e||((l=this._board[Ox88.a1])==null?void 0:l.type)!==ROOK||((u=this._board[Ox88.a1])==null?void 0:u.color)!==WHITE)&&(this._castling.w&=-65),(!e||((p=this._board[Ox88.h1])==null?void 0:p.type)!==ROOK||((f=this._board[Ox88.h1])==null?void 0:f.color)!==WHITE)&&(this._castling.w&=-33),(!r||((c=this._board[Ox88.a8])==null?void 0:c.type)!==ROOK||((h=this._board[Ox88.a8])==null?void 0:h.color)!==BLACK)&&(this._castling.b&=-65),(!r||((d=this._board[Ox88.h8])==null?void 0:d.type)!==ROOK||((m=this._board[Ox88.h8])==null?void 0:m.color)!==BLACK)&&(this._castling.b&=-33)}_updateEnPassantSquare(){var s,a;if(this._epSquare===EMPTY)return;const e=this._epSquare+(this._turn===WHITE?-16:16),r=this._epSquare+(this._turn===WHITE?16:-16),i=[r+1,r-1];if(this._board[e]!==null||this._board[this._epSquare]!==null||((s=this._board[r])==null?void 0:s.color)!==swapColor(this._turn)||((a=this._board[r])==null?void 0:a.type)!==PAWN){this._epSquare=EMPTY;return}const n=l=>{var u,p;return!(l&136)&&((u=this._board[l])==null?void 0:u.color)===this._turn&&((p=this._board[l])==null?void 0:p.type)===PAWN};i.some(n)||(this._epSquare=EMPTY)}_attacked(e,r,i){const n=[];for(let s=Ox88.a8;s<=Ox88.h1;s++){if(s&136){s+=7;continue}if(this._board[s]===void 0||this._board[s].color!==e)continue;const a=this._board[s],l=s-r;if(l===0)continue;const u=l+119;if(ATTACKS[u]&PIECE_MASKS[a.type]){if(a.type===PAWN){if(l>0&&a.color===WHITE||l<=0&&a.color===BLACK)if(i)n.push(algebraic(s));else return!0;continue}if(a.type==="n"||a.type==="k")if(i){n.push(algebraic(s));continue}else return!0;const p=RAYS[u];let f=s+p,c=!1;for(;f!==r;){if(this._board[f]!=null){c=!0;break}f+=p}if(!c)if(i){n.push(algebraic(s));continue}else return!0}}return i?n:!1}attackers(e,r){return r?this._attacked(r,Ox88[e],!0):this._attacked(this._turn,Ox88[e],!0)}_isKingAttacked(e){const r=this._kings[e];return r===-1?!1:this._attacked(swapColor(e),r)}isAttacked(e,r){return this._attacked(r,Ox88[e])}isCheck(){return this._isKingAttacked(this._turn)}inCheck(){return this.isCheck()}isCheckmate(){return this.isCheck()&&this._moves().length===0}isStalemate(){return!this.isCheck()&&this._moves().length===0}isInsufficientMaterial(){const e={b:0,n:0,r:0,q:0,k:0,p:0},r=[];let i=0,n=0;for(let s=Ox88.a8;s<=Ox88.h1;s++){if(n=(n+1)%2,s&136){s+=7;continue}const a=this._board[s];a&&(e[a.type]=a.type in e?e[a.type]+1:1,a.type===BISHOP&&r.push(n),i++)}if(i===2)return!0;if(i===3&&(e[BISHOP]===1||e[KNIGHT]===1))return!0;if(i===e[BISHOP]+2){let s=0;const a=r.length;for(let l=0;l<a;l++)s+=r[l];if(s===0||s===a)return!0}return!1}isThreefoldRepetition(){return this._getPositionCount(this.fen())>=3}isDrawByFiftyMoves(){return this._halfMoves>=100}isDraw(){return this.isDrawByFiftyMoves()||this.isStalemate()||this.isInsufficientMaterial()||this.isThreefoldRepetition()}isGameOver(){return this.isCheckmate()||this.isStalemate()||this.isDraw()}moves({verbose:e=!1,square:r=void 0,piece:i=void 0}={}){const n=this._moves({square:r,piece:i});return e?n.map(s=>new Move(this,s)):n.map(s=>this._moveToSan(s,n))}_moves({legal:e=!0,piece:r=void 0,square:i=void 0}={}){var d;const n=i?i.toLowerCase():void 0,s=r==null?void 0:r.toLowerCase(),a=[],l=this._turn,u=swapColor(l);let p=Ox88.a8,f=Ox88.h1,c=!1;if(n)if(n in Ox88)p=f=Ox88[n],c=!0;else return[];for(let m=p;m<=f;m++){if(m&136){m+=7;continue}if(!this._board[m]||this._board[m].color===u)continue;const{type:_}=this._board[m];let g;if(_===PAWN){if(s&&s!==_)continue;g=m+PAWN_OFFSETS[l][0],this._board[g]||(addMove(a,l,m,g,PAWN),g=m+PAWN_OFFSETS[l][1],SECOND_RANK[l]===rank(m)&&!this._board[g]&&addMove(a,l,m,g,PAWN,void 0,BITS.BIG_PAWN));for(let b=2;b<4;b++)g=m+PAWN_OFFSETS[l][b],!(g&136)&&(((d=this._board[g])==null?void 0:d.color)===u?addMove(a,l,m,g,PAWN,this._board[g].type,BITS.CAPTURE):g===this._epSquare&&addMove(a,l,m,g,PAWN,PAWN,BITS.EP_CAPTURE))}else{if(s&&s!==_)continue;for(let b=0,x=PIECE_OFFSETS[_].length;b<x;b++){const S=PIECE_OFFSETS[_][b];for(g=m;g+=S,!(g&136);){if(!this._board[g])addMove(a,l,m,g,_);else{if(this._board[g].color===l)break;addMove(a,l,m,g,_,this._board[g].type,BITS.CAPTURE);break}if(_===KNIGHT||_===KING)break}}}}if((s===void 0||s===KING)&&(!c||f===this._kings[l])){if(this._castling[l]&BITS.KSIDE_CASTLE){const m=this._kings[l],_=m+2;!this._board[m+1]&&!this._board[_]&&!this._attacked(u,this._kings[l])&&!this._attacked(u,m+1)&&!this._attacked(u,_)&&addMove(a,l,this._kings[l],_,KING,void 0,BITS.KSIDE_CASTLE)}if(this._castling[l]&BITS.QSIDE_CASTLE){const m=this._kings[l],_=m-2;!this._board[m-1]&&!this._board[m-2]&&!this._board[m-3]&&!this._attacked(u,this._kings[l])&&!this._attacked(u,m-1)&&!this._attacked(u,_)&&addMove(a,l,this._kings[l],_,KING,void 0,BITS.QSIDE_CASTLE)}}if(!e||this._kings[l]===-1)return a;const h=[];for(let m=0,_=a.length;m<_;m++)this._makeMove(a[m]),this._isKingAttacked(l)||h.push(a[m]),this._undoMove();return h}move(e,{strict:r=!1}={}){let i=null;if(typeof e=="string")i=this._moveFromSan(e,r);else if(typeof e=="object"){const s=this._moves();for(let a=0,l=s.length;a<l;a++)if(e.from===algebraic(s[a].from)&&e.to===algebraic(s[a].to)&&(!("promotion"in s[a])||e.promotion===s[a].promotion)){i=s[a];break}}if(!i)throw typeof e=="string"?new Error(`Invalid move: ${e}`):new Error(`Invalid move: ${JSON.stringify(e)}`);const n=new Move(this,i);return this._makeMove(i),this._incPositionCount(n.after),n}_push(e){this._history.push({move:e,kings:{b:this._kings.b,w:this._kings.w},turn:this._turn,castling:{b:this._castling.b,w:this._castling.w},epSquare:this._epSquare,halfMoves:this._halfMoves,moveNumber:this._moveNumber})}_makeMove(e){const r=this._turn,i=swapColor(r);if(this._push(e),this._board[e.to]=this._board[e.from],delete this._board[e.from],e.flags&BITS.EP_CAPTURE&&(this._turn===BLACK?delete this._board[e.to-16]:delete this._board[e.to+16]),e.promotion&&(this._board[e.to]={type:e.promotion,color:r}),this._board[e.to].type===KING){if(this._kings[r]=e.to,e.flags&BITS.KSIDE_CASTLE){const n=e.to-1,s=e.to+1;this._board[n]=this._board[s],delete this._board[s]}else if(e.flags&BITS.QSIDE_CASTLE){const n=e.to+1,s=e.to-2;this._board[n]=this._board[s],delete this._board[s]}this._castling[r]=0}if(this._castling[r]){for(let n=0,s=ROOKS[r].length;n<s;n++)if(e.from===ROOKS[r][n].square&&this._castling[r]&ROOKS[r][n].flag){this._castling[r]^=ROOKS[r][n].flag;break}}if(this._castling[i]){for(let n=0,s=ROOKS[i].length;n<s;n++)if(e.to===ROOKS[i][n].square&&this._castling[i]&ROOKS[i][n].flag){this._castling[i]^=ROOKS[i][n].flag;break}}e.flags&BITS.BIG_PAWN?r===BLACK?this._epSquare=e.to-16:this._epSquare=e.to+16:this._epSquare=EMPTY,e.piece===PAWN?this._halfMoves=0:e.flags&(BITS.CAPTURE|BITS.EP_CAPTURE)?this._halfMoves=0:this._halfMoves++,r===BLACK&&this._moveNumber++,this._turn=i}undo(){const e=this._undoMove();if(e){const r=new Move(this,e);return this._decPositionCount(r.after),r}return null}_undoMove(){const e=this._history.pop();if(e===void 0)return null;const r=e.move;this._kings=e.kings,this._turn=e.turn,this._castling=e.castling,this._epSquare=e.epSquare,this._halfMoves=e.halfMoves,this._moveNumber=e.moveNumber;const i=this._turn,n=swapColor(i);if(this._board[r.from]=this._board[r.to],this._board[r.from].type=r.piece,delete this._board[r.to],r.captured)if(r.flags&BITS.EP_CAPTURE){let s;i===BLACK?s=r.to-16:s=r.to+16,this._board[s]={type:PAWN,color:n}}else this._board[r.to]={type:r.captured,color:n};if(r.flags&(BITS.KSIDE_CASTLE|BITS.QSIDE_CASTLE)){let s,a;r.flags&BITS.KSIDE_CASTLE?(s=r.to+1,a=r.to-1):(s=r.to-2,a=r.to+1),this._board[s]=this._board[a],delete this._board[a]}return r}pgn({newline:e=`
`,maxWidth:r=0}={}){const i=[];let n=!1;for(const h in this._header)this._header[h]&&i.push(`[${h} "${this._header[h]}"]`+e),n=!0;n&&this._history.length&&i.push(e);const s=h=>{const d=this._comments[this.fen()];if(typeof d<"u"){const m=h.length>0?" ":"";h=`${h}${m}{${d}}`}return h},a=[];for(;this._history.length>0;)a.push(this._undoMove());const l=[];let u="";for(a.length===0&&l.push(s(""));a.length>0;){u=s(u);const h=a.pop();if(!h)break;if(!this._history.length&&h.color==="b"){const d=`${this._moveNumber}. ...`;u=u?`${u} ${d}`:d}else h.color==="w"&&(u.length&&l.push(u),u=this._moveNumber+".");u=u+" "+this._moveToSan(h,this._moves({legal:!0})),this._makeMove(h)}if(u.length&&l.push(s(u)),l.push(this._header.Result||"*"),r===0)return i.join("")+l.join(" ");const p=function(){return i.length>0&&i[i.length-1]===" "?(i.pop(),!0):!1},f=function(h,d){for(const m of d.split(" "))if(m){if(h+m.length>r){for(;p();)h--;i.push(e),h=0}i.push(m),h+=m.length,i.push(" "),h++}return p()&&h--,h};let c=0;for(let h=0;h<l.length;h++){if(c+l[h].length>r&&l[h].includes("{")){c=f(c,l[h]);continue}c+l[h].length>r&&h!==0?(i[i.length-1]===" "&&i.pop(),i.push(e),c=0):h!==0&&(i.push(" "),c++),i.push(l[h]),c+=l[h].length}return i.join("")}header(...e){for(let r=0;r<e.length;r+=2)typeof e[r]=="string"&&typeof e[r+1]=="string"&&(this._header[e[r]]=e[r+1]);return this._header}setHeader(e,r){var i;return this._header[e]=(i=r!=null?r:SEVEN_TAG_ROSTER[e])!=null?i:null,this.getHeaders()}removeHeader(e){return e in this._header?(this._header[e]=SEVEN_TAG_ROSTER[e]||null,!0):!1}getHeaders(){const e={};for(const[r,i]of Object.entries(this._header))i!==null&&(e[r]=i);return e}loadPgn(e,{strict:r=!1,newlineChar:i=`\r?
`}={}){function n(S){return S.replace(/\\/g,"\\")}function s(S){const T={},I=S.split(new RegExp(n(i)));let O="",L="";for(let P=0;P<I.length;P++){const C=/^\s*\[\s*([A-Za-z]+)\s*"(.*)"\s*\]\s*$/;O=I[P].replace(C,"$1"),L=I[P].replace(C,"$2"),O.trim().length>0&&(T[O]=L)}return T}e=e.trim();const l=new RegExp("^(\\[((?:"+n(i)+")|.)*\\])((?:\\s*"+n(i)+"){2}|(?:\\s*"+n(i)+")*$)").exec(e),u=l&&l.length>=2?l[1]:"";this.reset();const p=s(u);let f="";for(const S in p)S.toLowerCase()==="fen"&&(f=p[S]),this.header(S,p[S]);if(!r)f&&this.load(f,{preserveHeaders:!0});else if(p.SetUp==="1"){if(!("FEN"in p))throw new Error("Invalid PGN: FEN tag must be supplied with SetUp tag");this.load(p.FEN,{preserveHeaders:!0})}function c(S){return Array.from(S).map(function(T){return T.charCodeAt(0)<128?T.charCodeAt(0).toString(16):encodeURIComponent(T).replace(/%/g,"").toLowerCase()}).join("")}function h(S){return S.length==0?"":decodeURIComponent("%"+(S.match(/.{1,2}/g)||[]).join("%"))}const d=function(S){return S=S.replace(new RegExp(n(i),"g")," "),`{${c(S.slice(1,S.length-1))}}`},m=function(S){if(S.startsWith("{")&&S.endsWith("}"))return h(S.slice(1,S.length-1))};let _=e.replace(u,"").replace(new RegExp(`({[^}]*})+?|;([^${n(i)}]*)`,"g"),function(S,T,I){return T!==void 0?d(T):" "+d(`{${I.slice(1)}}`)}).replace(new RegExp(n(i),"g")," ");const g=/(\([^()]+\))+?/g;for(;g.test(_);)_=_.replace(g,"");_=_.replace(/\d+\.(\.\.)?/g,""),_=_.replace(/\.\.\./g,""),_=_.replace(/\$\d+/g,"");let b=_.trim().split(new RegExp(/\s+/));b=b.filter(S=>S!=="");let x="";for(let S=0;S<b.length;S++){const T=m(b[S]);if(T!==void 0){this._comments[this.fen()]=T;continue}const I=this._moveFromSan(b[S],r);if(I==null)if(TERMINATION_MARKERS.indexOf(b[S])>-1)x=b[S];else throw new Error(`Invalid move in PGN: ${b[S]}`);else x="",this._makeMove(I),this._incPositionCount(this.fen())}x&&Object.keys(this._header).length&&this._header.Result!==x&&this.setHeader("Result",x)}_moveToSan(e,r){let i="";if(e.flags&BITS.KSIDE_CASTLE)i="O-O";else if(e.flags&BITS.QSIDE_CASTLE)i="O-O-O";else{if(e.piece!==PAWN){const n=getDisambiguator(e,r);i+=e.piece.toUpperCase()+n}e.flags&(BITS.CAPTURE|BITS.EP_CAPTURE)&&(e.piece===PAWN&&(i+=algebraic(e.from)[0]),i+="x"),i+=algebraic(e.to),e.promotion&&(i+="="+e.promotion.toUpperCase())}return this._makeMove(e),this.isCheck()&&(this.isCheckmate()?i+="#":i+="+"),this._undoMove(),i}_moveFromSan(e,r=!1){const i=strippedSan(e);let n=inferPieceType(i),s=this._moves({legal:!0,piece:n});for(let h=0,d=s.length;h<d;h++)if(i===strippedSan(this._moveToSan(s[h],s)))return s[h];if(r)return null;let a,l,u,p,f,c=!1;if(l=i.match(/([pnbrqkPNBRQK])?([a-h][1-8])x?-?([a-h][1-8])([qrbnQRBN])?/),l?(a=l[1],u=l[2],p=l[3],f=l[4],u.length==1&&(c=!0)):(l=i.match(/([pnbrqkPNBRQK])?([a-h]?[1-8]?)x?-?([a-h][1-8])([qrbnQRBN])?/),l&&(a=l[1],u=l[2],p=l[3],f=l[4],u.length==1&&(c=!0))),n=inferPieceType(i),s=this._moves({legal:!0,piece:a||n}),!p)return null;for(let h=0,d=s.length;h<d;h++)if(u){if((!a||a.toLowerCase()==s[h].piece)&&Ox88[u]==s[h].from&&Ox88[p]==s[h].to&&(!f||f.toLowerCase()==s[h].promotion))return s[h];if(c){const m=algebraic(s[h].from);if((!a||a.toLowerCase()==s[h].piece)&&Ox88[p]==s[h].to&&(u==m[0]||u==m[1])&&(!f||f.toLowerCase()==s[h].promotion))return s[h]}}else if(i===strippedSan(this._moveToSan(s[h],s)).replace("x",""))return s[h];return null}ascii(){let e=`   +------------------------+
`;for(let r=Ox88.a8;r<=Ox88.h1;r++){if(file(r)===0&&(e+=" "+"87654321"[rank(r)]+" |"),this._board[r]){const i=this._board[r].type,s=this._board[r].color===WHITE?i.toUpperCase():i.toLowerCase();e+=" "+s+" "}else e+=" . ";r+1&136&&(e+=`|
`,r+=8)}return e+=`   +------------------------+
`,e+="     a  b  c  d  e  f  g  h",e}perft(e){const r=this._moves({legal:!1});let i=0;const n=this._turn;for(let s=0,a=r.length;s<a;s++)this._makeMove(r[s]),this._isKingAttacked(n)||(e-1>0?i+=this.perft(e-1):i++),this._undoMove();return i}turn(){return this._turn}board(){const e=[];let r=[];for(let i=Ox88.a8;i<=Ox88.h1;i++)this._board[i]==null?r.push(null):r.push({square:algebraic(i),type:this._board[i].type,color:this._board[i].color}),i+1&136&&(e.push(r),r=[],i+=8);return e}squareColor(e){if(e in Ox88){const r=Ox88[e];return(rank(r)+file(r))%2===0?"light":"dark"}return null}history({verbose:e=!1}={}){const r=[],i=[];for(;this._history.length>0;)r.push(this._undoMove());for(;;){const n=r.pop();if(!n)break;e?i.push(new Move(this,n)):i.push(this._moveToSan(n,this._moves())),this._makeMove(n)}return i}_getPositionCount(e){const r=trimFen(e);return this._positionCount[r]||0}_incPositionCount(e){const r=trimFen(e);this._positionCount[r]===void 0&&(this._positionCount[r]=0),this._positionCount[r]+=1}_decPositionCount(e){const r=trimFen(e);this._positionCount[r]===1?delete this._positionCount[r]:this._positionCount[r]-=1}_pruneComments(){const e=[],r={},i=n=>{n in this._comments&&(r[n]=this._comments[n])};for(;this._history.length>0;)e.push(this._undoMove());for(i(this.fen());;){const n=e.pop();if(!n)break;this._makeMove(n),i(this.fen())}this._comments=r}getComment(){return this._comments[this.fen()]}setComment(e){this._comments[this.fen()]=e.replace("{","[").replace("}","]")}deleteComment(){return this.removeComment()}removeComment(){const e=this._comments[this.fen()];return delete this._comments[this.fen()],e}getComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>({fen:e,comment:this._comments[e]}))}deleteComments(){return this.removeComments()}removeComments(){return this._pruneComments(),Object.keys(this._comments).map(e=>{const r=this._comments[e];return delete this._comments[e],{fen:e,comment:r}})}setCastlingRights(e,r){for(const n of[KING,QUEEN])r[n]!==void 0&&(r[n]?this._castling[e]|=SIDES[n]:this._castling[e]&=~SIDES[n]);this._updateCastlingRights();const i=this.getCastlingRights(e);return(r[KING]===void 0||r[KING]===i[KING])&&(r[QUEEN]===void 0||r[QUEEN]===i[QUEEN])}getCastlingRights(e){return{[KING]:(this._castling[e]&SIDES[KING])!==0,[QUEEN]:(this._castling[e]&SIDES[QUEEN])!==0}}moveNumber(){return this._moveNumber}}use_events(),use_events_mouse(),use_styles();const $beforeReconcile$$h=Symbol.for("#beforeReconcile"),$$up$$f=Symbol.for("##up"),$placeChild$$f=Symbol.for("#placeChild"),$afterReconcile$$h=Symbol.for("#afterReconcile"),$afterVisit$$e=Symbol.for("#afterVisit"),$appendChild$$6=Symbol.for("#appendChild");var $4$9=Symbol(),$7$3=Symbol(),$10$4=Symbol(),$12$2=Symbol(),$15$5=Symbol(),$17$7=Symbol(),$20$4=Symbol(),$22$7=Symbol(),$26$3=Symbol(),$28$3=Symbol(),$29$6=Symbol(),$33$3=Symbol(),$37$4=Symbol(),$39$3=Symbol(),$40$3=Symbol(),$42$2=Symbol(),$43$5=Symbol(),$53=Symbol(),$54$5=Symbol(),$59=Symbol(),$63$5=Symbol(),$65$3=Symbol(),$66$4=Symbol(),$69$1=Symbol(),$72$1=Symbol(),$74$2=Symbol(),$78$1=Symbol(),$80$1=Symbol(),$90$1=Symbol(),$91$1=Symbol(),$93$2=Symbol(),$96=Symbol();let game=new Chess,selected$2=null,board=game.board(),legalTargets$1=[],lastMove$1=null,capturedWhite=[],capturedBlack=[],rotate$1=!1,hold=!1;const pieceEmojis$1={p:"♟",r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",P:"♙",R:"♖",N:"♘",B:"♗",Q:"♕",K:"♔"};let c$0$h=Symbol();const Je=class Je extends Component{[__init__$](e=null,r=!0,i=!0){super[__init__$](...arguments),this.row=e?e.row:void 0,this.col=e?e.col:void 0}toSquare(e,r){return"abcdefgh"[r]+(8-e)}handleClick(e,r){const i=board[e][r],n=this.toSquare(e,r);if(selected$2){const a=game.moves({square:selected$2,verbose:!0}).find(function(l){return l.to==n});if(a){let l=game.get(a.to);l&&(l.color=="w"?capturedWhite.push(l):capturedBlack.push(l)),game.move(a),lastMove$1=[a.from,a.to],selected$2=null,board=game.board(),legalTargets$1=[],hold=!0,setTimeout(function(){return hold=!1,rotate$1=!rotate$1,commit()},800);return}else selected$2=null,legalTargets$1=[]}if(i&&i.color==game.turn()){let s=game.moves({square:selected$2,verbose:!0});if(s.length>0)return selected$2=n,s=game.moves({square:selected$2,verbose:!0}),legalTargets$1=s.map(function(a){return a.to})}}render(){var e=this,r,i,n,s,a=this._ns_||"",l,u,p,f,c,h,d,m;let _=board[this.row][this.col],g=this.toSquare(this.row,this.col),b=selected$2==g,x=legalTargets$1.includes(g),S=lastMove$1&&lastMove$1[0]==g,T=lastMove$1&&lastMove$1[1]==g,I=(this.row+this.col)%2==0?"#f0d9b5":"#b58863",O=S||T?"blue1":b?"gold":I,L=_?pieceEmojis$1[_.color=="w"?_.type.toUpperCase():_.type]:"";return n=this,n[$beforeReconcile$$h](),s=1,n[$4$9]===1||(s=0,n[$4$9]=1),u=1,(l=n[$7$3])||(u=0,n[$7$3]=l=createElement("div",n,`wecwfm-ah ${a}`,null)),u||l.on$("click",{$_:[function(P,C){return e.handleClick(e.row,e.col)}]},this),O===n[$10$4]||l.css$var("--wecwfm_ai",n[$10$4]=O,null,"bg"),r=null,x&&!_&&(p=1,(r=n[$12$2])||(p=0,n[$12$2]=r=createElement("div",null,`wecwfm-aj ${a}`,null)),p||(r[$$up$$f]=l)),n[$15$5]=l[$placeChild$$f](r,0,n[$15$5]),i=null,x&&_&&(f=1,(i=n[$17$7])||(f=0,n[$17$7]=i=createElement("div",null,`wecwfm-ak ${a}`,null)),f||(i[$$up$$f]=l)),n[$20$4]=l[$placeChild$$f](i,0,n[$20$4]),h=d=1,(c=n[$22$7])||(h=d=0,n[$22$7]=c=createElement("div",l,`wecwfm-al ${a}`,null)),m=rotate$1||void 0,m===n[$26$3]||(d|=2,n[$26$3]=m),d&2&&c.flag$(`wecwfm-al ${a} `+(n[$26$3]?"rotate":"")),m=L,m===n[$29$6]&&h||(n[$28$3]=c[$placeChild$$f](n[$29$6]=m,384,n[$28$3])),n[$afterReconcile$$h](s),n}};register$(Je,c$0$h,"render-square",2),defineTag("render-square",Je,{cssns:"wecwfm_af"});let RenderSquareComponent=Je,c$1$2=Symbol();const et=class et extends Component{[__init__$](e=null,r=!0,i=!0){super[__init__$](...arguments),this.list=e?e.list:void 0,this.piece=e?e.piece:void 0}render(){var e,r,i,n=this._ns_||"",s,a,l,u,p,f,c,h,d,m;e=this,e[$beforeReconcile$$h](),r=i=1,e[$33$3]===1||(r=i=0,e[$33$3]=1),r||(s=createElement("div",e,`wecwfm-an ${n}`,null)),(a=e[$37$4])||(e[$37$4]=a=createElement("p",s,`wecwfm-ao ${n}`,null)),l=this.piece,l===e[$40$3]&&r||(e[$39$3]=a[$placeChild$$f](e[$40$3]=l,128,e[$39$3])),r||a[$placeChild$$f](" pieces lost:"),(u=e[$42$2])||(e[$42$2]=u=createElement("div",s,`wecwfm-ap ${n}`,null)),(p=e[$43$5])||(e[$43$5]=p=createIndexedList(384,u)),f=0,c=p.$;for(let _=0,g=iterable$(this.list),b=g.length;_<b;_++){let x=g[_];d=1,(h=c[f])||(d=0,c[f]=h=createElement("span",p,`${n}`,null)),d||(h[$$up$$f]=p),m=pieceEmojis$1[x.color=="w"?x.type.toUpperCase():x.type],m===h[$54$5]&&d||(h[$53]=h[$placeChild$$f](h[$54$5]=m,384,h[$53])),f++}return p[$afterVisit$$e](f),e[$afterReconcile$$h](i),e}};register$(et,c$1$2,"lost-pieces",2),defineTag("lost-pieces",et,{});let LostPiecesComponent=et,c$2$1=Symbol();const tt=class tt extends Component{gameinfo(){return game.isCheckmate()?game.turn()=="w"?"Checkmate! Black wins":"Checkmate! White wins":game.isCheck()?(game.turn()=="w"?"♔":"♚")+" Check!":game.turn()=="w"?"♕ White's turn":"♛ Black's turn"}render(){var e,r,i,n,s=this._ns_||"",a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G;r=this,r[$beforeReconcile$$h](),i=n=1,r[$59]===1||(i=n=0,r[$59]=1),i||(a=createElement("div",r,`wecwfm-at ${s}`,null)),(l=r[$63$5])||(r[$63$5]=l=createElement("div",a,`wecwfm-au ${s}`,null)),e=null,hold?e=" ":(renderContext.context=r[$65$3]||(r[$65$3]={_:l}),e=this.gameinfo(),renderContext.context=null),r[$66$4]=l[$placeChild$$f](e,0,r[$66$4]),i||(u=createElement("div",a,`wecwfm-av ${s}`,null)),f=c=1,(p=r[$69$1])||(f=c=0,r[$69$1]=p=createComponent("lost-pieces",u,`${s}`)),capturedWhite===r[$72$1]||(p.list=r[$72$1]=capturedWhite),f||(p.piece="White"),f||!p.setup||p.setup(c),p[$afterVisit$$e](c),f||u[$appendChild$$6](p),d=1,(h=r[$74$2])||(d=0,r[$74$2]=h=createElement("div",u,`wecwfm-ax ${s}`,null)),m=rotate$1||void 0,m===r[$78$1]||(d|=2,r[$78$1]=m),d&2&&h.flag$(`wecwfm-ax ${s} `+(r[$78$1]?"rotate":"")),(_=r[$80$1])||(r[$80$1]=_=createIndexedList(2432,h)),g=0,b=_.$;for(let B=0;B<8;B++){(x=b[g])||(b[g]=x=createIndexedList(0,_)),S=0,T=x.$;for(let H=0;H<8;H++)O=L=1,(I=T[S])||(O=L=0,T[S]=I=createComponent("render-square",x,`${s}`)),O||(I[$$up$$f]=x),B===I[$90$1]||(I.row=I[$90$1]=B),H===I[$91$1]||(I.col=I[$91$1]=H),O||!I.setup||I.setup(L),I[$afterVisit$$e](L),S++;x[$afterVisit$$e](S),g++}return _[$afterVisit$$e](g),C=G=1,(P=r[$93$2])||(C=G=0,r[$93$2]=P=createComponent("lost-pieces",u,`${s}`)),capturedBlack===r[$96]||(P.list=r[$96]=capturedBlack),C||(P.piece="Black"),C||!P.setup||P.setup(G),P[$afterVisit$$e](G),C||u[$appendChild$$6](P),r[$afterReconcile$$h](n),r}};register$(tt,c$2$1,"Chessboard",2),defineTag("chessboard-wecwfm-ba",tt,{cssns:"wecwfm_ar",cssid:"wecwfm-ar"});let Chessboard=tt;var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var jsChessEngine$1={exports:{}},jsChessEngine=jsChessEngine$1.exports,hasRequiredJsChessEngine;function requireJsChessEngine(){return hasRequiredJsChessEngine||(hasRequiredJsChessEngine=1,function(t,e){(function(r,i){t.exports=i()})(jsChessEngine,function(){return function(r){var i={};function n(s){if(i[s])return i[s].exports;var a=i[s]={i:s,l:!1,exports:{}};return r[s].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=r,n.c=i,n.d=function(s,a,l){n.o(s,a)||Object.defineProperty(s,a,{enumerable:!0,get:l})},n.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},n.t=function(s,a){if(1&a&&(s=n(s)),8&a||4&a&&typeof s=="object"&&s&&s.__esModule)return s;var l=Object.create(null);if(n.r(l),Object.defineProperty(l,"default",{enumerable:!0,value:s}),2&a&&typeof s!="string")for(var u in s)n.d(l,u,(function(p){return s[p]}).bind(null,u));return l},n.n=function(s){var a=s&&s.__esModule?function(){return s.default}:function(){return s};return n.d(a,"a",a),a},n.o=function(s,a){return Object.prototype.hasOwnProperty.call(s,a)},n.p="",n(n.s=0)}([function(r,i,n){n.r(i),n.d(i,"Game",function(){return _e}),n.d(i,"moves",function(){return ye}),n.d(i,"status",function(){return Te}),n.d(i,"getFen",function(){return xe}),n.d(i,"move",function(){return Se}),n.d(i,"aiMove",function(){return W});const s=["A","B","C","D","E","F","G","H"],a=["1","2","3","4","5","6","7","8"],l={KING_W:"K",QUEEN_W:"Q",ROOK_W:"R",BISHOP_W:"B",KNIGHT_W:"N",PAWN_W:"P",KING_B:"k",QUEEN_B:"q",ROOK_B:"r",BISHOP_B:"b",KNIGHT_B:"n",PAWN_B:"p"},u="black",p="white",f=[0,1,2,3,4],c={0:1,1:2,2:2,3:3,4:3,5:4},h={0:2,1:2,2:4,3:4,4:5,5:5},d={fullMove:1,halfMove:0,enPassant:null,isFinished:!1,checkMate:!1,check:!1,turn:p},m=Object.assign({pieces:{E1:"K",D1:"Q",A1:"R",H1:"R",C1:"B",F1:"B",B1:"N",G1:"N",A2:"P",B2:"P",C2:"P",D2:"P",E2:"P",F2:"P",G2:"P",H2:"P",E8:"k",D8:"q",A8:"r",H8:"r",C8:"b",F8:"b",B8:"n",G8:"n",A7:"p",B7:"p",C7:"p",D7:"p",E7:"p",F7:"p",G7:"p",H7:"p"},castling:{whiteShort:!0,blackShort:!0,whiteLong:!0,blackLong:!0}},d),_={UP:{A1:"A2",A2:"A3",A3:"A4",A4:"A5",A5:"A6",A6:"A7",A7:"A8",A8:null,B1:"B2",B2:"B3",B3:"B4",B4:"B5",B5:"B6",B6:"B7",B7:"B8",B8:null,C1:"C2",C2:"C3",C3:"C4",C4:"C5",C5:"C6",C6:"C7",C7:"C8",C8:null,D1:"D2",D2:"D3",D3:"D4",D4:"D5",D5:"D6",D6:"D7",D7:"D8",D8:null,E1:"E2",E2:"E3",E3:"E4",E4:"E5",E5:"E6",E6:"E7",E7:"E8",E8:null,F1:"F2",F2:"F3",F3:"F4",F4:"F5",F5:"F6",F6:"F7",F7:"F8",F8:null,G1:"G2",G2:"G3",G3:"G4",G4:"G5",G5:"G6",G6:"G7",G7:"G8",G8:null,H1:"H2",H2:"H3",H3:"H4",H4:"H5",H5:"H6",H6:"H7",H7:"H8",H8:null},DOWN:{A1:null,A2:"A1",A3:"A2",A4:"A3",A5:"A4",A6:"A5",A7:"A6",A8:"A7",B1:null,B2:"B1",B3:"B2",B4:"B3",B5:"B4",B6:"B5",B7:"B6",B8:"B7",C1:null,C2:"C1",C3:"C2",C4:"C3",C5:"C4",C6:"C5",C7:"C6",C8:"C7",D1:null,D2:"D1",D3:"D2",D4:"D3",D5:"D4",D6:"D5",D7:"D6",D8:"D7",E1:null,E2:"E1",E3:"E2",E4:"E3",E5:"E4",E6:"E5",E7:"E6",E8:"E7",F1:null,F2:"F1",F3:"F2",F4:"F3",F5:"F4",F6:"F5",F7:"F6",F8:"F7",G1:null,G2:"G1",G3:"G2",G4:"G3",G5:"G4",G6:"G5",G7:"G6",G8:"G7",H1:null,H2:"H1",H3:"H2",H4:"H3",H5:"H4",H6:"H5",H7:"H6",H8:"H7"},LEFT:{A1:null,A2:null,A3:null,A4:null,A5:null,A6:null,A7:null,A8:null,B1:"A1",B2:"A2",B3:"A3",B4:"A4",B5:"A5",B6:"A6",B7:"A7",B8:"A8",C1:"B1",C2:"B2",C3:"B3",C4:"B4",C5:"B5",C6:"B6",C7:"B7",C8:"B8",D1:"C1",D2:"C2",D3:"C3",D4:"C4",D5:"C5",D6:"C6",D7:"C7",D8:"C8",E1:"D1",E2:"D2",E3:"D3",E4:"D4",E5:"D5",E6:"D6",E7:"D7",E8:"D8",F1:"E1",F2:"E2",F3:"E3",F4:"E4",F5:"E5",F6:"E6",F7:"E7",F8:"E8",G1:"F1",G2:"F2",G3:"F3",G4:"F4",G5:"F5",G6:"F6",G7:"F7",G8:"F8",H1:"G1",H2:"G2",H3:"G3",H4:"G4",H5:"G5",H6:"G6",H7:"G7",H8:"G8"},RIGHT:{A1:"B1",A2:"B2",A3:"B3",A4:"B4",A5:"B5",A6:"B6",A7:"B7",A8:"B8",B1:"C1",B2:"C2",B3:"C3",B4:"C4",B5:"C5",B6:"C6",B7:"C7",B8:"C8",C1:"D1",C2:"D2",C3:"D3",C4:"D4",C5:"D5",C6:"D6",C7:"D7",C8:"D8",D1:"E1",D2:"E2",D3:"E3",D4:"E4",D5:"E5",D6:"E6",D7:"E7",D8:"E8",E1:"F1",E2:"F2",E3:"F3",E4:"F4",E5:"F5",E6:"F6",E7:"F7",E8:"F8",F1:"G1",F2:"G2",F3:"G3",F4:"G4",F5:"G5",F6:"G6",F7:"G7",F8:"G8",G1:"H1",G2:"H2",G3:"H3",G4:"H4",G5:"H5",G6:"H6",G7:"H7",G8:"H8",H1:null,H2:null,H3:null,H4:null,H5:null,H6:null,H7:null,H8:null},UP_LEFT:{A1:null,A2:null,A3:null,A4:null,A5:null,A6:null,A7:null,A8:null,B1:"A2",B2:"A3",B3:"A4",B4:"A5",B5:"A6",B6:"A7",B7:"A8",B8:null,C1:"B2",C2:"B3",C3:"B4",C4:"B5",C5:"B6",C6:"B7",C7:"B8",C8:null,D1:"C2",D2:"C3",D3:"C4",D4:"C5",D5:"C6",D6:"C7",D7:"C8",D8:null,E1:"D2",E2:"D3",E3:"D4",E4:"D5",E5:"D6",E6:"D7",E7:"D8",E8:null,F1:"E2",F2:"E3",F3:"E4",F4:"E5",F5:"E6",F6:"E7",F7:"E8",F8:null,G1:"F2",G2:"F3",G3:"F4",G4:"F5",G5:"F6",G6:"F7",G7:"F8",G8:null,H1:"G2",H2:"G3",H3:"G4",H4:"G5",H5:"G6",H6:"G7",H7:"G8",H8:null},DOWN_RIGHT:{A1:null,A2:"B1",A3:"B2",A4:"B3",A5:"B4",A6:"B5",A7:"B6",A8:"B7",B1:null,B2:"C1",B3:"C2",B4:"C3",B5:"C4",B6:"C5",B7:"C6",B8:"C7",C1:null,C2:"D1",C3:"D2",C4:"D3",C5:"D4",C6:"D5",C7:"D6",C8:"D7",D1:null,D2:"E1",D3:"E2",D4:"E3",D5:"E4",D6:"E5",D7:"E6",D8:"E7",E1:null,E2:"F1",E3:"F2",E4:"F3",E5:"F4",E6:"F5",E7:"F6",E8:"F7",F1:null,F2:"G1",F3:"G2",F4:"G3",F5:"G4",F6:"G5",F7:"G6",F8:"G7",G1:null,G2:"H1",G3:"H2",G4:"H3",G5:"H4",G6:"H5",G7:"H6",G8:"H7",H1:null,H2:null,H3:null,H4:null,H5:null,H6:null,H7:null,H8:null},UP_RIGHT:{A1:"B2",A2:"B3",A3:"B4",A4:"B5",A5:"B6",A6:"B7",A7:"B8",A8:null,B1:"C2",B2:"C3",B3:"C4",B4:"C5",B5:"C6",B6:"C7",B7:"C8",B8:null,C1:"D2",C2:"D3",C3:"D4",C4:"D5",C5:"D6",C6:"D7",C7:"D8",C8:null,D1:"E2",D2:"E3",D3:"E4",D4:"E5",D5:"E6",D6:"E7",D7:"E8",D8:null,E1:"F2",E2:"F3",E3:"F4",E4:"F5",E5:"F6",E6:"F7",E7:"F8",E8:null,F1:"G2",F2:"G3",F3:"G4",F4:"G5",F5:"G6",F6:"G7",F7:"G8",F8:null,G1:"H2",G2:"H3",G3:"H4",G4:"H5",G5:"H6",G6:"H7",G7:"H8",G8:null,H1:null,H2:null,H3:null,H4:null,H5:null,H6:null,H7:null,H8:null},DOWN_LEFT:{A1:null,A2:null,A3:null,A4:null,A5:null,A6:null,A7:null,A8:null,B1:null,B2:"A1",B3:"A2",B4:"A3",B5:"A4",B6:"A5",B7:"A6",B8:"A7",C1:null,C2:"B1",C3:"B2",C4:"B3",C5:"B4",C6:"B5",C7:"B6",C8:"B7",D1:null,D2:"C1",D3:"C2",D4:"C3",D5:"C4",D6:"C5",D7:"C6",D8:"C7",E1:null,E2:"D1",E3:"D2",E4:"D3",E5:"D4",E6:"D5",E7:"D6",E8:"D7",F1:null,F2:"E1",F3:"E2",F4:"E3",F5:"E4",F6:"E5",F7:"E6",F8:"E7",G1:null,G2:"F1",G3:"F2",G4:"F3",G5:"F4",G6:"F5",G7:"F6",G8:"F7",H1:null,H2:"G1",H3:"G2",H4:"G3",H5:"G4",H6:"G5",H7:"G6",H8:"G7"}},g=[[0,0,0,0,0,0,0,0],[5,5,5,5,5,5,5,5],[1,1,2,3,3,2,1,1],[.5,.5,1,2.5,2.5,1,.5,.5],[0,0,0,2,2,0,0,0],[.5,0,1,0,0,1,0,.5],[.5,0,0,-2,-2,0,0,.5],[0,0,0,0,0,0,0,0]],b=[[-4,-3,-2,-2,-2,-2,-3,-4],[-3,-2,0,0,0,0,-2,-3],[-2,0,1,1.5,1.5,1,0,-2],[-2,.5,1.5,2,2,1.5,.5,-2],[-2,0,1.5,2,2,1.5,0,-2],[-2,.5,1,1.5,1.5,1,.5,-2],[-3,-2,0,.5,.5,0,-2,-3],[-4,-3,-2,-2,-2,-2,-3,-4]],x=[[-2,-1,-1,-1,-1,-1,-1,-2],[-1,0,0,0,0,0,0,-1],[-1,0,.5,1,1,.5,0,-1],[-1,.5,.5,1,1,.5,.5,-1],[-1,0,1,1,1,1,0,-1],[-1,1,1,1,1,1,1,-1],[-1,.5,0,0,0,0,.5,-1],[-2,-1,-1,-1,-1,-1,-1,-2]],S=[[0,0,0,0,0,0,0,0],[.5,1,1,1,1,1,1,.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[-.5,0,0,0,0,0,0,-.5],[0,0,0,.5,.5,0,0,0]],T=[[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-3,-4,-4,-5,-5,-4,-4,-3],[-2,-3,-3,-4,-4,-3,-3,-2],[-1,-2,-2,-2,-2,-2,-2,-1],[2,2,0,0,0,0,2,2],[2,3,1,0,0,1,3,2]],I=[[-2,-1,-1,-.5,-.5,-1,-1,-2],[-1,0,0,0,0,0,0,-1],[-1,0,.5,.5,.5,.5,0,-1],[-.5,0,.5,.5,.5,.5,0,-.5],[0,0,.5,.5,.5,.5,0,-.5],[-1,.5,.5,.5,.5,.5,0,-1],[-1,0,.5,0,0,0,0,-1],[-2,-1,-1,-.5,-.5,-1,-1,-2]],O={P:g.slice().reverse(),p:g,N:b.slice().reverse(),n:b,B:x.slice().reverse(),b:x,R:S.slice().reverse(),r:S,K:T.slice().reverse(),k:T,Q:I.slice().reverse(),q:I};function L(ue){return _.UP[ue]}function P(ue){return _.DOWN[ue]}function C(ue){return _.LEFT[ue]}function G(ue){return _.RIGHT[ue]}function B(ue){return _.UP_LEFT[ue]}function H(ue){return _.UP_RIGHT[ue]}function ee(ue){return _.DOWN_LEFT[ue]}function j(ue){return _.DOWN_RIGHT[ue]}function te(ue){const w=B(ue);return w?L(w):null}function J(ue){const w=B(ue);return w?C(w):null}function Z(ue){const w=H(ue);return w?L(w):null}function pe(ue){const w=H(ue);return w?G(w):null}function ae(ue){const w=ee(ue);return w?P(w):null}function oe(ue){const w=ee(ue);return w?C(w):null}function me(ue){const w=j(ue);return w?P(w):null}function le(ue){const w=j(ue);return w?G(w):null}function ce(ue,w){return w===p?_.UP[ue]:_.DOWN[ue]}function se(ue,w){return w===p?_.UP_LEFT[ue]:_.DOWN_RIGHT[ue]}function de(ue,w){return w===p?_.UP_RIGHT[ue]:_.DOWN_LEFT[ue]}function fe(ue,w){return w===p?_.DOWN_LEFT[ue]:_.UP_RIGHT[ue]}function X(ue,w){return w===p?_.DOWN_RIGHT[ue]:_.UP_LEFT[ue]}function he(ue){return{k:10,q:9,r:5,b:3,n:3,p:1}[ue.toLowerCase()]||0}function ne(ue){return typeof ue=="string"&&ue.match("^[a-hA-H]{1}[1-8]{1}$")}const ge=-1e3,Ee=1e3;class be{constructor(w=JSON.parse(JSON.stringify(m))){if(typeof w=="object")this.configuration=Object.assign({},d,w);else{if(typeof w!="string")throw new Error(`Unknown configuration type ${typeof config}.`);this.configuration=Object.assign({},d,function(F=""){const[V,K,A,re,y,v]=F.split(" "),k={pieces:Object.fromEntries(V.split("/").flatMap((D,z)=>{let q=0;return D.split("").reduce((Y,Q)=>{const ie=Q.match(/k|b|q|n|p|r/i);ie&&(Y.push([`${s[q]}${a[7-z]}`,ie[0]]),q+=1);const $e=Q.match(/[1-8]/);return $e&&(q+=Number($e)),Y},[])}))};return k.turn=K==="b"?u:p,k.castling={whiteLong:!1,whiteShort:!1,blackLong:!1,blackShort:!1},A.includes("K")&&(k.castling.whiteShort=!0),A.includes("k")&&(k.castling.blackShort=!0),A.includes("Q")&&(k.castling.whiteLong=!0),A.includes("q")&&(k.castling.blackLong=!0),ne(re)&&(k.enPassant=re.toUpperCase()),k.halfMove=parseInt(y),k.fullMove=parseInt(v),k}(w))}this.configuration.castling||(this.configuration.castling={whiteShort:!0,blackShort:!0,whiteLong:!0,blackLong:!0}),this.history=[]}getAttackingFields(w=this.getPlayingColor()){let F=[];for(const V in this.configuration.pieces){const K=this.getPiece(V);this.getPieceColor(K)===w&&(F=[...F,...this.getPieceMoves(K,V)])}return F}isAttackingKing(w=this.getPlayingColor()){let F=null;for(const V in this.configuration.pieces){const K=this.getPiece(V);if(this.isKing(K)&&this.getPieceColor(K)!==w){F=V;break}}return this.isPieceUnderAttack(F)}isPieceUnderAttack(w){const F=this.getPieceOnLocationColor(w),V=this.getEnemyColor(F);let K=!1,A=w,re=0;for(;L(A)&&!K;){A=L(A),re++;const v=this.getPiece(A);if(v&&this.getPieceColor(v)===V&&(this.isRook(v)||this.isQueen(v)||this.isKing(v)&&re===1)&&(K=!0),v)break}for(A=w,re=0;P(A)&&!K;){A=P(A),re++;const v=this.getPiece(A);if(v&&this.getPieceColor(v)===V&&(this.isRook(v)||this.isQueen(v)||this.isKing(v)&&re===1)&&(K=!0),v)break}for(A=w,re=0;C(A)&&!K;){A=C(A),re++;const v=this.getPiece(A);if(v&&this.getPieceColor(v)===V&&(this.isRook(v)||this.isQueen(v)||this.isKing(v)&&re===1)&&(K=!0),v)break}for(A=w,re=0;G(A)&&!K;){A=G(A),re++;const v=this.getPiece(A);if(v&&this.getPieceColor(v)===V&&(this.isRook(v)||this.isQueen(v)||this.isKing(v)&&re===1)&&(K=!0),v)break}for(A=w,re=0;de(A,F)&&!K;){A=de(A,F),re++;const v=this.getPiece(A);if(v&&this.getPieceColor(v)===V&&(this.isBishop(v)||this.isQueen(v)||re===1&&(this.isKing(v)||this.isPawn(v)))&&(K=!0),v)break}for(A=w,re=0;se(A,F)&&!K;){A=se(A,F),re++;const v=this.getPiece(A);if(v&&this.getPieceColor(v)===V&&(this.isBishop(v)||this.isQueen(v)||re===1&&(this.isKing(v)||this.isPawn(v)))&&(K=!0),v)break}for(A=w,re=0;X(A,F)&&!K;){A=X(A,F),re++;const v=this.getPiece(A);if(v&&this.getPieceColor(v)===V&&(this.isBishop(v)||this.isQueen(v)||this.isKing(v)&&re===1)&&(K=!0),v)break}for(A=w,re=0;fe(A,F)&&!K;){A=fe(A,F),re++;const v=this.getPiece(A);if(v&&this.getPieceColor(v)===V&&(this.isBishop(v)||this.isQueen(v)||this.isKing(v)&&re===1)&&(K=!0),v)break}A=Z(w);let y=this.getPiece(A);return y&&this.getPieceColor(y)===V&&this.isKnight(y)&&(K=!0),A=pe(w),y=this.getPiece(A),y&&this.getPieceColor(y)===V&&this.isKnight(y)&&(K=!0),A=J(w),y=this.getPiece(A),y&&this.getPieceColor(y)===V&&this.isKnight(y)&&(K=!0),A=te(w),y=this.getPiece(A),y&&this.getPieceColor(y)===V&&this.isKnight(y)&&(K=!0),A=ae(w),y=this.getPiece(A),y&&this.getPieceColor(y)===V&&this.isKnight(y)&&(K=!0),A=oe(w),y=this.getPiece(A),y&&this.getPieceColor(y)===V&&this.isKnight(y)&&(K=!0),A=me(w),y=this.getPiece(A),y&&this.getPieceColor(y)===V&&this.isKnight(y)&&(K=!0),A=le(w),y=this.getPiece(A),y&&this.getPieceColor(y)===V&&this.isKnight(y)&&(K=!0),K}hasPlayingPlayerCheck(){return this.isAttackingKing(this.getNonPlayingColor())}hasNonPlayingPlayerCheck(){return this.isAttackingKing(this.getPlayingColor())}getLowestValuePieceAttackingLocation(w,F=this.getPlayingColor()){let V=null;for(const K in this.configuration.pieces){const A=this.getPiece(K);this.getPieceColor(A)===F&&this.getPieceMoves(A,K).map(re=>{re===w&&(V===null||he(A)<V)&&(V=he(A))})}return V}getMoves(w=this.getPlayingColor(),F=null){const V={};let K=0;for(const y in this.configuration.pieces){const v=this.getPiece(y);if(this.getPieceColor(v)===w){const k=this.getPieceMoves(v,y);k.length&&K++,Object.assign(V,{[y]:k})}}const A=this.getAttackingFields(this.getNonPlayingColor());if(this.isLeftCastlingPossible(A)&&(this.isPlayingWhite()&&V.E1.push("C1"),this.isPlayingBlack()&&V.E8.push("C8")),this.isRightCastlingPossible(A)&&(this.isPlayingWhite()&&V.E1.push("G1"),this.isPlayingBlack()&&V.E8.push("G8")),F&&K>F)return V;const re={};for(const y in V)V[y].map(v=>{const k={pieces:Object.assign({},this.configuration.pieces),castling:Object.assign({},this.configuration.castling)},D=new be(k);D.move(y,v),(this.isPlayingWhite()&&!D.isAttackingKing(u)||this.isPlayingBlack()&&!D.isAttackingKing(p))&&(re[y]||(re[y]=[]),re[y].push(v))});return Object.keys(re).length||(this.configuration.isFinished=!0,this.hasPlayingPlayerCheck()&&(this.configuration.checkMate=!0)),re}isLeftCastlingPossible(w){if(this.isPlayingWhite()&&!this.configuration.castling.whiteLong||this.isPlayingBlack()&&!this.configuration.castling.blackLong)return!1;let F=null;if(this.isPlayingWhite()&&this.getPiece("E1")==="K"&&this.getPiece("A1")==="R"&&!w.includes("E1")?F="E1":this.isPlayingBlack()&&this.getPiece("E8")==="k"&&this.getPiece("A8")==="r"&&!w.includes("E8")&&(F="E8"),!F)return!1;let V=C(F);return!this.getPiece(V)&&!w.includes(V)&&(V=C(V),!this.getPiece(V)&&!w.includes(V)&&(V=C(V),!this.getPiece(V)))}isRightCastlingPossible(w){if(this.isPlayingWhite()&&!this.configuration.castling.whiteShort||this.isPlayingBlack()&&!this.configuration.castling.blackShort)return!1;let F=null;if(this.isPlayingWhite()&&this.getPiece("E1")==="K"&&this.getPiece("H1")==="R"&&!w.includes("E1")?F="E1":this.isPlayingBlack()&&this.getPiece("E8")==="k"&&this.getPiece("H8")==="r"&&!w.includes("E8")&&(F="E8"),!F)return!1;let V=G(F);return!this.getPiece(V)&&!w.includes(V)&&(V=G(V),!this.getPiece(V)&&!w.includes(V))}getPieceMoves(w,F){return this.isPawn(w)?this.getPawnMoves(w,F):this.isKnight(w)?this.getKnightMoves(w,F):this.isRook(w)?this.getRookMoves(w,F):this.isBishop(w)?this.getBishopMoves(w,F):this.isQueen(w)?this.getQueenMoves(w,F):this.isKing(w)?this.getKingMoves(w,F):[]}isPawn(w){return w.toUpperCase()==="P"}isKnight(w){return w.toUpperCase()==="N"}isRook(w){return w.toUpperCase()==="R"}isBishop(w){return w.toUpperCase()==="B"}isQueen(w){return w.toUpperCase()==="Q"}isKing(w){return w.toUpperCase()==="K"}getPawnMoves(w,F){const V=[],K=this.getPieceColor(w);let A=ce(F,K);return A&&!this.getPiece(A)&&(V.push(A),A=ce(A,K),function(re,y){return re===p&&y[1]==="2"||re===u&&y[1]==="7"}(K,F)&&A&&!this.getPiece(A)&&V.push(A)),A=se(F,K),A&&(this.getPiece(A)&&this.getPieceOnLocationColor(A)!==K||A===this.configuration.enPassant)&&V.push(A),A=de(F,K),A&&(this.getPiece(A)&&this.getPieceOnLocationColor(A)!==K||A===this.configuration.enPassant)&&V.push(A),V}getKnightMoves(w,F){const V=[],K=this.getPieceColor(w);let A=Z(F);return A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=pe(F),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=te(F),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=J(F),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=oe(F),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=ae(F),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=le(F),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=me(F),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),V}getRookMoves(w,F){const V=[],K=this.getPieceColor(w);let A=F;for(;L(A);){A=L(A);const re=this.getPieceOnLocationColor(A);if(this.getPieceOnLocationColor(A)!==K&&V.push(A),re)break}for(A=F;P(A);){A=P(A);const re=this.getPieceOnLocationColor(A);if(this.getPieceOnLocationColor(A)!==K&&V.push(A),re)break}for(A=F;G(A);){A=G(A);const re=this.getPieceOnLocationColor(A);if(this.getPieceOnLocationColor(A)!==K&&V.push(A),re)break}for(A=F;C(A);){A=C(A);const re=this.getPieceOnLocationColor(A);if(this.getPieceOnLocationColor(A)!==K&&V.push(A),re)break}return V}getBishopMoves(w,F){const V=[],K=this.getPieceColor(w);let A=F;for(;B(A);){A=B(A);const re=this.getPieceOnLocationColor(A);if(this.getPieceOnLocationColor(A)!==K&&V.push(A),re)break}for(A=F;H(A);){A=H(A);const re=this.getPieceOnLocationColor(A);if(this.getPieceOnLocationColor(A)!==K&&V.push(A),re)break}for(A=F;ee(A);){A=ee(A);const re=this.getPieceOnLocationColor(A);if(this.getPieceOnLocationColor(A)!==K&&V.push(A),re)break}for(A=F;j(A);){A=j(A);const re=this.getPieceOnLocationColor(A);if(this.getPieceOnLocationColor(A)!==K&&V.push(A),re)break}return V}getQueenMoves(w,F){return[...this.getRookMoves(w,F),...this.getBishopMoves(w,F)]}getKingMoves(w,F){const V=[],K=this.getPieceColor(w);let A=F;return A=L(A),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=F,A=G(A),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=F,A=P(A),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=F,A=C(A),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=F,A=B(A),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=F,A=H(A),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=F,A=ee(A),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),A=F,A=j(A),A&&this.getPieceOnLocationColor(A)!==K&&V.push(A),V}getPieceColor(w){return w.toUpperCase()===w?p:u}getPieceOnLocationColor(w){const F=this.getPiece(w);return F?F.toUpperCase()===F?p:u:null}getPiece(w){return this.configuration.pieces[w]}setPiece(w,F){if(!function(V){return Object.values(l).includes(V)}(F))throw new Error("Invalid piece "+F);if(!ne(w))throw new Error("Invalid location "+w);this.configuration.pieces[w.toUpperCase()]=F}removePiece(w){if(!ne(w))throw new Error("Invalid location "+w);delete this.configuration.pieces[w.toUpperCase()]}isEmpty(w){if(!ne(w))throw new Error("Invalid location "+w);return!this.configuration.pieces[w.toUpperCase()]}getEnemyColor(w){return w===p?u:p}getPlayingColor(){return this.configuration.turn}getNonPlayingColor(){return this.isPlayingWhite()?u:p}isPlayingWhite(){return this.configuration.turn===p}isPlayingBlack(){return this.configuration.turn===u}addMoveToHistory(w,F){this.history.push({from:w,to:F,configuration:JSON.parse(JSON.stringify(this.configuration))})}move(w,F){const V=this.getPiece(w),K=this.getPiece(F);if(!V)throw new Error("There is no piece at "+w);var A,re;if(Object.assign(this.configuration.pieces,{[F]:V}),delete this.configuration.pieces[w],this.isPlayingWhite()&&this.isPawn(V)&&F[1]==="8"&&Object.assign(this.configuration.pieces,{[F]:"Q"}),this.isPlayingBlack()&&this.isPawn(V)&&F[1]==="1"&&Object.assign(this.configuration.pieces,{[F]:"q"}),this.isPawn(V)&&F===this.configuration.enPassant&&delete this.configuration.pieces[A=F,re=this.getPlayingColor(),re===p?_.DOWN[A]:_.UP[A]],this.isPawn(V)&&this.isPlayingWhite()&&w[1]==="2"&&F[1]==="4"?this.configuration.enPassant=w[0]+"3":this.isPawn(V)&&this.isPlayingBlack()&&w[1]==="7"&&F[1]==="5"?this.configuration.enPassant=w[0]+"6":this.configuration.enPassant=null,w==="E1"&&Object.assign(this.configuration.castling,{whiteLong:!1,whiteShort:!1}),w==="E8"&&Object.assign(this.configuration.castling,{blackLong:!1,blackShort:!1}),w==="A1"&&Object.assign(this.configuration.castling,{whiteLong:!1}),w==="H1"&&Object.assign(this.configuration.castling,{whiteShort:!1}),w==="A8"&&Object.assign(this.configuration.castling,{blackLong:!1}),w==="H8"&&Object.assign(this.configuration.castling,{blackShort:!1}),this.isKing(V)){if(w==="E1"&&F==="C1")return this.move("A1","D1");if(w==="E8"&&F==="C8")return this.move("A8","D8");if(w==="E1"&&F==="G1")return this.move("H1","F1");if(w==="E8"&&F==="G8")return this.move("H8","F8")}this.configuration.turn=this.isPlayingWhite()?u:p,this.isPlayingWhite()&&this.configuration.fullMove++,this.configuration.halfMove++,(K||this.isPawn(V))&&(this.configuration.halfMove=0)}exportJson(){return{moves:this.getMoves(),pieces:this.configuration.pieces,turn:this.configuration.turn,isFinished:this.configuration.isFinished,check:this.hasPlayingPlayerCheck(),checkMate:this.configuration.checkMate,castling:this.configuration.castling,enPassant:this.configuration.enPassant,halfMove:this.configuration.halfMove,fullMove:this.configuration.fullMove}}calculateAiMove(w){return this.calculateAiMoves(w)[0]}calculateAiMoves(w){if(w=parseInt(w),!f.includes(w))throw new Error(`Invalid level ${w}. You can choose ${f.join(",")}`);this.shouldIncreaseLevel()&&w++;const F=[],V=this.calculateScore(this.getPlayingColor()),K=this.getMoves();for(const A in K)K[A].map(re=>{const y=this.getTestBoard(),v=!!y.getPiece(re);y.move(A,re),F.push({from:A,to:re,score:y.testMoveScores(this.getPlayingColor(),w,v,v?y.calculateScore(this.getPlayingColor()):V,re).score+y.calculateScoreByPiecesLocation(this.getPlayingColor())+Math.floor(Math.random()*(this.configuration.halfMove>10?this.configuration.halfMove-10:1)*10)/10})});return F.sort((A,re)=>A.score<re.score?1:A.score>re.score?-1:0),F}shouldIncreaseLevel(){return this.getIngamePiecesValue()<50}getIngamePiecesValue(){let w=0;for(const F in this.configuration.pieces)w+=he(this.getPiece(F));return w}getTestBoard(){const w={pieces:Object.assign({},this.configuration.pieces),castling:Object.assign({},this.configuration.castling),turn:this.configuration.turn,enPassant:this.configuration.enPassant};return new be(w)}testMoveScores(w,F,V,K,A,re=1){let y=null;if(re<h[F]&&this.hasPlayingPlayerCheck()?y=this.getMoves(this.getPlayingColor()):(re<c[F]||V&&re<h[F])&&(y=this.getMoves(this.getPlayingColor(),5)),this.configuration.isFinished)return{score:this.calculateScore(w)+(this.getPlayingColor()===w?re:-re),max:!0};if(!y)return K!==null?{score:K,max:!1}:{score:this.calculateScore(w),max:!1};let v=this.getPlayingColor()===w?ge:Ee,k=!1;for(const D in y)k||y[D].map(z=>{if(k)return;const q=this.getTestBoard(),Y=!!q.getPiece(z);if(q.move(D,z),q.hasNonPlayingPlayerCheck())return;const Q=q.testMoveScores(w,F,Y,Y?q.calculateScore(w):K,z,re+1);Q.max&&(k=!0),v=this.getPlayingColor()===w?Math.max(v,Q.score):Math.min(v,Q.score)});return{score:v,max:!1}}calculateScoreByPiecesLocation(w=this.getPlayingColor()){const F={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7};let V=0;for(const K in this.configuration.pieces){const A=this.getPiece(K);if(O[A]){const re=O[A][K[1]-1][F[K[0]]];V+=.5*(this.getPieceColor(A)===w?re:-re)}}return V}calculateScore(w=this.getPlayingColor()){let F=0;if(this.configuration.checkMate)return this.getPlayingColor()===w?ge:Ee;if(this.configuration.isFinished)return this.getPlayingColor()===w?Ee:ge;for(const V in this.configuration.pieces){const K=this.getPiece(V);this.getPieceColor(K)===w?F+=10*he(K):F-=10*he(K)}return F}}class _e{constructor(w){this.board=new be(w)}move(w,F){w=w.toUpperCase(),F=F.toUpperCase();const V=this.board.getMoves();if(!V[w]||!V[w].includes(F))throw new Error(`Invalid move from ${w} to ${F} for ${this.board.getPlayingColor()}`);return this.board.addMoveToHistory(w,F),this.board.move(w,F),{[w]:F}}moves(w=null){return(w?this.board.getMoves()[w.toUpperCase()]:this.board.getMoves())||[]}setPiece(w,F){this.board.setPiece(w,F)}removePiece(w){this.board.removePiece(w)}aiMove(w=2){const F=this.board.calculateAiMove(w);return this.move(F.from,F.to)}getHistory(w=!1){return w?this.board.history.reverse():this.board.history}printToConsole(){(function(w){process.stdout.write(`
`);let F=p;Object.assign([],a).reverse().map(V=>{process.stdout.write(""+V),s.map(K=>{switch(w.pieces[`${K}${V}`]){case"K":process.stdout.write("♚");break;case"Q":process.stdout.write("♛");break;case"R":process.stdout.write("♜");break;case"B":process.stdout.write("♝");break;case"N":process.stdout.write("♞");break;case"P":process.stdout.write("♟");break;case"k":process.stdout.write("♔");break;case"q":process.stdout.write("♕");break;case"r":process.stdout.write("♖");break;case"b":process.stdout.write("♗");break;case"n":process.stdout.write("♘");break;case"p":process.stdout.write("♙");break;default:process.stdout.write(F===p?"█":"░")}F=F===p?u:p}),F=F===p?u:p,process.stdout.write(`
`)}),process.stdout.write(" "),s.map(V=>{process.stdout.write(""+V)}),process.stdout.write(`
`)})(this.board.configuration)}exportJson(){return this.board.exportJson()}exportFEN(){return function(w){let F="";Object.assign([],a).reverse().map(y=>{let v=0;y<8&&(F+="/"),s.map(k=>{const D=w.pieces[`${k}${y}`];D?(v&&(F+=v.toString(),v=0),F+=D):v++}),F+=""+(v||"")}),F+=w.turn===p?" w ":" b ";const{whiteShort:V,whiteLong:K,blackLong:A,blackShort:re}=w.castling;return K||V||A||re?(V&&(F+="K"),K&&(F+="Q"),re&&(F+="k"),A&&(F+="q")):F+="-",F+=" "+(w.enPassant?w.enPassant.toLowerCase():"-"),F+=" "+w.halfMove,F+=" "+w.fullMove,F}(this.board.configuration)}}function ye(ue){if(!ue)throw new Error("Configuration param required.");return new _e(ue).moves()}function Te(ue){if(!ue)throw new Error("Configuration param required.");return new _e(ue).exportJson()}function xe(ue){if(!ue)throw new Error("Configuration param required.");return new _e(ue).exportFEN()}function Se(ue,w,F){if(!ue)throw new Error("Configuration param required.");const V=new _e(ue);return V.move(w,F),typeof ue=="object"?V.exportJson():V.exportFEN()}function W(ue,w=2){if(!ue)throw new Error("Configuration param required.");const F=new _e(ue).board.calculateAiMove(w);return{[F.from]:F.to}}}])})}(jsChessEngine$1)),jsChessEngine$1.exports}var jsChessEngineExports=requireJsChessEngine();use_events(),use_events_mouse(),use_styles();const $beforeReconcile$$g=Symbol.for("#beforeReconcile"),$placeChild$$e=Symbol.for("#placeChild"),$$up$$e=Symbol.for("##up"),$afterVisit$$d=Symbol.for("#afterVisit"),$afterReconcile$$g=Symbol.for("#afterReconcile"),$appendChild$$5=Symbol.for("#appendChild");var $34$4=Symbol(),$38$4=Symbol(),$40$2=Symbol(),$41$3=Symbol(),$43$4=Symbol(),$44$1=Symbol(),$54$4=Symbol(),$55$1=Symbol(),$60$4=Symbol(),$63$4=Symbol(),$66$3=Symbol(),$68$5=Symbol(),$71$4=Symbol(),$73$1=Symbol(),$76$3=Symbol(),$78=Symbol(),$80=Symbol(),$81$1=Symbol(),$85$1=Symbol(),$89$1=Symbol(),$91=Symbol(),$103$1=Symbol(),$104$1=Symbol(),$114=Symbol(),$115=Symbol(),$118=Symbol(),$121=Symbol(),$123=Symbol(),$126=Symbol();let currentFEN=null,selected$1=null,legalTargets=[],lastMove=null,difficulty$1=2,engine=new jsChessEngineExports.Game,whiteCaptured=[],blackCaptured=[];const initialCounts={P:8,R:2,N:2,B:2,Q:1,K:1,p:8,r:2,n:2,b:2,q:1,k:1},pieceEmojis={p:"♟",r:"♜",n:"♞",b:"♝",q:"♛",k:"♚",P:"♙",R:"♖",N:"♘",B:"♗",Q:"♕",K:"♔"};function updateBoard(){return currentFEN=engine.exportFEN(),updateCaptured()}function countPieces(t){let e={};for(let i=0,n=Object.keys(initialCounts),s=n.length,a;i<s;i++)a=n[i],e[a]=0;let r=toBoard(t);for(let i=0,n=iterable$(r),s=n.length;i<s;i++){let a=n[i];for(let l=0,u=iterable$(a),p=u.length;l<p;l++){let f=u[l];f&&(e[f]=e[f]+1)}}return e}function updateCaptured(){var t,e;let r=countPieces(currentFEN);whiteCaptured=[],blackCaptured=[],e=[];for(let i=0,n=Object.keys(initialCounts),s=n.length,a;i<s;i++){a=n[i];let l=initialCounts[a]-r[a];if(l>0){t=[];for(let u=l,p=0,f=u-p;f>0?p<u:p>u;f>0?p++:p--)t.push(a.toUpperCase()==a?whiteCaptured.push(a):blackCaptured.push(a));e.push(t)}}return e}function toBoard(t){let e=t.split(" ")[0].split("/"),r=[];for(let i=0,n=iterable$(e),s=n.length;i<s;i++){let a=n[i],l=[];for(let u=0,p=iterable$(a),f=p.length;u<f;u++){let c=p[u];if(isNaN(c))l.push(c);else for(let h=parseInt(c),d=0,m=h-d;m>0?d<h:d>h;m>0?d++:d--)l.push(null)}r.push(l)}return r}function toSquare(t,e){return"abcdefgh"[e]+(8-t)}function isWhiteTurn(){return currentFEN.split(" ")[1]=="w"}function isKingInCheck(t){let e=engine.exportJson(),r=t=="white"?"K":"k",i=null;for(let u=e.pieces,p=0,f=Object.keys(u),c=f.length,h,d;p<c;p++)if(h=f[p],d=u[h],d==r){i=h;break}if(!i)return!1;let n=new jsChessEngineExports.Game(engine.exportFEN()),s=t=="white"?"black":"white",a=n.exportFEN().split(" ");a[1]=s[0],n=new jsChessEngineExports.Game(a.join(" "));let l=n.exportJson().moves;for(let u=0,p=Object.keys(l),f=p.length,c,h;u<f;u++){c=p[u],h=l[c];for(let d=0,m=iterable$(h),_=m.length;d<_;d++)if(m[d]==i)return!0}return!1}let c$0$g=Symbol();const rt=class rt extends Component{[__init__$](e=null,r=!0,i=!0){super[__init__$](...arguments),this.pieces=e?e.pieces:void 0,this.color=e?e.color:void 0}render(){var e,r,i,n=this._ns_||"",s,a,l,u,p,f,c,h,d,m;e=this,e[$beforeReconcile$$g](),r=i=1,e[$34$4]===1||(r=i=0,e[$34$4]=1),r||(s=createElement("div",e,`lhpow5-ag ${n}`,null)),(a=e[$38$4])||(e[$38$4]=a=createElement("h3",s,`${n}`,null)),l=this.color,l===e[$41$3]&&r||(e[$40$2]=a[$placeChild$$e](e[$41$3]=l,128,e[$40$2])),r||a[$placeChild$$e](" pieces lost:"),(u=e[$43$4])||(e[$43$4]=u=createElement("div",s,`lhpow5-ai ${n}`,null)),(p=e[$44$1])||(e[$44$1]=p=createIndexedList(384,u)),f=0,c=p.$;for(let _=0,g=iterable$(this.pieces),b=g.length;_<b;_++){let x=g[_];d=1,(h=c[f])||(d=0,c[f]=h=createElement("span",p,`${n}`,null)),d||(h[$$up$$e]=p),m=pieceEmojis[x],m===h[$55$1]&&d||(h[$54$4]=h[$placeChild$$e](h[$55$1]=m,384,h[$54$4])),f++}return p[$afterVisit$$d](f),e[$afterReconcile$$g](i),e}};register$(rt,c$0$g,"captured-pieces-ai",2),defineTag("captured-pieces-ai",rt,{});let CapturedPiecesAiComponent=rt,c$1$1=Symbol();const it=class it extends Component{[__init__$](e=null,r=!0,i=!0){super[__init__$](...arguments),this.row=e?e.row:void 0,this.col=e?e.col:void 0}handleClick(e,r){if(!isWhiteTurn||engine.exportJson().isFinished)return;let i=toSquare(e,r),n=toBoard(currentFEN)[e][r];if(selected$1){let s=engine.moves(selected$1)||[];if(Array.isArray(s)&&s.includes(i.toUpperCase())){engine.move(selected$1,i),lastMove=[selected$1,i],selected$1=null,legalTargets=[],updateBoard(),setTimeout(function(){let a=engine.aiMove(difficulty$1);return lastMove=[Object.keys(a)[0],Object.values(a)[0]],commit(),updateBoard()},1500);return}else legalTargets=[],selected$1=null}if(n&&n.toUpperCase()==n&&isWhiteTurn)return selected$1=i,legalTargets=engine.moves(i)}render(){var e=this,r,i,n,s,a=this._ns_||"",l,u,p,f,c,h;let d=toBoard(currentFEN),m=toSquare(this.row,this.col),_=d[this.row][this.col],g=selected$1==m,b=legalTargets.includes(m.toUpperCase()),x=lastMove&&lastMove[0].toLowerCase()==m,S=lastMove&&lastMove[1].toLowerCase()==m,T=(this.row+this.col)%2==0?"#f0d9b5":"#b58863",I=x||S?"blue1":g?"gold":T,O=_&&pieceEmojis[_]||"";return n=this,n[$beforeReconcile$$g](),s=1,n[$60$4]===1||(s=0,n[$60$4]=1),u=1,(l=n[$63$4])||(u=0,n[$63$4]=l=createElement("div",n,`lhpow5-al ${a}`,null)),u||l.on$("click",{$_:[function(L,P){return e.handleClick(e.row,e.col)}]},this),I===n[$66$3]||l.css$var("--lhpow5_am",n[$66$3]=I,null,"bg"),r=null,b&&!_&&(p=1,(r=n[$68$5])||(p=0,n[$68$5]=r=createElement("div",null,`lhpow5-an ${a}`,null)),p||(r[$$up$$e]=l)),n[$71$4]=l[$placeChild$$e](r,0,n[$71$4]),i=null,b&&_&&(f=1,(i=n[$73$1])||(f=0,n[$73$1]=i=createElement("div",null,`lhpow5-ao ${a}`,null)),f||(i[$$up$$e]=l)),n[$76$3]=l[$placeChild$$e](i,0,n[$76$3]),(c=n[$78])||(n[$78]=c=createElement("div",l,`lhpow5-ap ${a}`,null)),h=O,h===n[$81$1]&&u||(n[$80]=c[$placeChild$$e](n[$81$1]=h,384,n[$80])),n[$afterReconcile$$g](s),n}};register$(it,c$1$1,"render-square-ai",2),defineTag("render-square-ai",it,{});let RenderSquareAiComponent=it,c$2=Symbol();const nt=class nt extends Component{render(){var e,r,i,n,s=this._ns_||"",a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J;currentFEN||updateBoard();let Z=engine.exportJson();r=this,r[$beforeReconcile$$g](),i=n=1,r[$85$1]===1||(i=n=0,r[$85$1]=1),i||(a=createElement("div",r,`lhpow5-as ${s}`,null)),(l=r[$89$1])||(r[$89$1]=l=createElement("div",a,`lhpow5-at ${s}`,null)),e=null,Z.isFinished?isWhiteTurn()?e="Checkmate! Computer wins":e="Checkmate! You win":isKingInCheck("white")?e="♔ Your King is in Check!":isKingInCheck("black")?e="♚ Computer's King is in Check!":isWhiteTurn()?e="♕ Your turn":e="♛ Computer's turn",r[$91]=l[$placeChild$$e](e,0,r[$91]),i||(u=createElement("div",a,`lhpow5-au ${s}`,null)),i||(p=createElement("div",u,`lhpow5-av ${s}`,null)),i||createElement("h1",p,`${s}`,"Chess AI"),i||(f=createElement("div",p,`lhpow5-ax ${s}`,null)),i||createElement("span",f,`lhpow5-ay ${s}`,"Difficulty: "),i||(c=createElement("select",f,`lhpow5-az ${s}`,null)),i||c.on$("change",{$_:[function(pe,ae){return difficulty$1=parseInt(pe.target.value)}]},this),i||(h=createElement("option",c,`${s}`,"Easy")),i||(h.richValue="1"),i||(d=createElement("option",c,`${s}`,"Medium")),i||(d.richValue="2"),i||(d.selected="selected"),i||(m=createElement("option",c,`${s}`,"Hard")),i||(m.richValue="3"),i||(_=createElement("option",c,`${s}`,"Extreme")),i||(_.richValue="4"),(g=r[$103$1])||(r[$103$1]=g=createElement("div",u,`lhpow5-be ${s}`,null)),(b=r[$104$1])||(r[$104$1]=b=createIndexedList(2432,g)),x=0,S=b.$;for(let pe=0;pe<8;pe++){(T=S[x])||(S[x]=T=createIndexedList(0,b)),I=0,O=T.$;for(let ae=0;ae<8;ae++)P=C=1,(L=O[I])||(P=C=0,O[I]=L=createComponent("render-square-ai",T,`${s}`)),P||(L[$$up$$e]=T),pe===L[$114]||(L.row=L[$114]=pe),ae===L[$115]||(L.col=L[$115]=ae),P||!L.setup||L.setup(C),L[$afterVisit$$d](C),I++;T[$afterVisit$$d](I),x++}return b[$afterVisit$$d](x),i||(G=createElement("div",u,`lhpow5-bg ${s}`,null)),H=ee=1,(B=r[$118])||(H=ee=0,r[$118]=B=createComponent("captured-pieces-ai",G,`${s}`)),blackCaptured===r[$121]||(B.pieces=r[$121]=blackCaptured),H||(B.color="Black"),H||!B.setup||B.setup(ee),B[$afterVisit$$d](ee),H||G[$appendChild$$5](B),te=J=1,(j=r[$123])||(te=J=0,r[$123]=j=createComponent("captured-pieces-ai",G,`${s}`)),whiteCaptured===r[$126]||(j.pieces=r[$126]=whiteCaptured),te||(j.color="White"),te||!j.setup||j.setup(J),j[$afterVisit$$d](J),te||G[$appendChild$$5](j),r[$afterReconcile$$g](n),r}};register$(nt,c$2,"ChessboardAI",2),defineTag("chessboard-ai-lhpow5-bj",nt,{cssid:"lhpow5-aq"});let ChessboardAI=nt;const $beforeReconcile$$f=Symbol.for("#beforeReconcile"),$afterReconcile$$f=Symbol.for("#afterReconcile");var $4$8=Symbol();let c$0$f=Symbol();const st=class st extends Component{setup(){var e=this;const r=globalThis.document.createElement("script");return r.src="https://www.desmos.com/api/v1.11/calculator.js?apiKey=dcb31709b452b1cf9dc26972add0fda6",r.async=!0,r.onload=function(){return e.initCalculator()},globalThis.document.head.appendChild(r)}initCalculator(){let e=globalThis.document.getElementById("calculator");return window.calc=Desmos.GraphingCalculator(e,{expressions:!0,expressionsTopbar:!0,zoomButtons:!0,settingsMenu:!0,border:!1,keypad:!0,graphpaper:!0,lockViewport:!1,showResetButtonOnGraphpaper:!0,showGrid:!0,showXAxis:!0,showYAxis:!0,xAxisLabel:"",yAxisLabel:"",xAxisArrowMode:"NONE",yAxisArrowMode:"NONE",language:"en"})}render(){var e,r,i,n=this._ns_||"",s,a;return e=this,e[$beforeReconcile$$f](),r=i=1,e[$4$8]===1||(r=i=0,e[$4$8]=1),r||(s=createElement("div",e,`xg7uyj-ag ${n}`,null)),r||createElement("div",s,`xg7uyj-ah ${n}`,"DESMOS"),r||(a=createElement("div",s,`xg7uyj-ai ${n}`,null)),r||(a.id="calculator"),e[$afterReconcile$$f](i),e}};register$(st,c$0$f,"DesmosGraph",2),defineTag("desmos-graph-xg7uyj-aj",st,{});let DesmosGraph=st;var algebrite={},BigInteger={exports:{}},hasRequiredBigInteger;function requireBigInteger(){return hasRequiredBigInteger||(hasRequiredBigInteger=1,function(t){var e=function(r){var i=1e7,n=7,s=9007199254740992,a=m(s),l="0123456789abcdefghijklmnopqrstuvwxyz",u=typeof BigInt=="function";function p(y,v,k,D){return typeof y>"u"?p[0]:typeof v<"u"?+v==10&&!k?A(y):Se(y,v,k,D):A(y)}function f(y,v){this.value=y,this.sign=v,this.isSmall=!1}f.prototype=Object.create(p.prototype);function c(y){this.value=y,this.sign=y<0,this.isSmall=!0}c.prototype=Object.create(p.prototype);function h(y){this.value=y}h.prototype=Object.create(p.prototype);function d(y){return-9007199254740992<y&&y<s}function m(y){return y<1e7?[y]:y<1e14?[y%1e7,Math.floor(y/1e7)]:[y%1e7,Math.floor(y/1e7)%1e7,Math.floor(y/1e14)]}function _(y){g(y);var v=y.length;if(v<4&&oe(y,a)<0)switch(v){case 0:return 0;case 1:return y[0];case 2:return y[0]+y[1]*i;default:return y[0]+(y[1]+y[2]*i)*i}return y}function g(y){for(var v=y.length;y[--v]===0;);y.length=v+1}function b(y){for(var v=new Array(y),k=-1;++k<y;)v[k]=0;return v}function x(y){return y>0?Math.floor(y):Math.ceil(y)}function S(y,v){var k=y.length,D=v.length,z=new Array(k),q=0,Y=i,Q,ie;for(ie=0;ie<D;ie++)Q=y[ie]+v[ie]+q,q=Q>=Y?1:0,z[ie]=Q-q*Y;for(;ie<k;)Q=y[ie]+q,q=Q===Y?1:0,z[ie++]=Q-q*Y;return q>0&&z.push(q),z}function T(y,v){return y.length>=v.length?S(y,v):S(v,y)}function I(y,v){var k=y.length,D=new Array(k),z=i,q,Y;for(Y=0;Y<k;Y++)q=y[Y]-z+v,v=Math.floor(q/z),D[Y]=q-v*z,v+=1;for(;v>0;)D[Y++]=v%z,v=Math.floor(v/z);return D}f.prototype.add=function(y){var v=A(y);if(this.sign!==v.sign)return this.subtract(v.negate());var k=this.value,D=v.value;return v.isSmall?new f(I(k,Math.abs(D)),this.sign):new f(T(k,D),this.sign)},f.prototype.plus=f.prototype.add,c.prototype.add=function(y){var v=A(y),k=this.value;if(k<0!==v.sign)return this.subtract(v.negate());var D=v.value;if(v.isSmall){if(d(k+D))return new c(k+D);D=m(Math.abs(D))}return new f(I(D,Math.abs(k)),k<0)},c.prototype.plus=c.prototype.add,h.prototype.add=function(y){return new h(this.value+A(y).value)},h.prototype.plus=h.prototype.add;function O(y,v){var k=y.length,D=v.length,z=new Array(k),q=0,Y=i,Q,ie;for(Q=0;Q<D;Q++)ie=y[Q]-q-v[Q],ie<0?(ie+=Y,q=1):q=0,z[Q]=ie;for(Q=D;Q<k;Q++){if(ie=y[Q]-q,ie<0)ie+=Y;else{z[Q++]=ie;break}z[Q]=ie}for(;Q<k;Q++)z[Q]=y[Q];return g(z),z}function L(y,v,k){var D;return oe(y,v)>=0?D=O(y,v):(D=O(v,y),k=!k),D=_(D),typeof D=="number"?(k&&(D=-D),new c(D)):new f(D,k)}function P(y,v,k){var D=y.length,z=new Array(D),q=-v,Y=i,Q,ie;for(Q=0;Q<D;Q++)ie=y[Q]+q,q=Math.floor(ie/Y),ie%=Y,z[Q]=ie<0?ie+Y:ie;return z=_(z),typeof z=="number"?(k&&(z=-z),new c(z)):new f(z,k)}f.prototype.subtract=function(y){var v=A(y);if(this.sign!==v.sign)return this.add(v.negate());var k=this.value,D=v.value;return v.isSmall?P(k,Math.abs(D),this.sign):L(k,D,this.sign)},f.prototype.minus=f.prototype.subtract,c.prototype.subtract=function(y){var v=A(y),k=this.value;if(k<0!==v.sign)return this.add(v.negate());var D=v.value;return v.isSmall?new c(k-D):P(D,Math.abs(k),k>=0)},c.prototype.minus=c.prototype.subtract,h.prototype.subtract=function(y){return new h(this.value-A(y).value)},h.prototype.minus=h.prototype.subtract,f.prototype.negate=function(){return new f(this.value,!this.sign)},c.prototype.negate=function(){var y=this.sign,v=new c(-this.value);return v.sign=!y,v},h.prototype.negate=function(){return new h(-this.value)},f.prototype.abs=function(){return new f(this.value,!1)},c.prototype.abs=function(){return new c(Math.abs(this.value))},h.prototype.abs=function(){return new h(this.value>=0?this.value:-this.value)};function C(y,v){var k=y.length,D=v.length,z=k+D,q=b(z),Y=i,Q,ie,$e,Ae,ve;for($e=0;$e<k;++$e){Ae=y[$e];for(var we=0;we<D;++we)ve=v[we],Q=Ae*ve+q[$e+we],ie=Math.floor(Q/Y),q[$e+we]=Q-ie*Y,q[$e+we+1]+=ie}return g(q),q}function G(y,v){var k=y.length,D=new Array(k),z=i,q=0,Y,Q;for(Q=0;Q<k;Q++)Y=y[Q]*v+q,q=Math.floor(Y/z),D[Q]=Y-q*z;for(;q>0;)D[Q++]=q%z,q=Math.floor(q/z);return D}function B(y,v){for(var k=[];v-- >0;)k.push(0);return k.concat(y)}function H(y,v){var k=Math.max(y.length,v.length);if(k<=30)return C(y,v);k=Math.ceil(k/2);var D=y.slice(k),z=y.slice(0,k),q=v.slice(k),Y=v.slice(0,k),Q=H(z,Y),ie=H(D,q),$e=H(T(z,D),T(Y,q)),Ae=T(T(Q,B(O(O($e,Q),ie),k)),B(ie,2*k));return g(Ae),Ae}function ee(y,v){return-.012*y-.012*v+15e-6*y*v>0}f.prototype.multiply=function(y){var v=A(y),k=this.value,D=v.value,z=this.sign!==v.sign,q;if(v.isSmall){if(D===0)return p[0];if(D===1)return this;if(D===-1)return this.negate();if(q=Math.abs(D),q<i)return new f(G(k,q),z);D=m(q)}return ee(k.length,D.length)?new f(H(k,D),z):new f(C(k,D),z)},f.prototype.times=f.prototype.multiply;function j(y,v,k){return y<i?new f(G(v,y),k):new f(C(v,m(y)),k)}c.prototype._multiplyBySmall=function(y){return d(y.value*this.value)?new c(y.value*this.value):j(Math.abs(y.value),m(Math.abs(this.value)),this.sign!==y.sign)},f.prototype._multiplyBySmall=function(y){return y.value===0?p[0]:y.value===1?this:y.value===-1?this.negate():j(Math.abs(y.value),this.value,this.sign!==y.sign)},c.prototype.multiply=function(y){return A(y)._multiplyBySmall(this)},c.prototype.times=c.prototype.multiply,h.prototype.multiply=function(y){return new h(this.value*A(y).value)},h.prototype.times=h.prototype.multiply;function te(y){var v=y.length,k=b(v+v),D=i,z,q,Y,Q,ie;for(Y=0;Y<v;Y++){Q=y[Y],q=0-Q*Q;for(var $e=Y;$e<v;$e++)ie=y[$e],z=2*(Q*ie)+k[Y+$e]+q,q=Math.floor(z/D),k[Y+$e]=z-q*D;k[Y+v]=q}return g(k),k}f.prototype.square=function(){return new f(te(this.value),!1)},c.prototype.square=function(){var y=this.value*this.value;return d(y)?new c(y):new f(te(m(Math.abs(this.value))),!1)},h.prototype.square=function(y){return new h(this.value*this.value)};function J(y,v){var k=y.length,D=v.length,z=i,q=b(v.length),Y=v[D-1],Q=Math.ceil(z/(2*Y)),ie=G(y,Q),$e=G(v,Q),Ae,ve,we,Oe,Ie,xt,Et;for(ie.length<=k&&ie.push(0),$e.push(0),Y=$e[D-1],ve=k-D;ve>=0;ve--){for(Ae=z-1,ie[ve+D]!==Y&&(Ae=Math.floor((ie[ve+D]*z+ie[ve+D-1])/Y)),we=0,Oe=0,xt=$e.length,Ie=0;Ie<xt;Ie++)we+=Ae*$e[Ie],Et=Math.floor(we/z),Oe+=ie[ve+Ie]-(we-Et*z),we=Et,Oe<0?(ie[ve+Ie]=Oe+z,Oe=-1):(ie[ve+Ie]=Oe,Oe=0);for(;Oe!==0;){for(Ae-=1,we=0,Ie=0;Ie<xt;Ie++)we+=ie[ve+Ie]-z+$e[Ie],we<0?(ie[ve+Ie]=we+z,we=0):(ie[ve+Ie]=we,we=1);Oe+=we}q[ve]=Ae}return ie=pe(ie,Q)[0],[_(q),_(ie)]}function Z(y,v){for(var k=y.length,D=v.length,z=[],q=[],Y=i,Q,ie,$e,Ae,ve;k;){if(q.unshift(y[--k]),g(q),oe(q,v)<0){z.push(0);continue}ie=q.length,$e=q[ie-1]*Y+q[ie-2],Ae=v[D-1]*Y+v[D-2],ie>D&&($e=($e+1)*Y),Q=Math.ceil($e/Ae);do{if(ve=G(v,Q),oe(ve,q)<=0)break;Q--}while(Q);z.push(Q),q=O(q,ve)}return z.reverse(),[_(z),_(q)]}function pe(y,v){var k=y.length,D=b(k),z=i,q,Y,Q,ie;for(Q=0,q=k-1;q>=0;--q)ie=Q*z+y[q],Y=x(ie/v),Q=ie-Y*v,D[q]=Y|0;return[D,Q|0]}function ae(y,v){var k,D=A(v);if(u)return[new h(y.value/D.value),new h(y.value%D.value)];var z=y.value,q=D.value,Y;if(q===0)throw new Error("Cannot divide by zero");if(y.isSmall)return D.isSmall?[new c(x(z/q)),new c(z%q)]:[p[0],y];if(D.isSmall){if(q===1)return[y,p[0]];if(q==-1)return[y.negate(),p[0]];var Q=Math.abs(q);if(Q<i){k=pe(z,Q),Y=_(k[0]);var ie=k[1];return y.sign&&(ie=-ie),typeof Y=="number"?(y.sign!==D.sign&&(Y=-Y),[new c(Y),new c(ie)]):[new f(Y,y.sign!==D.sign),new c(ie)]}q=m(Q)}var $e=oe(z,q);if($e===-1)return[p[0],y];if($e===0)return[p[y.sign===D.sign?1:-1],p[0]];z.length+q.length<=200?k=J(z,q):k=Z(z,q),Y=k[0];var Ae=y.sign!==D.sign,ve=k[1],we=y.sign;return typeof Y=="number"?(Ae&&(Y=-Y),Y=new c(Y)):Y=new f(Y,Ae),typeof ve=="number"?(we&&(ve=-ve),ve=new c(ve)):ve=new f(ve,we),[Y,ve]}f.prototype.divmod=function(y){var v=ae(this,y);return{quotient:v[0],remainder:v[1]}},h.prototype.divmod=c.prototype.divmod=f.prototype.divmod,f.prototype.divide=function(y){return ae(this,y)[0]},h.prototype.over=h.prototype.divide=function(y){return new h(this.value/A(y).value)},c.prototype.over=c.prototype.divide=f.prototype.over=f.prototype.divide,f.prototype.mod=function(y){return ae(this,y)[1]},h.prototype.mod=h.prototype.remainder=function(y){return new h(this.value%A(y).value)},c.prototype.remainder=c.prototype.mod=f.prototype.remainder=f.prototype.mod,f.prototype.pow=function(y){var v=A(y),k=this.value,D=v.value,z,q,Y;if(D===0)return p[1];if(k===0)return p[0];if(k===1)return p[1];if(k===-1)return v.isEven()?p[1]:p[-1];if(v.sign)return p[0];if(!v.isSmall)throw new Error("The exponent "+v.toString()+" is too large.");if(this.isSmall&&d(z=Math.pow(k,D)))return new c(x(z));for(q=this,Y=p[1];D&!0&&(Y=Y.times(q),--D),D!==0;)D/=2,q=q.square();return Y},c.prototype.pow=f.prototype.pow,h.prototype.pow=function(y){var v=A(y),k=this.value,D=v.value,z=BigInt(0),q=BigInt(1),Y=BigInt(2);if(D===z)return p[1];if(k===z)return p[0];if(k===q)return p[1];if(k===BigInt(-1))return v.isEven()?p[1]:p[-1];if(v.isNegative())return new h(z);for(var Q=this,ie=p[1];(D&q)===q&&(ie=ie.times(Q),--D),D!==z;)D/=Y,Q=Q.square();return ie},f.prototype.modPow=function(y,v){if(y=A(y),v=A(v),v.isZero())throw new Error("Cannot take modPow with modulus 0");var k=p[1],D=this.mod(v);for(y.isNegative()&&(y=y.multiply(p[-1]),D=D.modInv(v));y.isPositive();){if(D.isZero())return p[0];y.isOdd()&&(k=k.multiply(D).mod(v)),y=y.divide(2),D=D.square().mod(v)}return k},h.prototype.modPow=c.prototype.modPow=f.prototype.modPow;function oe(y,v){if(y.length!==v.length)return y.length>v.length?1:-1;for(var k=y.length-1;k>=0;k--)if(y[k]!==v[k])return y[k]>v[k]?1:-1;return 0}f.prototype.compareAbs=function(y){var v=A(y),k=this.value,D=v.value;return v.isSmall?1:oe(k,D)},c.prototype.compareAbs=function(y){var v=A(y),k=Math.abs(this.value),D=v.value;return v.isSmall?(D=Math.abs(D),k===D?0:k>D?1:-1):-1},h.prototype.compareAbs=function(y){var v=this.value,k=A(y).value;return v=v>=0?v:-v,k=k>=0?k:-k,v===k?0:v>k?1:-1},f.prototype.compare=function(y){if(y===1/0)return-1;if(y===-1/0)return 1;var v=A(y),k=this.value,D=v.value;return this.sign!==v.sign?v.sign?1:-1:v.isSmall?this.sign?-1:1:oe(k,D)*(this.sign?-1:1)},f.prototype.compareTo=f.prototype.compare,c.prototype.compare=function(y){if(y===1/0)return-1;if(y===-1/0)return 1;var v=A(y),k=this.value,D=v.value;return v.isSmall?k==D?0:k>D?1:-1:k<0!==v.sign?k<0?-1:1:k<0?1:-1},c.prototype.compareTo=c.prototype.compare,h.prototype.compare=function(y){if(y===1/0)return-1;if(y===-1/0)return 1;var v=this.value,k=A(y).value;return v===k?0:v>k?1:-1},h.prototype.compareTo=h.prototype.compare,f.prototype.equals=function(y){return this.compare(y)===0},h.prototype.eq=h.prototype.equals=c.prototype.eq=c.prototype.equals=f.prototype.eq=f.prototype.equals,f.prototype.notEquals=function(y){return this.compare(y)!==0},h.prototype.neq=h.prototype.notEquals=c.prototype.neq=c.prototype.notEquals=f.prototype.neq=f.prototype.notEquals,f.prototype.greater=function(y){return this.compare(y)>0},h.prototype.gt=h.prototype.greater=c.prototype.gt=c.prototype.greater=f.prototype.gt=f.prototype.greater,f.prototype.lesser=function(y){return this.compare(y)<0},h.prototype.lt=h.prototype.lesser=c.prototype.lt=c.prototype.lesser=f.prototype.lt=f.prototype.lesser,f.prototype.greaterOrEquals=function(y){return this.compare(y)>=0},h.prototype.geq=h.prototype.greaterOrEquals=c.prototype.geq=c.prototype.greaterOrEquals=f.prototype.geq=f.prototype.greaterOrEquals,f.prototype.lesserOrEquals=function(y){return this.compare(y)<=0},h.prototype.leq=h.prototype.lesserOrEquals=c.prototype.leq=c.prototype.lesserOrEquals=f.prototype.leq=f.prototype.lesserOrEquals,f.prototype.isEven=function(){return(this.value[0]&1)===0},c.prototype.isEven=function(){return(this.value&1)===0},h.prototype.isEven=function(){return(this.value&BigInt(1))===BigInt(0)},f.prototype.isOdd=function(){return(this.value[0]&1)===1},c.prototype.isOdd=function(){return(this.value&1)===1},h.prototype.isOdd=function(){return(this.value&BigInt(1))===BigInt(1)},f.prototype.isPositive=function(){return!this.sign},c.prototype.isPositive=function(){return this.value>0},h.prototype.isPositive=c.prototype.isPositive,f.prototype.isNegative=function(){return this.sign},c.prototype.isNegative=function(){return this.value<0},h.prototype.isNegative=c.prototype.isNegative,f.prototype.isUnit=function(){return!1},c.prototype.isUnit=function(){return Math.abs(this.value)===1},h.prototype.isUnit=function(){return this.abs().value===BigInt(1)},f.prototype.isZero=function(){return!1},c.prototype.isZero=function(){return this.value===0},h.prototype.isZero=function(){return this.value===BigInt(0)},f.prototype.isDivisibleBy=function(y){var v=A(y);return v.isZero()?!1:v.isUnit()?!0:v.compareAbs(2)===0?this.isEven():this.mod(v).isZero()},h.prototype.isDivisibleBy=c.prototype.isDivisibleBy=f.prototype.isDivisibleBy;function me(y){var v=y.abs();if(v.isUnit())return!1;if(v.equals(2)||v.equals(3)||v.equals(5))return!0;if(v.isEven()||v.isDivisibleBy(3)||v.isDivisibleBy(5))return!1;if(v.lesser(49))return!0}function le(y,v){for(var k=y.prev(),D=k,z=0,q,Y,Q;D.isEven();)D=D.divide(2),z++;e:for(Y=0;Y<v.length;Y++)if(!y.lesser(v[Y])&&(Q=e(v[Y]).modPow(D,y),!(Q.isUnit()||Q.equals(k)))){for(q=z-1;q!=0;q--){if(Q=Q.square().mod(y),Q.isUnit())return!1;if(Q.equals(k))continue e}return!1}return!0}f.prototype.isPrime=function(y){var v=me(this);if(v!==r)return v;var k=this.abs(),D=k.bitLength();if(D<=64)return le(k,[2,3,5,7,11,13,17,19,23,29,31,37]);for(var z=Math.log(2)*D.toJSNumber(),q=Math.ceil(y===!0?2*Math.pow(z,2):z),Y=[],Q=0;Q<q;Q++)Y.push(e(Q+2));return le(k,Y)},h.prototype.isPrime=c.prototype.isPrime=f.prototype.isPrime,f.prototype.isProbablePrime=function(y,v){var k=me(this);if(k!==r)return k;for(var D=this.abs(),z=y===r?5:y,q=[],Y=0;Y<z;Y++)q.push(e.randBetween(2,D.minus(2),v));return le(D,q)},h.prototype.isProbablePrime=c.prototype.isProbablePrime=f.prototype.isProbablePrime,f.prototype.modInv=function(y){for(var v=e.zero,k=e.one,D=A(y),z=this.abs(),q,Y,Q;!z.isZero();)q=D.divide(z),Y=v,Q=D,v=k,D=z,k=Y.subtract(q.multiply(k)),z=Q.subtract(q.multiply(z));if(!D.isUnit())throw new Error(this.toString()+" and "+y.toString()+" are not co-prime");return v.compare(0)===-1&&(v=v.add(y)),this.isNegative()?v.negate():v},h.prototype.modInv=c.prototype.modInv=f.prototype.modInv,f.prototype.next=function(){var y=this.value;return this.sign?P(y,1,this.sign):new f(I(y,1),this.sign)},c.prototype.next=function(){var y=this.value;return y+1<s?new c(y+1):new f(a,!1)},h.prototype.next=function(){return new h(this.value+BigInt(1))},f.prototype.prev=function(){var y=this.value;return this.sign?new f(I(y,1),!0):P(y,1,this.sign)},c.prototype.prev=function(){var y=this.value;return y-1>-9007199254740992?new c(y-1):new f(a,!0)},h.prototype.prev=function(){return new h(this.value-BigInt(1))};for(var ce=[1];2*ce[ce.length-1]<=i;)ce.push(2*ce[ce.length-1]);var se=ce.length,de=ce[se-1];function fe(y){return Math.abs(y)<=i}f.prototype.shiftLeft=function(y){var v=A(y).toJSNumber();if(!fe(v))throw new Error(String(v)+" is too large for shifting.");if(v<0)return this.shiftRight(-v);var k=this;if(k.isZero())return k;for(;v>=se;)k=k.multiply(de),v-=se-1;return k.multiply(ce[v])},h.prototype.shiftLeft=c.prototype.shiftLeft=f.prototype.shiftLeft,f.prototype.shiftRight=function(y){var v,k=A(y).toJSNumber();if(!fe(k))throw new Error(String(k)+" is too large for shifting.");if(k<0)return this.shiftLeft(-k);for(var D=this;k>=se;){if(D.isZero()||D.isNegative()&&D.isUnit())return D;v=ae(D,de),D=v[1].isNegative()?v[0].prev():v[0],k-=se-1}return v=ae(D,ce[k]),v[1].isNegative()?v[0].prev():v[0]},h.prototype.shiftRight=c.prototype.shiftRight=f.prototype.shiftRight;function X(y,v,k){v=A(v);for(var D=y.isNegative(),z=v.isNegative(),q=D?y.not():y,Y=z?v.not():v,Q=0,ie=0,$e=null,Ae=null,ve=[];!q.isZero()||!Y.isZero();)$e=ae(q,de),Q=$e[1].toJSNumber(),D&&(Q=de-1-Q),Ae=ae(Y,de),ie=Ae[1].toJSNumber(),z&&(ie=de-1-ie),q=$e[0],Y=Ae[0],ve.push(k(Q,ie));for(var we=k(D?1:0,z?1:0)!==0?e(-1):e(0),Oe=ve.length-1;Oe>=0;Oe-=1)we=we.multiply(de).add(e(ve[Oe]));return we}f.prototype.not=function(){return this.negate().prev()},h.prototype.not=c.prototype.not=f.prototype.not,f.prototype.and=function(y){return X(this,y,function(v,k){return v&k})},h.prototype.and=c.prototype.and=f.prototype.and,f.prototype.or=function(y){return X(this,y,function(v,k){return v|k})},h.prototype.or=c.prototype.or=f.prototype.or,f.prototype.xor=function(y){return X(this,y,function(v,k){return v^k})},h.prototype.xor=c.prototype.xor=f.prototype.xor;var he=1<<30,ne=(i&-1e7)*(i&-1e7)|he;function ge(y){var v=y.value,k=typeof v=="number"?v|he:typeof v=="bigint"?v|BigInt(he):v[0]+v[1]*i|ne;return k&-k}function Ee(y,v){if(v.compareTo(y)<=0){var k=Ee(y,v.square(v)),D=k.p,z=k.e,q=D.multiply(v);return q.compareTo(y)<=0?{p:q,e:z*2+1}:{p:D,e:z*2}}return{p:e(1),e:0}}f.prototype.bitLength=function(){var y=this;return y.compareTo(e(0))<0&&(y=y.negate().subtract(e(1))),y.compareTo(e(0))===0?e(0):e(Ee(y,e(2)).e).add(e(1))},h.prototype.bitLength=c.prototype.bitLength=f.prototype.bitLength;function be(y,v){return y=A(y),v=A(v),y.greater(v)?y:v}function _e(y,v){return y=A(y),v=A(v),y.lesser(v)?y:v}function ye(y,v){if(y=A(y).abs(),v=A(v).abs(),y.equals(v))return y;if(y.isZero())return v;if(v.isZero())return y;for(var k=p[1],D,z;y.isEven()&&v.isEven();)D=_e(ge(y),ge(v)),y=y.divide(D),v=v.divide(D),k=k.multiply(D);for(;y.isEven();)y=y.divide(ge(y));do{for(;v.isEven();)v=v.divide(ge(v));y.greater(v)&&(z=v,v=y,y=z),v=v.subtract(y)}while(!v.isZero());return k.isUnit()?y:y.multiply(k)}function Te(y,v){return y=A(y).abs(),v=A(v).abs(),y.divide(ye(y,v)).multiply(v)}function xe(y,v,k){y=A(y),v=A(v);var D=k||Math.random,z=_e(y,v),q=be(y,v),Y=q.subtract(z).add(1);if(Y.isSmall)return z.add(Math.floor(D()*Y));for(var Q=w(Y,i).value,ie=[],$e=!0,Ae=0;Ae<Q.length;Ae++){var ve=$e?Q[Ae]+(Ae+1<Q.length?Q[Ae+1]/i:0):i,we=x(D()*ve);ie.push(we),we<Q[Ae]&&($e=!1)}return z.add(p.fromArray(ie,i,!1))}var Se=function(y,v,k,D){k=k||l,y=String(y),D||(y=y.toLowerCase(),k=k.toLowerCase());var z=y.length,q,Y=Math.abs(v),Q={};for(q=0;q<k.length;q++)Q[k[q]]=q;for(q=0;q<z;q++){var ie=y[q];if(ie!=="-"&&ie in Q&&Q[ie]>=Y){if(ie==="1"&&Y===1)continue;throw new Error(ie+" is not a valid digit in base "+v+".")}}v=A(v);var $e=[],Ae=y[0]==="-";for(q=Ae?1:0;q<y.length;q++){var ie=y[q];if(ie in Q)$e.push(A(Q[ie]));else if(ie==="<"){var ve=q;do q++;while(y[q]!==">"&&q<y.length);$e.push(A(y.slice(ve+1,q)))}else throw new Error(ie+" is not a valid character")}return W($e,v,Ae)};function W(y,v,k){var D=p[0],z=p[1],q;for(q=y.length-1;q>=0;q--)D=D.add(y[q].times(z)),z=z.times(v);return k?D.negate():D}function ue(y,v){return v=v||l,y<v.length?v[y]:"<"+y+">"}function w(y,v){if(v=e(v),v.isZero()){if(y.isZero())return{value:[0],isNegative:!1};throw new Error("Cannot convert nonzero numbers to base 0.")}if(v.equals(-1)){if(y.isZero())return{value:[0],isNegative:!1};if(y.isNegative())return{value:[].concat.apply([],Array.apply(null,Array(-y.toJSNumber())).map(Array.prototype.valueOf,[1,0])),isNegative:!1};var k=Array.apply(null,Array(y.toJSNumber()-1)).map(Array.prototype.valueOf,[0,1]);return k.unshift([1]),{value:[].concat.apply([],k),isNegative:!1}}var D=!1;if(y.isNegative()&&v.isPositive()&&(D=!0,y=y.abs()),v.isUnit())return y.isZero()?{value:[0],isNegative:!1}:{value:Array.apply(null,Array(y.toJSNumber())).map(Number.prototype.valueOf,1),isNegative:D};for(var z=[],q=y,Y;q.isNegative()||q.compareAbs(v)>=0;){Y=q.divmod(v),q=Y.quotient;var Q=Y.remainder;Q.isNegative()&&(Q=v.minus(Q).abs(),q=q.next()),z.push(Q.toJSNumber())}return z.push(q.toJSNumber()),{value:z.reverse(),isNegative:D}}function F(y,v,k){var D=w(y,v);return(D.isNegative?"-":"")+D.value.map(function(z){return ue(z,k)}).join("")}f.prototype.toArray=function(y){return w(this,y)},c.prototype.toArray=function(y){return w(this,y)},h.prototype.toArray=function(y){return w(this,y)},f.prototype.toString=function(y,v){if(y===r&&(y=10),y!==10||v)return F(this,y,v);for(var k=this.value,D=k.length,z=String(k[--D]),q="0000000",Y;--D>=0;)Y=String(k[D]),z+=q.slice(Y.length)+Y;var Q=this.sign?"-":"";return Q+z},c.prototype.toString=function(y,v){return y===r&&(y=10),y!=10||v?F(this,y,v):String(this.value)},h.prototype.toString=c.prototype.toString,h.prototype.toJSON=f.prototype.toJSON=c.prototype.toJSON=function(){return this.toString()},f.prototype.valueOf=function(){return parseInt(this.toString(),10)},f.prototype.toJSNumber=f.prototype.valueOf,c.prototype.valueOf=function(){return this.value},c.prototype.toJSNumber=c.prototype.valueOf,h.prototype.valueOf=h.prototype.toJSNumber=function(){return parseInt(this.toString(),10)};function V(y){if(d(+y)){var v=+y;if(v===x(v))return u?new h(BigInt(v)):new c(v);throw new Error("Invalid integer: "+y)}var k=y[0]==="-";k&&(y=y.slice(1));var D=y.split(/e/i);if(D.length>2)throw new Error("Invalid integer: "+D.join("e"));if(D.length===2){var z=D[1];if(z[0]==="+"&&(z=z.slice(1)),z=+z,z!==x(z)||!d(z))throw new Error("Invalid integer: "+z+" is not a valid exponent.");var q=D[0],Y=q.indexOf(".");if(Y>=0&&(z-=q.length-Y-1,q=q.slice(0,Y)+q.slice(Y+1)),z<0)throw new Error("Cannot include negative exponent part for integers");q+=new Array(z+1).join("0"),y=q}var Q=/^([0-9][0-9]*)$/.test(y);if(!Q)throw new Error("Invalid integer: "+y);if(u)return new h(BigInt(k?"-"+y:y));for(var ie=[],$e=y.length,Ae=n,ve=$e-Ae;$e>0;)ie.push(+y.slice(ve,$e)),ve-=Ae,ve<0&&(ve=0),$e-=Ae;return g(ie),new f(ie,k)}function K(y){if(u)return new h(BigInt(y));if(d(y)){if(y!==x(y))throw new Error(y+" is not an integer.");return new c(y)}return V(y.toString())}function A(y){return typeof y=="number"?K(y):typeof y=="string"?V(y):typeof y=="bigint"?new h(y):y}for(var re=0;re<1e3;re++)p[re]=A(re),re>0&&(p[-re]=A(-re));return p.one=p[1],p.zero=p[0],p.minusOne=p[-1],p.max=be,p.min=_e,p.gcd=ye,p.lcm=Te,p.isInstance=function(y){return y instanceof f||y instanceof c||y instanceof h},p.randBetween=xe,p.fromArray=function(y,v,k){return W(y.map(A),A(v||10),k)},p}();t.hasOwnProperty("exports")&&(t.exports=e)}(BigInteger)),BigInteger.exports}var hasRequiredAlgebrite;function requireAlgebrite(){return hasRequiredAlgebrite||(hasRequiredAlgebrite=1,function(exports){(function(){var $,ABS,ADD,ADJ,AND,APPROXRATIO,ARCCOS,ARCCOSH,ARCSIN,ARCSINH,ARCTAN,ARCTANH,ARG,ASSUME_REAL_VARIABLES,ATOMIZE,AUTOEXPAND,BAKE,BESSELJ,BESSELY,BINDING,BINOMIAL,BINOM_check_args,C1,C2,C3,C4,C5,C6,CEILING,CHECK,CHOOSE,CIRCEXP,CLEAR,CLEARALL,CLEARPATTERNS,CLOCK,COEFF,COFACTOR,CONDENSE,CONJ,CONS,CONTRACT,COS,COSH,Condense,DEBUG,DEBUG_ABS,DEBUG_ARG,DEBUG_CLOCKFORM,DEBUG_IMAG,DEBUG_IS,DEBUG_MULTIPLY,DEBUG_POWER,DEBUG_RATIONALIZE,DEBUG_RECT,DEBUG_SIMPLIFY,DECOMP,DEFINT,DEGREE,DENOMINATOR,DERIVATIVE,DET,DET_check_arg,DIM,DIRAC,DIVISORS,DO,DOT,DOUBLE,DRAW,DRAWX,DSOLVE,E,EIGEN,EIGENVAL,EIGENVEC,EIG_N,EIG_check_arg,EIG_yydd,EIG_yyqq,ERF,ERFC,EVAL,EXP,EXPAND,EXPCOS,EXPSIN,Eval,Eval_Eval,Eval_abs,Eval_add,Eval_adj,Eval_and,Eval_approxratio,Eval_arccos,Eval_arccosh,Eval_arcsin,Eval_arcsinh,Eval_arctan,Eval_arctanh,Eval_arg,Eval_besselj,Eval_bessely,Eval_binding,Eval_binomial,Eval_ceiling,Eval_check,Eval_choose,Eval_circexp,Eval_clear,Eval_clearall,Eval_clearpatterns,Eval_clock,Eval_coeff,Eval_cofactor,Eval_condense,Eval_conj,Eval_cons,Eval_contract,Eval_cos,Eval_cosh,Eval_decomp,Eval_defint,Eval_degree,Eval_denominator,Eval_derivative,Eval_det,Eval_dim,Eval_dirac,Eval_divisors,Eval_do,Eval_dsolve,Eval_eigen,Eval_eigenval,Eval_eigenvec,Eval_erf,Eval_erfc,Eval_exp,Eval_expand,Eval_expcos,Eval_expsin,Eval_factor,Eval_factorial,Eval_factorpoly,Eval_filter,Eval_float,Eval_floor,Eval_for,Eval_function_reference,Eval_gamma,Eval_gcd,Eval_hermite,Eval_hilbert,Eval_imag,Eval_index,Eval_inner,Eval_integral,Eval_inv,Eval_invg,Eval_isinteger,Eval_isprime,Eval_laguerre,Eval_lcm,Eval_leading,Eval_legendre,Eval_log,Eval_lookup,Eval_mod,Eval_multiply,Eval_not,Eval_nroots,Eval_number,Eval_numerator,Eval_operator,Eval_or,Eval_outer,Eval_pattern,Eval_patternsinfo,Eval_polar,Eval_power,Eval_predicate,Eval_prime,Eval_print,Eval_print2dascii,Eval_printcomputer,Eval_printhuman,Eval_printlatex,Eval_printlist,Eval_product,Eval_quote,Eval_quotient,Eval_rank,Eval_rationalize,Eval_real,Eval_rect,Eval_roots,Eval_round,Eval_setq,Eval_sgn,Eval_shape,Eval_silentpattern,Eval_simplify,Eval_sin,Eval_sinh,Eval_sqrt,Eval_stop,Eval_subst,Eval_sum,Eval_sym,Eval_symbolsinfo,Eval_tan,Eval_tanh,Eval_taylor,Eval_tensor,Eval_test,Eval_testeq,Eval_testge,Eval_testgt,Eval_testle,Eval_testlt,Eval_transpose,Eval_unit,Eval_user_function,Eval_zero,Evalpoly,FACTOR,FACTORIAL,FACTORPOLY,FILTER,FLOATF,FLOOR,FOR,FORCE_FIXED_PRINTOUT,FUNCTION,Find,GAMMA,GCD,HERMITE,HILBERT,IMAG,INDEX,INNER,INTEGRAL,INV,INVG,INV_check_arg,INV_decomp,ISINTEGER,ISPRIME,LAGUERRE,LAST,LAST_2DASCII_PRINT,LAST_FULL_PRINT,LAST_LATEX_PRINT,LAST_LIST_PRINT,LAST_PLAIN_PRINT,LAST_PRINT,LCM,LEADING,LEGENDRE,LOG,LOOKUP,M,MAXDIM,MAXPRIMETAB,MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES,MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE,MAX_FIXED_PRINTOUT_DIGITS,MEQUAL,METAA,METAB,METAX,MOD,MSIGN,MULTIPLY,MZERO,N,NIL,NOT,NROOTS,NROOTS_ABS,NROOTS_DELTA,NROOTS_EPSILON,NROOTS_RANDOM,NROOTS_YMAX,NROOTS_divpoly,NSYM,NUM,NUMBER,NUMERATOR,OPERATOR,OR,OUTER,PATTERN,PATTERNSINFO,PI,POLAR,POWER,PRIME,PRINT,PRINT2DASCII,PRINTFULL,PRINTLATEX,PRINTLIST,PRINTMODE_2DASCII,PRINTMODE_COMPUTER,PRINTMODE_HUMAN,PRINTMODE_LATEX,PRINTMODE_LIST,PRINTOUTRESULT,PRINTPLAIN,PRINT_LEAVE_E_ALONE,PRINT_LEAVE_X_ALONE,PRODUCT,QUOTE,QUOTIENT,RANK,RATIONALIZE,REAL,ROOTS,ROUND,SECRETX,SETQ,SGN,SHAPE,SILENTPATTERN,SIMPLIFY,SIN,SINH,SPACE_BETWEEN_COLUMNS,SPACE_BETWEEN_ROWS,SQRT,STOP,STR,SUBST,SUM,SYM,SYMBOLSINFO,SYMBOL_A,SYMBOL_A_UNDERSCORE,SYMBOL_B,SYMBOL_B_UNDERSCORE,SYMBOL_C,SYMBOL_D,SYMBOL_I,SYMBOL_IDENTITY_MATRIX,SYMBOL_J,SYMBOL_N,SYMBOL_R,SYMBOL_S,SYMBOL_T,SYMBOL_X,SYMBOL_X_UNDERSCORE,SYMBOL_Y,SYMBOL_Z,TAN,TANH,TAYLOR,TENSOR,TEST,TESTEQ,TESTGE,TESTGT,TESTLE,TESTLT,TIMING_DEBUGS,TOS,TRACE,TRANSPOSE,T_DOUBLE,T_EQ,T_FUNCTION,T_GTEQ,T_INTEGER,T_LTEQ,T_NEQ,T_NEWLINE,T_QUOTASSIGN,T_STRING,T_SYMBOL,U,UNIT,VERSION,YMAX,YYE,YYRECT,ZERO,__emit_char,__emit_str,__factor_add,__factorial,__is_negative,__is_radical_number,__lcm,__legendre,__legendre2,__legendre3,__normalize_radical_factors,__rationalize_tensor,_print,abs,absValFloat,absval,absval_tensor,add,addSymbolLeftOfAssignment,addSymbolRightOfAssignment,add_all,add_factor_to_accumulator,add_numbers,add_terms,adj,alloc_tensor,allocatedId,any_denominators,approxAll,approxLogs,approxLogsOfRationals,approxOneRatioOnly,approxRadicals,approxRadicalsOfRationals,approxRationalsOfLogs,approxRationalsOfPowersOfE,approxRationalsOfPowersOfPI,approxRationalsOfRadicals,approxSineOfRationalMultiplesOfPI,approxSineOfRationals,approxTrigonometric,approx_just_an_integer,approx_logarithmsOfRationals,approx_radicalOfRatio,approx_ratioOfRadical,approx_rationalOfE,approx_rationalOfPi,approx_rationalsOfLogarithms,approx_sine_of_pi_times_rational,approx_sine_of_rational,approxratioRecursive,arccos,arccosh,arcsin,arcsinh,arctan,arctanh,areunivarpolysfactoredorexpandedform,arg,assignmentFound,avoidCalculatingPowersIntoArctans,bake,bake_poly,bake_poly_term,besselj,bessely,bigInt,bignum_factorial,bignum_float,bignum_power_number,bignum_scan_float,bignum_scan_integer,bignum_truncate,binding,binomial,build_tensor,caaddr,caadr,caar,cadaddr,cadadr,cadar,caddaddr,caddadr,caddar,caddddr,cadddr,caddr,cadr,car,cdaddr,cdadr,cdar,cddaddr,cddar,cdddaddr,cddddr,cdddr,cddr,cdr,ceiling,chainOfUserSymbolsNotFunctionsBeingEvaluated,charTabIndex,chartab,check_esc_flag,check_stack,check_tensor_dimensions,choose,choose_check_args,circexp,clearAlgebraEnvironment,clearRenamedVariablesToAvoidBindingToExternalScope,clear_symbols,clear_term,clockform,cmpGlyphs,cmp_args,cmp_expr,cmp_terms,codeGen,coeff,cofactor,collectLatexStringFromReturnValue,collectUserSymbols,combine_factors,combine_terms,compare_numbers,compare_rationals,compare_tensors,compatible,computeDependenciesFromAlgebra,computeResultsAndJavaScriptFromAlgebra,compute_fa,conjugate,cons,consCount,contract,convert_rational_to_double,copy_tensor,cosine,cosine_of_angle,cosine_of_angle_sum,count,countOccurrencesOfSymbol,count_denominators,counter,countsize,d_scalar_scalar,d_scalar_scalar_1,d_scalar_tensor,d_tensor_scalar,d_tensor_tensor,dabs,darccos,darccosh,darcsin,darcsinh,darctan,darctanh,dbesselj0,dbesseljn,dbessely0,dbesselyn,dcos,dcosh,dd,decomp,decomp_product,decomp_sum,defineSomeHandyConstants,define_user_function,defn,defn_str,degree,denominator,derf,derfc,derivative,derivative_of_integral,det,determinant,dfunction,dhermite,dirac,divide,divide_numbers,divisors,divisors_onstack,divpoly,dlog,do_clearPatterns,do_clearall,do_simplify_nested_radicals,dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication,dotprod_unicode,doubleToReasonableString,dpow,dpower,dproduct,dsgn,dsin,dsinh,dsum,dtan,dtanh,dupl,eigen,elelmIndex,elem,emit_denominator,emit_denominators,emit_expr,emit_factor,emit_factorial_function,emit_flat_tensor,emit_fraction,emit_function,emit_index_function,emit_multiply,emit_number,emit_numerators,emit_numerical_fraction,emit_power,emit_string,emit_subexpr,emit_symbol,emit_tensor,emit_tensor_inner,emit_term,emit_top_expr,emit_unsigned_expr,emit_x,equal,equaln,equalq,erfc,errorMessage,esc_flag,evaluatingAsFloats,evaluatingPolar,exec,expand,expand_get_A,expand_get_AF,expand_get_B,expand_get_C,expand_get_CF,expand_tensor,expanding,expcos,exponential,expr_level,expsin,f1,f10,f2,f3,f4,f5,f9,f_equals_a,factor,factor_a,factor_again,factor_b,factor_number,factor_small_number,factor_term,factorial,factorpoly,factors,filter,filter_main,filter_sum,filter_tensor,findDependenciesInScript,findPossibleClockForm,findPossibleExponentialForm,findroot,fixup_fraction,fixup_power,flag,floatToRatioRoutine,frame,functionInvokationsScanningStack,gamma,gamma_of_sum,gammaf,gcd,gcd_main,gcd_numbers,gcd_polys,gcd_powers_with_same_base,gcd_product_product,gcd_product_sum,gcd_sum,gcd_sum_product,gcd_sum_sum,gen,getSimpleRoots,get_binding,get_factor_from_complex_root,get_factor_from_real_root,get_innerprod_factors,get_next_token,get_printname,get_size,get_token,glyph,guess,hasImaginaryCoeff,hasNegativeRationalExponent,hash_addition,hash_function,hash_multiplication,hash_power,hashcode_values,hashed_itab,hermite,hilbert,i1,imag,imaginaryunit,index_function,init,initNRoots,inited,inner,inner_f,input_str,integral,integral_of_form,integral_of_product,integral_of_sum,inv,inverse,invert_number,invg,isNumberOneOverSomething,isNumericAtom,isNumericAtomOrTensor,isSimpleRoot,isSmall,isSymbolLeftOfAssignment,isSymbolReclaimable,isZeroAtom,isZeroAtomOrTensor,isZeroLikeOrNonZeroLikeOrUndetermined,isZeroTensor,is_denominator,is_factor,is_small_integer,is_usr_symbol,isadd,isalnumorunderscore,isalpha,isalphaOrUnderscore,iscomplexnumber,iscomplexnumberdouble,iscons,isdenominator,isdigit,isdouble,iseveninteger,isfactor,isfactorial,isfloating,isfraction,isidentitymatrix,isimaginarynumber,isimaginarynumberdouble,isimaginaryunit,isinnerordot,isinteger,isintegerfactor,isintegerorintegerfloat,isinv,iskeyword,isminusone,isminusoneoversqrttwo,isminusoneovertwo,isminussqrtthreeovertwo,ismultiply,isnegative,isnegativenumber,isnegativeterm,isnonnegativeinteger,isnpi,isone,isoneover,isoneoversqrttwo,isoneovertwo,isplusone,isplustwo,ispolyexpandedform,ispolyexpandedform_expr,ispolyexpandedform_factor,ispolyexpandedform_term,ispolyfactoredorexpandedform,ispolyfactoredorexpandedform_factor,ispolyfactoredorexpandedform_power,isposint,ispositivenumber,ispower,isquarterturn,isrational,isspace,issqrtthree,issqrtthreeovertwo,isstr,issymbol,issymbolic,istensor,istranspose,isunivarpolyfactoredorexpandedform,itab,italu_hashcode,j1,laguerre,laguerre2,lastFoundSymbol,latexErrorSign,lcm,leading,legendre,length,lessp,level,list,logarithm,lookupsTotal,lu_decomp,madd,makePositive,makeSignSameAs,make_hashed_itab,mcmp,mdiv,mdivrem,meta_mode,mgcd,mini_solve,mint,mmod,mmul,mod,monic,move,moveTos,mp_denominator,mp_numerator,mpow,mprime,mroot,msub,multinomial_sum,multiply,multiply_all,multiply_all_noexpand,multiply_consecutive_constants,multiply_denominators,multiply_denominators_factor,multiply_denominators_term,multiply_noexpand,multiply_numbers,n_factor_number,negate,negate_noexpand,negate_number,new_integer,new_string,newline_flag,nil_symbols,normaliseDots,normalisedCoeff,normalize_angle,nroots_a,nroots_b,nroots_c,nroots_df,nroots_dx,nroots_fa,nroots_fb,nroots_x,nroots_y,nterms,numerator,numericRootOfPolynomial,o,one,oneElement,one_as_double,outer,p0,p1,p2,p3,p4,p5,p6,p7,p8,p9,parse,parse_internal,parse_p1,parse_p2,parse_time_simplifications,partition,patternHasBeenFound,patternsinfo,polar,polarRectAMinusOneBase,polyform,pop,pop_double,pop_frame,pop_integer,power,power_str,power_sum,power_tensor,predefinedSymbolsInGlobalScope_doNotTrackInDependencies,prime,primetab,print2dascii,printMode,print_ABS_latex,print_ARCCOS_codegen,print_ARCSIN_codegen,print_ARCTAN_codegen,print_BINOMIAL_latex,print_COS_codegen,print_DEFINT_latex,print_DOT_codegen,print_DOT_latex,print_DO_codegen,print_FOR_codegen,print_INV_codegen,print_INV_latex,print_PRODUCT_codegen,print_PRODUCT_latex,print_SETQ_codegen,print_SIN_codegen,print_SQRT_latex,print_SUM_codegen,print_SUM_latex,print_TAN_codegen,print_TESTEQ_latex,print_TESTGE_latex,print_TESTGT_latex,print_TESTLE_latex,print_TESTLT_latex,print_TEST_codegen,print_TEST_latex,print_TRANSPOSE_codegen,print_TRANSPOSE_latex,print_UNIT_codegen,print_a_over_b,print_base_of_denom,print_char,print_denom,print_expo_of_denom,print_expr,print_factor,print_factorial_function,print_glyphs,print_index_function,print_list,print_multiply_sign,print_number,print_power,print_str,print_subexpr,print_tensor,print_tensor_inner,print_tensor_inner_latex,print_tensor_latex,print_term,printchar,printchar_nowrap,printline,promote_tensor,push,pushTryNotToDuplicate,push_double,push_factor,push_frame,push_integer,push_rational,push_symbol,push_term_factors,push_terms,push_zero_matrix,qadd,qdiv,qmul,qpow,qpowf,quickfactor,quickpower,rational,rationalize,rationalize_coefficients,real,reciprocate,rect,recursionLevelNestedRadicalsRemoval,recursiveDependencies,ref,ref1,rememberPrint,remove_negative_exponents,reset_after_error,restore,restoreMetaBindings,rewrite_args,rewrite_args_tensor,roots,roots2,roots3,run,runUserDefinedSimplifications,save,saveMetaBindings,scalar_times_tensor,scan,scan_error,scan_expression,scan_factor,scan_function_call_with_function_name,scan_function_call_without_function_name,scan_index,scan_meta,scan_power,scan_relation,scan_stmt,scan_str,scan_string,scan_subexpr,scan_symbol,scan_tensor,scan_term,scanned,scanningParameters,setM,setSignTo,set_binding,set_component,setq_indexed,sgn,shape,sign,sign_of_term,simfac,simfac_term,simpleComplexityMeasure,simplify,simplifyForCodeGeneration,simplify_1_in_products,simplify_main,simplify_nested_radicals,simplify_polar,simplify_polarRect,simplify_rational_expressions,simplify_rectToClock,simplify_tensor,simplify_trig,sine,sine_of_angle,sine_of_angle_sum,skipRootVariableToBeSolved,sort_stack,square,stack,stackAddsCount,std_symbol,step,step2,stop,strcmp,stringsEmittedByUserPrintouts,subst,subtract,swap,symbol,symbolsDependencies,symbolsHavingReassignments,symbolsInExpressionsWithoutAssignments,symbolsLeftOfAssignment,symbolsRightOfAssignment,symbolsinfo,symnum,symtab,take_care_of_nested_radicals,tangent,taylor,tensor,tensor_plus_tensor,tensor_times_scalar,testApprox,test_flag,token,token_buf,token_str,top,top_level_eval,tos,transform,transpose,transpose_unicode,trigmode,trivial_divide,try_kth_prime,turnErrorMessageToLatex,update_token_buf,userSimplificationsInListForm,userSimplificationsInStringForm,usr_symbol,version,will_be_displayed_as_fraction,ybinomial,ycosh,ydirac,yerf,yerfc,yfloor,yindex,yround,ysinh,yyarg,yybesselj,yybessely,yyceiling,yycondense,yycontract,yycosh,yydegree,yydetg,yydivpoly,yyerf,yyerfc,yyexpand,yyfactorpoly,yyfloat,yyfloor,yyhermite,yyhermite2,yyinvg,yylcm,yylog,yymultiply,yyouter,yypower,yyrationalize,yyround,yysgn,yysimfac,yysinh,yytangent,zero,zzfloat,hasProp={}.hasOwnProperty;for(bigInt=requireBigInteger(),version="1.4.0",NSYM=1e3,DEBUG=!1,PRINTOUTRESULT=!1,PRINTMODE_LATEX="PRINTMODE_LATEX",PRINTMODE_2DASCII="PRINTMODE_2DASCII",PRINTMODE_COMPUTER="PRINTMODE_COMPUTER",PRINTMODE_HUMAN="PRINTMODE_HUMAN",PRINTMODE_LIST="PRINTMODE_LIST",printMode=PRINTMODE_COMPUTER,dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication=!0,recursionLevelNestedRadicalsRemoval=0,do_simplify_nested_radicals=!0,avoidCalculatingPowersIntoArctans=!0,rational=(function(){class t{}return t.prototype.a=null,t.prototype.b=null,t}).call(this),U=(function(){class t{toString(){return print_expr(this)}toLatexString(){return collectLatexStringFromReturnValue(this)}constructor(){this.cons={},this.cons.car=null,this.cons.cdr=null,this.q=new rational}}return t.prototype.cons=null,t.prototype.printname="",t.prototype.str="",t.prototype.tensor=null,t.prototype.q=null,t.prototype.d=0,t.prototype.k=0,t.prototype.tag=0,t}).call(this),errorMessage="",CONS=0,NUM=1,DOUBLE=2,STR=3,TENSOR=4,SYM=5,counter=0,ABS=counter++,ADD=counter++,ADJ=counter++,AND=counter++,APPROXRATIO=counter++,ARCCOS=counter++,ARCCOSH=counter++,ARCSIN=counter++,ARCSINH=counter++,ARCTAN=counter++,ARCTANH=counter++,ARG=counter++,ATOMIZE=counter++,BESSELJ=counter++,BESSELY=counter++,BINDING=counter++,BINOMIAL=counter++,CEILING=counter++,CHECK=counter++,CHOOSE=counter++,CIRCEXP=counter++,CLEAR=counter++,CLEARALL=counter++,CLEARPATTERNS=counter++,CLOCK=counter++,COEFF=counter++,COFACTOR=counter++,CONDENSE=counter++,CONJ=counter++,CONTRACT=counter++,COS=counter++,COSH=counter++,DECOMP=counter++,DEFINT=counter++,DEGREE=counter++,DENOMINATOR=counter++,DERIVATIVE=counter++,DET=counter++,DIM=counter++,DIRAC=counter++,DIVISORS=counter++,DO=counter++,DOT=counter++,DRAW=counter++,DSOLVE=counter++,EIGEN=counter++,EIGENVAL=counter++,EIGENVEC=counter++,ERF=counter++,ERFC=counter++,EVAL=counter++,EXP=counter++,EXPAND=counter++,EXPCOS=counter++,EXPSIN=counter++,FACTOR=counter++,FACTORIAL=counter++,FACTORPOLY=counter++,FILTER=counter++,FLOATF=counter++,FLOOR=counter++,FOR=counter++,FUNCTION=counter++,GAMMA=counter++,GCD=counter++,HERMITE=counter++,HILBERT=counter++,IMAG=counter++,INDEX=counter++,INNER=counter++,INTEGRAL=counter++,INV=counter++,INVG=counter++,ISINTEGER=counter++,ISPRIME=counter++,LAGUERRE=counter++,LCM=counter++,LEADING=counter++,LEGENDRE=counter++,LOG=counter++,LOOKUP=counter++,MOD=counter++,MULTIPLY=counter++,NOT=counter++,NROOTS=counter++,NUMBER=counter++,NUMERATOR=counter++,OPERATOR=counter++,OR=counter++,OUTER=counter++,PATTERN=counter++,PATTERNSINFO=counter++,POLAR=counter++,POWER=counter++,PRIME=counter++,PRINT_LEAVE_E_ALONE=counter++,PRINT_LEAVE_X_ALONE=counter++,PRINT=counter++,PRINT2DASCII=counter++,PRINTFULL=counter++,PRINTLATEX=counter++,PRINTLIST=counter++,PRINTPLAIN=counter++,PRODUCT=counter++,QUOTE=counter++,QUOTIENT=counter++,RANK=counter++,RATIONALIZE=counter++,REAL=counter++,ROUND=counter++,YYRECT=counter++,ROOTS=counter++,SETQ=counter++,SGN=counter++,SILENTPATTERN=counter++,SIMPLIFY=counter++,SIN=counter++,SINH=counter++,SHAPE=counter++,SQRT=counter++,STOP=counter++,SUBST=counter++,SUM=counter++,SYMBOLSINFO=counter++,TAN=counter++,TANH=counter++,TAYLOR=counter++,TEST=counter++,TESTEQ=counter++,TESTGE=counter++,TESTGT=counter++,TESTLE=counter++,TESTLT=counter++,TRANSPOSE=counter++,UNIT=counter++,ZERO=counter++,NIL=counter++,LAST=counter++,LAST_PRINT=counter++,LAST_2DASCII_PRINT=counter++,LAST_FULL_PRINT=counter++,LAST_LATEX_PRINT=counter++,LAST_LIST_PRINT=counter++,LAST_PLAIN_PRINT=counter++,AUTOEXPAND=counter++,BAKE=counter++,ASSUME_REAL_VARIABLES=counter++,TRACE=counter++,FORCE_FIXED_PRINTOUT=counter++,MAX_FIXED_PRINTOUT_DIGITS=counter++,YYE=counter++,DRAWX=counter++,METAA=counter++,METAB=counter++,METAX=counter++,SECRETX=counter++,VERSION=counter++,PI=counter++,SYMBOL_A=counter++,SYMBOL_B=counter++,SYMBOL_C=counter++,SYMBOL_D=counter++,SYMBOL_I=counter++,SYMBOL_J=counter++,SYMBOL_N=counter++,SYMBOL_R=counter++,SYMBOL_S=counter++,SYMBOL_T=counter++,SYMBOL_X=counter++,SYMBOL_Y=counter++,SYMBOL_Z=counter++,SYMBOL_IDENTITY_MATRIX=counter++,SYMBOL_A_UNDERSCORE=counter++,SYMBOL_B_UNDERSCORE=counter++,SYMBOL_X_UNDERSCORE=counter++,C1=counter++,C2=counter++,C3=counter++,C4=counter++,C5=counter++,C6=counter++,counter++,E=YYE,TOS=1e5,MAXPRIMETAB=1e4,MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES=5,MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE=10,MAXDIM=24,symbolsDependencies={},symbolsHavingReassignments=[],symbolsInExpressionsWithoutAssignments=[],patternHasBeenFound=!1,predefinedSymbolsInGlobalScope_doNotTrackInDependencies=["rationalize","abs","e","i","pi","sin","ceiling","cos","roots","integral","derivative","defint","sqrt","eig","cov","deig","dcov","float","floor","product","root","round","sum","test","unit"],parse_time_simplifications=!0,chainOfUserSymbolsNotFunctionsBeingEvaluated=[],stringsEmittedByUserPrintouts="",tensor=(function(){class t{constructor(){this.dim=function(){var r,i,n;for(n=[],r=0,i=MAXDIM;0<=i?r<=i:r>=i;0<=i?r++:r--)n.push(0);return n}(),this.elem=[]}}return t.prototype.ndim=0,t.prototype.dim=null,t.prototype.nelem=0,t.prototype.elem=null,t}).call(this),(function(){class t{}return t.prototype.h=0,t.prototype.w=0,t.prototype.n=0,t.prototype.a=[],t}).call(this),(function(){class t{}return t.prototype.ascent=0,t.prototype.descent=0,t.prototype.width=0,t}).call(this),tos=0,expanding=0,evaluatingAsFloats=0,evaluatingPolar=0,primetab=function(){var t,e,r,i;for(i=[2],e=3;i.length<MAXPRIMETAB;){for(r=0,t=Math.sqrt(e);r<i.length&&i[r]<=t;){if(e%i[r]===0){r=-1;break}r++}r!==-1&&i.push(e),e+=2}return i[MAXPRIMETAB]=0,i}(),esc_flag=0,trigmode=0,symtab=[],binding=[],isSymbolReclaimable=[],stack=[],frame=0,p0=null,p1=null,p2=null,p3=null,p4=null,p5=null,p6=null,p7=null,p8=null,p9=null,zero=null,one=null,one_as_double=null,imaginaryunit=null,test_flag=0,codeGen=!1,userSimplificationsInListForm=[],userSimplificationsInStringForm=[],transpose_unicode=7488,dotprod_unicode=183,symbol=function(t){return symtab[t]},iscons=function(t){return t.k===CONS},isrational=function(t){return t.k===NUM},isdouble=function(t){return t.k===DOUBLE},isNumericAtom=function(t){return isrational(t)||isdouble(t)},isstr=function(t){return t.k===STR},istensor=function(t){if(t==null)debugger;else return t.k===TENSOR},isNumericAtomOrTensor=function(t){var e,r,i,n,s;if(isNumericAtom(t)||t===symbol(SYMBOL_IDENTITY_MATRIX))return 1;if(!istensor(t)&&!isNumericAtom(t))return 0;for(i=t.tensor.nelem,e=t.tensor.elem,r=n=0,s=i;0<=s?n<s:n>s;r=0<=s?++n:--n)if(!isNumericAtomOrTensor(e[r]))return 0;return 1},issymbol=function(t){return t.k===SYM},iskeyword=function(t){return issymbol(t)&&symnum(t)<NIL},car=function(t){return iscons(t)?t.cons.car:symbol(NIL)},cdr=function(t){return iscons(t)?t.cons.cdr:symbol(NIL)},caar=function(t){return car(car(t))},cadr=function(t){return car(cdr(t))},cdar=function(t){return cdr(car(t))},cddr=function(t){return cdr(cdr(t))},caadr=function(t){return car(car(cdr(t)))},caddr=function(t){return car(cdr(cdr(t)))},cadar=function(t){return car(cdr(car(t)))},cdadr=function(t){return cdr(car(cdr(t)))},cddar=function(t){return cdr(cdr(car(t)))},cdddr=function(t){return cdr(cdr(cdr(t)))},caaddr=function(t){return car(car(cdr(cdr(t))))},cadadr=function(t){return car(cdr(car(cdr(t))))},caddar=function(t){return car(cdr(cdr(car(t))))},cdaddr=function(t){return cdr(car(cdr(cdr(t))))},cadddr=function(t){return car(cdr(cdr(cdr(t))))},cddddr=function(t){return cdr(cdr(cdr(cdr(t))))},caddddr=function(t){return car(cdr(cdr(cdr(cdr(t)))))},cadaddr=function(t){return car(cdr(car(cdr(cdr(t)))))},cddaddr=function(t){return cdr(cdr(car(cdr(cdr(t)))))},caddadr=function(t){return car(cdr(cdr(car(cdr(t)))))},cdddaddr=function(t){return cdr(cdr(cdr(car(cdr(cdr(t))))))},caddaddr=function(t){return car(cdr(cdr(car(cdr(cdr(t))))))},isadd=function(t){return car(t)===symbol(ADD)},ismultiply=function(t){return car(t)===symbol(MULTIPLY)},ispower=function(t){return car(t)===symbol(POWER)},isfactorial=function(t){return car(t)===symbol(FACTORIAL)},isinnerordot=function(t){return car(t)===symbol(INNER)||car(t)===symbol(DOT)},istranspose=function(t){return car(t)===symbol(TRANSPOSE)},isinv=function(t){return car(t)===symbol(INV)},isidentitymatrix=function(t){return t===symbol(SYMBOL_IDENTITY_MATRIX)},MSIGN=function(t){return t.isPositive()?1:t.isZero()?0:-1},MZERO=function(t){return t.isZero()},MEQUAL=function(t,e){if(t==null)debugger;return t.equals(e)},reset_after_error=function(){return moveTos(0),esc_flag=0,frame=TOS,evaluatingAsFloats=0,evaluatingPolar=0},$=exports!==null?exports:this,$.version=version,$.isadd=isadd,$.ismultiply=ismultiply,$.ispower=ispower,$.isfactorial=isfactorial,$.car=car,$.cdr=cdr,$.caar=caar,$.cadr=cadr,$.cdar=cdar,$.cddr=cddr,$.caadr=caadr,$.caddr=caddr,$.cadar=cadar,$.cdadr=cdadr,$.cddar=cddar,$.cdddr=cdddr,$.caaddr=caaddr,$.cadadr=cadadr,$.caddar=caddar,$.cdaddr=cdaddr,$.cadddr=cadddr,$.cddddr=cddddr,$.caddddr=caddddr,$.cadaddr=cadaddr,$.cddaddr=cddaddr,$.caddadr=caddadr,$.cdddaddr=cdddaddr,$.caddaddr=caddaddr,$.symbol=symbol,$.iscons=iscons,$.isrational=isrational,$.isdouble=isdouble,$.isNumericAtom=isNumericAtom,$.isstr=isstr,$.istensor=istensor,$.issymbol=issymbol,$.iskeyword=iskeyword,$.CONS=CONS,$.NUM=NUM,$.DOUBLE=DOUBLE,$.STR=STR,$.TENSOR=TENSOR,$.SYM=SYM,DEBUG_ABS=!1,Eval_abs=function(){return push(cadr(p1)),Eval(),abs()},absValFloat=function(){return Eval(),absval(),Eval(),zzfloat()},abs=function(){var t;if(t=top(),DEBUG_ABS&&console.trace(">>>>  ABS of "+t),numerator(),DEBUG_ABS&&console.log("ABS numerator "+stack[tos-1]),absval(),DEBUG_ABS&&console.log("ABSVAL numerator: "+stack[tos-1]),push(t),denominator(),DEBUG_ABS&&console.log("ABS denominator: "+stack[tos-1]),absval(),DEBUG_ABS&&console.log("ABSVAL denominator: "+stack[tos-1]),divide(),DEBUG_ABS&&console.log("ABSVAL divided: "+stack[tos-1]),DEBUG_ABS)return console.log("<<<<<<<  ABS")},absval=function(){var t,e;if(save(),p1=pop(),e=p1,DEBUG_ABS&&console.log("ABS of "+p1),isZeroAtomOrTensor(p1)){DEBUG_ABS&&console.log(" abs: "+p1+" just zero"),push(zero),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(isnegativenumber(p1)){DEBUG_ABS&&console.log(" abs: "+p1+" just a negative"),push(p1),negate(),restore();return}if(ispositivenumber(p1)){DEBUG_ABS&&console.log(" abs: "+p1+" just a positive"),push(p1),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(p1===symbol(PI)){DEBUG_ABS&&console.log(" abs: "+p1+" of PI"),push(p1),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(ADD)&&(findPossibleClockForm(p1)||findPossibleExponentialForm(p1)||Find(p1,imaginaryunit))){DEBUG_ABS&&console.log(" abs: "+p1+" is a sum"),DEBUG_ABS&&console.log("abs of a sum"),push(p1),rect(),p1=pop(),push(p1),real(),push_integer(2),power(),push(p1),imag(),push_integer(2),power(),add(),push_rational(1,2),power(),simplify_trig(),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(POWER)&&equaln(cadr(p1),-1)){DEBUG_ABS&&console.log(" abs: "+p1+" is -1 to any power"),evaluatingAsFloats?(DEBUG_ABS&&console.log(" abs: numeric, so result is 1.0"),push_double(1)):(DEBUG_ABS&&console.log(" abs: symbolic, so result is 1"),push_integer(1)),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(POWER)&&ispositivenumber(caddr(p1))){DEBUG_ABS&&console.log(" abs: "+p1+" is something to the power of a positive number"),push(cadr(p1)),abs(),push(caddr(p1)),power(),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(POWER)&&cadr(p1)===symbol(E)){DEBUG_ABS&&console.log(" abs: "+p1+" is an exponential"),push(caddr(p1)),real(),exponential(),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(MULTIPLY)){for(DEBUG_ABS&&console.log(" abs: "+p1+" is a product"),t=!1,p1=cdr(p1);iscons(p1);)push(car(p1)),absval(),t&&multiply(),t=!0,p1=cdr(p1);DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(car(p1)===symbol(ABS)){DEBUG_ABS&&console.log(" abs: "+p1+" is abs of a abs"),push_symbol(ABS),push(cadr(p1)),list(2),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore();return}if(istensor(p1)){absval_tensor(),restore();return}return(isnegativeterm(p1)||car(p1)===symbol(ADD)&&isnegativeterm(cadr(p1)))&&(push(p1),negate(),p1=pop()),DEBUG_ABS&&console.log(" abs: "+p1+" is nothing decomposable"),push_symbol(ABS),push(p1),list(2),DEBUG_ABS&&console.log(" --> ABS of "+e+" : "+stack[tos-1]),restore()},absval_tensor=function(){return p1.tensor.ndim!==1&&stop("abs(tensor) with tensor rank > 1"),push(p1),push(p1),conjugate(),inner(),push_rational(1,2),power(),simplify(),Eval()},flag=0,Eval_add=function(){var t;for(t=tos,p1=cdr(p1);iscons(p1);)push(car(p1)),Eval(),p2=pop(),push_terms(p2),p1=cdr(p1);return add_terms(tos-t)},stackAddsCount=0,add_terms=function(t){var e,r,i,n,s,a,l,u,p;if(stackAddsCount++,r=0,e=tos-t,DEBUG&&console.log("stack before adding terms #"+stackAddsCount),DEBUG)for(r=s=0,a=tos;0<=a?s<a:s>a;r=0<=a?++s:--s)console.log(print_list(stack[r]));for(r=i=0;i<10&&!(t<2||(flag=0,p=stack.slice(e,e+t),p.sort(cmp_terms),stack=stack.slice(0,e).concat(p).concat(stack.slice(e+t)),flag===0));r=++i)t=combine_terms(e,t);switch(moveTos(e+t),t){case 0:evaluatingAsFloats?push_double(0):push(zero);break;case 1:break;default:list(t),p1=pop(),push_symbol(ADD),push(p1),cons()}if(DEBUG&&console.log("stack after adding terms #"+stackAddsCount),DEBUG){for(u=[],r=n=0,l=tos;0<=l?n<l:n>l;r=0<=l?++n:--n)u.push(console.log(print_list(stack[r])));return u}},cmp_terms=function(t,e){var r,i,n,s;if(r=0,isNumericAtom(t)&&isNumericAtom(e))return flag=1,0;if(istensor(t)&&istensor(e)){if(t.tensor.ndim<e.tensor.ndim)return-1;if(t.tensor.ndim>e.tensor.ndim)return 1;for(r=i=0,n=t.tensor.ndim;0<=n?i<n:i>n;r=0<=n?++i:--i){if(t.tensor.dim[r]<e.tensor.dim[r])return-1;if(t.tensor.dim[r]>e.tensor.dim[r])return 1}return flag=1,0}return car(t)===symbol(MULTIPLY)&&(t=cdr(t),isNumericAtom(car(t))&&(t=cdr(t),cdr(t)===symbol(NIL)&&(t=car(t)))),car(e)===symbol(MULTIPLY)&&(e=cdr(e),isNumericAtom(car(e))&&(e=cdr(e),cdr(e)===symbol(NIL)&&(e=car(e)))),s=cmp_expr(t,e),s===0&&(flag=1),s},combine_terms=function(t,e){var r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S;for(r=0;r<e-1;){if(check_esc_flag(),p3=stack[t+r],p4=stack[t+r+1],istensor(p3)&&istensor(p4)){if(push(p3),push(p4),tensor_plus_tensor(),p1=pop(),p1!==symbol(NIL)){for(stack[t+r]=p1,n=u=p=r+1,f=e-1;p<=f?u<f:u>f;n=p<=f?++u:--u)stack[t+n]=stack[t+n+1];e--,r--}r++;continue}if(istensor(p3)||istensor(p4)){r++;continue}if(isNumericAtom(p3)&&isNumericAtom(p4)){if(push(p3),push(p4),add_numbers(),p1=pop(),isZeroAtomOrTensor(p1)){for(n=i=c=r,h=e-2;c<=h?i<h:i>h;n=c<=h?++i:--i)stack[t+n]=stack[t+n+2];e-=2}else{for(stack[t+r]=p1,n=s=d=r+1,m=e-1;d<=m?s<m:s>m;n=d<=m?++s:--s)stack[t+n]=stack[t+n+1];e--}r--,r++;continue}if(isNumericAtom(p3)||isNumericAtom(p4)){r++;continue}if(evaluatingAsFloats?(p1=one_as_double,p2=one_as_double):(p1=one,p2=one),S=0,car(p3)===symbol(MULTIPLY)&&(p3=cdr(p3),S=1,isNumericAtom(car(p3))&&(p1=car(p3),p3=cdr(p3),cdr(p3)===symbol(NIL)&&(p3=car(p3),S=0))),car(p4)===symbol(MULTIPLY)&&(p4=cdr(p4),isNumericAtom(car(p4))&&(p2=car(p4),p4=cdr(p4),cdr(p4)===symbol(NIL)&&(p4=car(p4)))),!equal(p3,p4)){r++;continue}if(push(p1),push(p2),add_numbers(),p1=pop(),isZeroAtomOrTensor(p1)){for(n=a=_=r,g=e-2;_<=g?a<g:a>g;n=_<=g?++a:--a)stack[t+n]=stack[t+n+2];e-=2,r--,r++;continue}for(push(p1),S?(push(symbol(MULTIPLY)),push(p3),cons()):push(p3),multiply(),stack[t+r]=pop(),n=l=b=r+1,x=e-1;b<=x?l<x:l>x;n=b<=x?++l:--l)stack[t+n]=stack[t+n+1];e--,r--,r++}return e},push_terms=function(t){var e;if(car(t)===symbol(ADD)){for(t=cdr(t),e=[];iscons(t);)push(car(t)),e.push(t=cdr(t));return e}else if(!isZeroAtom(t))return push(t)},add=function(){var t;return save(),p2=pop(),p1=pop(),t=tos,push_terms(p1),push_terms(p2),add_terms(tos-t),restore()},add_all=function(t){var e,r,i,n,s;for(r=0,save(),s=tos-t,e=tos,r=i=0,n=t;0<=n?i<n:i>n;r=0<=n?++i:--i)push_terms(stack[s+r]);return add_terms(tos-e),p1=pop(),moveTos(tos-t),push(p1),restore()},subtract=function(){return negate(),add()},Eval_adj=function(){return push(cadr(p1)),Eval(),adj()},adj=function(){var t,e,r,i,n,s,a;for(t=0,r=0,i=0,save(),p1=pop(),istensor(p1)&&p1.tensor.ndim===2&&p1.tensor.dim[0]===p1.tensor.dim[1]||stop("adj: square matrix expected"),i=p1.tensor.dim[0],p2=alloc_tensor(i*i),p2.tensor.ndim=2,p2.tensor.dim[0]=i,p2.tensor.dim[1]=i,t=n=0,s=i;0<=s?n<s:n>s;t=0<=s?++n:--n)for(r=e=0,a=i;0<=a?e<a:e>a;r=0<=a?++e:--e)cofactor(p1,i,t,r),p2.tensor.elem[i*r+t]=pop();return push(p2),restore()},Eval_approxratio=function(){var t;return t=cadr(p1),push(t),approxratioRecursive()},approxratioRecursive=function(){var t,e,r,i,n;if(t=0,save(),p1=pop(),istensor(p1)){for(p4=alloc_tensor(p1.tensor.nelem),p4.tensor.ndim=p1.tensor.ndim,t=r=0,i=p1.tensor.ndim;0<=i?r<i:r>i;t=0<=i?++r:--r)p4.tensor.dim[t]=p1.tensor.dim[t];for(t=e=0,n=p1.tensor.nelem;0<=n?e<n:e>n;t=0<=n?++e:--e)push(p1.tensor.elem[t]),approxratioRecursive(),p4.tensor.elem[t]=pop(),check_tensor_dimensions(p4);push(p4)}else p1.k===DOUBLE?(push(p1),approxOneRatioOnly()):iscons(p1)?(push(car(p1)),approxratioRecursive(),push(cdr(p1)),approxratioRecursive(),cons()):push(p1);return restore()},approxOneRatioOnly=function(){var t,e,r,i,n,s;if(zzfloat(),i=pop(),i.k===DOUBLE){n=i.d,r=n.toString().split("."),r.length===2?(t=r[1].length,e=1/Math.pow(10,t),s=floatToRatioRoutine(n,e),push_rational(s[0],s[1])):push_integer(n);return}return push_symbol(APPROXRATIO),push(theArgument),list(2)},floatToRatioRoutine=function(t,e){var r,i,n,s,a,l,u;if(n=void 0,i=void 0,r=void 0,l=void 0,s=void 0,a=void 0,u=[0,0],isNaN(t))return u;if(t===1/0)return u[0]=1,u[1]=0,u;if(t===-1/0)return u[0]=-1,u[1]=0,u;if(t<0?r=-1:r=1,t=Math.abs(t),Math.abs(t-Math.floor(t))<e)return n=t*r,i=1,u[0]=n,u[1]=i,u;if(t<1e-19)return n=r,i=1e19,u[0]=n,u[1]=i,u;if(t>1e19)return n=1e19*r,i=1,u[0]=n,u[1]=i,u;for(l=t,s=0,i=1;l=1/(l-Math.floor(l)),a=i,i=i*Math.floor(l)+s,s=a,n=Math.floor(t*i+.5),Math.abs(t-n/i)>e&&l!==Math.floor(l););return n=r*n,u[0]=n,u[1]=i,u},approx_just_an_integer=0,approx_sine_of_rational=1,approx_sine_of_pi_times_rational=2,approx_rationalOfPi=3,approx_radicalOfRatio=4,approx_ratioOfRadical=6,approx_rationalOfE=7,approx_logarithmsOfRationals=8,approx_rationalsOfLogarithms=9,approxRationalsOfRadicals=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b;if(b=t.toString().split("."),b.length===2)c=b[1].length,d=1/Math.pow(10,c);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];for(console.log("precision: "+d),e=null,f=Number.MAX_VALUE,_=[2,3,5,6,7,8,10],h=0,u=_.length;h<u;h++)for(s=_[h],l=a=1;a<=10;l=++a)n=Math.sqrt(s)/l,Math.abs(n)>1e-10?(m=t/n,p=Math.round(m),i=Math.abs(1-m/p)):(m=1,p=1,i=Math.abs(t-n)),i<2*d&&(r=simpleComplexityMeasure(p,s,l),r<f&&(f=r,g=p+" * sqrt( "+s+" ) / "+l,e=[g,approx_ratioOfRadical,p,s,l]));return e},approxRadicalsOfRationals=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S;if(S=t.toString().split("."),S.length===2)h=S[1].length,m=1/Math.pow(10,h);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];for(console.log("precision: "+m),e=null,c=Number.MAX_VALUE,g=[1,2,3,5,6,7,8,10],d=0,u=g.length;d<u;d++)for(s=g[d],b=[1,2,3,5,6,7,8,10],a=0,p=b.length;a<p;a++)l=b[a],n=Math.sqrt(s/l),Math.abs(n)>1e-10?(_=t/n,f=Math.round(_),i=Math.abs(1-_/f)):(_=1,f=1,i=Math.abs(t-n)),i<2*m&&(r=simpleComplexityMeasure(f,s,l),r<c&&(c=r,x=f+" * (sqrt( "+s+" / "+l+" )",e=[x,approx_radicalOfRatio,f,s,l]));return e},approxRadicals=function(t){var e,r,i,n,s;if(s=t.toString().split("."),s.length===2)i=s[1].length,n=1/Math.pow(10,i);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];return console.log("precision: "+n),r=approxRationalsOfRadicals(t),r!=null?r:(e=approxRadicalsOfRationals(t),e!=null?e:null)},approxLogs=function(t){var e,r,i,n,s;if(s=t.toString().split("."),s.length===2)i=s[1].length,n=1/Math.pow(10,i);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];return console.log("precision: "+n),r=approxRationalsOfLogs(t),r!=null?r:(e=approxLogsOfRationals(t),e!=null?e:null)},approxRationalsOfLogs=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_;if(_=t.toString().split("."),_.length===2)f=_[1].length,h=1/Math.pow(10,f);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];for(console.log("precision: "+h),e=null,p=Number.MAX_VALUE,s=c=2;c<=5;s=++c)for(l=a=1;a<=5;l=++a)n=Math.log(s)/l,Math.abs(n)>1e-10?(d=t/n,u=Math.round(d),i=Math.abs(1-d/u)):(d=1,u=1,i=Math.abs(t-n)),!(u!==1&&Math.abs(Math.floor(u/l))===Math.abs(u/l))&&i<2.2*h&&(r=simpleComplexityMeasure(u,s,l),r<p&&(p=r,m=u+" * log( "+s+" ) / "+l,e=[m,approx_rationalsOfLogarithms,u,s,l]));return e},approxLogsOfRationals=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_;if(_=t.toString().split("."),_.length===2)f=_[1].length,h=1/Math.pow(10,f);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];for(console.log("precision: "+h),e=null,p=Number.MAX_VALUE,s=c=1;c<=5;s=++c)for(l=a=1;a<=5;l=++a)n=Math.log(s/l),Math.abs(n)>1e-10?(d=t/n,u=Math.round(d),i=Math.abs(1-d/u)):(d=1,u=1,i=Math.abs(t-n)),i<1.96*h&&(r=simpleComplexityMeasure(u,s,l),r<p&&(p=r,m=u+" * log( "+s+" / "+l+" )",e=[m,approx_logarithmsOfRationals,u,s,l]));return e},approxRationalsOfPowersOfE=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_;if(_=t.toString().split("."),_.length===2)f=_[1].length,h=1/Math.pow(10,f);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];for(console.log("precision: "+h),e=null,p=Number.MAX_VALUE,s=c=1;c<=2;s=++c)for(l=a=1;a<=12;l=++a)n=Math.pow(Math.E,s)/l,Math.abs(n)>1e-10?(d=t/n,u=Math.round(d),i=Math.abs(1-d/u)):(d=1,u=1,i=Math.abs(t-n)),i<2*h&&(r=simpleComplexityMeasure(u,s,l),r<p&&(p=r,m=u+" * (e ^ "+s+" ) / "+l,e=[m,approx_rationalOfE,u,s,l]));return e},approxRationalsOfPowersOfPI=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_;if(_=t.toString().split("."),_.length===2)f=_[1].length,h=1/Math.pow(10,f);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];for(console.log("precision: "+h),e=null,p=Number.MAX_VALUE,s=c=1;c<=5;s=++c)for(l=a=1;a<=12;l=++a)n=Math.pow(Math.PI,s)/l,Math.abs(n)>1e-10?(d=t/n,u=Math.round(d),i=Math.abs(1-d/u)):(d=1,u=1,i=Math.abs(t-n)),i<2*h&&(r=simpleComplexityMeasure(u,s,l),r<p&&(p=r,m=u+" * (pi ^ "+s+" ) / "+l+" )",e=[m,approx_rationalOfPi,u,s,l]));return e},approxTrigonometric=function(t){var e,r,i,n,s;if(s=t.toString().split("."),s.length===2)i=s[1].length,n=1/Math.pow(10,i);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];return console.log("precision: "+n),r=approxSineOfRationals(t),r!=null?r:(e=approxSineOfRationalMultiplesOfPI(t),e!=null?e:null)},approxSineOfRationals=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g;if(g=t.toString().split("."),g.length===2)c=g[1].length,d=1/Math.pow(10,c);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];for(console.log("precision: "+d),e=null,f=Number.MAX_VALUE,a=h=1;h<=4;a=++h)for(u=l=1;l<=4;u=++l)n=a/u,s=Math.sin(n),Math.abs(s)>1e-10?(m=t/s,p=Math.round(m),i=Math.abs(1-m/p)):(m=1,p=1,i=Math.abs(t-s)),i<2*d&&(r=simpleComplexityMeasure(p,a,u),r<f&&(f=r,_=p+" * sin( "+a+"/"+u+" )",e=[_,approx_sine_of_rational,p,a,u]));return e},approxSineOfRationalMultiplesOfPI=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g;if(g=t.toString().split("."),g.length===2)c=g[1].length,d=1/Math.pow(10,c);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];for(console.log("precision: "+d),e=null,f=Number.MAX_VALUE,a=h=1;h<=13;a=++h)for(u=l=1;l<=13;u=++l)n=a/u,s=Math.sin(Math.PI*n),Math.abs(s)>1e-10?(m=t/s,p=Math.round(m),i=Math.abs(1-m/p)):(m=1,p=1,i=Math.abs(t-s)),i<23*d&&(r=simpleComplexityMeasure(p,a,u),r<f&&(f=r,_=p+" * sin( "+a+"/"+u+" * pi )",e=[_,approx_sine_of_pi_times_rational,p,a,u]));return e},approxAll=function(t){var e,r,i,n,s,a,l,u,p,f,c,h;if(h=t.toString().split("."),h.length===2)f=h[1].length,c=1/Math.pow(10,f);else return[""+Math.floor(t),approx_just_an_integer,Math.floor(t),1,2];return console.log("precision: "+c),p=Number.MAX_VALUE,u=0,l=null,e=!0,i=approxRadicals(t),i!=null&&(u=simpleComplexityMeasure(i),u<p?(e&&console.log("better explanation by approxRadicals: "+i+" complexity: "+u),p=u,l=i):e&&console.log("subpar explanation by approxRadicals: "+i+" complexity: "+u)),r=approxLogs(t),r!=null&&(u=simpleComplexityMeasure(r),u<p?(e&&console.log("better explanation by approxLogs: "+r+" complexity: "+u),p=u,l=r):e&&console.log("subpar explanation by approxLogs: "+r+" complexity: "+u)),n=approxRationalsOfPowersOfE(t),n!=null&&(u=simpleComplexityMeasure(n),u<p?(e&&console.log("better explanation by approxRationalsOfPowersOfE: "+n+" complexity: "+u),p=u,l=n):e&&console.log("subpar explanation by approxRationalsOfPowersOfE: "+n+" complexity: "+u)),s=approxRationalsOfPowersOfPI(t),s!=null&&(u=simpleComplexityMeasure(s),u<p?(e&&console.log("better explanation by approxRationalsOfPowersOfPI: "+s+" complexity: "+u),p=u,l=s):e&&console.log("subpar explanation by approxRationalsOfPowersOfPI: "+s+" complexity: "+u)),a=approxTrigonometric(t),a!=null&&(u=simpleComplexityMeasure(a),u<p?(e&&console.log("better explanation by approxTrigonometric: "+a+" complexity: "+u),p=u,l=a):e&&console.log("subpar explanation by approxTrigonometric: "+a+" complexity: "+u)),l},simpleComplexityMeasure=function(t,e,r){var i;if(i=null,t instanceof Array){switch(t[1]){case approx_sine_of_pi_times_rational:i=4;break;case approx_rationalOfPi:i=Math.pow(4,Math.abs(t[3]))*Math.abs(t[2]);break;case approx_rationalOfE:i=Math.pow(3,Math.abs(t[3]))*Math.abs(t[2]);break;default:i=0}i+=Math.abs(t[2])*(Math.abs(t[3])+Math.abs(t[4]))}else i+=Math.abs(t)*(Math.abs(e)+Math.abs(r));return t[2]===1?i-=1:i+=1,t[3]===1?i-=1:i+=1,t[4]===1?i-=1:i+=1,i<0&&(i=0),i},testApprox=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le,ce,se,de,fe,X,he,ne,ge,Ee,be,_e,ye,Te,xe,Se,W,ue,w,F,V;for(ae=[2,3,5,6,7,8,10],B=0,m=ae.length;B<m;B++)for(r=ae[B],oe=[2,3,5,6,7,8,10],i=0,_=oe.length;i<_;i++)a=oe[i],r!==a&&(console.log("testapproxRadicals testing: 1 * sqrt( "+r+" ) / "+a),e=r/a,W=Math.sqrt(r)/a,X=approxRadicals(W),ne=X[2]*Math.sqrt(X[3])/X[4],Math.abs(W-ne)>1e-15&&console.log("fail testapproxRadicals: 1 * sqrt( "+r+" ) / "+a+" . obtained: "+X));for(me=[2,3,5,6,7,8,10],l=0,g=me.length;l<g;l++)for(r=me[l],le=[2,3,5,6,7,8,10],c=0,b=le.length;c<b;c++)a=le[c],r!==a&&(console.log("testapproxRadicals testing with 4 digits: 1 * sqrt( "+r+" ) / "+a),e=r/a,j=Math.sqrt(r)/a,W=j.toFixed(4),X=approxRadicals(W),ne=X[2]*Math.sqrt(X[3])/X[4],Math.abs(j-ne)>1e-15&&console.log("fail testapproxRadicals with 4 digits: 1 * sqrt( "+r+" ) / "+a+" . obtained: "+X));for(ce=[2,3,5,6,7,8,10],O=0,x=ce.length;O<x;O++)for(r=ce[O],se=[2,3,5,6,7,8,10],C=0,S=se.length;C<S;C++)a=se[C],r!==a&&(console.log("testapproxRadicals testing: 1 * sqrt( "+r+" / "+a+" )"),e=r/a,W=Math.sqrt(r/a),X=approxRadicals(W),X!=null&&(ne=X[2]*Math.sqrt(X[3]/X[4]),X[1]===approx_radicalOfRatio&&Math.abs(W-ne)>1e-15&&console.log("fail testapproxRadicals: 1 * sqrt( "+r+" / "+a+" ) . obtained: "+X)));for(de=[1,2,3,5,6,7,8,10],H=0,T=de.length;H<T;H++)for(r=de[H],fe=[1,2,3,5,6,7,8,10],te=0,I=fe.length;te<I;te++)a=fe[te],!(r===1&&a===1)&&(console.log("testapproxRadicals testing with 4 digits:: 1 * sqrt( "+r+" / "+a+" )"),e=r/a,j=Math.sqrt(r/a),W=j.toFixed(4),X=approxRadicals(W),ne=X[2]*Math.sqrt(X[3]/X[4]),X[1]===approx_radicalOfRatio&&Math.abs(j-ne)>1e-15&&console.log("fail testapproxRadicals with 4 digits:: 1 * sqrt( "+r+" / "+a+" ) . obtained: "+X));for(r=Z=1;Z<=5;r=++Z)for(a=ge=1;ge<=5;a=++ge)console.log("testApproxAll testing: 1 * log("+r+" ) / "+a),e=r/a,W=Math.log(r)/a,X=approxAll(W),ne=X[2]*Math.log(X[3])/X[4],Math.abs(W-ne)>1e-15&&console.log("fail testApproxAll: 1 * log("+r+" ) / "+a+" . obtained: "+X);for(r=be=1;be<=5;r=++be)for(a=ye=1;ye<=5;a=++ye)console.log("testApproxAll testing with 4 digits: 1 * log("+r+" ) / "+a),e=r/a,j=Math.log(r)/a,W=j.toFixed(4),X=approxAll(W),ne=X[2]*Math.log(X[3])/X[4],Math.abs(j-ne)>1e-15&&console.log("fail testApproxAll with 4 digits: 1 * log("+r+" ) / "+a+" . obtained: "+X);for(r=xe=1;xe<=5;r=++xe)for(a=ue=1;ue<=5;a=++ue)console.log("testApproxAll testing: 1 * log("+r+" / "+a+" )"),e=r/a,W=Math.log(r/a),X=approxAll(W),ne=X[2]*Math.log(X[3]/X[4]),Math.abs(W-ne)>1e-15&&console.log("fail testApproxAll: 1 * log("+r+" / "+a+" ) . obtained: "+X);for(r=F=1;F<=5;r=++F)for(a=n=1;n<=5;a=++n)console.log("testApproxAll testing with 4 digits: 1 * log("+r+" / "+a+" )"),e=r/a,j=Math.log(r/a),W=j.toFixed(4),X=approxAll(W),ne=X[2]*Math.log(X[3]/X[4]),Math.abs(j-ne)>1e-15&&console.log("fail testApproxAll with 4 digits: 1 * log("+r+" / "+a+" ) . obtained: "+X);for(r=u=1;u<=2;r=++u)for(a=h=1;h<=12;a=++h)console.log("testApproxAll testing: 1 * (e ^ "+r+" ) / "+a),e=r/a,W=Math.pow(Math.E,r)/a,X=approxAll(W),ne=X[2]*Math.pow(Math.E,X[3])/X[4],Math.abs(W-ne)>1e-15&&console.log("fail testApproxAll: 1 * (e ^ "+r+" ) / "+a+" . obtained: "+X);for(r=L=1;L<=2;r=++L)for(a=G=1;G<=12;a=++G)console.log("approxRationalsOfPowersOfE testing with 4 digits: 1 * (e ^ "+r+" ) / "+a),e=r/a,j=Math.pow(Math.E,r)/a,W=j.toFixed(4),X=approxRationalsOfPowersOfE(W),ne=X[2]*Math.pow(Math.E,X[3])/X[4],Math.abs(j-ne)>1e-15&&console.log("fail approxRationalsOfPowersOfE with 4 digits: 1 * (e ^ "+r+" ) / "+a+" . obtained: "+X);for(r=ee=1;ee<=2;r=++ee)for(a=J=1;J<=12;a=++J)console.log("testApproxAll testing: 1 * pi ^ "+r+" / "+a),e=r/a,W=Math.pow(Math.PI,r)/a,X=approxAll(W),ne=X[2]*Math.pow(Math.PI,X[3])/X[4],Math.abs(W-ne)>1e-15&&console.log("fail testApproxAll: 1 * pi ^ "+r+" / "+a+" ) . obtained: "+X);for(r=pe=1;pe<=2;r=++pe)for(a=Ee=1;Ee<=12;a=++Ee)console.log("approxRationalsOfPowersOfPI testing with 4 digits: 1 * pi ^ "+r+" / "+a),e=r/a,j=Math.pow(Math.PI,r)/a,W=j.toFixed(4),X=approxRationalsOfPowersOfPI(W),ne=X[2]*Math.pow(Math.PI,X[3])/X[4],Math.abs(j-ne)>1e-15&&console.log("fail approxRationalsOfPowersOfPI with 4 digits: 1 * pi ^ "+r+" / "+a+" ) . obtained: "+X);for(r=_e=1;_e<=4;r=++_e)for(a=Te=1;Te<=4;a=++Te)console.log("testApproxAll testing: 1 * sin( "+r+"/"+a+" )"),e=r/a,W=Math.sin(e),X=approxAll(W),he=X[3]/X[4],ne=X[2]*Math.sin(he),Math.abs(W-ne)>1e-15&&console.log("fail testApproxAll: 1 * sin( "+r+"/"+a+" ) . obtained: "+X);for(r=Se=1;Se<=4;r=++Se)for(a=w=1;w<=4;a=++w)console.log("testApproxAll testing with 5 digits: 1 * sin( "+r+"/"+a+" )"),e=r/a,j=Math.sin(e),W=j.toFixed(5),X=approxAll(W),X==null&&console.log("fail testApproxAll with 5 digits: 1 * sin( "+r+"/"+a+" ) . obtained:  undefined "),he=X[3]/X[4],ne=X[2]*Math.sin(he),t=Math.abs(j-ne),t>1e-14&&console.log("fail testApproxAll with 5 digits: 1 * sin( "+r+"/"+a+" ) . obtained: "+X+" error: "+t);for(r=V=1;V<=4;r=++V)for(a=s=1;s<=4;a=++s)console.log("testApproxAll testing with 4 digits: 1 * sin( "+r+"/"+a+" )"),e=r/a,j=Math.sin(e),W=j.toFixed(4),X=approxAll(W),X==null&&console.log("fail testApproxAll with 4 digits: 1 * sin( "+r+"/"+a+" ) . obtained:  undefined "),he=X[3]/X[4],ne=X[2]*Math.sin(he),t=Math.abs(j-ne),t>1e-14&&console.log("fail testApproxAll with 4 digits: 1 * sin( "+r+"/"+a+" ) . obtained: "+X+" error: "+t);for(W=0,approxAll(W)[0]!=="0"&&console.log("fail testApproxAll: 0"),W=0,approxAll(W)[0]!=="0"&&console.log("fail testApproxAll: 0.0"),W=0,approxAll(W)[0]!=="0"&&console.log("fail testApproxAll: 0.00"),W=0,approxAll(W)[0]!=="0"&&console.log("fail testApproxAll: 0.000"),W=0,approxAll(W)[0]!=="0"&&console.log("fail testApproxAll: 0.0000"),W=1,approxAll(W)[0]!=="1"&&console.log("fail testApproxAll: 1"),W=1,approxAll(W)[0]!=="1"&&console.log("fail testApproxAll: 1.0"),W=1,approxAll(W)[0]!=="1"&&console.log("fail testApproxAll: 1.00"),W=1,approxAll(W)[0]!=="1"&&console.log("fail testApproxAll: 1.000"),W=1,approxAll(W)[0]!=="1"&&console.log("fail testApproxAll: 1.0000"),W=1,approxAll(W)[0]!=="1"&&console.log("fail testApproxAll: 1.00000"),W=Math.sqrt(2),approxAll(W)[0]!=="1 * sqrt( 2 ) / 1"&&console.log("fail testApproxAll: Math.sqrt(2)"),W=1.41,approxAll(W)[0]!=="1 * sqrt( 2 ) / 1"&&console.log("fail testApproxAll: 1.41"),W=1.4,approxRadicals(W)[0]!=="1 * sqrt( 2 ) / 1"&&console.log("fail approxRadicals: 1.4"),W=.6,approxLogs(W)[0]!=="1 * log( 2 ) / 1"&&console.log("fail approxLogs: 0.6"),W=.69,approxLogs(W)[0]!=="1 * log( 2 ) / 1"&&console.log("fail approxLogs: 0.69"),W=.7,approxLogs(W)[0]!=="1 * log( 2 ) / 1"&&console.log("fail approxLogs: 0.7"),W=1.09,approxLogs(W)[0]!=="1 * log( 3 ) / 1"&&console.log("fail approxLogs: 1.09"),W=1.09,approxAll(W)[0]!=="1 * log( 3 ) / 1"&&console.log("fail approxAll: 1.09"),W=1.098,approxAll(W)[0]!=="1 * log( 3 ) / 1"&&console.log("fail approxAll: 1.098"),W=1.1,approxAll(W)[0]!=="1 * log( 3 ) / 1"&&console.log("fail approxAll: 1.1"),W=1.11,approxAll(W)[0]!=="1 * log( 3 ) / 1"&&console.log("fail approxAll: 1.11"),W=Math.sqrt(3),approxAll(W)[0]!=="1 * sqrt( 3 ) / 1"&&console.log("fail testApproxAll: Math.sqrt(3)"),W=1,approxAll(W)[0]!=="1"&&console.log("fail testApproxAll: 1.0000"),W=3.141592,approxAll(W)[0]!=="1 * (pi ^ 1 ) / 1 )"&&console.log("fail testApproxAll: 3.141592"),W=31.41592,approxAll(W)[0]!=="10 * (pi ^ 1 ) / 1 )"&&console.log("fail testApproxAll: 31.41592"),W=314.1592,approxAll(W)[0]!=="100 * (pi ^ 1 ) / 1 )"&&console.log("fail testApproxAll: 314.1592"),W=3141592653589793e-8,approxAll(W)[0]!=="10000000 * (pi ^ 1 ) / 1 )"&&console.log("fail testApproxAll: 31415926.53589793"),W=Math.sqrt(2),approxTrigonometric(W)[0]!=="2 * sin( 1/4 * pi )"&&console.log("fail approxTrigonometric: Math.sqrt(2)"),W=Math.sqrt(3),approxTrigonometric(W)[0]!=="2 * sin( 1/3 * pi )"&&console.log("fail approxTrigonometric: Math.sqrt(3)"),W=(Math.sqrt(6)-Math.sqrt(2))/4,approxAll(W)[0]!=="1 * sin( 1/12 * pi )"&&console.log("fail testApproxAll: (Math.sqrt(6) - Math.sqrt(2))/4"),W=Math.sqrt(2-Math.sqrt(2))/2,approxAll(W)[0]!=="1 * sin( 1/8 * pi )"&&console.log("fail testApproxAll: Math.sqrt(2 - Math.sqrt(2))/2"),W=(Math.sqrt(6)+Math.sqrt(2))/4,approxAll(W)[0]!=="1 * sin( 5/12 * pi )"&&console.log("fail testApproxAll: (Math.sqrt(6) + Math.sqrt(2))/4"),W=Math.sqrt(2+Math.sqrt(3))/2,approxAll(W)[0]!=="1 * sin( 5/12 * pi )"&&console.log("fail testApproxAll: Math.sqrt(2 + Math.sqrt(3))/2"),W=(Math.sqrt(5)-1)/4,approxAll(W)[0]!=="1 * sin( 1/10 * pi )"&&console.log("fail testApproxAll: (Math.sqrt(5) - 1)/4"),W=Math.sqrt(10-2*Math.sqrt(5))/4,approxAll(W)[0]!=="1 * sin( 1/5 * pi )"&&console.log("fail testApproxAll: Math.sqrt(10 - 2*Math.sqrt(5))/4"),W=Math.sin(Math.PI/7),approxAll(W)[0]!=="1 * sin( 1/7 * pi )"&&console.log("fail testApproxAll: Math.sin(Math.PI/7)"),W=Math.sin(Math.PI/9),approxAll(W)[0]!=="1 * sin( 1/9 * pi )"&&console.log("fail testApproxAll: Math.sin(Math.PI/9)"),W=1836.15267,approxRationalsOfPowersOfPI(W)[0]!=="6 * (pi ^ 5 ) / 1 )"&&console.log("fail approxRationalsOfPowersOfPI: 1836.15267"),r=p=1;p<=13;r=++p)for(a=f=1;f<=13;a=++f)console.log("approxTrigonometric testing: 1 * sin( "+r+"/"+a+" * pi )"),e=r/a,W=Math.sin(Math.PI*e),X=approxTrigonometric(W),he=X[3]/X[4],ne=X[2]*Math.sin(Math.PI*he),Math.abs(W-ne)>1e-15&&console.log("fail approxTrigonometric: 1 * sin( "+r+"/"+a+" * pi ) . obtained: "+X);for(r=d=1;d<=13;r=++d)for(a=P=1;P<=13;a=++P)r===5&&a===11||r===6&&a===11||(console.log("approxTrigonometric testing with 4 digits: 1 * sin( "+r+"/"+a+" * pi )"),e=r/a,j=Math.sin(Math.PI*e),W=j.toFixed(4),X=approxTrigonometric(W),he=X[3]/X[4],ne=X[2]*Math.sin(Math.PI*he),t=Math.abs(j-ne),t>1e-14&&console.log("fail approxTrigonometric with 4 digits: 1 * sin( "+r+"/"+a+" * pi ) . obtained: "+X+" error: "+t));return console.log("testApprox done")},$.approxRadicals=approxRadicals,$.approxRationalsOfLogs=approxRationalsOfLogs,$.approxAll=approxAll,$.testApprox=testApprox,Eval_arccos=function(){return push(cadr(p1)),Eval(),arccos()},arccos=function(){var t,e,r;if(r=0,t=0,save(),p1=pop(),car(p1)===symbol(COS)){push(cadr(p1)),restore();return}if(isdouble(p1)){e=0,t=Math.acos(p1.d),e&&stop("arccos function argument is not in the interval [-1,1]"),push_double(t),restore();return}if(isoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){evaluatingAsFloats?push_double(Math.PI/4):(push_rational(1,4),push_symbol(PI),multiply()),restore();return}if(isminusoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),-1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){evaluatingAsFloats?push_double(Math.PI*3/4):(push_rational(3,4),push_symbol(PI),multiply()),restore();return}if(issqrtthreeovertwo(p1)){evaluatingAsFloats?push_double(Math.PI/6):(push_rational(1,6),push_symbol(PI),multiply()),restore();return}if(isminussqrtthreeovertwo(p1)){evaluatingAsFloats?push_double(5*Math.PI/6):(push_rational(5,6),push_symbol(PI),multiply()),restore();return}if(!isrational(p1)){push_symbol(ARCCOS),push(p1),list(2),restore();return}switch(push(p1),push_integer(2),multiply(),r=pop_integer(),r){case-2:evaluatingAsFloats?push_double(Math.PI):push_symbol(PI);break;case-1:evaluatingAsFloats?push_double(Math.PI*2/3):(push_rational(2,3),push_symbol(PI),multiply());break;case 0:evaluatingAsFloats?push_double(Math.PI/2):(push_rational(1,2),push_symbol(PI),multiply());break;case 1:evaluatingAsFloats?push_double(Math.PI/3):(push_rational(1,3),push_symbol(PI),multiply());break;case 2:evaluatingAsFloats?push_double(0):push(zero);break;default:push_symbol(ARCCOS),push(p1),list(2)}return restore()},Eval_arccosh=function(){return push(cadr(p1)),Eval(),arccosh()},arccosh=function(){var t;if(t=0,save(),p1=pop(),car(p1)===symbol(COSH)){push(cadr(p1)),restore();return}if(isdouble(p1)){t=p1.d,t<1&&stop("arccosh function argument is less than 1.0"),t=Math.log(t+Math.sqrt(t*t-1)),push_double(t),restore();return}if(isplusone(p1)){push(zero),restore();return}return push_symbol(ARCCOSH),push(p1),list(2),restore()},Eval_arcsin=function(){return push(cadr(p1)),Eval(),arcsin()},arcsin=function(){var t,e,r;if(r=0,t=0,save(),p1=pop(),car(p1)===symbol(SIN)){push(cadr(p1)),restore();return}if(isdouble(p1)){e=0,t=Math.asin(p1.d),e&&stop("arcsin function argument is not in the interval [-1,1]"),push_double(t),restore();return}if(isoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){push_rational(1,4),push_symbol(PI),multiply(),restore();return}if(isminusoneoversqrttwo(p1)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),-1,2)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),2)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){evaluatingAsFloats?push_double(-Math.PI/4):(push_rational(-1,4),push_symbol(PI),multiply()),restore();return}if(issqrtthreeovertwo(p1)){evaluatingAsFloats?push_double(Math.PI/3):(push_rational(1,3),push_symbol(PI),multiply()),restore();return}if(isminussqrtthreeovertwo(p1)){evaluatingAsFloats?push_double(-Math.PI/3):(push_rational(-1,3),push_symbol(PI),multiply()),restore();return}if(!isrational(p1)){push_symbol(ARCSIN),push(p1),list(2),restore();return}switch(push(p1),push_integer(2),multiply(),r=pop_integer(),r){case-2:evaluatingAsFloats?push_double(-Math.PI/2):(push_rational(-1,2),push_symbol(PI),multiply());break;case-1:evaluatingAsFloats?push_double(-Math.PI/6):(push_rational(-1,6),push_symbol(PI),multiply());break;case 0:evaluatingAsFloats?push_double(0):push(zero);break;case 1:evaluatingAsFloats?push_double(Math.PI/6):(push_rational(1,6),push_symbol(PI),multiply());break;case 2:evaluatingAsFloats?push_double(Math.PI/2):(push_rational(1,2),push_symbol(PI),multiply());break;default:push_symbol(ARCSIN),push(p1),list(2)}return restore()},Eval_arcsinh=function(){return push(cadr(p1)),Eval(),arcsinh()},arcsinh=function(){var t;if(t=0,save(),p1=pop(),car(p1)===symbol(SINH)){push(cadr(p1)),restore();return}if(isdouble(p1)){t=p1.d,t=Math.log(t+Math.sqrt(t*t+1)),push_double(t),restore();return}if(isZeroAtomOrTensor(p1)){push(zero),restore();return}return push_symbol(ARCSINH),push(p1),list(2),restore()},Eval_arctan=function(){return push(cadr(p1)),Eval(),arctan()},arctan=function(){var t,e;if(t=0,save(),p1=pop(),car(p1)===symbol(TAN)){push(cadr(p1)),restore();return}if(isdouble(p1)){e=0,t=Math.atan(p1.d),e&&stop("arctan function error"),push_double(t),restore();return}if(isZeroAtomOrTensor(p1)){push(zero),restore();return}if(isnegative(p1)){push(p1),negate(),arctan(),negate(),restore();return}if(Find(p1,symbol(SIN))&&Find(p1,symbol(COS))&&(push(p1),numerator(),p2=pop(),push(p1),denominator(),p3=pop(),car(p2)===symbol(SIN)&&car(p3)===symbol(COS)&&equal(cadr(p2),cadr(p3)))){push(cadr(p2)),restore();return}if(car(p1)===symbol(POWER)&&equaln(cadr(p1),3)&&equalq(caddr(p1),-1,2)||car(p1)===symbol(MULTIPLY)&&equalq(car(cdr(p1)),1,3)&&car(car(cdr(cdr(p1))))===symbol(POWER)&&equaln(car(cdr(car(cdr(cdr(p1))))),3)&&equalq(car(cdr(cdr(car(cdr(cdr(p1)))))),1,2)){push_rational(1,6),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),restore();return}if(equaln(p1,1)){push_rational(1,4),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),restore();return}if(car(p1)===symbol(POWER)&&equaln(cadr(p1),3)&&equalq(caddr(p1),1,2)){push_rational(1,3),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),multiply(),restore();return}return push_symbol(ARCTAN),push(p1),list(2),restore()},Eval_arctanh=function(){return push(cadr(p1)),Eval(),arctanh()},arctanh=function(){var t;if(t=0,save(),p1=pop(),car(p1)===symbol(TANH)){push(cadr(p1)),restore();return}if(isdouble(p1)){t=p1.d,(t<-1||t>1)&&stop("arctanh function argument is not in the interval [-1,1]"),t=Math.log((1+t)/(1-t))/2,push_double(t),restore();return}if(isZeroAtomOrTensor(p1)){push(zero),restore();return}return push_symbol(ARCTANH),push(p1),list(2),restore()},DEBUG_ARG=!1,Eval_arg=function(){return push(cadr(p1)),Eval(),arg()},arg=function(){return save(),p1=pop(),push(p1),numerator(),yyarg(),push(p1),denominator(),yyarg(),subtract(),restore()},yyarg=function(){if(save(),p1=pop(),ispositivenumber(p1)||p1===symbol(PI))isdouble(p1)||evaluatingAsFloats?push_double(0):push_integer(0);else if(isnegativenumber(p1))isdouble(p1)||evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),negate();else if(issymbol(p1))push_symbol(ARG),push(p1),list(2);else if(car(p1)===symbol(POWER)&&equaln(cadr(p1),-1))evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),push(caddr(p1)),multiply();else if(car(p1)===symbol(POWER)&&cadr(p1)===symbol(E))push(caddr(p1)),imag();else if(car(p1)===symbol(POWER)&&isoneovertwo(caddr(p1))){if(DEBUG_ARG&&console.log("arg of a sqrt: "+p1),DEBUG_ARG)debugger;push(cadr(p1)),arg(),DEBUG_ARG&&console.log(" = 1/2 * "+stack[tos-1]),push(caddr(p1)),multiply()}else if(car(p1)===symbol(MULTIPLY))for(push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),arg(),add(),p1=cdr(p1);else car(p1)===symbol(ADD)?(push(p1),rect(),p1=pop(),push(p1),real(),p2=pop(),push(p1),imag(),p3=pop(),isZeroAtomOrTensor(p2)?(evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),isnegative(p3)&&negate()):(push(p3),push(p2),divide(),arctan(),isnegative(p2)&&(evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),isnegative(p3)?subtract():add()))):isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))?(push_symbol(ARG),push(p1),list(2)):push_integer(0);return restore()},bake=function(){var t,e,r,i,n,s;if(t=0,e=0,r=0,i=0,n=0,s=0,expanding++,save(),p1=pop(),e=ispolyexpandedform(p1,symbol(SYMBOL_S)),r=ispolyexpandedform(p1,symbol(SYMBOL_T)),i=ispolyexpandedform(p1,symbol(SYMBOL_X)),n=ispolyexpandedform(p1,symbol(SYMBOL_Y)),s=ispolyexpandedform(p1,symbol(SYMBOL_Z)),e===1&&r===0&&i===0&&n===0&&s===0)p2=symbol(SYMBOL_S),bake_poly();else if(e===0&&r===1&&i===0&&n===0&&s===0)p2=symbol(SYMBOL_T),bake_poly();else if(e===0&&r===0&&i===1&&n===0&&s===0)p2=symbol(SYMBOL_X),bake_poly();else if(e===0&&r===0&&i===0&&n===1&&s===0)p2=symbol(SYMBOL_Y),bake_poly();else if(e===0&&r===0&&i===0&&n===0&&s===1)p2=symbol(SYMBOL_Z),bake_poly();else if(iscons(p1)&&car(p1)!==symbol(FOR)){for(t=tos,push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),bake(),p1=cdr(p1);list(tos-t)}else push(p1);return restore(),expanding--},polyform=function(){var t;if(t=0,save(),p2=pop(),p1=pop(),ispolyexpandedform(p1,p2))bake_poly();else if(iscons(p1)){for(t=tos,push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),polyform(),p1=cdr(p1);list(tos-t)}else push(p1);return restore()},bake_poly=function(){var t,e,r,i,n,s;for(e=0,r=0,i=0,n=0,t=tos,i=coeff(p2,p1),e=tos,r=s=i-1;s>=0;r=s+=-1)p1=stack[t+r],bake_poly_term(r);return n=tos-e,n>1&&(list(n),push(symbol(ADD)),swap(),cons()),p1=pop(),moveTos(tos-i),push(p1)},bake_poly_term=function(t){var e,r;if(e=0,r=0,!isZeroAtomOrTensor(p1)){if(t===0){if(car(p1)===symbol(ADD))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else push(p1);return}if(e=tos,car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else equaln(p1,1)||push(p1);if(t===1?push(p2):(push(symbol(POWER)),push(p2),push_integer(t),list(3)),r=tos-e,r>1)return list(r),push(symbol(MULTIPLY)),swap(),cons()}},Eval_besselj=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),besselj()},besselj=function(){return save(),yybesselj(),restore()},yybesselj=function(){var t,e;if(t=0,e=0,p2=pop(),p1=pop(),push(p2),e=pop_integer(),isdouble(p1)&&!isNaN(e)){t=jn(e,p1.d),push_double(t);return}if(isZeroAtomOrTensor(p1)&&isZeroAtomOrTensor(p2)){push_integer(1);return}if(isZeroAtomOrTensor(p1)&&!isNaN(e)){push_integer(0);return}if(p2.k===NUM&&MEQUAL(p2.q.b,2)){if(MEQUAL(p2.q.a,1)){evaluatingAsFloats?push_double(2/Math.PI):(push_integer(2),push_symbol(PI),divide()),push(p1),divide(),push_rational(1,2),power(),push(p1),sine(),multiply();return}if(MEQUAL(p2.q.a,-1)){evaluatingAsFloats?push_double(2/Math.PI):(push_integer(2),push_symbol(PI),divide()),push(p1),divide(),push_rational(1,2),power(),push(p1),cosine(),multiply();return}push_integer(MSIGN(p2.q.a)),p3=pop(),push_integer(2),push(p1),divide(),push(p2),push(p3),subtract(),multiply(),push(p1),push(p2),push(p3),subtract(),besselj(),multiply(),push(p1),push(p2),push_integer(2),push(p3),multiply(),subtract(),besselj(),subtract();return}if(isnegativeterm(p1)){push(p1),negate(),push(p2),power(),push(p1),push(p2),negate(),power(),multiply(),push_symbol(BESSELJ),push(p1),negate(),push(p2),list(3),multiply();return}if(isnegativeterm(p2)){push_integer(-1),push(p2),power(),push_symbol(BESSELJ),push(p1),push(p2),negate(),list(3),multiply();return}return push(symbol(BESSELJ)),push(p1),push(p2),list(3)},Eval_bessely=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),bessely()},bessely=function(){return save(),yybessely(),restore()},yybessely=function(){var t,e;if(t=0,e=0,p2=pop(),p1=pop(),push(p2),e=pop_integer(),isdouble(p1)&&!isNaN(e)){t=yn(e,p1.d),push_double(t);return}if(isnegativeterm(p2)){push_integer(-1),push(p2),power(),push_symbol(BESSELY),push(p1),push(p2),negate(),list(3),multiply();return}push_symbol(BESSELY),push(p1),push(p2),list(3)},mint=function(t){return bigInt(t)},isSmall=function(t){return t.geq(Number.MIN_SAFE_INTEGER)&&t.leq(Number.MAX_SAFE_INTEGER)},setSignTo=function(t,e){if(t.isPositive()){if(e<0)return t.multiply(bigInt(-1))}else if(e>0)return t.multiply(bigInt(-1));return t},makeSignSameAs=function(t,e){if(t.isPositive()){if(e.isNegative())return t.multiply(bigInt(-1))}else if(e.isPositive())return t.multiply(bigInt(-1));return t},makePositive=function(t){return t.isNegative()?t.multiply(bigInt(-1)):t},add_numbers=function(){var t,e,r;if(t=1,e=1,isrational(stack[tos-1])&&isrational(stack[tos-2])){qadd();return}return save(),p2=pop(),p1=pop(),isdouble(p1)?t=p1.d:t=convert_rational_to_double(p1),isdouble(p2)?e=p2.d:e=convert_rational_to_double(p2),r=t+e,push_double(r),restore()},multiply_numbers=function(){var t,e;if(t=0,e=0,isrational(stack[tos-1])&&isrational(stack[tos-2])){qmul();return}return save(),p2=pop(),p1=pop(),isdouble(p1)?t=p1.d:t=convert_rational_to_double(p1),isdouble(p2)?e=p2.d:e=convert_rational_to_double(p2),push_double(t*e),restore()},divide_numbers=function(){var t,e;if(t=0,e=0,isrational(stack[tos-1])&&isrational(stack[tos-2])){qdiv();return}return save(),p2=pop(),p1=pop(),isZeroAtomOrTensor(p2)&&stop("divide by zero"),isdouble(p1)?t=p1.d:t=convert_rational_to_double(p1),isdouble(p2)?e=p2.d:e=convert_rational_to_double(p2),push_double(t/e),restore()},invert_number=function(){var t,e;if(save(),p1=pop(),isZeroAtomOrTensor(p1)&&stop("divide by zero"),isdouble(p1)){push_double(1/p1.d),restore();return}return t=bigInt(p1.q.a),e=bigInt(p1.q.b),e=makeSignSameAs(e,t),t=setSignTo(t,1),p1=new U,p1.k=NUM,p1.q.a=e,p1.q.b=t,push(p1),restore()},compare_rationals=function(t,e){var r,i,n;return n=0,r=mmul(t.q.a,e.q.b),i=mmul(t.q.b,e.q.a),n=mcmp(r,i),n},compare_numbers=function(t,e){var r,i;return r=0,i=0,isrational(t)&&isrational(e)?compare_rationals(t,e):(isdouble(t)?r=t.d:r=convert_rational_to_double(t),isdouble(e)?i=e.d:i=convert_rational_to_double(e),r<i?-1:r>i?1:0)},negate_number=function(){if(save(),p1=pop(),isZeroAtomOrTensor(p1)){push(p1),restore();return}switch(p1.k){case NUM:p2=new U,p2.k=NUM,p2.q.a=bigInt(p1.q.a.multiply(bigInt.minusOne)),p2.q.b=bigInt(p1.q.b),push(p2);break;case DOUBLE:push_double(-p1.d);break;default:stop("bug caught in mp_negate_number")}return restore()},bignum_truncate=function(){var t;return save(),p1=pop(),t=mdiv(p1.q.a,p1.q.b),p1=new U,p1.k=NUM,p1.q.a=t,p1.q.b=bigInt(1),push(p1),restore()},mp_numerator=function(){if(save(),p1=pop(),p1.k!==NUM){push(one),restore();return}return p2=new U,p2.k=NUM,p2.q.a=bigInt(p1.q.a),p2.q.b=bigInt(1),push(p2),restore()},mp_denominator=function(){if(save(),p1=pop(),p1.k!==NUM){push(one),restore();return}return p2=new U,p2.k=NUM,p2.q.a=bigInt(p1.q.b),p2.q.b=bigInt(1),push(p2),restore()},bignum_power_number=function(t){var e,r,i;return save(),p1=pop(),e=mpow(p1.q.a,Math.abs(t)),r=mpow(p1.q.b,Math.abs(t)),t<0&&(i=e,e=r,r=i,e=makeSignSameAs(e,r),r=setSignTo(r,1)),p1=new U,p1.k=NUM,p1.q.a=e,p1.q.b=r,push(p1),restore()},convert_rational_to_double=function(t){var e,r;if(t.q==null)debugger;return e=t.q.a.divmod(t.q.b),r=e.quotient+e.remainder/t.q.b.toJSNumber(),r},new_integer=function(t){var e;return e=new U,e.k=NUM,e.q.a=bigInt(t),e.q.b=bigInt(1),e},push_integer=function(t){return DEBUG&&console.log("pushing integer "+t),push(new_integer(t))},push_double=function(t){return save(),p1=new U,p1.k=DOUBLE,p1.d=t,push(p1),restore()},push_rational=function(t,e){var r;return r=new U,r.k=NUM,r.q.a=bigInt(t),r.q.b=bigInt(e),push(r)},pop_integer=function(){var t;switch(t=NaN,save(),p1=pop(),p1.k){case NUM:isinteger(p1)&&isSmall(p1.q.a)&&(t=p1.q.a.toJSNumber());break;case DOUBLE:DEBUG&&console.log("popping integer but double is found"),Math.floor(p1.d)===p1.d&&(DEBUG&&console.log("...altough it's an integer"),t=p1.d)}return restore(),t},bignum_scan_integer=function(t){var e,r,i;return save(),r=0,i=t[r],(i==="+"||i==="-")&&r++,e=bigInt(t.substring(r)),p1=new U,p1.k=NUM,p1.q.a=e,p1.q.b=bigInt(1),push(p1),i==="-"&&negate(),restore()},bignum_scan_float=function(t){return push_double(parseFloat(t))},print_number=function(t,e){var r,i,n;switch(i="",n="",t.k){case NUM:r=t.q.a.toString(),e||r[0]==="-"&&(r=r.substring(1)),printMode===PRINTMODE_LATEX&&isfraction(t)&&(r="\\frac{"+r+"}{"),i+=r,isfraction(t)&&(printMode!==PRINTMODE_LATEX&&(i+="/"),n=t.q.b.toString(),printMode===PRINTMODE_LATEX&&(n+="}"),i+=n);break;case DOUBLE:r=doubleToReasonableString(t.d),e||r[0]==="-"&&(r=r.substring(1)),i+=r}return i},gcd_numbers=function(){return save(),p2=pop(),p1=pop(),p3=new U,p3.k=NUM,p3.q.a=mgcd(p1.q.a,p2.q.a),p3.q.b=mgcd(p1.q.b,p2.q.b),p3.q.a=setSignTo(p3.q.a,1),push(p3),restore()},pop_double=function(){var t;switch(t=0,save(),p1=pop(),p1.k){case NUM:t=convert_rational_to_double(p1);break;case DOUBLE:t=p1.d;break;default:t=0}return restore(),t},bignum_float=function(){var t;return t=0,t=convert_rational_to_double(pop()),push_double(t)},bignum_factorial=function(t){return save(),p1=new U,p1.k=NUM,p1.q.a=__factorial(t),p1.q.b=bigInt(1),push(p1),restore()},__factorial=function(t){var e,r,i,n,s,a;if(i=0,t===0||t===1)return e=bigInt(1),e;if(e=bigInt(2),r=bigInt(0),3<=t)for(i=n=3,s=t;3<=s?n<=s:n>=s;i=3<=s?++n:--n)r=bigInt(i),a=mmul(e,r),e=a;return e},Eval_binomial=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),binomial()},binomial=function(){return save(),ybinomial(),restore()},ybinomial=function(){if(p2=pop(),p1=pop(),BINOM_check_args()===0){push(zero);return}return push(p1),factorial(),push(p2),factorial(),divide(),push(p1),push(p2),subtract(),factorial(),divide()},BINOM_check_args=function(){return isNumericAtom(p1)&&lessp(p1,zero)||isNumericAtom(p2)&&lessp(p2,zero)||isNumericAtom(p1)&&isNumericAtom(p2)&&lessp(p1,p2)?0:1},Eval_ceiling=function(){return push(cadr(p1)),Eval(),ceiling()},ceiling=function(){return save(),yyceiling(),restore()},yyceiling=function(){var t;if(t=0,p1=pop(),!isNumericAtom(p1)){push_symbol(CEILING),push(p1),list(2);return}if(isdouble(p1)){t=Math.ceil(p1.d),push_double(t);return}if(isinteger(p1)){push(p1);return}return p3=new U,p3.k=NUM,p3.q.a=mdiv(p1.q.a,p1.q.b),p3.q.b=mint(1),push(p3),isnegativenumber(p1)?1:(push_integer(1),add())},Eval_choose=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),choose()},choose=function(){if(save(),p2=pop(),p1=pop(),choose_check_args()===0){push_integer(0),restore();return}return push(p1),factorial(),push(p2),factorial(),divide(),push(p1),push(p2),subtract(),factorial(),divide(),restore()},choose_check_args=function(){return isNumericAtom(p1)&&lessp(p1,zero)||isNumericAtom(p2)&&lessp(p2,zero)||isNumericAtom(p1)&&isNumericAtom(p2)&&lessp(p1,p2)?0:1},Eval_circexp=function(){return push(cadr(p1)),Eval(),circexp(),Eval()},circexp=function(){var t,e,r,i;if(e=0,t=0,save(),p1=pop(),car(p1)===symbol(COS)){push(cadr(p1)),expcos(),restore();return}if(car(p1)===symbol(SIN)){push(cadr(p1)),expsin(),restore();return}if(car(p1)===symbol(TAN)){p1=cadr(p1),push(imaginaryunit),push(p1),multiply(),exponential(),p2=pop(),push(imaginaryunit),push(p1),multiply(),negate(),exponential(),p3=pop(),push(p3),push(p2),subtract(),push(imaginaryunit),multiply(),push(p2),push(p3),add(),divide(),restore();return}if(car(p1)===symbol(COSH)){p1=cadr(p1),push(p1),exponential(),push(p1),negate(),exponential(),add(),push_rational(1,2),multiply(),restore();return}if(car(p1)===symbol(SINH)){p1=cadr(p1),push(p1),exponential(),push(p1),negate(),exponential(),subtract(),push_rational(1,2),multiply(),restore();return}if(car(p1)===symbol(TANH)){p1=cadr(p1),push(p1),push_integer(2),multiply(),exponential(),p1=pop(),push(p1),push_integer(1),subtract(),push(p1),push_integer(1),add(),divide(),restore();return}if(iscons(p1)){for(t=tos;iscons(p1);)push(car(p1)),circexp(),p1=cdr(p1);list(tos-t),restore();return}if(p1.k===TENSOR){for(push(p1),copy_tensor(),p1=pop(),e=r=0,i=p1.tensor.nelem;0<=i?r<i:r>i;e=0<=i?++r:--r)push(p1.tensor.elem[e]),circexp(),p1.tensor.elem[e]=pop();push(p1),restore();return}return push(p1),restore()},Eval_clearall=function(){return do_clearall(),push(symbol(NIL))},do_clearall=function(){return test_flag===0&&clear_term(),do_clearPatterns(),clear_symbols(),defn(),codeGen=!1},clearRenamedVariablesToAvoidBindingToExternalScope=function(){var t,e,r,i;for(i=[],t=e=0,r=symtab.length;0<=r?e<r:e>r;t=0<=r?++e:--e)symtab[t].printname.indexOf("AVOID_BINDING_TO_EXTERNAL_SCOPE_VALUE")!==-1?(symtab[t].k=SYM,symtab[t].printname="",binding[t]=symtab[t],i.push(isSymbolReclaimable[t]=!0)):i.push(void 0);return i},Eval_clear=function(){var t,e;for(p2=cdr(p1);iscons(p2);)e=car(p2),e.k!==SYM&&stop("symbol error"),t=symtab.indexOf(e),symtab[t].k=SYM,symtab[t].printname="",binding[t]=symtab[t],isSymbolReclaimable[t]=!0,p2=cdr(p2);return push(symbol(NIL))},DEBUG_CLOCKFORM=!1,Eval_clock=function(){return push(cadr(p1)),Eval(),clockform()},clockform=function(){return save(),p1=pop(),push(p1),abs(),DEBUG_CLOCKFORM&&console.log("clockform: abs of "+p1+" : "+stack[tos-1]),push_symbol(POWER),push_integer(-1),push(p1),arg(),DEBUG_CLOCKFORM&&console.log("clockform: arg of "+p1+" : "+stack[tos-1]),evaluatingAsFloats?push_double(Math.PI):push(symbol(PI)),divide(),DEBUG_CLOCKFORM&&console.log("clockform: divide : "+stack[tos-1]),list(3),DEBUG_CLOCKFORM&&console.log("clockform: power : "+stack[tos-1]),multiply(),DEBUG_CLOCKFORM&&console.log("clockform: multiply : "+stack[tos-1]),restore()},Eval_coeff=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),p3=pop(),p2=pop(),p1=pop(),p3===symbol(NIL)&&(p3=p2,p2=symbol(SYMBOL_X)),push(p1),push(p2),push(p3),power(),divide(),push(p2),filter()},coeff=function(t,e){var r,i,n,s;for(DEBUG&&console.log("coeff: "+t+" "+e),r=0;;){if(push(e),push(t),push(zero),subst(),Eval(),i=pop(),push(i),r++,push(e),push(i),subtract(),n=pop(),equal(n,zero))return DEBUG&&console.log("coeff: result: "+r),r;push(n),push(t),s=expanding,expanding=1,divide(),expanding=s,e=pop()}},Eval_cofactor=function(){var t,e,r;return t=0,e=0,r=0,push(cadr(p1)),Eval(),p2=pop(),istensor(p2)&&p2.tensor.ndim===2&&p2.tensor.dim[0]===p2.tensor.dim[1]||stop("cofactor: 1st arg: square matrix expected"),r=p2.tensor.dim[0],push(caddr(p1)),Eval(),t=pop_integer(),(t<1||t>r)&&stop("cofactor: 2nd arg: row index expected"),push(cadddr(p1)),Eval(),e=pop_integer(),(e<1||e>r)&&stop("cofactor: 3rd arg: column index expected"),cofactor(p2,r,t-1,e-1)},cofactor=function(t,e,r,i){var n,s,a,l,u,p;for(n=0,a=0,n=l=0,u=e;0<=u?l<u:l>u;n=0<=u?++l:--l)for(a=s=0,p=e;0<=p?s<p:s>p;a=0<=p?++s:--s)n!==r&&a!==i&&push(t.tensor.elem[e*n+a]);if(determinant(e-1),(r+i)%2)return negate()},Eval_condense=function(){return push(cadr(p1)),Eval(),Condense()},Condense=function(){var t;return t=expanding,expanding=0,save(),yycondense(),restore(),expanding=t},yycondense=function(){if(p1=pop(),car(p1)!==symbol(ADD)){push(p1);return}for(p3=cdr(p1),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),DEBUG&&console.log("calculating gcd between: "+stack[tos-1]+" and "+stack[tos-2]),gcd(),DEBUG&&console.log("partial gcd: "+stack[tos-1]),p3=cdr(p3);for(DEBUG&&console.log("condense: this is the gcd of all the terms: "+stack[tos-1]),inverse(),p2=pop(),push(zero),p3=cdr(p1);iscons(p3);)push(p2),push(car(p3)),multiply_noexpand(),add(),p3=cdr(p3);return yyexpand(),push(p2),divide()},Eval_conj=function(){return push(cadr(p1)),Eval(),p1=pop(),push(p1),Find(p1,imaginaryunit)?conjugate():(polar(),conjugate(),clockform())},conjugate=function(){return push(imaginaryunit),push(imaginaryunit),negate(),subst(),Eval()},consCount=0,cons=function(){var t;if(consCount++,DEBUG&&console.log("cons tos: "+tos+" # "+consCount),t=new U,t.k=CONS,t.cons.cdr=pop(),t===t.cons.cdr){debugger;console.log("something wrong p == its cdr")}return t.cons.car=pop(),push(t)},Eval_contract=function(){return push(cadr(p1)),Eval(),cddr(p1)===symbol(NIL)?(push_integer(1),push_integer(2)):(push(caddr(p1)),Eval(),push(cadddr(p1)),Eval()),contract()},contract=function(){return save(),yycontract(),restore()},yycontract=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G;if(n=0,s=0,l=0,p=0,f=0,h=0,m=0,g=0,b=0,e=[],r=[],p3=pop(),p2=pop(),p1=pop(),!istensor(p1)){isZeroAtomOrTensor(p1)||stop("contract: tensor expected, 1st arg is not a tensor"),push(zero);return}for(push(p2),f=pop_integer(),push(p3),h=pop_integer(),g=p1.tensor.ndim,(f<1||f>g||h<1||h>g||f===h||p1.tensor.dim[f-1]!==p1.tensor.dim[h-1])&&stop("contract: index out of range"),f--,h--,m=p1.tensor.dim[f],b=1,s=x=0,T=g;0<=T?x<T:x>T;s=0<=T?++x:--x)s!==f&&s!==h&&(b*=p1.tensor.dim[s]);for(p2=alloc_tensor(b),p2.tensor.ndim=g-2,l=0,s=a=0,I=g;0<=I?a<I:a>I;s=0<=I?++a:--a)s!==f&&s!==h&&(p2.tensor.dim[l++]=p1.tensor.dim[s]);for(t=p1.tensor.elem,i=p2.tensor.elem,s=u=0,O=g;0<=O?u<O:u>O;s=0<=O?++u:--u)e[s]=0,r[s]=p1.tensor.dim[s];for(s=c=0,L=b;0<=L?c<L:c>L;s=0<=L?++c:--c){for(push(zero),l=d=0,P=m;0<=P?d<P:d>P;l=0<=P?++d:--d){for(e[f]=l,e[h]=l,n=0,p=_=0,C=g;0<=C?_<C:_>C;p=0<=C?++_:--_)n=n*r[p]+e[p];push(t[n]),add()}for(i[s]=pop(),l=S=G=g-1;G<=0?S<=0:S>=0;l=G<=0?++S:--S)if(!(l===f||l===h)){if(++e[l]<r[l])break;e[l]=0}}return push(b===1?i[0]:p2)},Eval_cos=function(){return push(cadr(p1)),Eval(),cosine()},cosine=function(){return save(),p1=pop(),car(p1)===symbol(ADD)?cosine_of_angle_sum():cosine_of_angle(),restore()},cosine_of_angle_sum=function(){for(p2=cdr(p1);iscons(p2);){if(p4=car(p2),isnpi(p4)){push(p1),push(p4),subtract(),p3=pop(),push(p3),cosine(),push(p4),cosine(),multiply(),push(p3),sine(),push(p4),sine(),multiply(),subtract();return}p2=cdr(p2)}return cosine_of_angle()},cosine_of_angle=function(){var t,e;if(car(p1)===symbol(ARCCOS)){push(cadr(p1));return}if(isdouble(p1)){t=Math.cos(p1.d),Math.abs(t)<1e-10&&(t=0),push_double(t);return}if(isnegative(p1)&&(push(p1),negate(),p1=pop()),car(p1)===symbol(ARCTAN)){push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),push_rational(-1,2),power();return}if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),e=pop_integer(),e<0||isNaN(e)){push(symbol(COS)),push(p1),list(2);return}switch(e%360){case 90:case 270:return push_integer(0);case 60:case 300:return push_rational(1,2);case 120:case 240:return push_rational(-1,2);case 45:case 315:return push_rational(1,2),push_integer(2),push_rational(1,2),power(),multiply();case 135:case 225:return push_rational(-1,2),push_integer(2),push_rational(1,2),power(),multiply();case 30:case 330:return push_rational(1,2),push_integer(3),push_rational(1,2),power(),multiply();case 150:case 210:return push_rational(-1,2),push_integer(3),push_rational(1,2),power(),multiply();case 0:return push_integer(1);case 180:return push_integer(-1);default:return push(symbol(COS)),push(p1),list(2)}},Eval_cosh=function(){return push(cadr(p1)),Eval(),ycosh()},ycosh=function(){return save(),yycosh(),restore()},yycosh=function(){var t;if(t=0,p1=pop(),car(p1)===symbol(ARCCOSH)){push(cadr(p1));return}if(isdouble(p1)){t=Math.cosh(p1.d),Math.abs(t)<1e-10&&(t=0),push_double(t);return}if(isZeroAtomOrTensor(p1)){push(one);return}return push_symbol(COSH),push(p1),list(2)},Eval_decomp=function(){var t;return save(),console.log("Eval_decomp is being called!!!!!!!!!!!!!!!!!!!!"),t=tos,push(symbol(NIL)),push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),p1=pop(),p1===symbol(NIL)?guess():push(p1),decomp(!1),list(tos-t),restore()},pushTryNotToDuplicate=function(t){if(tos>0&&(DEBUG&&console.log("comparing "+t+" to: "+stack[tos-1]),equal(t,stack[tos-1]))){DEBUG&&console.log("skipping "+t+" because it's already on stack ");return}return push(t)},decomp=function(t){if(save(),p2=pop(),p1=pop(),DEBUG&&console.log("DECOMPOSING "+p1),t){if(!iscons(p1)){DEBUG&&console.log(" ground thing: "+p1),pushTryNotToDuplicate(p1),restore();return}}else if(Find(p1,p2)===0){DEBUG&&console.log(" entire expression is constant"),pushTryNotToDuplicate(p1),restore();return}if(isadd(p1)){decomp_sum(t),restore();return}if(ismultiply(p1)){decomp_product(t),restore();return}for(DEBUG&&console.log(" naive decomp"),p3=cdr(p1),DEBUG&&console.log("startig p3: "+p3);iscons(p3);)t&&push(car(p3)),DEBUG&&console.log("recursive decomposition"),push(car(p3)),DEBUG&&console.log("car(p3): "+car(p3)),push(p2),DEBUG&&console.log("p2: "+p2),decomp(t),p3=cdr(p3);return restore()},decomp_sum=function(t){var e;for(DEBUG&&console.log(" decomposing the sum "),e=0,p3=cdr(p1);iscons(p3);)(Find(car(p3),p2)||t)&&(push(car(p3)),push(p2),decomp(t)),p3=cdr(p3);for(e=tos,p3=cdr(p1);iscons(p3);)Find(car(p3),p2)===0&&pushTryNotToDuplicate(car(p3)),p3=cdr(p3);if(tos-e)return add_all(tos-e),p3=pop(),pushTryNotToDuplicate(p3),push(p3),negate()},decomp_product=function(t){var e;for(DEBUG&&console.log(" decomposing the product "),e=0,p3=cdr(p1);iscons(p3);)(Find(car(p3),p2)||t)&&(push(car(p3)),push(p2),decomp(t)),p3=cdr(p3);for(e=tos,p3=cdr(p1);iscons(p3);)Find(car(p3),p2)===0&&pushTryNotToDuplicate(car(p3)),p3=cdr(p3);if(tos-e)return multiply_all(tos-e)},define_user_function=function(){return p3=caadr(p1),p4=cdadr(p1),p5=caddr(p1),issymbol(p3)||stop("function name?"),car(p5)===symbol(EVAL)&&(push(cadr(p5)),Eval(),p5=pop()),push_symbol(FUNCTION),push(p5),push(p4),list(3),p5=pop(),set_binding(p3,p5),push_symbol(NIL)},Eval_function_reference=function(){return push(p1)},Eval_defint=function(){for(push(cadr(p1)),Eval(),p2=pop(),p1=cddr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1),Eval(),p3=pop(),push(car(p1)),p1=cdr(p1),Eval(),p4=pop(),push(car(p1)),p1=cdr(p1),Eval(),p5=pop(),push(p2),push(p3),integral(),p2=pop(),push(p2),push(p3),push(p5),subst(),Eval(),push(p2),push(p3),push(p4),subst(),Eval(),subtract(),p2=pop();return push(p2)},Eval_degree=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),p1=pop(),p1===symbol(NIL)?guess():push(p1),degree()},degree=function(){return save(),p2=pop(),p1=pop(),p3=zero,yydegree(p1),push(p3),restore()},yydegree=function(t){var e;if(equal(t,p2)){if(isZeroAtomOrTensor(p3))return p3=one}else if(car(t)===symbol(POWER)){if(equal(cadr(t),p2)&&isNumericAtom(caddr(t))&&lessp(p3,caddr(t)))return p3=caddr(t)}else if(iscons(t)){for(t=cdr(t),e=[];iscons(t);)yydegree(car(t)),e.push(t=cdr(t));return e}},Eval_denominator=function(){return push(cadr(p1)),Eval(),denominator()},denominator=function(){var t,e;if(t=0,e=pop(),car(e)===symbol(ADD)&&(push(e),rationalize(),e=pop()),car(e)===symbol(MULTIPLY)&&!isplusone(car(cdr(e)))){for(t=tos,e=cdr(e);iscons(e);)push(car(e)),denominator(),e=cdr(e);return multiply_all(tos-t)}else return isrational(e)?(push(e),mp_denominator()):car(e)===symbol(POWER)&&isnegativeterm(caddr(e))?(push(e),reciprocate()):push(one)},Eval_derivative=function(){var t,e,r,i,n;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),p2=pop(),p2===symbol(NIL)?(guess(),push(symbol(NIL))):isNumericAtom(p2)?(guess(),push(p2)):(push(p2),p1=cdr(p1),push(car(p1)),Eval()),p5=pop(),p4=pop(),p3=pop();;){if(isNumericAtom(p5)?(push(p5),e=pop_integer(),isNaN(e)&&stop("nth derivative: check n")):e=1,push(p3),e>=0)for(r=0,i=e;0<=i?r<i:r>i;0<=i?++r:--r)push(p4),derivative();else for(e=-e,t=0,n=e;0<=n?t<n:t>n;0<=n?++t:--t)push(p4),integral();if(p3=pop(),p5===symbol(NIL))break;if(isNumericAtom(p5)){if(p1=cdr(p1),push(car(p1)),Eval(),p5=pop(),p5===symbol(NIL))break;isNumericAtom(p5)||(p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop())}else p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop()}return push(p3)},derivative=function(){return save(),p2=pop(),p1=pop(),isNumericAtom(p2)&&stop("undefined function"),istensor(p1)?istensor(p2)?d_tensor_tensor():d_tensor_scalar():istensor(p2)?d_scalar_tensor():d_scalar_scalar(),restore()},d_scalar_scalar=function(){return issymbol(p2)?d_scalar_scalar_1():(push(p1),push(p2),push(symbol(SECRETX)),subst(),push(symbol(SECRETX)),derivative(),push(symbol(SECRETX)),push(p2),subst())},d_scalar_scalar_1=function(){if(equal(p1,p2)){push(one);return}if(!iscons(p1)){push(zero);return}if(isadd(p1)){dsum();return}if(car(p1)===symbol(MULTIPLY)){dproduct();return}if(car(p1)===symbol(POWER)){dpower();return}if(car(p1)===symbol(DERIVATIVE)){dd();return}if(car(p1)===symbol(LOG)){dlog();return}if(car(p1)===symbol(SIN)){dsin();return}if(car(p1)===symbol(COS)){dcos();return}if(car(p1)===symbol(TAN)){dtan();return}if(car(p1)===symbol(ARCSIN)){darcsin();return}if(car(p1)===symbol(ARCCOS)){darccos();return}if(car(p1)===symbol(ARCTAN)){darctan();return}if(car(p1)===symbol(SINH)){dsinh();return}if(car(p1)===symbol(COSH)){dcosh();return}if(car(p1)===symbol(TANH)){dtanh();return}if(car(p1)===symbol(ARCSINH)){darcsinh();return}if(car(p1)===symbol(ARCCOSH)){darccosh();return}if(car(p1)===symbol(ARCTANH)){darctanh();return}if(car(p1)===symbol(ABS)){dabs();return}if(car(p1)===symbol(SGN)){dsgn();return}if(car(p1)===symbol(HERMITE)){dhermite();return}if(car(p1)===symbol(ERF)){derf();return}if(car(p1)===symbol(ERFC)){derfc();return}if(car(p1)===symbol(BESSELJ)){isZeroAtomOrTensor(caddr(p1))?dbesselj0():dbesseljn();return}if(car(p1)===symbol(BESSELY)){isZeroAtomOrTensor(caddr(p1))?dbessely0():dbesselyn();return}if(car(p1)===symbol(INTEGRAL)&&caddr(p1)===p2){derivative_of_integral();return}return dfunction()},dsum=function(){var t;for(t=tos,p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),derivative(),p1=cdr(p1);return add_all(tos-t)},dproduct=function(){var t,e,r,i,n,s,a;for(t=0,r=0,i=0,i=length(p1)-1,t=n=0,s=i;0<=s?n<s:n>s;t=0<=s?++n:--n){for(p3=cdr(p1),r=e=0,a=i;0<=a?e<a:e>a;r=0<=a?++e:--e)push(car(p3)),t===r&&(push(p2),derivative()),p3=cdr(p3);multiply_all(i)}return add_all(i)},dpower=function(){return push(caddr(p1)),push(cadr(p1)),divide(),push(cadr(p1)),push(p2),derivative(),multiply(),push(cadr(p1)),logarithm(),push(caddr(p1)),push(p2),derivative(),multiply(),add(),push(p1),multiply()},dlog=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),divide()},dd=function(){return push(cadr(p1)),push(p2),derivative(),p3=pop(),car(p3)===symbol(DERIVATIVE)?(push_symbol(DERIVATIVE),push_symbol(DERIVATIVE),push(cadr(p3)),lessp(caddr(p3),caddr(p1))?(push(caddr(p3)),list(3),push(caddr(p1))):(push(caddr(p1)),list(3),push(caddr(p3))),list(3)):(push(p3),push(caddr(p1)),derivative())},dfunction=function(){return p3=cdr(p1),p3===symbol(NIL)||Find(p3,p2)?(push_symbol(DERIVATIVE),push(p1),push(p2),list(3)):push(zero)},dsin=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),cosine(),multiply()},dcos=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),sine(),multiply(),negate()},dtan=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),cosine(),push_integer(-2),power(),multiply()},darcsin=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),push_rational(-1,2),power(),multiply()},darccos=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),push_rational(-1,2),power(),multiply(),negate()},darctan=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),inverse(),multiply(),simplify()},dsinh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ycosh(),multiply()},dcosh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ysinh(),multiply()},dtanh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),ycosh(),push_integer(-2),power(),multiply()},darcsinh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(2),power(),push_integer(1),add(),push_rational(-1,2),power(),multiply()},darccosh=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(2),power(),push_integer(-1),add(),push_rational(-1,2),power(),multiply()},darctanh=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(1),push(cadr(p1)),push_integer(2),power(),subtract(),inverse(),multiply()},dabs=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),sgn(),multiply()},dsgn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),dirac(),multiply(),push_integer(2),multiply()},dhermite=function(){return push(cadr(p1)),push(p2),derivative(),push_integer(2),push(caddr(p1)),multiply(),multiply(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),hermite(),multiply()},derf=function(){return push(cadr(p1)),push_integer(2),power(),push_integer(-1),multiply(),exponential(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(-1,2),power(),multiply(),push_integer(2),multiply(),push(cadr(p1)),push(p2),derivative(),multiply()},derfc=function(){return push(cadr(p1)),push_integer(2),power(),push_integer(-1),multiply(),exponential(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(-1,2),power(),multiply(),push_integer(-2),multiply(),push(cadr(p1)),push(p2),derivative(),multiply()},dbesselj0=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(1),besselj(),multiply(),push_integer(-1),multiply()},dbesseljn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),besselj(),push(caddr(p1)),push_integer(-1),multiply(),push(cadr(p1)),divide(),push(cadr(p1)),push(caddr(p1)),besselj(),multiply(),add(),multiply()},dbessely0=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push_integer(1),besselj(),multiply(),push_integer(-1),multiply()},dbesselyn=function(){return push(cadr(p1)),push(p2),derivative(),push(cadr(p1)),push(caddr(p1)),push_integer(-1),add(),bessely(),push(caddr(p1)),push_integer(-1),multiply(),push(cadr(p1)),divide(),push(cadr(p1)),push(caddr(p1)),bessely(),multiply(),add(),multiply()},derivative_of_integral=function(){return push(cadr(p1))},DET_check_arg=function(){return istensor(p1)?p1.tensor.ndim!==2||p1.tensor.dim[0]!==p1.tensor.dim[1]?0:1:0},det=function(){var t,e,r,i,n,s,a;if(e=0,i=0,save(),p1=pop(),DET_check_arg()===0){push_symbol(DET),push(p1),list(2),restore();return}for(i=p1.tensor.nelem,t=p1.tensor.elem,e=n=0,s=i;(0<=s?n<s:n>s)&&isNumericAtom(t[e]);e=0<=s?++n:--n);if(e===i)yydetg();else{for(e=r=0,a=p1.tensor.nelem;0<=a?r<a:r>a;e=0<=a?++r:--r)push(p1.tensor.elem[e]);determinant(p1.tensor.dim[0])}return restore()},determinant=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m;for(i=0,n=0,a=0,l=0,p=0,h=0,d=0,m=0,e=[],i=tos-t*t,n=u=0,f=t;0<=f?u<f:u>f;n=0<=f?++u:--u)e[n]=n,e[n+t]=0,e[n+t+t]=1;for(d=1,push(zero);;){for(push_integer(d===1?1:-1),n=s=0,c=t;0<=c?s<c:s>c;n=0<=c?++s:--s)l=t*e[n]+n,push(stack[i+l]),multiply();for(add(),a=t-1,h=0,r=!1;;){if(p=e[t+a]+e[t+t+a],p<0){e[t+t+a]=-e[t+t+a],a--;continue}if(p===a+1){if(a===0){r=!0;break}h++,e[t+t+a]=-e[t+t+a],a--;continue}break}if(r)break;m=e[a-e[t+a]+h],e[a-e[t+a]+h]=e[a-p+h],e[a-p+h]=m,e[t+a]=p,d=-d}return stack[i]=stack[tos-1],moveTos(i+1)},yydetg=function(){var t,e,r,i;for(t=0,e=0,e=p1.tensor.dim[0],t=r=0,i=e*e;0<=i?r<i:r>i;t=0<=i?++r:--r)push(p1.tensor.elem[t]);return lu_decomp(e),moveTos(tos-e*e),push(p1)},M=function(t,e,r,i){return stack[t+e*r+i]},setM=function(t,e,r,i,n){return stack[t+e*r+i]=n},lu_decomp=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x;for(e=0,r=0,i=0,s=0,r=tos-t*t,p1=one,e=p=0,f=t-1;0<=f?p<f:p>f;e=0<=f?++p:--p){if(equal(M(r,t,e,e),zero)){for(i=n=c=e+1,h=t;(c<=h?n<h:n>h)&&equal(M(r,t,i,e),zero);i=c<=h?++n:--n);if(i===t){p1=zero;break}for(s=a=d=e,m=t;d<=m?a<m:a>m;s=d<=m?++a:--a)p2=M(r,t,e,s),setM(r,t,e,s,M(r,t,i,s)),setM(r,t,i,s,p2);push(p1),negate(),p1=pop()}for(push(p1),push(M(r,t,e,e)),multiply(),p1=pop(),i=l=_=e+1,g=t;_<=g?l<g:l>g;i=_<=g?++l:--l)for(push(M(r,t,i,e)),push(M(r,t,e,e)),divide(),negate(),p2=pop(),setM(r,t,i,e,zero),s=u=b=e+1,x=t;b<=x?u<x:u>x;s=b<=x?++u:--u)push(M(r,t,e,s)),push(p2),multiply(),push(M(r,t,i,s)),add(),setM(r,t,i,s,pop())}return push(p1),push(M(r,t,t-1,t-1)),multiply(),p1=pop()},Eval_dirac=function(){return push(cadr(p1)),Eval(),dirac()},dirac=function(){return save(),ydirac(),restore()},ydirac=function(){if(p1=pop(),isdouble(p1))if(p1.d===0){push_integer(1);return}else{push_integer(0);return}if(isrational(p1))if(MZERO(mmul(p1.q.a,p1.q.b))){push_integer(1);return}else{push_integer(0);return}if(car(p1)===symbol(POWER)){push_symbol(DIRAC),push(cadr(p1)),list(2);return}if(isnegativeterm(p1)){push_symbol(DIRAC),push(p1),negate(),list(2);return}return(isnegativeterm(p1)||car(p1)===symbol(ADD)&&isnegativeterm(cadr(p1)))&&(push(p1),negate(),p1=pop()),push_symbol(DIRAC),push(p1),list(2)},divisors=function(){var t,e,r,i,n,s;for(e=0,t=0,r=0,save(),t=tos-1,divisors_onstack(),r=tos-t,s=stack.slice(t,t+r),s.sort(cmp_expr),stack=stack.slice(0,t).concat(s).concat(stack.slice(t+r)),p1=alloc_tensor(r),p1.tensor.ndim=1,p1.tensor.dim[0]=r,e=i=0,n=r;0<=n?i<n:i>n;e=0<=n?++i:--i)p1.tensor.elem[e]=stack[t+e];return moveTos(t),push(p1),restore()},divisors_onstack=function(){var t,e,r,i,n,s;if(t=0,e=0,r=0,i=0,save(),p1=pop(),t=tos,isNumericAtom(p1))push(p1),factor_small_number();else if(car(p1)===symbol(ADD))push(p1),__factor_add();else if(car(p1)===symbol(MULTIPLY))for(p1=cdr(p1),isNumericAtom(car(p1))&&(push(car(p1)),factor_small_number(),p1=cdr(p1));iscons(p1);)p2=car(p1),car(p2)===symbol(POWER)?(push(cadr(p2)),push(caddr(p2))):(push(p2),push(one)),p1=cdr(p1);else car(p1)===symbol(POWER)?(push(cadr(p1)),push(caddr(p1))):(push(p1),push(one));for(r=tos,push(one),gen(t,r),i=tos-r,e=n=0,s=i;0<=s?n<s:n>s;e=0<=s?++n:--n)stack[t+e]=stack[r+e];return moveTos(t+i),restore()},gen=function(t,e){var r,i,n,s;if(r=0,i=0,save(),p1=pop(),t===e){push(p1),restore();return}if(p2=stack[t+0],p3=stack[t+1],push(p3),r=pop_integer(),!isNaN(r))for(i=n=0,s=Math.abs(r);0<=s?n<=s:n>=s;i=0<=s?++n:--n)push(p1),push(p2),push_integer(sign(r)*i),power(),multiply(),gen(t+2,e);return restore()},__factor_add=function(){for(save(),p1=pop(),p3=cdr(p1),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),gcd(),p3=cdr(p3);if(p2=pop(),isplusone(p2)){push(p1),push(one),restore();return}if(isNumericAtom(p2))push(p2),factor_small_number();else if(car(p2)===symbol(MULTIPLY))for(p3=cdr(p2),isNumericAtom(car(p3))?(push(car(p3)),factor_small_number()):(push(car(p3)),push(one)),p3=cdr(p3);iscons(p3);)push(car(p3)),push(one),p3=cdr(p3);else push(p2),push(one);for(push(p2),inverse(),p2=pop(),push(zero),p3=cdr(p1);iscons(p3);)push(p2),push(car(p3)),multiply(),add(),p3=cdr(p3);return push(one),restore()},dpow=function(){var t,e,r,i,n,s;if(t=0,e=0,r=0,i=0,n=0,s=0,i=pop_double(),r=pop_double(),r===0&&i<0&&stop("divide by zero"),r>=0||i%1===0){n=Math.pow(r,i),push_double(n);return}return n=Math.pow(Math.abs(r),i),s=Math.PI*i,i%.5===0?(t=0,e=Math.sin(s)):(t=Math.cos(s),e=Math.sin(s)),push_double(t*n),push_double(e*n),push(imaginaryunit),multiply(),add()},EIG_N=0,EIG_yydd=[],EIG_yyqq=[],Eval_eigen=function(){return EIG_check_arg()===0&&stop("eigen: argument is not a square matrix"),eigen(EIGEN),p1=usr_symbol("D"),set_binding(p1,p2),p1=usr_symbol("Q"),set_binding(p1,p3),push(symbol(NIL))},Eval_eigenval=function(){if(EIG_check_arg()===0){push_symbol(EIGENVAL),push(p1),list(2);return}return eigen(EIGENVAL),push(p2)},Eval_eigenvec=function(){if(EIG_check_arg()===0){push_symbol(EIGENVEC),push(p1),list(2);return}return eigen(EIGENVEC),push(p3)},EIG_check_arg=function(){var t,e,r,i,n,s,a,l,u,p,f;if(t=0,r=0,push(cadr(p1)),Eval(),yyfloat(),Eval(),p1=pop(),!istensor(p1))return 0;for((p1.tensor.ndim!==2||p1.tensor.dim[0]!==p1.tensor.dim[1])&&stop("eigen: argument is not a square matrix"),EIG_N=p1.tensor.dim[0],t=s=0,a=EIG_N;0<=a?s<a:s>a;t=0<=a?++s:--s)for(r=e=0,l=EIG_N;0<=l?e<l:e>l;r=0<=l?++e:--e)isdouble(p1.tensor.elem[EIG_N*t+r])||stop("eigen: matrix is not numerical");for(t=i=0,u=EIG_N-1;0<=u?i<u:i>u;t=0<=u?++i:--i)for(r=n=p=t+1,f=EIG_N;p<=f?n<f:n>f;r=p<=f?++n:--n)Math.abs(p1.tensor.elem[EIG_N*t+r].d-p1.tensor.elem[EIG_N*r+t].d)>1e-10&&stop("eigen: matrix is not symmetrical");return 1},eigen=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P;for(e=0,i=0,e=u=0,h=EIG_N*EIG_N;0<=h?u<h:u>h;e=0<=h?++u:--u)EIG_yydd[e]=0;for(e=r=0,d=EIG_N*EIG_N;0<=d?r<d:r>d;e=0<=d?++r:--r)EIG_yyqq[e]=0;for(e=n=0,_=EIG_N;0<=_?n<_:n>_;e=0<=_?++n:--n)for(EIG_yydd[EIG_N*e+e]=p1.tensor.elem[EIG_N*e+e].d,i=s=g=e+1,b=EIG_N;g<=b?s<b:s>b;i=g<=b?++s:--s)EIG_yydd[EIG_N*e+i]=p1.tensor.elem[EIG_N*e+i].d,EIG_yydd[EIG_N*i+e]=p1.tensor.elem[EIG_N*e+i].d;for(e=a=0,x=EIG_N;0<=x?a<x:a>x;e=0<=x?++a:--a)for(EIG_yyqq[EIG_N*e+e]=1,i=l=S=e+1,T=EIG_N;S<=T?l<T:l>T;i=S<=T?++l:--l)EIG_yyqq[EIG_N*e+i]=0,EIG_yyqq[EIG_N*i+e]=0;for(e=p=0;p<100&&step()!==0;e=++p);if(e===100&&printstr(`
note: eigen did not converge
`),t===EIGEN||t===EIGENVAL)for(push(p1),copy_tensor(),p2=pop(),e=f=0,I=EIG_N;0<=I?f<I:f>I;e=0<=I?++f:--f)for(i=c=0,O=EIG_N;0<=O?c<O:c>O;i=0<=O?++c:--c)push_double(EIG_yydd[EIG_N*e+i]),p2.tensor.elem[EIG_N*e+i]=pop();if(t===EIGEN||t===EIGENVEC){for(push(p1),copy_tensor(),p3=pop(),L=[],e=P=0,m=EIG_N;0<=m?P<m:P>m;e=0<=m?++P:--P)L.push(function(){var C,G,B;for(G=[],i=B=0,C=EIG_N;0<=C?B<C:B>C;i=0<=C?++B:--B)push_double(EIG_yyqq[EIG_N*e+i]),G.push(p3.tensor.elem[EIG_N*e+i]=pop());return G}());return L}},step=function(){var t,e,r,i,n,s,a,l;for(e=0,i=0,t=0,e=n=0,s=EIG_N-1;0<=s?n<s:n>s;e=0<=s?++n:--n)for(i=r=a=e+1,l=EIG_N;a<=l?r<l:r>l;i=a<=l?++r:--r)EIG_yydd[EIG_N*e+i]!==0&&(step2(e,i),t++);return t},step2=function(t,e){var r,i,n,s,a,l,u,p,f,c,h,d,m;for(a=0,d=0,m=0,r=0,i=0,c=0,h=0,m=.5*(EIG_yydd[EIG_N*t+t]-EIG_yydd[EIG_N*e+e])/EIG_yydd[EIG_N*t+e],d=1/(Math.abs(m)+Math.sqrt(m*m+1)),m<0&&(d=-d),r=1/Math.sqrt(d*d+1),c=d*r,a=l=0,u=EIG_N;0<=u?l<u:l>u;a=0<=u?++l:--l)i=EIG_yydd[EIG_N*t+a],h=EIG_yydd[EIG_N*e+a],EIG_yydd[EIG_N*t+a]=r*i+c*h,EIG_yydd[EIG_N*e+a]=r*h-c*i;for(a=n=0,p=EIG_N;0<=p?n<p:n>p;a=0<=p?++n:--n)i=EIG_yydd[EIG_N*a+t],h=EIG_yydd[EIG_N*a+e],EIG_yydd[EIG_N*a+t]=r*i+c*h,EIG_yydd[EIG_N*a+e]=r*h-c*i;for(a=s=0,f=EIG_N;0<=f?s<f:s>f;a=0<=f?++s:--s)i=EIG_yyqq[EIG_N*t+a],h=EIG_yyqq[EIG_N*e+a],EIG_yyqq[EIG_N*t+a]=r*i+c*h,EIG_yyqq[EIG_N*e+a]=r*h-c*i;return EIG_yydd[EIG_N*t+e]=0,EIG_yydd[EIG_N*e+t]=0},Eval_erf=function(){return push(cadr(p1)),Eval(),yerf()},yerf=function(){return save(),yyerf(),restore()},yyerf=function(){var t;if(t=0,p1=pop(),isdouble(p1)){t=1-erfc(p1.d),push_double(t);return}if(isZeroAtomOrTensor(p1)){push(zero);return}if(isnegativeterm(p1)){push_symbol(ERF),push(p1),negate(),list(2),negate();return}push_symbol(ERF),push(p1),list(2)},Eval_erfc=function(){return push(cadr(p1)),Eval(),yerfc()},yerfc=function(){return save(),yyerfc(),restore()},yyerfc=function(){var t;if(t=0,p1=pop(),isdouble(p1)){t=erfc(p1.d),push_double(t);return}if(isZeroAtomOrTensor(p1)){push(one);return}push_symbol(ERFC),push(p1),list(2)},erfc=function(t){var e,r,i;return t===0?1:(r=0,i=0,e=0,i=Math.abs(t),r=1/(1+.5*i),e=r*Math.exp(-i*i-1.26551223+r*(1.00002368+r*(.37409196+r*(.09678418+r*(-.18628806+r*(.27886807+r*(-1.13520398+r*(1.48851587+r*(-.82215223+r*.17087277))))))))),t>=0?e:2-e)},Eval=function(){var t;if(check_esc_flag(),save(),p1=pop(),p1==null)debugger;switch(!evaluatingAsFloats&&isfloating(p1)&&(t=!0,evaluatingAsFloats++),p1.k){case CONS:Eval_cons();break;case NUM:evaluatingAsFloats?push_double(convert_rational_to_double(p1)):push(p1);break;case DOUBLE:case STR:push(p1);break;case TENSOR:Eval_tensor();break;case SYM:Eval_sym();break;default:stop("atom?")}return t&&evaluatingAsFloats--,restore()},Eval_sym=function(){var t,e,r,i,n,s;if(iskeyword(p1)){push(p1),push(symbol(LAST)),list(2),Eval();return}else if(p1===symbol(PI)&&evaluatingAsFloats){push_double(Math.PI);return}if(p2=get_binding(p1),DEBUG&&console.log("looked up: "+p1+" which contains: "+p2),push(p2),p1!==p2){if(i=chainOfUserSymbolsNotFunctionsBeingEvaluated.indexOf(p1),i!==-1){for(t="",e=r=n=i,s=chainOfUserSymbolsNotFunctionsBeingEvaluated.length;n<=s?r<s:r>s;e=n<=s?++r:--r)t+=chainOfUserSymbolsNotFunctionsBeingEvaluated[e].printname+" -> ";t+=p1.printname,stop("recursive evaluation of symbols: "+t);return}return chainOfUserSymbolsNotFunctionsBeingEvaluated.push(p1),Eval(),chainOfUserSymbolsNotFunctionsBeingEvaluated.pop()}},Eval_cons=function(){var t;if(t=car(p1),car(t)===symbol(EVAL)){Eval_user_function();return}switch(issymbol(t)||stop("cons?"),symnum(t)){case ABS:return Eval_abs();case ADD:return Eval_add();case ADJ:return Eval_adj();case AND:return Eval_and();case ARCCOS:return Eval_arccos();case ARCCOSH:return Eval_arccosh();case ARCSIN:return Eval_arcsin();case ARCSINH:return Eval_arcsinh();case ARCTAN:return Eval_arctan();case ARCTANH:return Eval_arctanh();case ARG:return Eval_arg();case ATOMIZE:return Eval_atomize();case BESSELJ:return Eval_besselj();case BESSELY:return Eval_bessely();case BINDING:return Eval_binding();case BINOMIAL:return Eval_binomial();case CEILING:return Eval_ceiling();case CHECK:return Eval_check();case CHOOSE:return Eval_choose();case CIRCEXP:return Eval_circexp();case CLEAR:return Eval_clear();case CLEARALL:return Eval_clearall();case CLEARPATTERNS:return Eval_clearpatterns();case CLOCK:return Eval_clock();case COEFF:return Eval_coeff();case COFACTOR:return Eval_cofactor();case CONDENSE:return Eval_condense();case CONJ:return Eval_conj();case CONTRACT:return Eval_contract();case COS:return Eval_cos();case COSH:return Eval_cosh();case DECOMP:return Eval_decomp();case DEGREE:return Eval_degree();case DEFINT:return Eval_defint();case DENOMINATOR:return Eval_denominator();case DERIVATIVE:return Eval_derivative();case DET:return Eval_det();case DIM:return Eval_dim();case DIRAC:return Eval_dirac();case DIVISORS:return Eval_divisors();case DO:return Eval_do();case DOT:return Eval_inner();case DRAW:return Eval_draw();case DSOLVE:return Eval_dsolve();case EIGEN:return Eval_eigen();case EIGENVAL:return Eval_eigenval();case EIGENVEC:return Eval_eigenvec();case ERF:return Eval_erf();case ERFC:return Eval_erfc();case EVAL:return Eval_Eval();case EXP:return Eval_exp();case EXPAND:return Eval_expand();case EXPCOS:return Eval_expcos();case EXPSIN:return Eval_expsin();case FACTOR:return Eval_factor();case FACTORIAL:return Eval_factorial();case FACTORPOLY:return Eval_factorpoly();case FILTER:return Eval_filter();case FLOATF:return Eval_float();case APPROXRATIO:return Eval_approxratio();case FLOOR:return Eval_floor();case FOR:return Eval_for();case FUNCTION:return Eval_function_reference();case GAMMA:return Eval_gamma();case GCD:return Eval_gcd();case HERMITE:return Eval_hermite();case HILBERT:return Eval_hilbert();case IMAG:return Eval_imag();case INDEX:return Eval_index();case INNER:return Eval_inner();case INTEGRAL:return Eval_integral();case INV:return Eval_inv();case INVG:return Eval_invg();case ISINTEGER:return Eval_isinteger();case ISPRIME:return Eval_isprime();case LAGUERRE:return Eval_laguerre();case LCM:return Eval_lcm();case LEADING:return Eval_leading();case LEGENDRE:return Eval_legendre();case LOG:return Eval_log();case LOOKUP:return Eval_lookup();case MOD:return Eval_mod();case MULTIPLY:return Eval_multiply();case NOT:return Eval_not();case NROOTS:return Eval_nroots();case NUMBER:return Eval_number();case NUMERATOR:return Eval_numerator();case OPERATOR:return Eval_operator();case OR:return Eval_or();case OUTER:return Eval_outer();case PATTERN:return Eval_pattern();case PATTERNSINFO:return Eval_patternsinfo();case POLAR:return Eval_polar();case POWER:return Eval_power();case PRIME:return Eval_prime();case PRINT:return Eval_print();case PRINT2DASCII:return Eval_print2dascii();case PRINTFULL:return Eval_printcomputer();case PRINTLATEX:return Eval_printlatex();case PRINTLIST:return Eval_printlist();case PRINTPLAIN:return Eval_printhuman();case PRODUCT:return Eval_product();case QUOTE:return Eval_quote();case QUOTIENT:return Eval_quotient();case RANK:return Eval_rank();case RATIONALIZE:return Eval_rationalize();case REAL:return Eval_real();case ROUND:return Eval_round();case YYRECT:return Eval_rect();case ROOTS:return Eval_roots();case SETQ:return Eval_setq();case SGN:return Eval_sgn();case SILENTPATTERN:return Eval_silentpattern();case SIMPLIFY:return Eval_simplify();case SIN:return Eval_sin();case SINH:return Eval_sinh();case SHAPE:return Eval_shape();case SQRT:return Eval_sqrt();case STOP:return Eval_stop();case SUBST:return Eval_subst();case SUM:return Eval_sum();case SYMBOLSINFO:return Eval_symbolsinfo();case TAN:return Eval_tan();case TANH:return Eval_tanh();case TAYLOR:return Eval_taylor();case TEST:return Eval_test();case TESTEQ:return Eval_testeq();case TESTGE:return Eval_testge();case TESTGT:return Eval_testgt();case TESTLE:return Eval_testle();case TESTLT:return Eval_testlt();case TRANSPOSE:return Eval_transpose();case UNIT:return Eval_unit();case ZERO:return Eval_zero();default:return Eval_user_function()}},Eval_binding=function(){return push(get_binding(cadr(p1)))},Eval_check=function(){var t;return t=isZeroLikeOrNonZeroLikeOrUndetermined(cadr(p1)),t==null?push(p1):push_integer(t)},Eval_det=function(){return push(cadr(p1)),Eval(),det()},Eval_dim=function(){var t;return push(cadr(p1)),Eval(),p2=pop(),iscons(cddr(p1))?(push(caddr(p1)),Eval(),t=pop_integer()):t=1,istensor(p2)?t<1||t>p2.tensor.ndim?push(p1):push_integer(p2.tensor.dim[t-1]):push_integer(1)},Eval_divisors=function(){return push(cadr(p1)),Eval(),divisors()},Eval_do=function(){var t;for(push(car(p1)),p1=cdr(p1),t=[];iscons(p1);)pop(),push(car(p1)),Eval(),t.push(p1=cdr(p1));return t},Eval_dsolve=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),dsolve()},Eval_Eval=function(){for(push(cadr(p1)),Eval(),p1=cddr(p1);iscons(p1);)push(car(p1)),Eval(),push(cadr(p1)),Eval(),subst(),p1=cddr(p1);return Eval()},Eval_exp=function(){return push(cadr(p1)),Eval(),exponential()},Eval_factorial=function(){return push(cadr(p1)),Eval(),factorial()},Eval_factorpoly=function(){var t;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),factorpoly(),p1=cdr(p1),t=[];iscons(p1);)push(car(p1)),Eval(),factorpoly(),t.push(p1=cdr(p1));return t},Eval_hermite=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),hermite()},Eval_hilbert=function(){return push(cadr(p1)),Eval(),hilbert()},Eval_index=function(){var t,e,r;if(t=tos,e=p1,p1=cdr(p1),push(car(p1)),Eval(),r=stack[tos-1],isNumericAtom(r)&&stop("trying to access a scalar as a tensor"),!istensor(r)){moveTos(t),push(e);return}for(p1=cdr(p1);iscons(p1);){if(push(car(p1)),Eval(),!isintegerorintegerfloat(stack[tos-1])){moveTos(t),push(e);return}p1=cdr(p1)}return index_function(tos-t)},Eval_inv=function(){return push(cadr(p1)),Eval(),inv()},Eval_invg=function(){return push(cadr(p1)),Eval(),invg()},Eval_isinteger=function(){var t;if(push(cadr(p1)),Eval(),p1=pop(),isrational(p1)){isinteger(p1)?push(one):push(zero);return}if(isdouble(p1)){t=Math.floor(p1.d),t===p1.d?push(one):push(zero);return}return push_symbol(ISINTEGER),push(p1),list(2)},Eval_number=function(){return push(cadr(p1)),Eval(),p1=pop(),p1.k===NUM||p1.k===DOUBLE?push_integer(1):push_integer(0)},Eval_operator=function(){var t;for(t=tos,push_symbol(OPERATOR),p1=cdr(p1);iscons(p1);)push(car(p1)),Eval(),p1=cdr(p1);return list(tos-t)},Eval_quote=function(){return push(cadr(p1))},Eval_rank=function(){return push(cadr(p1)),Eval(),p1=pop(),istensor(p1)?push_integer(p1.tensor.ndim):push(zero)},Eval_setq=function(){if(caadr(p1)===symbol(INDEX)){setq_indexed();return}if(iscons(cadr(p1))){define_user_function();return}return issymbol(cadr(p1))||stop("symbol assignment: error in symbol"),push(caddr(p1)),Eval(),p2=pop(),set_binding(cadr(p1),p2),push(symbol(NIL))},setq_indexed=function(){var t;for(p4=cadadr(p1),issymbol(p4)||stop("indexed assignment: expected a symbol name"),t=tos,push(caddr(p1)),Eval(),p2=cdadr(p1);iscons(p2);)push(car(p2)),Eval(),p2=cdr(p2);return set_component(tos-t),p3=pop(),set_binding(p4,p3),push(symbol(NIL))},Eval_sqrt=function(){return push(cadr(p1)),Eval(),push_rational(1,2),power()},Eval_stop=function(){return stop("user stop")},Eval_subst=function(){return push(cadddr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadr(p1)),Eval(),subst(),Eval()},Eval_unit=function(){var t,e,r,i;if(t=0,e=0,push(cadr(p1)),Eval(),e=pop_integer(),isNaN(e)){push(p1);return}if(e<1){push(p1);return}for(p1=alloc_tensor(e*e),p1.tensor.ndim=2,p1.tensor.dim[0]=e,p1.tensor.dim[1]=e,t=r=0,i=e;0<=i?r<i:r>i;t=0<=i?++r:--r)p1.tensor.elem[e*t+t]=one;return check_tensor_dimensions(p1),push(p1)},Eval_predicate=function(){return save(),p1=top(),car(p1)===symbol(SETQ)&&(pop(),push_symbol(TESTEQ),push(cadr(p1)),push(caddr(p1)),list(3)),Eval(),restore()},Eval_expand=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),p2=pop(),p2===symbol(NIL)?guess():push(p2),expand()},expand=function(){var t;if(save(),p9=pop(),p5=pop(),istensor(p5)){expand_tensor(),restore();return}if(car(p5)===symbol(ADD)){for(push_integer(0),p1=cdr(p5);iscons(p1);)push(car(p1)),push(p9),expand(),add(),p1=cdr(p1);restore();return}if(push(p5),numerator(),p3=pop(),push(p5),denominator(),p2=pop(),remove_negative_exponents(),push(p3),push(p2),push(p9),(isone(p3)||isone(p2))&&(!ispolyexpandedform(p2,p9)||isone(p2))){pop(),pop(),pop(),push(p5),restore();return}if(divpoly(),p7=pop(),push(p3),push(p2),push(p7),multiply(),subtract(),p3=pop(),isZeroAtomOrTensor(p3)){push(p7),restore();return}return push(p2),push(p9),factorpoly(),p2=pop(),expand_get_C(),expand_get_B(),expand_get_A(),istensor(p4)?(push(p4),t=expanding,expanding=1,inv(),expanding=t,push(p3),inner(),push(p2),inner()):(push(p3),push(p4),t=expanding,expanding=1,divide(),expanding=t,push(p2),multiply()),push(p7),add(),restore()},expand_tensor=function(){var t,e,r;for(t=0,push(p5),copy_tensor(),p5=pop(),t=e=0,r=p5.tensor.nelem;0<=r?e<r:e>r;t=0<=r?++e:--e)push(p5.tensor.elem[t]),push(p9),expand(),p5.tensor.elem[t]=pop();return push(p5)},remove_negative_exponents=function(){var t,e,r,i,n,s,a;for(t=0,e=0,r=0,i=0,n=0,t=tos,factors(p2),factors(p3),n=tos-t,r=0,e=s=0,a=n;0<=a?s<a:s>a;e=0<=a?++s:--s)p1=stack[t+e],car(p1)===symbol(POWER)&&cadr(p1)===p9&&(push(caddr(p1)),i=pop_integer(),!isNaN(i)&&i<r&&(r=i));if(moveTos(t),r!==0)return push(p2),push(p9),push_integer(-r),power(),multiply(),p2=pop(),push(p3),push(p9),push_integer(-r),power(),multiply(),p3=pop()},expand_get_C=function(){var t,e,r,i,n,s,a,l,u,p;if(e=0,r=0,n=0,s=0,e=tos,car(p2)===symbol(MULTIPLY))for(p1=cdr(p2);iscons(p1);)p5=car(p1),expand_get_CF(),p1=cdr(p1);else p5=p2,expand_get_CF();if(s=tos-e,s===1){p4=pop();return}for(p4=alloc_tensor(s*s),p4.tensor.ndim=2,p4.tensor.dim[0]=s,p4.tensor.dim[1]=s,t=e,r=a=0,u=s;0<=u?a<u:a>u;r=0<=u?++a:--a)for(n=i=0,p=s;0<=p?i<p:i>p;n=0<=p?++i:--i)push(stack[t+n]),push(p9),push_integer(r),power(),l=expanding,expanding=1,divide(),expanding=l,push(p9),filter(),p4.tensor.elem[s*r+n]=pop();return moveTos(tos-s)},expand_get_CF=function(){var t,e,r,i,n,s,a,l;if(t=0,e=0,r=0,i=0,!!Find(p5,p9)){for(s=expanding,expanding=1,trivial_divide(),expanding=s,car(p5)===symbol(POWER)?(push(caddr(p5)),i=pop_integer(),p6=cadr(p5)):(i=1,p6=p5),push(p6),push(p9),degree(),t=pop_integer(),l=[],e=n=0,a=i;0<=a?n<a:n>a;e=0<=a?++n:--n)l.push(function(){var u,p,f;for(f=[],r=u=0,p=t;0<=p?u<p:u>p;r=0<=p?++u:--u)push(p8),push(p6),push_integer(e),power(),s=expanding,expanding=1,multiply(),expanding=s,push(p9),push_integer(r),power(),s=expanding,expanding=1,multiply(),f.push(expanding=s);return f}());return l}},trivial_divide=function(){var t;if(t=0,car(p2)===symbol(MULTIPLY)){for(t=tos,p0=cdr(p2);iscons(p0);)equal(car(p0),p5)||(push(car(p0)),Eval()),p0=cdr(p0);multiply_all(tos-t)}else push_integer(1);return p8=pop()},expand_get_B=function(){var t,e,r,i,n;if(t=0,e=0,!!istensor(p4)){for(e=p4.tensor.dim[0],p8=alloc_tensor(e),p8.tensor.ndim=1,p8.tensor.dim[0]=e,t=r=0,n=e;0<=n?r<n:r>n;t=0<=n?++r:--r)push(p3),push(p9),push_integer(t),power(),i=expanding,expanding=1,divide(),expanding=i,push(p9),filter(),p8.tensor.elem[t]=pop();return p3=p8}},expand_get_A=function(){var t,e,r,i,n;if(t=0,e=0,r=0,!istensor(p4)){push(p2),reciprocate(),p2=pop();return}if(t=tos,car(p2)===symbol(MULTIPLY))for(p8=cdr(p2);iscons(p8);)p5=car(p8),expand_get_AF(),p8=cdr(p8);else p5=p2,expand_get_AF();for(r=tos-t,p8=alloc_tensor(r),p8.tensor.ndim=1,p8.tensor.dim[0]=r,e=i=0,n=r;0<=n?i<n:i>n;e=0<=n?++i:--i)p8.tensor.elem[e]=stack[t+e];return moveTos(t),p2=p8},expand_get_AF=function(){var t,e,r,i,n,s,a;if(t=0,e=0,r=0,i=1,!!Find(p5,p9)){for(car(p5)===symbol(POWER)&&(push(caddr(p5)),i=pop_integer(),p5=cadr(p5)),push(p5),push(p9),degree(),t=pop_integer(),a=[],e=n=s=i;s<=0?n<0:n>0;e=s<=0?++n:--n)a.push(function(){var l,u,p;for(p=[],r=l=0,u=t;0<=u?l<u:l>u;r=0<=u?++l:--l)push(p5),push_integer(e),power(),reciprocate(),push(p9),push_integer(r),power(),p.push(multiply());return p}());return a}},Eval_expcos=function(){return push(cadr(p1)),Eval(),expcos()},expcos=function(){return save(),p1=pop(),push(imaginaryunit),push(p1),multiply(),exponential(),push_rational(1,2),multiply(),push(imaginaryunit),negate(),push(p1),multiply(),exponential(),push_rational(1,2),multiply(),add(),restore()},Eval_expsin=function(){return push(cadr(p1)),Eval(),expsin()},expsin=function(){return save(),p1=pop(),push(imaginaryunit),push(p1),multiply(),exponential(),push(imaginaryunit),divide(),push_rational(1,2),multiply(),push(imaginaryunit),negate(),push(p1),multiply(),exponential(),push(imaginaryunit),divide(),push_rational(1,2),multiply(),subtract(),restore()},Eval_factor=function(){var t;for(push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),p2=pop(),p2===symbol(NIL)?guess():push(p2),factor(),p1=cdddr(p1),t=[];iscons(p1);)push(car(p1)),Eval(),factor_again(),t.push(p1=cdr(p1));return t},factor_again=function(){var t,e;if(save(),p2=pop(),p1=pop(),t=tos,car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),factor_term(),p1=cdr(p1);else push(p1),push(p2),factor_term();return e=tos-t,e>1&&multiply_all_noexpand(e),restore()},factor_term=function(){if(save(),factorpoly(),p1=pop(),car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),p1=cdr(p1);else push(p1);return restore()},factor=function(){return save(),p2=pop(),p1=pop(),isinteger(p1)?(push(p1),factor_number()):(push(p1),push(p2),factorpoly()),restore()},factor_small_number=function(){var t,e,r,i,n,s;for(r=0,save(),i=pop_integer(),isNaN(i)&&stop("number too big to factor"),i<0&&(i=-i),r=n=0,s=MAXPRIMETAB;(0<=s?n<s:n>s)&&(t=primetab[r],!(t>i/t));r=0<=s?++n:--n){for(e=0;i%t===0;)i/=t,e++;e&&(push_integer(t),push_integer(e))}return i>1&&(push_integer(i),push_integer(1)),restore()},factorial=function(){var t;if(t=0,save(),p1=pop(),push(p1),t=pop_integer(),t<0||isNaN(t)){push_symbol(FACTORIAL),push(p1),list(2),restore();return}return bignum_factorial(t),restore()},factorpoly=function(){var t,e;return DEBUG&&console.log("factorpoly: "+stack[tos-1].toString()+" "+stack[tos-2].toString()),save(),e=pop(),t=pop(),!Find(t,e)||!ispolyexpandedform(t,e)||!issymbol(e)?push(t):yyfactorpoly(e,t),restore()},yyfactorpoly=function(t,e){var r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H;for(DEBUG&&(u=t,B=e,console.log("yyfactorpoly: "+u+" "+B)),save(),c=tos,isfloating(e)&&stop("floating point numbers in polynomial"),x=tos,l=coeff(t,e)-1,DEBUG&&console.log("yyfactorpoly: "+u+" "+B+" factpoly_expo before rationalize_coefficients: "+l),b=rationalize_coefficients(c),DEBUG&&console.log("yyfactorpoly: "+u+" "+B+" factpoly_expo  after rationalize_coefficients: "+l),H="real",C=null;l>0;)if(DEBUG&&console.log("yyfactorpoly: "+u+" "+B+" factpoly_expo inside while loop: "+l),isZeroAtomOrTensor(stack[x+0])?(DEBUG&&console.log("yyfactorpoly: "+u+" "+B+" isZeroAtomOrTensor"),r=one,n=zero):H==="real"?[f,r,n]=get_factor_from_real_root(t,l,x):H==="complex"&&([p,r]=get_factor_from_complex_root(C,l,x)),H==="real")if(f===0){H="complex";continue}else{for(push(r),push(t),multiply(),push(n),add(),i=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+B+` success
FACTOR=`+i),push(b),push(i),multiply_noexpand(),b=pop(),yydivpoly(l,x,r,n);l&&isZeroAtomOrTensor(stack[x+l]);)l--;for(push(zero),h=g=0,I=l;0<=I?g<=I:g>=I;h=0<=I?++g:--g)push(stack[x+h]),push(t),push_integer(h),power(),multiply(),add();C=pop()}else if(H==="complex"){if(p===0)break;if(push(r),push(t),subtract(),push(r),conjugate(),push(t),subtract(),multiply(),G=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+B+` success
FACTOR=`+G),push(b),T=pop(),push(b),push(G),multiply_noexpand(),b=pop(),C==null){for(push(zero),h=d=0,O=l;0<=O?d<=O:d>=O;h=0<=O?++d:--d)push(stack[x+h]),push(t),push_integer(h),power(),multiply(),add();C=pop()}if(a=C,push(a),push(G),push(t),divpoly(),C=pop(),push(C),push(G),multiply(),s=pop(),!equal(s,a)){DEBUG&&console.log("we found a polynomial based on complex root and its conj but it doesn't divide the poly, quitting"),DEBUG&&console.log("so just returning previousFactorisation times dividend: "+T+" * "+a),push(T),push(a),S=expanding,expanding=0,yycondense(),expanding=S,multiply_noexpand(),b=pop(),stack[c]=b,moveTos(c+1),restore();return}for(h=m=0,L=l;0<=L?m<=L:m>=L;h=0<=L?++m:--m)pop();coeff(t,C),l-=2}for(DEBUG&&console.log("yyfactorpoly: "+u+" "+B+" building the remaining unfactored part of the polynomial"),push(zero),h=_=0,P=l;0<=P?_<=P:_>=P;h=0<=P?++_:--_)push(stack[x+h]),push(t),push_integer(h),power(),multiply(),add();return e=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+B+" remaining unfactored part of the polynomial: "+e.toString()),push(e),S=expanding,expanding=0,yycondense(),expanding=S,e=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+B+" new poly with extracted common factor: "+e.toString()),l>0&&isnegativeterm(stack[x+l])&&(push(e),negate(),e=pop(),push(b),negate_noexpand(),b=pop()),push(b),push(e),multiply_noexpand(),b=pop(),DEBUG&&console.log("yyfactorpoly: "+u+" "+B+" result: "+b),stack[c]=b,moveTos(c+1),restore()},rationalize_coefficients=function(t){var e,r,i,n,s,a,l,u,p;for(n=one,e=i=a=t,l=tos;a<=l?i<l:i>l;e=a<=l?++i:--i)push(stack[e]),denominator(),push(n),lcm(),n=pop();for(e=r=u=t,p=tos;u<=p?r<p:r>p;e=u<=p?++r:--r)push(n),push(stack[e]),multiply(),stack[e]=pop();return push(n),reciprocate(),s=pop(),DEBUG&&console.log("rationalize_coefficients result: "+s.toString()),s},get_factor_from_real_root=function(t,e,r){var i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C;if(DEBUG&&console.log("get_factor_from_real_root"),l=0,a=0,i=0,n=0,h=0,d=0,DEBUG){for(push(zero),l=m=0,g=e;0<=g?m<=g:m>=g;l=0<=g?++m:--m)push(stack[r+l]),push(t),push_integer(l),power(),multiply(),add();_=pop(),console.log("POLY="+_)}if(a=tos,n=tos,push(stack[r+e]),divisors_onstack(),d=tos-n,i=tos,push(stack[r+0]),divisors_onstack(),h=tos-i,DEBUG){for(console.log("divisors of base term"),l=u=0,b=h;0<=b?u<b:u>b;l=0<=b?++u:--u)console.log(", "+stack[i+l]);for(console.log("divisors of leading term"),l=p=0,x=d;0<=x?p<x:p>x;l=0<=x?++p:--p)console.log(", "+stack[n+l])}for(I=f=0,S=d;0<=S?f<S:f>S;I=0<=S?++f:--f)for(O=c=0,T=h;0<=T?c<T:c>T;O=0<=T?++c:--c){if(P=stack[n+I],L=stack[i+O],push(L),push(P),divide(),negate(),C=pop(),s=Evalpoly(e,r,C),DEBUG&&(console.log("try A="+P),console.log(", B="+L),console.log(", root "+t),console.log("=-B/A="+C),console.log(", POLY("+C),console.log(")="+s)),isZeroAtomOrTensor(s))return moveTos(a),DEBUG&&console.log("get_factor_from_real_root returning 1"),[1,P,L];if(push(L),negate(),L=pop(),push(C),negate(),C=pop(),s=Evalpoly(e,r,C),DEBUG&&(console.log("try A="+P),console.log(", B="+L),console.log(", root "+t),console.log("=-B/A="+C),console.log(", POLY("+C),console.log(")="+s)),isZeroAtomOrTensor(s))return moveTos(a),DEBUG&&console.log("get_factor_from_real_root returning 1"),[1,P,L]}return moveTos(a),DEBUG&&console.log("get_factor_from_real_root returning"),[0,null,null]},get_factor_from_complex_root=function(t,e,r){var i,n,s,a,l,u,p;if(n=0,e<=2)return DEBUG&&console.log("no more factoring via complex roots to be found in polynomial of degree <= 2"),[0,null];if(DEBUG&&console.log("complex root finding for POLY="+t),n=tos,push_integer(-1),push_rational(2,3),power(),rect(),p=pop(),DEBUG&&console.log("complex root finding: trying with "+p),push(p),i=Evalpoly(e,r,p),DEBUG&&console.log("complex root finding result: "+i),isZeroAtomOrTensor(i))return moveTos(n),DEBUG&&console.log("get_factor_from_complex_root returning 1"),[1,p];if(push_integer(1),push_rational(2,3),power(),rect(),p=pop(),DEBUG&&console.log("complex root finding: trying with "+p),push(p),i=Evalpoly(e,r,p),DEBUG&&console.log("complex root finding result: "+i),isZeroAtomOrTensor(i))return moveTos(n),DEBUG&&console.log("get_factor_from_complex_root returning 1"),[1,p];for(l=a=-10;a<=10;l=++a)for(u=s=1;s<=5;u=++s)if(push_integer(l),push_integer(u),push(imaginaryunit),multiply(),add(),rect(),p=pop(),DEBUG&&console.log("complex root finding: trying simple complex combination "+p),push(p),i=Evalpoly(e,r,p),isZeroAtomOrTensor(i))return moveTos(n),DEBUG&&console.log("found complex root: "+i),[1,p];return moveTos(n),DEBUG&&console.log("get_factor_from_complex_root returning 0"),[0,null]},yydivpoly=function(t,e,r,i){var n,s,a,l;for(n=zero,s=a=l=t;l<=0?a<0:a>0;s=l<=0?++a:--a)push(stack[e+s]),stack[e+s]=n,push(r),divide(),n=pop(),push(stack[e+s-1]),push(n),push(i),multiply(),subtract(),stack[e+s-1]=pop();if(stack[e+0]=n,DEBUG)return console.log("yydivpoly Q: "+n.toString())},Evalpoly=function(t,e,r){var i,n,s;for(push(zero),i=n=s=t;s<=0?n<=0:n>=0;i=s<=0?++n:--n)push(r),multiply(),push(stack[e+i]),add();return pop()},factors=function(t){var e;if(e=tos,car(t)===symbol(ADD))for(t=cdr(t);iscons(t);)push_term_factors(car(t)),t=cdr(t);else push_term_factors(t);return tos-e},push_term_factors=function(t){var e;if(car(t)===symbol(MULTIPLY)){for(t=cdr(t),e=[];iscons(t);)push(car(t)),e.push(t=cdr(t));return e}else return push(t)},Eval_filter=function(){var t;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),t=[];iscons(p1);)push(car(p1)),Eval(),filter(),t.push(p1=cdr(p1));return t},filter=function(){return save(),p2=pop(),p1=pop(),filter_main(),restore()},filter_main=function(){return car(p1)===symbol(ADD)?filter_sum():istensor(p1)?filter_tensor():Find(p1,p2)?push_integer(0):push(p1)},filter_sum=function(){var t;for(push_integer(0),p1=cdr(p1),t=[];iscons(p1);)push(car(p1)),push(p2),filter(),add(),t.push(p1=cdr(p1));return t},filter_tensor=function(){var t,e,r,i,n,s;for(t=0,r=0,r=p1.tensor.nelem,p3=alloc_tensor(r),p3.tensor.ndim=p1.tensor.ndim,t=i=0,n=p1.tensor.ndim;0<=n?i<n:i>n;t=0<=n?++i:--i)p3.tensor.dim[t]=p1.tensor.dim[t];for(t=e=0,s=r;0<=s?e<s:e>s;t=0<=s?++e:--e)push(p1.tensor.elem[t]),push(p2),filter(),p3.tensor.elem[t]=pop();return push(p3)},Eval_float=function(){return evaluatingAsFloats++,push(cadr(p1)),Eval(),yyfloat(),Eval(),evaluatingAsFloats--},zzfloat=function(){return save(),evaluatingAsFloats++,Eval(),yyfloat(),Eval(),evaluatingAsFloats--,restore()},yyfloat=function(){var t,e,r,i;if(e=0,t=0,evaluatingAsFloats++,save(),p1=pop(),iscons(p1)){for(t=tos;iscons(p1);)push(car(p1)),yyfloat(),p1=cdr(p1);list(tos-t)}else if(p1.k===TENSOR){for(push(p1),copy_tensor(),p1=pop(),e=r=0,i=p1.tensor.nelem;0<=i?r<i:r>i;e=0<=i?++r:--r)push(p1.tensor.elem[e]),yyfloat(),p1.tensor.elem[e]=pop();push(p1)}else p1.k===NUM?(push(p1),bignum_float()):p1===symbol(PI)?push_double(Math.PI):p1===symbol(E)?push_double(Math.E):push(p1);return restore(),evaluatingAsFloats--},Eval_floor=function(){return push(cadr(p1)),Eval(),yfloor()},yfloor=function(){return save(),yyfloor(),restore()},yyfloor=function(){var t;if(t=0,p1=pop(),!isNumericAtom(p1)){push_symbol(FLOOR),push(p1),list(2);return}if(isdouble(p1)){t=Math.floor(p1.d),push_double(t);return}if(isinteger(p1)){push(p1);return}if(p3=new U,p3.k=NUM,p3.q.a=mdiv(p1.q.a,p1.q.b),p3.q.b=mint(1),push(p3),isnegativenumber(p1))return push_integer(-1),add()},Eval_for=function(){var t,e,r,i,n,s,a;if(t=0,e=0,r=0,i=caddr(p1),issymbol(i)||stop("for: 2nd arg should be the variable to loop over"),push(cadddr(p1)),Eval(),e=pop_integer(),isNaN(e)){push(p1);return}if(push(caddddr(p1)),Eval(),r=pop_integer(),isNaN(r)){push(p1);return}for(p4=get_binding(i),t=n=s=e,a=r;s<=a?n<=a:n>=a;t=s<=a?++n:--n)push_integer(t),p5=pop(),set_binding(i,p5),push(cadr(p1)),Eval(),pop();return set_binding(i,p4),push_symbol(NIL)},Eval_gamma=function(){return push(cadr(p1)),Eval(),gamma()},gamma=function(){return save(),gammaf(),restore()},gammaf=function(){if(p1=pop(),isrational(p1)&&MEQUAL(p1.q.a,1)&&MEQUAL(p1.q.b,2)){evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(1,2),power();return}if(isrational(p1)&&MEQUAL(p1.q.a,3)&&MEQUAL(p1.q.b,2)){evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_rational(1,2),power(),push_rational(1,2),multiply();return}if(isnegativeterm(p1)){evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push_integer(-1),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),push(p1),multiply(),sine(),push(p1),multiply(),push(p1),negate(),gamma(),multiply(),divide();return}if(car(p1)===symbol(ADD)){gamma_of_sum();return}push_symbol(GAMMA),push(p1),list(2)},gamma_of_sum=function(){if(p3=cdr(p1),isrational(car(p3))&&MEQUAL(car(p3).q.a,1)&&MEQUAL(car(p3).q.b,1))return push(cadr(p3)),push(cadr(p3)),gamma(),multiply();if(isrational(car(p3))&&MEQUAL(car(p3).q.a,-1)&&MEQUAL(car(p3).q.b,1))return push(cadr(p3)),gamma(),push(cadr(p3)),push_integer(-1),add(),divide();push_symbol(GAMMA),push(p1),list(2)},Eval_gcd=function(){var t;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),t=[];iscons(p1);)push(car(p1)),Eval(),gcd(),t.push(p1=cdr(p1));return t},gcd=function(){var t;return t=expanding,save(),gcd_main(),restore(),expanding=t},gcd_main=function(){var t;if(expanding=1,p2=pop(),p1=pop(),DEBUG&&console.log("gcd_main: p1: "+p1+" p2: "+p2),equal(p1,p2)){push(p1);return}if(isrational(p1)&&isrational(p2)){push(p1),push(p2),gcd_numbers();return}if(t=areunivarpolysfactoredorexpandedform(p1,p2)){gcd_polys(t);return}if(car(p1)===symbol(ADD)&&car(p2)===symbol(ADD)){gcd_sum_sum();return}if(car(p1)===symbol(ADD)&&(gcd_sum(p1),p1=pop()),car(p2)===symbol(ADD)&&(gcd_sum(p2),p2=pop()),car(p1)===symbol(MULTIPLY)){gcd_sum_product();return}if(car(p2)===symbol(MULTIPLY)){gcd_product_sum();return}if(car(p1)===symbol(MULTIPLY)&&car(p2)===symbol(MULTIPLY)){gcd_product_product();return}return gcd_powers_with_same_base()},areunivarpolysfactoredorexpandedform=function(t,e){var r;return DEBUG&&console.log("areunivarpolysfactoredorexpandedform: p1: "+t+" p2: "+e),(r=isunivarpolyfactoredorexpandedform(t))&&isunivarpolyfactoredorexpandedform(e,r)?r:!1},gcd_polys=function(t){if(DEBUG&&console.log("gcd_polys: p1: "+p1+" polyVar: "+t),push(p1),push(t),factorpoly(),p1=pop(),push(p2),push(t),factorpoly(),p2=pop(),DEBUG&&console.log("GCD: factored polys:"),DEBUG&&console.log("  p1:"+p1.toString()),DEBUG&&console.log("  p2:"+p2.toString()),(car(p1)===symbol(MULTIPLY)||car(p2)===symbol(MULTIPLY))&&(car(p1)!==symbol(MULTIPLY)&&(push_symbol(MULTIPLY),push(p1),push(one),list(3),p1=pop()),car(p2)!==symbol(MULTIPLY)&&(push_symbol(MULTIPLY),push(p2),push(one),list(3),p2=pop())),car(p1)===symbol(MULTIPLY)&&car(p2)===symbol(MULTIPLY)){gcd_product_product();return}return gcd_powers_with_same_base(),!0},gcd_product_product=function(){var t;for(push(one),p3=cdr(p1),t=[];iscons(p3);){for(p4=cdr(p2);iscons(p4);)push(car(p3)),push(car(p4)),gcd(),multiply(),p4=cdr(p4);t.push(p3=cdr(p3))}return t},gcd_powers_with_same_base=function(){if(car(p1)===symbol(POWER)?(p3=caddr(p1),p1=cadr(p1)):p3=one,car(p2)===symbol(POWER)?(p4=caddr(p2),p2=cadr(p2)):p4=one,!equal(p1,p2)){push(one);return}if(isNumericAtom(p3)&&isNumericAtom(p4)){push(p1),lessp(p3,p4)?push(p3):push(p4),power();return}if(push(p3),push(p4),divide(),p5=pop(),isNumericAtom(p5)){push(p1),car(p3)===symbol(MULTIPLY)&&isNumericAtom(cadr(p3))?p5=cadr(p3):p5=one,car(p4)===symbol(MULTIPLY)&&isNumericAtom(cadr(p4))?p6=cadr(p4):p6=one,lessp(p5,p6)?push(p3):push(p4),power();return}if(push(p3),push(p4),subtract(),p5=pop(),!isNumericAtom(p5)){push(one);return}return push(p1),isnegativenumber(p5)?push(p3):push(p4),power()},gcd_sum_sum=function(){if(length(p1)!==length(p2)){push(one);return}for(p3=cdr(p1),push(car(p3)),p3=cdr(p3);iscons(p3);)push(car(p3)),gcd(),p3=cdr(p3);for(p3=pop(),p4=cdr(p2),push(car(p4)),p4=cdr(p4);iscons(p4);)push(car(p4)),gcd(),p4=cdr(p4);return p4=pop(),push(p1),push(p3),divide(),p5=pop(),push(p2),push(p4),divide(),p6=pop(),equal(p5,p6)?(push(p5),push(p3),push(p4),gcd(),multiply()):push(one)},gcd_sum=function(t){var e;for(t=cdr(t),push(car(t)),t=cdr(t),e=[];iscons(t);)push(car(t)),gcd(),e.push(t=cdr(t));return e},gcd_sum_product=function(){var t;for(push(one),p3=cdr(p1),t=[];iscons(p3);)push(car(p3)),push(p2),gcd(),multiply(),t.push(p3=cdr(p3));return t},gcd_product_sum=function(){var t;for(push(one),p4=cdr(p2),t=[];iscons(p4);)push(p1),push(car(p4)),gcd(),multiply(),t.push(p4=cdr(p4));return t},guess=function(){var t;return t=pop(),push(t),Find(t,symbol(SYMBOL_X))?push_symbol(SYMBOL_X):Find(t,symbol(SYMBOL_Y))?push_symbol(SYMBOL_Y):Find(t,symbol(SYMBOL_Z))?push_symbol(SYMBOL_Z):Find(t,symbol(SYMBOL_T))?push_symbol(SYMBOL_T):Find(t,symbol(SYMBOL_S))?push_symbol(SYMBOL_S):push_symbol(SYMBOL_X)},hermite=function(){return save(),yyhermite(),restore()},yyhermite=function(){var t;if(t=0,p2=pop(),p1=pop(),push(p2),t=pop_integer(),t<0||isNaN(t)){push_symbol(HERMITE),push(p1),push(p2),list(3);return}return issymbol(p1)?yyhermite2(t):(p3=p1,p1=symbol(SECRETX),yyhermite2(t),p1=p3,push(symbol(SECRETX)),push(p1),subst(),Eval())},yyhermite2=function(t){var e,r,i,n;for(e=0,push_integer(1),push_integer(0),p4=pop(),n=[],e=r=0,i=t;0<=i?r<i:r>i;e=0<=i?++r:--r)p5=p4,p4=pop(),push(p1),push(p4),multiply(),push_integer(e),push(p5),multiply(),subtract(),push_integer(2),n.push(multiply());return n},hilbert=function(){var t,e,r,i,n,s,a;if(t=0,r=0,i=0,save(),p2=pop(),push(p2),i=pop_integer(),i<2){push_symbol(HILBERT),push(p2),list(2),restore();return}for(push_zero_matrix(i,i),p1=pop(),t=n=0,s=i;0<=s?n<s:n>s;t=0<=s?++n:--n)for(r=e=0,a=i;0<=a?e<a:e>a;r=0<=a?++e:--e)push_integer(t+r+1),inverse(),p1.tensor.elem[t*i+r]=pop();return push(p1),restore()},DEBUG_IMAG=!1,Eval_imag=function(){return push(cadr(p1)),Eval(),imag()},imag=function(){return save(),rect(),p1=pop(),DEBUG_IMAG&&console.log("IMAGE of "+p1),push(p1),push(p1),conjugate(),DEBUG_IMAG&&console.log(" image: conjugate result: "+stack[tos-1]),subtract(),push_integer(2),divide(),DEBUG_IMAG&&console.log(" image: 1st divide result: "+stack[tos-1]),push(imaginaryunit),divide(),DEBUG_IMAG&&console.log(" image: 2nd divide result: "+stack[tos-1]),restore()},index_function=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T;for(e=0,n=0,a=0,u=0,p=0,T=0,save(),S=tos-t,p1=stack[S],u=p1.tensor.ndim,a=t-1,a>u&&stop("too many indices for tensor"),n=0,e=f=0,c=a;0<=c?f<c:f>c;e=0<=c?++f:--f)push(stack[S+e+1]),T=pop_integer(),(T<1||T>p1.tensor.dim[e])&&stop("index out of range"),n=n*p1.tensor.dim[e]+T-1;if(u===a){moveTos(tos-t),push(p1.tensor.elem[n]),restore();return}for(e=r=h=a,d=u;h<=d?r<d:r>d;e=h<=d?++r:--r)n=n*p1.tensor.dim[e]+0;for(p=1,e=i=m=a,_=u;m<=_?i<_:i>_;e=m<=_?++i:--i)p*=p1.tensor.dim[e];for(p2=alloc_tensor(p),p2.tensor.ndim=u-a,e=s=g=a,b=u;g<=b?s<b:s>b;e=g<=b?++s:--s)p2.tensor.dim[e-a]=p1.tensor.dim[e];for(e=l=0,x=p;0<=x?l<x:l>x;e=0<=x?++l:--l)p2.tensor.elem[e]=p1.tensor.elem[n+e];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),moveTos(tos-t),push(p2),restore()},set_component=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S;for(e=0,n=0,a=0,p=0,S=0,save(),t<3&&stop("error in indexed assign"),x=tos-t,p2=stack[x],p1=stack[x+1],istensor(p1)||stop("error in indexed assign: assigning to something that is not a tensor"),p=p1.tensor.ndim,a=t-2,a>p&&stop("error in indexed assign"),n=0,e=f=0,c=a;0<=c?f<c:f>c;e=0<=c?++f:--f)push(stack[x+e+2]),S=pop_integer(),(S<1||S>p1.tensor.dim[e])&&stop(`error in indexed assign
`),n=n*p1.tensor.dim[e]+S-1;for(e=r=h=a,d=p;h<=d?r<d:r>d;e=h<=d?++r:--r)n=n*p1.tensor.dim[e]+0;for(p3=alloc_tensor(p1.tensor.nelem),p3.tensor.ndim=p1.tensor.ndim,e=i=0,m=p1.tensor.ndim;0<=m?i<m:i>m;e=0<=m?++i:--i)p3.tensor.dim[e]=p1.tensor.dim[e];for(e=s=0,_=p1.tensor.nelem;0<=_?s<_:s>_;e=0<=_?++s:--s)p3.tensor.elem[e]=p1.tensor.elem[e];if(check_tensor_dimensions(p1),check_tensor_dimensions(p3),p1=p3,p===a){istensor(p2)&&stop("error in indexed assign"),p1.tensor.elem[n]=p2,check_tensor_dimensions(p1),moveTos(tos-t),push(p1),restore();return}for(istensor(p2)||stop("error in indexed assign"),p-a!==p2.tensor.ndim&&stop("error in indexed assign"),e=l=0,g=p2.tensor.ndim;0<=g?l<g:l>g;e=0<=g?++l:--l)p1.tensor.dim[a+e]!==p2.tensor.dim[e]&&stop("error in indexed assign");for(e=u=0,b=p2.tensor.nelem;0<=b?u<b:u>b;e=0<=b?++u:--u)p1.tensor.elem[n+e]=p2.tensor.elem[e];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),moveTos(tos-t),push(p1),restore()},Eval_inner=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g;for(g=[],g.push(car(cdr(p1))),m=car(cdr(cdr(p1))),m===symbol(NIL)&&stop("pattern needs at least a template and a transformed version"),s=cdr(cdr(p1));s!==symbol(NIL);)g.push(car(s)),s=cdr(s);if(g.length>2){for(push_symbol(INNER),push(g[g.length-2]),push(g[g.length-1]),list(3),e=a=2,u=g.length;2<=u?a<u:a>u;e=2<=u?++a:--a)push_symbol(INNER),swap(),push(g[g.length-e-1]),swap(),list(3);p1=pop(),Eval_inner();return}for(l=[],get_innerprod_factors(p1,l),h=[],e=r=0,p=l.length;0<=p?r<p:r>p;e=0<=p?++r:--r)l[e]!==symbol(SYMBOL_IDENTITY_MATRIX)&&h.push(l[e]);if(l=h,h=[],l.length>1){for(_=0,e=i=0,f=l.length;(0<=f?i<f:i>f)&&e+_+1<=l.length-1;e=0<=f?++i:--i){isNumericAtomOrTensor(l[e+_])||isNumericAtomOrTensor(l[e+_+1])?h.push(l[e+_]):(push(l[e+_]),Eval(),inv(),push(l[e+_+1]),Eval(),subtract(),t=pop(),isZeroAtomOrTensor(t)?_+=1:h.push(l[e+_]));if(e+_===l.length-2&&h.push(l[l.length-1]),e+_>=l.length-1)break}l=h}if(push(symbol(INNER)),l.length>0)for(e=n=0,c=l.length;0<=c?n<c:n>c;e=0<=c?++n:--n)push(l[e]);else{pop(),push(symbol(SYMBOL_IDENTITY_MATRIX));return}for(list(l.length+1),p1=pop(),p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),d=[];iscons(p1);)push(car(p1)),Eval(),inner(),d.push(p1=cdr(p1));return d},inner=function(){var t,e,r,i;if(save(),p2=pop(),p1=pop(),isnegativeterm(p2)&&isnegativeterm(p1)&&(push(p2),negate(),p2=pop(),push(p1),negate(),p1=pop()),isinnerordot(p1)&&(t=car(cdr(p1)),e=car(cdr(cdr(p1))),r=p2,p1=t,push(e),push(r),inner(),p2=pop()),p1===symbol(SYMBOL_IDENTITY_MATRIX)){push(p2),restore();return}else if(p2===symbol(SYMBOL_IDENTITY_MATRIX)){push(p1),restore();return}if(istensor(p1)&&istensor(p2))inner_f();else{if(!(isNumericAtomOrTensor(p1)||isNumericAtomOrTensor(p2))&&(push(p1),push(p2),inv(),subtract(),i=pop(),isZeroAtomOrTensor(i))){push_symbol(SYMBOL_IDENTITY_MATRIX),restore();return}if(expanding&&isadd(p1)){for(p1=cdr(p1),push(zero);iscons(p1);)push(car(p1)),push(p2),inner(),add(),p1=cdr(p1);restore();return}if(expanding&&isadd(p2)){for(p2=cdr(p2),push(zero);iscons(p2);)push(p1),push(car(p2)),inner(),add(),p2=cdr(p2);restore();return}if(push(p1),push(p2),istensor(p1)&&isNumericAtom(p2))tensor_times_scalar();else if(isNumericAtom(p1)&&istensor(p2))scalar_times_tensor();else if(isNumericAtom(p1)||isNumericAtom(p2))multiply();else{pop(),pop(),push_symbol(INNER),push(p1),push(p2),list(3),restore();return}}return restore()},inner_f=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L;if(s=0,h=p1.tensor.dim[p1.tensor.ndim-1],h!==p2.tensor.dim[0]){debugger;stop("inner: tensor dimension check")}for(m=p1.tensor.ndim+p2.tensor.ndim-2,m>MAXDIM&&stop("inner: rank of result exceeds maximum"),t=p1.tensor.elem,r=p2.tensor.elem,e=1,s=_=0,b=p1.tensor.ndim-1;0<=b?_<b:_>b;s=0<=b?++_:--_)e*=p1.tensor.dim[s];for(i=1,s=a=1,x=p2.tensor.ndim;1<=x?a<x:a>x;s=1<=x?++a:--a)i*=p2.tensor.dim[s];for(p3=alloc_tensor(e*i),n=p3.tensor.elem,s=u=0,S=e;0<=S?u<S:u>S;s=0<=S?++u:--u)for(l=f=0,T=h;0<=T?f<T:f>T;l=0<=T?++f:--f)if(!isZeroAtomOrTensor(t[s*h+l]))for(p=c=0,I=i;0<=I?c<I:c>I;p=0<=I?++c:--c)push(t[s*h+l]),push(r[l*i+p]),multiply(),push(n[s*i+p]),add(),n[s*i+p]=pop();if(m===0)return push(p3.tensor.elem[0]);for(p3.tensor.ndim=m,l=0,s=d=0,O=p1.tensor.ndim-1;0<=O?d<O:d>O;s=0<=O?++d:--d)p3.tensor.dim[s]=p1.tensor.dim[s];for(l=p1.tensor.ndim-1,s=g=0,L=p2.tensor.ndim-1;0<=L?g<L:g>L;s=0<=L?++g:--g)p3.tensor.dim[l+s]=p2.tensor.dim[s+1];return push(p3)},get_innerprod_factors=function(t,e){if(!iscons(t)){add_factor_to_accumulator(t,e);return}if(cdr(t)===symbol(NIL)){t=get_innerprod_factors(car(t),e);return}if(isinnerordot(t)){get_innerprod_factors(car(cdr(t)),e),get_innerprod_factors(cdr(cdr(t)),e);return}return add_factor_to_accumulator(t,e)},add_factor_to_accumulator=function(t,e){if(t!==symbol(NIL))return e.push(t)},itab=["f(a,a*x)","f(1/x,log(x))","f(x^a,x^(a+1)/(a+1))","f(x^(-2),-x^(-1))","f(x^(-1/2),2*x^(1/2))","f(x^(1/2),2/3*x^(3/2))","f(x,x^2/2)","f(x^2,x^3/3)","f(exp(a*x),1/a*exp(a*x))","f(exp(a*x+b),1/a*exp(a*x+b))","f(x*exp(a*x^2),exp(a*x^2)/(2*a))","f(x*exp(a*x^2+b),exp(a*x^2+b)/(2*a))","f(log(a*x),x*log(a*x)-x)","f(a^x,a^x/log(a),or(not(number(a)),a>0))","f(1/(a+x^2),1/sqrt(a)*arctan(x/sqrt(a)),or(not(number(a)),a>0))","f(1/(a-x^2),1/sqrt(a)*arctanh(x/sqrt(a)))","f(1/sqrt(a-x^2),arcsin(x/(sqrt(a))))","f(1/sqrt(a+x^2),log(x+sqrt(a+x^2)))","f(1/(a+b*x),1/b*log(a+b*x))","f(1/(a+b*x)^2,-1/(b*(a+b*x)))","f(1/(a+b*x)^3,-1/(2*b)*1/(a+b*x)^2)","f(x/(a+b*x),x/b-a*log(a+b*x)/b/b)","f(x/(a+b*x)^2,1/b^2*(log(a+b*x)+a/(a+b*x)))","f(x^2/(a+b*x),1/b^2*(1/2*(a+b*x)^2-2*a*(a+b*x)+a^2*log(a+b*x)))","f(x^2/(a+b*x)^2,1/b^3*(a+b*x-2*a*log(a+b*x)-a^2/(a+b*x)))","f(x^2/(a+b*x)^3,1/b^3*(log(a+b*x)+2*a/(a+b*x)-1/2*a^2/(a+b*x)^2))","f(1/x*1/(a+b*x),-1/a*log((a+b*x)/x))","f(1/x*1/(a+b*x)^2,1/a*1/(a+b*x)-1/a^2*log((a+b*x)/x))","f(1/x*1/(a+b*x)^3,1/a^3*(1/2*((2*a+b*x)/(a+b*x))^2+log(x/(a+b*x))))","f(1/x^2*1/(a+b*x),-1/(a*x)+b/a^2*log((a+b*x)/x))","f(1/x^3*1/(a+b*x),(2*b*x-a)/(2*a^2*x^2)+b^2/a^3*log(x/(a+b*x)))","f(1/x^2*1/(a+b*x)^2,-(a+2*b*x)/(a^2*x*(a+b*x))+2*b/a^3*log((a+b*x)/x))","f(1/(a+b*x^2),1/sqrt(a*b)*arctan(x*sqrt(a*b)/a),or(not(number(a*b)),a*b>0))","f(1/(a+b*x^2),1/(2*sqrt(-a*b))*log((a+x*sqrt(-a*b))/(a-x*sqrt(-a*b))),or(not(number(a*b)),a*b<0))","f(x/(a+b*x^2),1/2*1/b*log(a+b*x^2))","f(x^2/(a+b*x^2),x/b-a/b*integral(1/(a+b*x^2),x))","f(1/(a+b*x^2)^2,x/(2*a*(a+b*x^2))+1/2*1/a*integral(1/(a+b*x^2),x))","f(1/x*1/(a+b*x^2),1/2*1/a*log(x^2/(a+b*x^2)))","f(1/x^2*1/(a+b*x^2),-1/(a*x)-b/a*integral(1/(a+b*x^2),x))","f(1/(a+b*x^3),1/3*1/a*(a/b)^(1/3)*(1/2*log(((a/b)^(1/3)+x)^3/(a+b*x^3))+sqrt(3)*arctan((2*x-(a/b)^(1/3))*(a/b)^(-1/3)/sqrt(3))))","f(x^2/(a+b*x^3),1/3*1/b*log(a+b*x^3))","f(x/(a+b*x^4),1/2*sqrt(b/a)/b*arctan(x^2*sqrt(b/a)),or(not(number(a*b)),a*b>0))","f(x/(a+b*x^4),1/4*sqrt(-b/a)/b*log((x^2-sqrt(-a/b))/(x^2+sqrt(-a/b))),or(not(number(a*b)),a*b<0))","f(x^3/(a+b*x^4),1/4*1/b*log(a+b*x^4))","f(sqrt(a+b*x),2/3*1/b*sqrt((a+b*x)^3))","f(x*sqrt(a+b*x),-2*(2*a-3*b*x)*sqrt((a+b*x)^3)/15/b^2)","f(x^2*sqrt(a+b*x),2*(8*a^2-12*a*b*x+15*b^2*x^2)*sqrt((a+b*x)^3)/105/b^3)","f(sqrt(a+b*x)/x,2*sqrt(a+b*x)+a*integral(1/x*1/sqrt(a+b*x),x))","f(sqrt(a+b*x)/x^2,-sqrt(a+b*x)/x+b/2*integral(1/x*1/sqrt(a+b*x),x))","f(1/sqrt(a+b*x),2*sqrt(a+b*x)/b)","f(x/sqrt(a+b*x),-2/3*(2*a-b*x)*sqrt(a+b*x)/b^2)","f(x^2/sqrt(a+b*x),2/15*(8*a^2-4*a*b*x+3*b^2*x^2)*sqrt(a+b*x)/b^3)","f(1/x*1/sqrt(a+b*x),1/sqrt(a)*log((sqrt(a+b*x)-sqrt(a))/(sqrt(a+b*x)+sqrt(a))),or(not(number(a)),a>0))","f(1/x*1/sqrt(a+b*x),2/sqrt(-a)*arctan(sqrt(-(a+b*x)/a)),or(not(number(a)),a<0))","f(1/x^2*1/sqrt(a+b*x),-sqrt(a+b*x)/a/x-1/2*b/a*integral(1/x*1/sqrt(a+b*x),x))","f(sqrt(x^2+a),1/2*(x*sqrt(x^2+a)+a*log(x+sqrt(x^2+a))))","f(1/sqrt(x^2+a),log(x+sqrt(x^2+a)))","f(1/x*1/sqrt(x^2+a),arcsec(x/sqrt(-a))/sqrt(-a),or(not(number(a)),a<0))","f(1/x*1/sqrt(x^2+a),-1/sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(-a)*arcsec(x/sqrt(-a)),or(not(number(a)),a<0))","f(x/sqrt(x^2+a),sqrt(x^2+a))","f(x*sqrt(x^2+a),1/3*sqrt((x^2+a)^3))","f(sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2+a^(1/3))^3)+3/2*a^(1/3)*x*sqrt(x^2+a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2+a^(1/3)))))","f(sqrt(-a+x^6-3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2-a^(1/3))^3)-3/2*a^(1/3)*x*sqrt(x^2-a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2-a^(1/3)))))","f(1/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),x/a^(1/3)/sqrt(x^2+a^(1/3)))","f(x/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),-1/sqrt(x^2+a^(1/3)))","f(x*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/5*sqrt((x^2+a^(1/3))^5))","f(x^2*sqrt(x^2+a),1/4*x*sqrt((x^2+a)^3)-1/8*a*x*sqrt(x^2+a)-1/8*a^2*log(x+sqrt(x^2+a)))","f(x^3*sqrt(x^2+a),(1/5*x^2-2/15*a)*sqrt((x^2+a)^3),and(number(a),a>0))","f(x^3*sqrt(x^2+a),sqrt((x^2+a)^5)/5-a*sqrt((x^2+a)^3)/3,and(number(a),a<0))","f(x^2/sqrt(x^2+a),1/2*x*sqrt(x^2+a)-1/2*a*log(x+sqrt(x^2+a)))","f(x^3/sqrt(x^2+a),1/3*sqrt((x^2+a)^3)-a*sqrt(x^2+a))","f(1/x^2*1/sqrt(x^2+a),-sqrt(x^2+a)/a/x)","f(1/x^3*1/sqrt(x^2+a),-1/2*sqrt(x^2+a)/a/x^2+1/2*log((sqrt(a)+sqrt(x^2+a))/x)/a^(3/2),or(not(number(a)),a>0))","f(1/x^3*1/sqrt(x^2-a),1/2*sqrt(x^2-a)/a/x^2+1/2*1/(a^(3/2))*arcsec(x/(a^(1/2))),or(not(number(a)),a>0))","f(x^2*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/6*x*sqrt((x^2+a^(1/3))^5)-1/24*a^(1/3)*x*sqrt((x^2+a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2+a^(1/3))-1/16*a*log(x+sqrt(x^2+a^(1/3))),or(not(number(a)),a>0))","f(x^2*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/6*x*sqrt((x^2-a^(1/3))^5)+1/24*a^(1/3)*x*sqrt((x^2-a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2-a^(1/3))+1/16*a*log(x+sqrt(x^2-a^(1/3))),or(not(number(a)),a>0))","f(x^3*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/7*sqrt((x^2+a^(1/3))^7)-1/5*a^(1/3)*sqrt((x^2+a^(1/3))^5),or(not(number(a)),a>0))","f(x^3*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/7*sqrt((x^2-a^(1/3))^7)+1/5*a^(1/3)*sqrt((x^2-a^(1/3))^5),or(not(number(a)),a>0))","f(1/(x-a)/sqrt(x^2-a^2),-sqrt(x^2-a^2)/a/(x-a))","f(1/(x+a)/sqrt(x^2-a^2),sqrt(x^2-a^2)/a/(x+a))","f(sqrt(a-x^2),1/2*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(abs(a)))))","f(1/x*1/sqrt(a-x^2),-1/sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x,sqrt(a-x^2)-sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))","f(x/sqrt(a-x^2),-sqrt(a-x^2))","f(x*sqrt(a-x^2),-1/3*sqrt((a-x^2)^3))","f(x^2*sqrt(a-x^2),-x/4*sqrt((a-x^2)^3)+1/8*a*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(a))),or(not(number(a)),a>0))","f(x^3*sqrt(a-x^2),(-1/5*x^2-2/15*a)*sqrt((a-x^2)^3),or(not(number(a)),a>0))","f(x^2/sqrt(a-x^2),-x/2*sqrt(a-x^2)+a/2*arcsin(x/sqrt(a)),or(not(number(a)),a>0))","f(1/x^2*1/sqrt(a-x^2),-sqrt(a-x^2)/a/x,or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^2,-sqrt(a-x^2)/x-arcsin(x/sqrt(a)),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^3,-1/2*sqrt(a-x^2)/x^2+1/2*log((sqrt(a)+sqrt(a-x^2))/x)/sqrt(a),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^4,-1/3*sqrt((a-x^2)^3)/a/x^3,or(not(number(a)),a>0))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*log(x*sqrt(a)+sqrt(a*x^2+b))/2/sqrt(a),and(number(a),a>0))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*arcsin(x*sqrt(-a/b))/2/sqrt(-a),and(number(a),a<0))","f(sin(a*x),-cos(a*x)/a)","f(cos(a*x),sin(a*x)/a)","f(tan(a*x),-log(cos(a*x))/a)","f(1/tan(a*x),log(sin(a*x))/a)","f(1/cos(a*x),log(tan(pi/4+a*x/2))/a)","f(1/sin(a*x),log(tan(a*x/2))/a)","f(sin(a*x)^2,x/2-sin(2*a*x)/(4*a))","f(sin(a*x)^3,-cos(a*x)*(sin(a*x)^2+2)/(3*a))","f(sin(a*x)^4,3/8*x-sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))","f(cos(a*x)^2,x/2+sin(2*a*x)/(4*a))","f(cos(a*x)^3,sin(a*x)*(cos(a*x)^2+2)/(3*a))","f(cos(a*x)^4,3/8*x+sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))","f(1/sin(a*x)^2,-1/(a*tan(a*x)))","f(1/cos(a*x)^2,tan(a*x)/a)","f(sin(a*x)*cos(a*x),sin(a*x)^2/(2*a))","f(sin(a*x)^2*cos(a*x)^2,-sin(4*a*x)/(32*a)+x/8)","f(sin(a*x)/cos(a*x)^2,1/(a*cos(a*x)))","f(sin(a*x)^2/cos(a*x),(log(tan(pi/4+a*x/2))-sin(a*x))/a)","f(cos(a*x)/sin(a*x)^2,-1/(a*sin(a*x)))","f(1/(sin(a*x)*cos(a*x)),log(tan(a*x))/a)","f(1/(sin(a*x)*cos(a*x)^2),(1/cos(a*x)+log(tan(a*x/2)))/a)","f(1/(sin(a*x)^2*cos(a*x)),(log(tan(pi/4+a*x/2))-1/sin(a*x))/a)","f(1/(sin(a*x)^2*cos(a*x)^2),-2/(a*tan(2*a*x)))","f(sin(a+b*x),-cos(a+b*x)/b)","f(cos(a+b*x),sin(a+b*x)/b)","f(1/(b+b*sin(a*x)),-tan(pi/4-a*x/2)/a/b)","f(1/(b-b*sin(a*x)),tan(pi/4+a*x/2)/a/b)","f(1/(b+b*cos(a*x)),tan(a*x/2)/a/b)","f(1/(b-b*cos(a*x)),-1/tan(a*x/2)/a/b)","f(1/(a+b*sin(x)),1/sqrt(b^2-a^2)*log((a*tan(x/2)+b-sqrt(b^2-a^2))/(a*tan(x/2)+b+sqrt(b^2-a^2))),b^2-a^2)","f(1/(a+b*cos(x)),1/sqrt(b^2-a^2)*log((sqrt(b^2-a^2)*tan(x/2)+a+b)/(sqrt(b^2-a^2)*tan(x/2)-a-b)),b^2-a^2)","f(x*sin(a*x),sin(a*x)/a^2-x*cos(a*x)/a)","f(x^2*sin(a*x),2*x*sin(a*x)/a^2-(a^2*x^2-2)*cos(a*x)/a^3)","f(x*cos(a*x),cos(a*x)/a^2+x*sin(a*x)/a)","f(x^2*cos(a*x),2*x*cos(a*x)/a^2+(a^2*x^2-2)*sin(a*x)/a^3)","f(arcsin(a*x),x*arcsin(a*x)+sqrt(1-a^2*x^2)/a)","f(arccos(a*x),x*arccos(a*x)-sqrt(1-a^2*x^2)/a)","f(arctan(a*x),x*arctan(a*x)-1/2*log(1+a^2*x^2)/a)","f(x*log(a*x),x^2*log(a*x)/2-x^2/4)","f(x^2*log(a*x),x^3*log(a*x)/3-1/9*x^3)","f(log(x)^2,x*log(x)^2-2*x*log(x)+2*x)","f(1/x*1/(a+log(x)),log(a+log(x)))","f(log(a*x+b),(a*x+b)*log(a*x+b)/a-x)","f(log(a*x+b)/x^2,a/b*log(x)-(a*x+b)*log(a*x+b)/b/x)","f(sinh(x),cosh(x))","f(cosh(x),sinh(x))","f(tanh(x),log(cosh(x)))","f(x*sinh(x),x*cosh(x)-sinh(x))","f(x*cosh(x),x*sinh(x)-cosh(x))","f(sinh(x)^2,sinh(2*x)/4-x/2)","f(tanh(x)^2,x-tanh(x))","f(cosh(x)^2,sinh(2*x)/4+x/2)","f(x^3*exp(a*x^2),exp(a*x^2)*(x^2/a-1/(a^2))/2)","f(x^3*exp(a*x^2+b),exp(a*x^2)*exp(b)*(x^2/a-1/(a^2))/2)","f(exp(a*x^2),-i*sqrt(pi)*erf(i*sqrt(a)*x)/sqrt(a)/2)","f(erf(a*x),x*erf(a*x)+exp(-a^2*x^2)/a/sqrt(pi))","f(x^2*(1-x^2)^(3/2),(x*sqrt(1-x^2)*(-8*x^4+14*x^2-3)+3*arcsin(x))/48)","f(x^2*(1-x^2)^(5/2),(x*sqrt(1-x^2)*(48*x^6-136*x^4+118*x^2-15)+15*arcsin(x))/384)","f(x^4*(1-x^2)^(3/2),(-x*sqrt(1-x^2)*(16*x^6-24*x^4+2*x^2+3)+3*arcsin(x))/128)","f(x*exp(a*x),exp(a*x)*(a*x-1)/(a^2))","f(x*exp(a*x+b),exp(a*x+b)*(a*x-1)/(a^2))","f(x^2*exp(a*x),exp(a*x)*(a^2*x^2-2*a*x+2)/(a^3))","f(x^2*exp(a*x+b),exp(a*x+b)*(a^2*x^2-2*a*x+2)/(a^3))","f(x^3*exp(a*x),exp(a*x)*x^3/a-3/a*integral(x^2*exp(a*x),x))","f(x^3*exp(a*x+b),exp(a*x+b)*x^3/a-3/a*integral(x^2*exp(a*x+b),x))",0],Eval_integral=function(){var t,e,r,i,n;for(e=0,p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),p2=pop(),p2===symbol(NIL)?(guess(),push(symbol(NIL))):isNumericAtom(p2)?(guess(),push(p2)):(push(p2),p1=cdr(p1),push(car(p1)),Eval()),p5=pop(),p4=pop(),p3=pop();;){if(isNumericAtom(p5)?(push(p5),e=pop_integer(),isNaN(e)&&stop("nth integral: check n")):e=1,push(p3),e>=0)for(r=0,i=e;0<=i?r<i:r>i;0<=i?++r:--r)push(p4),integral();else for(e=-e,t=0,n=e;0<=n?t<n:t>n;0<=n?++t:--t)push(p4),derivative();if(p3=pop(),p5===symbol(NIL))break;if(isNumericAtom(p5)){if(p1=cdr(p1),push(car(p1)),Eval(),p5=pop(),p5===symbol(NIL))break;isNumericAtom(p5)||(p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop())}else p4=p5,p1=cdr(p1),push(car(p1)),Eval(),p5=pop()}return push(p3)},integral=function(){return save(),p2=pop(),p1=pop(),car(p1)===symbol(ADD)?integral_of_sum():car(p1)===symbol(MULTIPLY)?integral_of_product():integral_of_form(),p1=pop(),Find(p1,symbol(INTEGRAL))&&stop("integral: sorry, could not find a solution"),push(p1),simplify(),Eval(),restore()},integral_of_sum=function(){var t;for(p1=cdr(p1),push(car(p1)),push(p2),integral(),p1=cdr(p1),t=[];iscons(p1);)push(car(p1)),push(p2),integral(),add(),t.push(p1=cdr(p1));return t},integral_of_product=function(){return push(p1),push(p2),partition(),p1=pop(),integral_of_form(),multiply()},integral_of_form=function(){var t,e;if(t=italu_hashcode(p1,p2).toFixed(6),e=hashed_itab[t],!e){push_symbol(INTEGRAL),push(p1),push(p2),list(3);return}return push(p1),push(p2),transform(e,!1),p3=pop(),p3===symbol(NIL)?(push_symbol(INTEGRAL),push(p1),push(p2),list(3)):push(p3)},hashcode_values={x:.95532,constexp:1.43762,constant:1.1441659362941434,constbase:1.2036412230421882,sin:1.7330548251830322,arcsin:1.6483368529465805,cos:1.0586721236863401,arccos:1.8405225918106694,tan:1.1224943776292506,arctan:1.1297397925394963,sinh:1.8176164926060079,cosh:1.9404934661708022,tanh:1.6421307715103122,log:1.477443701354924,erf:1.0825269225702916},italu_hashcode=function(t,e){var r;if(issymbol(t))return equal(t,e)?hashcode_values.x:hashcode_values.constant;if(iscons(t))switch(symnum(car(t))){case ADD:return hash_addition(cdr(t),e);case MULTIPLY:return hash_multiplication(cdr(t),e);case POWER:return hash_power(cadr(t),caddr(t),e);case EXP:return hash_power(symbol(E),cadr(t),e);case SQRT:return push_double(.5),r=pop(),hash_power(cadr(t),r,e);default:return hash_function(t,e)}return hashcode_values.constant},hash_function=function(t,e){var r,i,n;if(!Find(cadr(t),e))return hashcode_values.constant;if(n=car(t),r=italu_hashcode(cadr(t),e),i=hashcode_values[n.printname],!i)throw new Error("Unsupported function "+n.printname);return Math.pow(i,r)},hash_addition=function(t,e){var r,i,n,s,a;for(a={};iscons(t);)n=car(t),t=cdr(t),s=0,Find(n,e)?s=italu_hashcode(n,e):s=hashcode_values.constant,a[s.toFixed(6)]=!0;i=0;for(r in a)hasProp.call(a,r)&&(a[r],i=i+parseFloat(r,10));return i},hash_multiplication=function(t,e){var r,i;for(r=1;iscons(t);)i=car(t),t=cdr(t),Find(i,e)&&(r=r*italu_hashcode(i,e));return r},hash_power=function(t,e,r){var i,n;if(i=hashcode_values.constant,n=hashcode_values.constexp,Find(t,r)&&(i=italu_hashcode(t,r)),Find(e,r))n=italu_hashcode(e,r);else{if(i===hashcode_values.constant)return hashcode_values.constant;isminusone(e)?n=-1:isoneovertwo(e)?n=.5:isminusoneovertwo(e)?n=-.5:equalq(e,2,1)?n=2:equalq(e,-2,1)&&(n=-2)}return Math.pow(i,n)},make_hashed_itab=function(){var t,e,r,i,n,s,a,l;for(a={},n=0,i=itab.length;n<i&&(s=itab[n],!!s);n++)scan_meta(s),t=pop(),l=cadr(t),e=italu_hashcode(l,symbol(METAX)),r=e.toFixed(6),a[r]||(a[r]=[]),a[r].push(s);return console.log("hashed_itab = "+JSON.stringify(a,null,2)),a},$.make_hashed_itab=make_hashed_itab,hashed_itab={"1.144166":["f(a,a*x)"],"1.046770":["f(1/x,log(x))"],"0.936400":["f(x^a,x^(a+1)/(a+1))"],"1.095727":["f(x^(-2),-x^(-1))"],"1.023118":["f(x^(-1/2),2*x^(1/2))"],"0.977405":["f(x^(1/2),2/3*x^(3/2))"],"0.955320":["f(x,x^2/2)"],"0.912636":["f(x^2,x^3/3)"],"1.137302":["f(exp(a*x),1/a*exp(a*x))","f(a^x,a^x/log(a),or(not(number(a)),a>0))"],"1.326774":["f(exp(a*x+b),1/a*exp(a*x+b))"],"1.080259":["f(x*exp(a*x^2),exp(a*x^2)/(2*a))"],"1.260228":["f(x*exp(a*x^2+b),exp(a*x^2+b)/(2*a))"],"1.451902":["f(log(a*x),x*log(a*x)-x)"],"0.486192":["f(1/(a+x^2),1/sqrt(a)*arctan(x/sqrt(a)),or(not(number(a)),a>0))","f(1/(a-x^2),1/sqrt(a)*arctanh(x/sqrt(a)))","f(1/(a+b*x^2),1/sqrt(a*b)*arctan(x*sqrt(a*b)/a),or(not(number(a*b)),a*b>0))","f(1/(a+b*x^2),1/(2*sqrt(-a*b))*log((a+x*sqrt(-a*b))/(a-x*sqrt(-a*b))),or(not(number(a*b)),a*b<0))"],"0.697274":["f(1/sqrt(a-x^2),arcsin(x/(sqrt(a))))","f(1/sqrt(a+x^2),log(x+sqrt(a+x^2)))","f(1/sqrt(x^2+a),log(x+sqrt(x^2+a)))"],"0.476307":["f(1/(a+b*x),1/b*log(a+b*x))"],"0.226868":["f(1/(a+b*x)^2,-1/(b*(a+b*x)))"],"2.904531":["f(1/(a+b*x)^3,-1/(2*b)*1/(a+b*x)^2)"],"0.455026":["f(x/(a+b*x),x/b-a*log(a+b*x)/b/b)"],"0.216732":["f(x/(a+b*x)^2,1/b^2*(log(a+b*x)+a/(a+b*x)))"],"0.434695":["f(x^2/(a+b*x),1/b^2*(1/2*(a+b*x)^2-2*a*(a+b*x)+a^2*log(a+b*x)))"],"0.207048":["f(x^2/(a+b*x)^2,1/b^3*(a+b*x-2*a*log(a+b*x)-a^2/(a+b*x)))"],"2.650781":["f(x^2/(a+b*x)^3,1/b^3*(log(a+b*x)+2*a/(a+b*x)-1/2*a^2/(a+b*x)^2))"],"0.498584":["f(1/x*1/(a+b*x),-1/a*log((a+b*x)/x))"],"0.237479":["f(1/x*1/(a+b*x)^2,1/a*1/(a+b*x)-1/a^2*log((a+b*x)/x))"],"3.040375":["f(1/x*1/(a+b*x)^3,1/a^3*(1/2*((2*a+b*x)/(a+b*x))^2+log(x/(a+b*x))))"],"0.521902":["f(1/x^2*1/(a+b*x),-1/(a*x)+b/a^2*log((a+b*x)/x))"],"0.446014":["f(1/x^3*1/(a+b*x),(2*b*x-a)/(2*a^2*x^2)+b^2/a^3*log(x/(a+b*x)))"],"0.248586":["f(1/x^2*1/(a+b*x)^2,-(a+2*b*x)/(a^2*x*(a+b*x))+2*b/a^3*log((a+b*x)/x))"],"0.464469":["f(x/(a+b*x^2),1/2*1/b*log(a+b*x^2))"],"0.443716":["f(x^2/(a+b*x^2),x/b-a/b*integral(1/(a+b*x^2),x))"],"0.236382":["f(1/(a+b*x^2)^2,x/(2*a*(a+b*x^2))+1/2*1/a*integral(1/(a+b*x^2),x))"],"0.508931":["f(1/x*1/(a+b*x^2),1/2*1/a*log(x^2/(a+b*x^2)))"],"0.532733":["f(1/x^2*1/(a+b*x^2),-1/(a*x)-b/a*integral(1/(a+b*x^2),x))"],"0.480638":["f(1/(a+b*x^3),1/3*1/a*(a/b)^(1/3)*(1/2*log(((a/b)^(1/3)+x)^3/(a+b*x^3))+sqrt(3)*arctan((2*x-(a/b)^(1/3))*(a/b)^(-1/3)/sqrt(3))))"],"0.438648":["f(x^2/(a+b*x^3),1/3*1/b*log(a+b*x^3))"],"0.459164":["f(x/(a+b*x^4),1/2*sqrt(b/a)/b*arctan(x^2*sqrt(b/a)),or(not(number(a*b)),a*b>0))","f(x/(a+b*x^4),1/4*sqrt(-b/a)/b*log((x^2-sqrt(-a/b))/(x^2+sqrt(-a/b))),or(not(number(a*b)),a*b<0))"],"0.450070":["f(x^3/(a+b*x^4),1/4*1/b*log(a+b*x^4))"],"1.448960":["f(sqrt(a+b*x),2/3*1/b*sqrt((a+b*x)^3))"],"1.384221":["f(x*sqrt(a+b*x),-2*(2*a-3*b*x)*sqrt((a+b*x)^3)/15/b^2)"],"1.322374":["f(x^2*sqrt(a+b*x),2*(8*a^2-12*a*b*x+15*b^2*x^2)*sqrt((a+b*x)^3)/105/b^3)"],"1.516728":["f(sqrt(a+b*x)/x,2*sqrt(a+b*x)+a*integral(1/x*1/sqrt(a+b*x),x))"],"1.587665":["f(sqrt(a+b*x)/x^2,-sqrt(a+b*x)/x+b/2*integral(1/x*1/sqrt(a+b*x),x))"],"0.690150":["f(1/sqrt(a+b*x),2*sqrt(a+b*x)/b)"],"0.659314":["f(x/sqrt(a+b*x),-2/3*(2*a-b*x)*sqrt(a+b*x)/b^2)"],"0.629856":["f(x^2/sqrt(a+b*x),2/15*(8*a^2-4*a*b*x+3*b^2*x^2)*sqrt(a+b*x)/b^3)"],"0.722428":["f(1/x*1/sqrt(a+b*x),1/sqrt(a)*log((sqrt(a+b*x)-sqrt(a))/(sqrt(a+b*x)+sqrt(a))),or(not(number(a)),a>0))","f(1/x*1/sqrt(a+b*x),2/sqrt(-a)*arctan(sqrt(-(a+b*x)/a)),or(not(number(a)),a<0))"],"0.756216":["f(1/x^2*1/sqrt(a+b*x),-sqrt(a+b*x)/a/x-1/2*b/a*integral(1/x*1/sqrt(a+b*x),x))"],"1.434156":["f(sqrt(x^2+a),1/2*(x*sqrt(x^2+a)+a*log(x+sqrt(x^2+a))))","f(sqrt(a-x^2),1/2*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(abs(a)))))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*log(x*sqrt(a)+sqrt(a*x^2+b))/2/sqrt(a),and(number(a),a>0))","f(sqrt(a*x^2+b),x*sqrt(a*x^2+b)/2+b*arcsin(x*sqrt(-a/b))/2/sqrt(-a),and(number(a),a<0))"],"0.729886":["f(1/x*1/sqrt(x^2+a),arcsec(x/sqrt(-a))/sqrt(-a),or(not(number(a)),a<0))","f(1/x*1/sqrt(x^2+a),-1/sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(1/x*1/sqrt(a-x^2),-1/sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))"],"1.501230":["f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(a)*log((sqrt(a)+sqrt(x^2+a))/x),or(not(number(a)),a>0))","f(sqrt(x^2+a)/x,sqrt(x^2+a)-sqrt(-a)*arcsec(x/sqrt(-a)),or(not(number(a)),a<0))","f(sqrt(a-x^2)/x,sqrt(a-x^2)-sqrt(a)*log((sqrt(a)+sqrt(a-x^2))/x),or(not(number(a)),a>0))"],"0.666120":["f(x/sqrt(x^2+a),sqrt(x^2+a))","f(x/sqrt(a-x^2),-sqrt(a-x^2))"],"1.370077":["f(x*sqrt(x^2+a),1/3*sqrt((x^2+a)^3))","f(x*sqrt(a-x^2),-1/3*sqrt((a-x^2)^3))"],"1.730087":["f(sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2+a^(1/3))^3)+3/2*a^(1/3)*x*sqrt(x^2+a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2+a^(1/3)))))","f(sqrt(-a+x^6-3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/4*(x*sqrt((x^2-a^(1/3))^3)-3/2*a^(1/3)*x*sqrt(x^2-a^(1/3))+3/2*a^(2/3)*log(x+sqrt(x^2-a^(1/3)))))"],"0.578006":["f(1/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),x/a^(1/3)/sqrt(x^2+a^(1/3)))"],"0.552180":["f(x/sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),-1/sqrt(x^2+a^(1/3)))"],"1.652787":["f(x*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/5*sqrt((x^2+a^(1/3))^5))"],"1.308862":["f(x^2*sqrt(x^2+a),1/4*x*sqrt((x^2+a)^3)-1/8*a*x*sqrt(x^2+a)-1/8*a^2*log(x+sqrt(x^2+a)))","f(x^2*sqrt(a-x^2),-x/4*sqrt((a-x^2)^3)+1/8*a*(x*sqrt(a-x^2)+a*arcsin(x/sqrt(a))),or(not(number(a)),a>0))"],"1.342944":["f(x^3*sqrt(x^2+a),(1/5*x^2-2/15*a)*sqrt((x^2+a)^3),and(number(a),a>0))","f(x^3*sqrt(x^2+a),sqrt((x^2+a)^5)/5-a*sqrt((x^2+a)^3)/3,and(number(a),a<0))","f(x^3*sqrt(a-x^2),(-1/5*x^2-2/15*a)*sqrt((a-x^2)^3),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^3,-1/2*sqrt(a-x^2)/x^2+1/2*log((sqrt(a)+sqrt(a-x^2))/x)/sqrt(a),or(not(number(a)),a>0))","f(sqrt(a-x^2)/x^4,-1/3*sqrt((a-x^2)^3)/a/x^3,or(not(number(a)),a>0))"],"0.636358":["f(x^2/sqrt(x^2+a),1/2*x*sqrt(x^2+a)-1/2*a*log(x+sqrt(x^2+a)))","f(x^2/sqrt(a-x^2),-x/2*sqrt(a-x^2)+a/2*arcsin(x/sqrt(a)),or(not(number(a)),a>0))"],"0.652928":["f(x^3/sqrt(x^2+a),1/3*sqrt((x^2+a)^3)-a*sqrt(x^2+a))","f(1/x^3*1/sqrt(x^2+a),-1/2*sqrt(x^2+a)/a/x^2+1/2*log((sqrt(a)+sqrt(x^2+a))/x)/a^(3/2),or(not(number(a)),a>0))","f(1/x^3*1/sqrt(x^2-a),1/2*sqrt(x^2-a)/a/x^2+1/2*1/(a^(3/2))*arcsec(x/(a^(1/2))),or(not(number(a)),a>0))"],"0.764022":["f(1/x^2*1/sqrt(x^2+a),-sqrt(x^2+a)/a/x)","f(1/x^2*1/sqrt(a-x^2),-sqrt(a-x^2)/a/x,or(not(number(a)),a>0))"],"1.578940":["f(x^2*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/6*x*sqrt((x^2+a^(1/3))^5)-1/24*a^(1/3)*x*sqrt((x^2+a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2+a^(1/3))-1/16*a*log(x+sqrt(x^2+a^(1/3))),or(not(number(a)),a>0))","f(x^2*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/6*x*sqrt((x^2-a^(1/3))^5)+1/24*a^(1/3)*x*sqrt((x^2-a^(1/3))^3)-1/16*a^(2/3)*x*sqrt(x^2-a^(1/3))+1/16*a*log(x+sqrt(x^2-a^(1/3))),or(not(number(a)),a>0))"],"1.620055":["f(x^3*sqrt(a+x^6+3*a^(1/3)*x^4+3*a^(2/3)*x^2),1/7*sqrt((x^2+a^(1/3))^7)-1/5*a^(1/3)*sqrt((x^2+a^(1/3))^5),or(not(number(a)),a>0))","f(x^3*sqrt(-a-3*a^(1/3)*x^4+3*a^(2/3)*x^2+x^6),1/7*sqrt((x^2-a^(1/3))^7)+1/5*a^(1/3)*sqrt((x^2-a^(1/3))^5),or(not(number(a)),a>0))"],"0.332117":["f(1/(x-a)/sqrt(x^2-a^2),-sqrt(x^2-a^2)/a/(x-a))","f(1/(x+a)/sqrt(x^2-a^2),sqrt(x^2-a^2)/a/(x+a))"],"1.571443":["f(sqrt(a-x^2)/x^2,-sqrt(a-x^2)/x-arcsin(x/sqrt(a)),or(not(number(a)),a>0))"],"1.690994":["f(sin(a*x),-cos(a*x)/a)"],"1.055979":["f(cos(a*x),sin(a*x)/a)"],"1.116714":["f(tan(a*x),-log(cos(a*x))/a)"],"0.895484":["f(1/tan(a*x),log(sin(a*x))/a)"],"0.946989":["f(1/cos(a*x),log(tan(pi/4+a*x/2))/a)"],"0.591368":["f(1/sin(a*x),log(tan(a*x/2))/a)"],"2.859462":["f(sin(a*x)^2,x/2-sin(2*a*x)/(4*a))"],"2.128050":["f(sin(a*x)^3,-cos(a*x)*(sin(a*x)^2+2)/(3*a))","f(sin(a*x)^4,3/8*x-sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))"],"1.115091":["f(cos(a*x)^2,x/2+sin(2*a*x)/(4*a))"],"1.081452":["f(cos(a*x)^3,sin(a*x)*(cos(a*x)^2+2)/(3*a))","f(cos(a*x)^4,3/8*x+sin(2*a*x)/(4*a)+sin(4*a*x)/(32*a))"],"0.349716":["f(1/sin(a*x)^2,-1/(a*tan(a*x)))"],"0.896788":["f(1/cos(a*x)^2,tan(a*x)/a)"],"1.785654":["f(sin(a*x)*cos(a*x),sin(a*x)^2/(2*a))"],"3.188560":["f(sin(a*x)^2*cos(a*x)^2,-sin(4*a*x)/(32*a)+x/8)"],"1.516463":["f(sin(a*x)/cos(a*x)^2,1/(a*cos(a*x)))"],"2.707879":["f(sin(a*x)^2/cos(a*x),(log(tan(pi/4+a*x/2))-sin(a*x))/a)"],"0.369293":["f(cos(a*x)/sin(a*x)^2,-1/(a*sin(a*x)))"],"0.560019":["f(1/(sin(a*x)*cos(a*x)),log(tan(a*x))/a)"],"0.530332":["f(1/(sin(a*x)*cos(a*x)^2),(1/cos(a*x)+log(tan(a*x/2)))/a)"],"0.331177":["f(1/(sin(a*x)^2*cos(a*x)),(log(tan(pi/4+a*x/2))-1/sin(a*x))/a)"],"0.313621":["f(1/(sin(a*x)^2*cos(a*x)^2),-2/(a*tan(2*a*x)))"],"3.172365":["f(sin(a+b*x),-cos(a+b*x)/b)"],"1.127162":["f(cos(a+b*x),sin(a+b*x)/b)"],"0.352714":["f(1/(b+b*sin(a*x)),-tan(pi/4-a*x/2)/a/b)","f(1/(b-b*sin(a*x)),tan(pi/4+a*x/2)/a/b)","f(1/(a+b*sin(x)),1/sqrt(b^2-a^2)*log((a*tan(x/2)+b-sqrt(b^2-a^2))/(a*tan(x/2)+b+sqrt(b^2-a^2))),b^2-a^2)"],"0.454515":["f(1/(b+b*cos(a*x)),tan(a*x/2)/a/b)","f(1/(b-b*cos(a*x)),-1/tan(a*x/2)/a/b)","f(1/(a+b*cos(x)),1/sqrt(b^2-a^2)*log((sqrt(b^2-a^2)*tan(x/2)+a+b)/(sqrt(b^2-a^2)*tan(x/2)-a-b)),b^2-a^2)"],"1.615441":["f(x*sin(a*x),sin(a*x)/a^2-x*cos(a*x)/a)"],"1.543263":["f(x^2*sin(a*x),2*x*sin(a*x)/a^2-(a^2*x^2-2)*cos(a*x)/a^3)"],"1.008798":["f(x*cos(a*x),cos(a*x)/a^2+x*sin(a*x)/a)"],"0.963724":["f(x^2*cos(a*x),2*x*cos(a*x)/a^2+(a^2*x^2-2)*sin(a*x)/a^3)"],"1.611938":["f(arcsin(a*x),x*arcsin(a*x)+sqrt(1-a^2*x^2)/a)"],"1.791033":["f(arccos(a*x),x*arccos(a*x)-sqrt(1-a^2*x^2)/a)"],"1.123599":["f(arctan(a*x),x*arctan(a*x)-1/2*log(1+a^2*x^2)/a)"],"1.387031":["f(x*log(a*x),x^2*log(a*x)/2-x^2/4)"],"1.325058":["f(x^2*log(a*x),x^3*log(a*x)/3-1/9*x^3)"],"2.108018":["f(log(x)^2,x*log(x)^2-2*x*log(x)+2*x)"],"0.403214":["f(1/x*1/(a+log(x)),log(a+log(x)))"],"2.269268":["f(log(a*x+b),(a*x+b)*log(a*x+b)/a-x)"],"2.486498":["f(log(a*x+b)/x^2,a/b*log(x)-(a*x+b)*log(a*x+b)/b/x)"],"1.769733":["f(sinh(x),cosh(x))"],"1.883858":["f(cosh(x),sinh(x))"],"1.606140":["f(tanh(x),log(cosh(x)))"],"1.690661":["f(x*sinh(x),x*cosh(x)-sinh(x))"],"1.799688":["f(x*cosh(x),x*sinh(x)-cosh(x))"],"3.131954":["f(sinh(x)^2,sinh(2*x)/4-x/2)"],"2.579685":["f(tanh(x)^2,x-tanh(x))"],"3.548923":["f(cosh(x)^2,sinh(2*x)/4+x/2)"],"1.058866":["f(x^3*exp(a*x^2),exp(a*x^2)*(x^2/a-1/(a^2))/2)"],"1.235270":["f(x^3*exp(a*x^2+b),exp(a*x^2)*exp(b)*(x^2/a-1/(a^2))/2)"],"1.130783":["f(exp(a*x^2),-i*sqrt(pi)*erf(i*sqrt(a)*x)/sqrt(a)/2)"],"1.078698":["f(erf(a*x),x*erf(a*x)+exp(-a^2*x^2)/a/sqrt(pi))"],"2.573650":["f(x^2*(1-x^2)^(3/2),(x*sqrt(1-x^2)*(-8*x^4+14*x^2-3)+3*arcsin(x))/48)","f(x^2*(1-x^2)^(5/2),(x*sqrt(1-x^2)*(48*x^6-136*x^4+118*x^2-15)+15*arcsin(x))/384)"],"2.640666":["f(x^4*(1-x^2)^(3/2),(-x*sqrt(1-x^2)*(16*x^6-24*x^4+2*x^2+3)+3*arcsin(x))/128)"],"1.086487":["f(x*exp(a*x),exp(a*x)*(a*x-1)/(a^2))"],"1.267493":["f(x*exp(a*x+b),exp(a*x+b)*(a*x-1)/(a^2))"],"1.037943":["f(x^2*exp(a*x),exp(a*x)*(a^2*x^2-2*a*x+2)/(a^3))"],"1.210862":["f(x^2*exp(a*x+b),exp(a*x+b)*(a^2*x^2-2*a*x+2)/(a^3))"],"1.064970":["f(x^3*exp(a*x),exp(a*x)*x^3/a-3/a*integral(x^2*exp(a*x),x))"],"1.242392":["f(x^3*exp(a*x+b),exp(a*x+b)*x^3/a-3/a*integral(x^2*exp(a*x+b),x))"]},INV_check_arg=function(){return istensor(p1)?p1.tensor.ndim!==2||p1.tensor.dim[0]!==p1.tensor.dim[1]?0:1:0},inv=function(){var t,e,r,i;if(save(),p1=pop(),isinv(p1)){push(car(cdr(p1))),restore();return}if(isidentitymatrix(p1)){push(p1),restore();return}if(expanding&&isinnerordot(p1)){for(p1=cdr(p1),t=[];iscons(p1);)t.push(car(p1)),p1=cdr(p1);for(e=r=i=t.length-1;i<=0?r<=0:r>=0;e=i<=0?++r:--r)push(t[e]),inv(),e!==t.length-1&&inner();restore();return}if(INV_check_arg()===0){push_symbol(INV),push(p1),list(2),restore();return}return isNumericAtomOrTensor(p1)?yyinvg():(push(p1),adj(),push(p1),det(),p2=pop(),isZeroAtomOrTensor(p2)&&stop("inverse of singular matrix"),push(p2),divide()),restore()},invg=function(){if(save(),p1=pop(),INV_check_arg()===0){push_symbol(INVG),push(p1),list(2),restore();return}return yyinvg(),restore()},yyinvg=function(){var t,e,r,i,n,s,a,l,u,p,f,c;for(t=0,e=0,i=0,a=0,a=p1.tensor.dim[0],t=tos,e=l=0,u=a;0<=u?l<u:l>u;e=0<=u?++l:--l)for(i=r=0,p=a;0<=p?r<p:r>p;i=0<=p?++r:--r)push(e===i?one:zero);for(e=n=0,f=a*a;0<=f?n<f:n>f;e=0<=f?++n:--n)push(p1.tensor.elem[e]);for(INV_decomp(a),p1=alloc_tensor(a*a),p1.tensor.ndim=2,p1.tensor.dim[0]=a,p1.tensor.dim[1]=a,e=s=0,c=a*a;0<=c?s<c:s>c;e=0<=c?++s:--s)p1.tensor.elem[e]=stack[t+e];return moveTos(tos-2*a*a),push(p1)},INV_decomp=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_;for(e=0,r=0,i=0,s=0,_=0,e=tos-t*t,_=e-t*t,m=[],r=u=0,p=t;0<=p?u<p:u>p;r=0<=p?++u:--u){if(equal(stack[e+t*r+r],zero)){for(i=n=f=r+1,c=t;(f<=c?n<c:n>c)&&equal(stack[e+t*i+r],zero);i=f<=c?++n:--n);for(i===t&&stop("inverse of singular matrix"),s=a=0,h=t;0<=h?a<h:a>h;s=0<=h?++a:--a)p2=stack[e+t*r+s],stack[e+t*r+s]=stack[e+t*i+s],stack[e+t*i+s]=p2,p2=stack[_+t*r+s],stack[_+t*r+s]=stack[_+t*i+s],stack[_+t*i+s]=p2}for(p2=stack[e+t*r+r],s=l=0,d=t;0<=d?l<d:l>d;s=0<=d?++l:--l)s>r&&(push(stack[e+t*r+s]),push(p2),divide(),stack[e+t*r+s]=pop()),push(stack[_+t*r+s]),push(p2),divide(),stack[_+t*r+s]=pop();m.push(function(){var g,b,x;for(x=[],i=g=0,b=t;0<=b?g<b:g>b;i=0<=b?++g:--g)i!==r&&(p2=stack[e+t*i+r],x.push(function(){var S,T,I;for(I=[],s=S=0,T=t;0<=T?S<T:S>T;s=0<=T?++S:--S)s>r&&(push(stack[e+t*i+s]),push(stack[e+t*r+s]),push(p2),multiply(),subtract(),stack[e+t*i+s]=pop()),push(stack[_+t*i+s]),push(stack[_+t*r+s]),push(p2),multiply(),subtract(),I.push(stack[_+t*i+s]=pop());return I}()));return x}())}return m},DEBUG_IS=!1,isZeroAtom=function(t){switch(t.k){case NUM:return MZERO(t.q.a);case DOUBLE:return t.d===0;default:return!1}},isZeroTensor=function(t){var e,r,i;if(t.k!==TENSOR)return 0;for(e=r=0,i=t.tensor.nelem;0<=i?r<i:r>i;e=0<=i?++r:--r)if(!isZeroAtomOrTensor(t.tensor.elem[e]))return 0;return 1},isZeroAtomOrTensor=function(t){return isZeroAtom(t)||isZeroTensor(t)},isZeroLikeOrNonZeroLikeOrUndetermined=function(t){var e;if(push(t),Eval_predicate(),e=pop(),isZeroAtomOrTensor(e))return 0;if(isNumericAtomOrTensor(e))return 1;if(push(e),zzfloat(),e=pop(),isZeroAtomOrTensor(e))return 0;if(isNumericAtomOrTensor(e))return 1;if(Find(e,imaginaryunit)){if(push(e),absValFloat(),Eval_predicate(),e=pop(),isZeroAtomOrTensor(e))return 0;if(isNumericAtomOrTensor(e))return 1}return null},isnegativenumber=function(t){switch(t.k){case NUM:if(MSIGN(t.q.a)===-1)return 1;break;case DOUBLE:if(t.d<0)return 1}return 0},ispositivenumber=function(t){switch(t.k){case NUM:if(MSIGN(t.q.a)===1)return 1;break;case DOUBLE:if(t.d>0)return 1}return 0},isplustwo=function(t){switch(t.k){case NUM:if(MEQUAL(t.q.a,2)&&MEQUAL(t.q.b,1))return 1;break;case DOUBLE:if(t.d===2)return 1}return 0},isplusone=function(t){switch(t.k){case NUM:if(MEQUAL(t.q.a,1)&&MEQUAL(t.q.b,1))return 1;break;case DOUBLE:if(t.d===1)return 1}return 0},isminusone=function(t){switch(t.k){case NUM:if(MEQUAL(t.q.a,-1)&&MEQUAL(t.q.b,1))return 1;break;case DOUBLE:if(t.d===-1)return 1}return 0},isone=function(t){return isplusone(t)||isminusone(t)},isinteger=function(t){return t.k===NUM&&MEQUAL(t.q.b,1)?1:0},isintegerorintegerfloat=function(t){return t.k===DOUBLE?t.d===Math.round(t.d)?1:0:isinteger(t)},isnonnegativeinteger=function(t){return isrational(t)&&MEQUAL(t.q.b,1)&&MSIGN(t.q.a)===1?1:0},isposint=function(t){return isinteger(t)&&MSIGN(t.q.a)===1?1:0},isunivarpolyfactoredorexpandedform=function(t,e){return DEBUG&&console.log("isunivarpolyfactoredorexpandedform: p: "+t+" x: "+e),e==null&&(push(t),guess(),e=pop(),pop()),ispolyfactoredorexpandedform(t,e)&&Find(t,symbol(SYMBOL_X))+Find(t,symbol(SYMBOL_Y))+Find(t,symbol(SYMBOL_Z))===1?e:0},ispolyfactoredorexpandedform=function(t,e){return ispolyfactoredorexpandedform_factor(t,e)},ispolyfactoredorexpandedform_factor=function(t,e){if(car(t)===symbol(MULTIPLY)){for(t=cdr(t);iscons(t);){if(DEBUG&&console.log("ispolyfactoredorexpandedform_factor testing "+car(t)),!ispolyfactoredorexpandedform_power(car(t),e))return DEBUG&&console.log("... tested negative:"+car(t)),0;t=cdr(t)}return 1}else return ispolyfactoredorexpandedform_power(t,e)},ispolyfactoredorexpandedform_power=function(t,e){return car(t)===symbol(POWER)?(DEBUG&&console.log("ispolyfactoredorexpandedform_power (isposint(caddr(p)) "+(isposint(caddr(t)),DEBUG?console.log("ispolyfactoredorexpandedform_power ispolyexpandedform_expr(cadr(p), x)) "+ispolyexpandedform_expr(cadr(t),e)):void 0)),isposint(caddr(t))&&ispolyexpandedform_expr(cadr(t),e)):(DEBUG&&console.log("ispolyfactoredorexpandedform_power not a power, testing if this is exp form: "+t),ispolyexpandedform_expr(t,e))},ispolyexpandedform=function(t,e){return Find(t,e)?ispolyexpandedform_expr(t,e):0},ispolyexpandedform_expr=function(t,e){if(car(t)===symbol(ADD)){for(t=cdr(t);iscons(t);){if(!ispolyexpandedform_term(car(t),e))return 0;t=cdr(t)}return 1}else return ispolyexpandedform_term(t,e)},ispolyexpandedform_term=function(t,e){if(car(t)===symbol(MULTIPLY)){for(t=cdr(t);iscons(t);){if(!ispolyexpandedform_factor(car(t),e))return 0;t=cdr(t)}return 1}else return ispolyexpandedform_factor(t,e)},ispolyexpandedform_factor=function(t,e){return equal(t,e)?1:car(t)===symbol(POWER)&&equal(cadr(t),e)?isposint(caddr(t))?1:0:Find(t,e)?0:1},isnegativeterm=function(t){return isnegativenumber(t)||car(t)===symbol(MULTIPLY)&&isnegativenumber(cadr(t))?1:0},hasNegativeRationalExponent=function(t){return car(t)===symbol(POWER)&&isrational(car(cdr(cdr(t))))&&isnegativenumber(car(cdr(t)))?(DEBUG_IS&&console.log("hasNegativeRationalExponent: "+t.toString()+" has imaginary component"),1):(DEBUG_IS&&console.log("hasNegativeRationalExponent: "+t.toString()+" has NO imaginary component"),0)},isimaginarynumberdouble=function(t){return car(t)===symbol(MULTIPLY)&&length(t)===3&&isdouble(cadr(t))&&hasNegativeRationalExponent(caddr(t))||equal(t,imaginaryunit)?1:0},isimaginarynumber=function(t){return car(t)===symbol(MULTIPLY)&&length(t)===3&&isNumericAtom(cadr(t))&&equal(caddr(t),imaginaryunit)||equal(t,imaginaryunit)||hasNegativeRationalExponent(caddr(t))?(DEBUG_IS&&console.log("isimaginarynumber: "+t.toString()+" is imaginary number"),1):(DEBUG_IS&&console.log("isimaginarynumber: "+t.toString()+" isn't an imaginary number"),0)},iscomplexnumberdouble=function(t){return car(t)===symbol(ADD)&&length(t)===3&&isdouble(cadr(t))&&isimaginarynumberdouble(caddr(t))||isimaginarynumberdouble(t)?1:0},iscomplexnumber=function(t){if(DEBUG_IS)debugger;return car(t)===symbol(ADD)&&length(t)===3&&isNumericAtom(cadr(t))&&isimaginarynumber(caddr(t))||isimaginarynumber(t)?(DEBUG&&console.log("iscomplexnumber: "+t.toString()+" is imaginary number"),1):(DEBUG&&console.log("iscomplexnumber: "+t.toString()+" is imaginary number"),0)},iseveninteger=function(t){return isinteger(t)&&t.q.a.isEven()?1:0},isnegative=function(t){return car(t)===symbol(ADD)&&isnegativeterm(cadr(t))||isnegativeterm(t)?1:0},issymbolic=function(t){if(issymbol(t))return 1;for(;iscons(t);){if(issymbolic(car(t)))return 1;t=cdr(t)}return 0},isintegerfactor=function(t){return isinteger(t)||car(t)===symbol(POWER)&&isinteger(cadr(t))&&isinteger(caddr(t))},isNumberOneOverSomething=function(t){return isfraction(t)&&MEQUAL(t.q.a.abs(),1)},isoneover=function(t){return car(t)===symbol(POWER)&&isminusone(caddr(t))},isfraction=function(t){return t.k===NUM&&!MEQUAL(t.q.b,1)},equaln=function(t,e){switch(t.k){case NUM:return MEQUAL(t.q.a,e)&&MEQUAL(t.q.b,1);case DOUBLE:return t.d===e;default:return!1}},equalq=function(t,e,r){switch(t.k){case NUM:return MEQUAL(t.q.a,e)&&MEQUAL(t.q.b,r);case DOUBLE:return t.d===e/r;default:return!1}},isoneovertwo=function(t){return equalq(t,1,2)},isminusoneovertwo=function(t){return equalq(t,-1,2)},isoneoversqrttwo=function(t){return car(t)===symbol(POWER)&&equaln(cadr(t),2)&&equalq(caddr(t),-1,2)},isminusoneoversqrttwo=function(t){return car(t)===symbol(MULTIPLY)&&equaln(cadr(t),-1)&&isoneoversqrttwo(caddr(t))&&length(t)===3},issqrtthreeovertwo=function(t){return car(t)===symbol(MULTIPLY)&&isoneovertwo(cadr(t))&&issqrtthree(caddr(t))&&length(t)===3},isminussqrtthreeovertwo=function(t){return car(t)===symbol(MULTIPLY)&&isminusoneovertwo(cadr(t))&&issqrtthree(caddr(t))&&length(t)===3},issqrtthree=function(t){return car(t)===symbol(POWER)&&equaln(cadr(t),3)&&isoneovertwo(caddr(t))},isfloating=function(t){if(t.k===DOUBLE||t===symbol(FLOATF))return 1;for(;iscons(t);){if(isfloating(car(t)))return 1;t=cdr(t)}return 0},isimaginaryunit=function(t){return equal(t,imaginaryunit)?1:0},isquarterturn=function(t){var e,r;if(r=0,e=0,car(t)!==symbol(MULTIPLY))return 0;if(equal(cadr(t),imaginaryunit))return caddr(t)!==symbol(PI)||length(t)!==3?0:2;if(!isNumericAtom(cadr(t))||!equal(caddr(t),imaginaryunit)||cadddr(t)!==symbol(PI)||length(t)!==4||(push(cadr(t)),push_integer(2),multiply(),r=pop_integer(),isNaN(r)))return 0;switch(r<1&&(e=1,r=-r),r%4){case 0:r=1;break;case 1:e?r=4:r=3;break;case 2:r=2;break;case 3:e?r=3:r=4}return r},isnpi=function(t){var e;return e=0,t===symbol(PI)?2:!(car(t)===symbol(MULTIPLY)&&isNumericAtom(cadr(t))&&caddr(t)===symbol(PI)&&length(t)===3)||(push(cadr(t)),push_integer(2),multiply(),e=pop_integer(),isNaN(e))?0:(e<0?e=4- -e%4:e=1+(e-1)%4,e)},$.isZeroAtomOrTensor=isZeroAtomOrTensor,$.isnegativenumber=isnegativenumber,$.isplusone=isplusone,$.isminusone=isminusone,$.isinteger=isinteger,$.isnonnegativeinteger=isnonnegativeinteger,$.isposint=isposint,$.isnegativeterm=isnegativeterm,$.isimaginarynumber=isimaginarynumber,$.iscomplexnumber=iscomplexnumber,$.iseveninteger=iseveninteger,$.isnegative=isnegative,$.issymbolic=issymbolic,$.isintegerfactor=isintegerfactor,$.isoneover=isoneover,$.isfraction=isfraction,$.isoneoversqrttwo=isoneoversqrttwo,$.isminusoneoversqrttwo=isminusoneoversqrttwo,$.isfloating=isfloating,$.isimaginaryunit=isimaginaryunit,$.isquarterturn=isquarterturn,$.isnpi=isnpi,Eval_isprime=function(){return push(cadr(p1)),Eval(),p1=pop(),isnonnegativeinteger(p1)&&mprime(p1.q.a)?push_integer(1):push_integer(0)},Eval_laguerre=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),p2=pop(),p2===symbol(NIL)?push_integer(0):push(p2),laguerre()},laguerre=function(){var t;if(t=0,save(),p3=pop(),p2=pop(),p1=pop(),push(p2),t=pop_integer(),t<0||isNaN(t)){push_symbol(LAGUERRE),push(p1),push(p2),push(p3),list(4),restore();return}return issymbol(p1)?laguerre2(t):(p4=p1,p1=symbol(SECRETX),laguerre2(t),p1=p4,push(symbol(SECRETX)),push(p1),subst(),Eval()),restore()},laguerre2=function(t){var e,r,i,n;for(e=0,push_integer(1),push_integer(0),p6=pop(),n=[],e=r=0,i=t;0<=i?r<i:r>i;e=0<=i?++r:--r)p5=p6,p6=pop(),push_integer(2*e+1),push(p1),subtract(),push(p3),add(),push(p6),multiply(),push_integer(e),push(p3),add(),push(p5),multiply(),subtract(),push_integer(e+1),n.push(divide());return n},Eval_lcm=function(){var t;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),t=[];iscons(p1);)push(car(p1)),Eval(),lcm(),t.push(p1=cdr(p1));return t},lcm=function(){var t;return t=expanding,save(),yylcm(),restore(),expanding=t},yylcm=function(){return expanding=1,p2=pop(),p1=pop(),push(p1),push(p2),gcd(),push(p1),divide(),push(p2),divide(),inverse()},Eval_leading=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),p1=pop(),p1===symbol(NIL)?guess():push(p1),leading()},leading=function(){return save(),p2=pop(),p1=pop(),push(p1),push(p2),degree(),p3=pop(),push(p1),push(p2),push(p3),power(),divide(),push(p2),filter(),restore()},Eval_legendre=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),p2=pop(),p2===symbol(NIL)?push_integer(0):push(p2),legendre()},legendre=function(){return save(),__legendre(),restore()},__legendre=function(){var t,e;if(t=0,e=0,p3=pop(),p2=pop(),p1=pop(),push(p2),e=pop_integer(),push(p3),t=pop_integer(),e<0||isNaN(e)||t<0||isNaN(t)){push_symbol(LEGENDRE),push(p1),push(p2),push(p3),list(4);return}return issymbol(p1)?__legendre2(e,t):(p4=p1,p1=symbol(SECRETX),__legendre2(e,t),p1=p4,push(symbol(SECRETX)),push(p1),subst(),Eval()),__legendre3(t)},__legendre2=function(t,e){var r,i,n,s,a,l;for(r=0,push_integer(1),push_integer(0),p6=pop(),r=n=0,s=t;0<=s?n<s:n>s;r=0<=s?++n:--n)p5=p6,p6=pop(),push_integer(2*r+1),push(p1),multiply(),push(p6),multiply(),push_integer(r),push(p5),multiply(),subtract(),push_integer(r+1),divide();for(l=[],r=i=0,a=e;0<=a?i<a:i>a;r=0<=a?++i:--i)push(p1),l.push(derivative());return l},__legendre3=function(t){if(t!==0&&(car(p1)===symbol(COS)?(push(cadr(p1)),sine(),square()):car(p1)===symbol(SIN)?(push(cadr(p1)),cosine(),square()):(push_integer(1),push(p1),square(),subtract()),push_integer(t),push_rational(1,2),multiply(),power(),multiply(),t%2))return negate()},list=function(t){var e,r,i;for(push(symbol(NIL)),i=[],e=0,r=t;0<=r?e<r:e>r;0<=r?++e:--e)i.push(cons());return i},Eval_log=function(){return push(cadr(p1)),Eval(),logarithm()},logarithm=function(){return save(),yylog(),restore()},yylog=function(){var t;if(t=0,p1=pop(),p1===symbol(E)){push_integer(1);return}if(equaln(p1,1)){push_integer(0);return}if(isnegativenumber(p1)){push(p1),negate(),logarithm(),push(imaginaryunit),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),multiply(),add();return}if(isdouble(p1)){t=Math.log(p1.d),push_double(t);return}if(isfraction(p1)){push(p1),numerator(),logarithm(),push(p1),denominator(),logarithm(),subtract();return}if(car(p1)===symbol(POWER)){push(caddr(p1)),push(cadr(p1)),logarithm(),multiply();return}if(car(p1)===symbol(MULTIPLY)){for(push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),logarithm(),add(),p1=cdr(p1);return}return push_symbol(LOG),push(p1),list(2)},Eval_lookup=function(){return p1=cadr(p1),!iscons(p1)&&cadr(p1).k===SYM&&(p1=get_binding(p1)),push(p1)},madd=function(t,e){return t.add(e)},msub=function(t,e){return t.subtract(e)},mgcd=function(t,e){return bigInt.gcd(t,e)},new_string=function(t){var e;return e=new U,e.k=STR,e.str=t,e},push_zero_matrix=function(t,e){return push(alloc_tensor(t*e)),stack[tos-1].tensor.ndim=2,stack[tos-1].tensor.dim[0]=t,stack[tos-1].tensor.dim[1]=e},equal=function(t,e){return cmp_expr(t,e)===0?1:0},lessp=function(t,e){return cmp_expr(t,e)<0?1:0},sign=function(t){return t<0?-1:t>0?1:0},cmp_expr=function(t,e){var r;if(r=0,t===e)return 0;if(t===symbol(NIL))return-1;if(e===symbol(NIL))return 1;if(isNumericAtom(t)&&isNumericAtom(e))return sign(compare_numbers(t,e));if(isNumericAtom(t))return-1;if(isNumericAtom(e))return 1;if(isstr(t)&&isstr(e))return sign(strcmp(t.str,e.str));if(isstr(t))return-1;if(isstr(e))return 1;if(issymbol(t)&&issymbol(e))return sign(strcmp(get_printname(t),get_printname(e)));if(issymbol(t))return-1;if(issymbol(e))return 1;if(istensor(t)&&istensor(e))return compare_tensors(t,e);if(istensor(t))return-1;if(istensor(e))return 1;for(;iscons(t)&&iscons(e);){if(r=cmp_expr(car(t),car(e)),r!==0)return r;t=cdr(t),e=cdr(e)}return iscons(e)?-1:iscons(t)?1:0},length=function(t){var e;for(e=0;iscons(t);)t=cdr(t),e++;return e},yyexpand=function(){var t;return t=expanding,expanding=1,Eval(),expanding=t},exponential=function(){return push_symbol(E),swap(),power()},square=function(){return push_integer(2),power()},sort_stack=function(t){var e,r;return e=tos-t,r=stack.slice(e,e+t),r.sort(cmp_expr),stack=stack.slice(0,e).concat(r).concat(stack.slice(e+t))},$.equal=equal,$.length=length,mmul=function(t,e){return t.multiply(e)},mdiv=function(t,e){return t.divide(e)},mmod=function(t,e){return t.mod(e)},mdivrem=function(t,e){var r;return r=t.divmod(e),[r.quotient,r.remainder]},Eval_mod=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),mod()},mod=function(){var t;if(t=0,save(),p2=pop(),p1=pop(),isZeroAtomOrTensor(p2)&&stop("mod function: divide by zero"),!isNumericAtom(p1)||!isNumericAtom(p2)){push_symbol(MOD),push(p1),push(p2),list(3),restore();return}return isdouble(p1)&&(push(p1),t=pop_integer(),isNaN(t)&&stop("mod function: cannot convert float value to integer"),push_integer(t),p1=pop()),isdouble(p2)&&(push(p2),t=pop_integer(),isNaN(t)&&stop("mod function: cannot convert float value to integer"),push_integer(t),p2=pop()),(!isinteger(p1)||!isinteger(p2))&&stop("mod function: integer arguments expected"),p3=new U,p3.k=NUM,p3.q.a=mmod(p1.q.a,p2.q.a),p3.q.b=mint(1),push(p3),restore()},mpow=function(t,e){return t.pow(e)},mprime=function(t){return t.isProbablePrime()},mroot=function(t,e){var r,i,n,s,a,l,u;for(t=t.abs(),r=0,i=0,n=0,e===0&&stop("root index is zero"),n=0;t.shiftRight(n)>0;)n++;if(n===0)return mint(0);for(n=Math.floor((n-1)/e),i=Math.floor(n/32+1),l=bigInt(i),r=s=0,a=i;0<=a?s<a:s>a;r=0<=a?++s:--s)l=l.and(bigInt(1).shiftLeft(r).not());for(;n>=0;){switch(l=l.or(bigInt(1).shiftLeft(n)),u=mpow(l,e),mcmp(u,t)){case 0:return l;case 1:l=l.and(bigInt(1).shiftLeft(n).not())}n--}return 0},DEBUG_MULTIPLY=!1,Eval_multiply=function(){var t;for(push(cadr(p1)),Eval(),p1=cddr(p1),t=[];iscons(p1);)push(car(p1)),Eval(),multiply(),t.push(p1=cdr(p1));return t},multiply=function(){return esc_flag&&stop("escape key stop"),isNumericAtom(stack[tos-2])&&isNumericAtom(stack[tos-1])?multiply_numbers():(save(),yymultiply(),restore())},yymultiply=function(){var t,e,r,i,n,s;if(t=0,e=0,r=0,p2=pop(),p1=pop(),t=tos,isZeroAtom(p1)||isZeroAtom(p2)){evaluatingAsFloats?push_double(0):push(zero);return}if(expanding&&isadd(p1)){for(p1=cdr(p1),evaluatingAsFloats?push_double(0):push(zero);iscons(p1);)push(car(p1)),push(p2),multiply(),add(),p1=cdr(p1);return}if(expanding&&isadd(p2)){for(p2=cdr(p2),evaluatingAsFloats?push_double(0):push(zero);iscons(p2);)push(p1),push(car(p2)),multiply(),add(),p2=cdr(p2);return}if(!istensor(p1)&&istensor(p2)){push(p1),push(p2),scalar_times_tensor();return}if(istensor(p1)&&!istensor(p2)){push(p1),push(p2),tensor_times_scalar();return}for(car(p1)===symbol(MULTIPLY)?p1=cdr(p1):(push(p1),list(1),p1=pop()),car(p2)===symbol(MULTIPLY)?p2=cdr(p2):(push(p2),list(1),p2=pop()),isNumericAtom(car(p1))&&isNumericAtom(car(p2))?(push(car(p1)),push(car(p2)),multiply_numbers(),p1=cdr(p1),p2=cdr(p2)):isNumericAtom(car(p1))?(push(car(p1)),p1=cdr(p1)):isNumericAtom(car(p2))?(push(car(p2)),p2=cdr(p2)):evaluatingAsFloats?push_double(1):push(one),parse_p1(),parse_p2();iscons(p1)&&iscons(p2);){if(caar(p1)===symbol(OPERATOR)&&caar(p2)===symbol(OPERATOR)){push_symbol(OPERATOR),push(cdar(p1)),push(cdar(p2)),append(),cons(),p1=cdr(p1),p2=cdr(p2),parse_p1(),parse_p2();continue}switch(cmp_expr(p3,p4)){case-1:push(car(p1)),p1=cdr(p1),parse_p1();break;case 1:push(car(p2)),p2=cdr(p2),parse_p2();break;case 0:combine_factors(t),p1=cdr(p1),p2=cdr(p2),parse_p1(),parse_p2();break;default:stop("internal error 2")}}for(;iscons(p1);)push(car(p1)),p1=cdr(p1);for(;iscons(p2);)push(car(p2)),p2=cdr(p2);if(__normalize_radical_factors(t),expanding){for(e=i=n=t,s=tos;n<=s?i<s:i>s;e=n<=s?++i:--i)if(isadd(stack[e])){multiply_all(tos-t);return}}if(r=tos-t,r!==1){if(isrational(stack[t])&&equaln(stack[t],1)){r===2?(p7=pop(),pop(),push(p7)):(stack[t]=symbol(MULTIPLY),list(r));return}return list(r),p7=pop(),push_symbol(MULTIPLY),push(p7),cons()}},parse_p1=function(){if(p3=car(p1),p5=evaluatingAsFloats?one_as_double:one,car(p3)===symbol(POWER))return p5=caddr(p3),p3=cadr(p3)},parse_p2=function(){if(p4=car(p2),p6=evaluatingAsFloats?one_as_double:one,car(p4)===symbol(POWER))return p6=caddr(p4),p4=cadr(p4)},combine_factors=function(t){return push(p4),push(p5),push(p6),add(),power(),p7=pop(),isNumericAtom(p7)?(push(stack[t]),push(p7),multiply_numbers(),stack[t]=pop()):car(p7)===symbol(MULTIPLY)&&isNumericAtom(cadr(p7))&&cdddr(p7)===symbol(NIL)?(push(stack[t]),push(cadr(p7)),multiply_numbers(),stack[t]=pop(),push(caddr(p7))):push(p7)},multiply_noexpand=function(){var t;return t=expanding,expanding=0,multiply(),expanding=t},multiply_all=function(t){var e,r,i,n;if(r=0,t!==1){if(t===0){push(evaluatingAsFloats?one_as_double:one);return}for(e=tos-t,push(stack[e]),r=i=1,n=t;1<=n?i<n:i>n;r=1<=n?++i:--i)push(stack[e+r]),multiply();return stack[e]=pop(),moveTos(e+1)}},multiply_all_noexpand=function(t){var e;return e=expanding,expanding=0,multiply_all(t),expanding=e},divide=function(){return isNumericAtom(stack[tos-2])&&isNumericAtom(stack[tos-1])?divide_numbers():(inverse(),multiply())},inverse=function(){return isNumericAtom(stack[tos-1])?invert_number():(push_integer(-1),power())},reciprocate=function(){return inverse()},negate=function(){return isNumericAtom(stack[tos-1])?negate_number():(evaluatingAsFloats?push_double(-1):push_integer(-1),multiply())},negate_noexpand=function(){var t;return t=expanding,expanding=0,negate(),expanding=t},__normalize_radical_factors=function(t){var e,r,i,n,s,a,l,u,p,f;if(e=0,!(isplusone(stack[t])||isminusone(stack[t])||isdouble(stack[t]))){for(e=n=s=t+1,a=tos;(s<=a?n<a:n>a)&&!__is_radical_number(stack[e]);e=s<=a?++n:--n);if(e!==tos){for(save(),push(stack[t]),mp_numerator(),DEBUG_MULTIPLY&&console.log("__normalize_radical_factors numerator: "+stack[tos-1]),p1=pop(),e=r=l=t+1,u=tos;(l<=u?r<u:r>u)&&!(isplusone(p1)||isminusone(p1));e=l<=u?++r:--r)__is_radical_number(stack[e])&&(p3=cadr(stack[e]),p4=caddr(stack[e]),isnegativenumber(p4)&&(push(p1),push(p3),divide(),p5=pop(),isinteger(p5)&&(p1=p5,push_symbol(POWER),push(p3),push(evaluatingAsFloats?one_as_double:one),push(p4),add(),list(3),stack[e]=pop())));for(push(stack[t]),mp_denominator(),DEBUG_MULTIPLY&&console.log("__normalize_radical_factors denominator: "+stack[tos-1]),p2=pop(),e=i=p=t+1,f=tos;(p<=f?i<f:i>f)&&!isplusone(p2);e=p<=f?++i:--i)if(__is_radical_number(stack[e])&&(p3=cadr(stack[e]),p4=caddr(stack[e]),!isnegativenumber(p4)&&(push(p2),push(p3),divide(),p5=pop(),!!isinteger(p5)))){if(DEBUG_MULTIPLY&&console.log("__new radical p5: "+p5.toString()),DEBUG_MULTIPLY&&console.log("__new radical top stack: "+stack[tos-1]),p2=p5,push_symbol(POWER),push(p3),push(p4),DEBUG_MULTIPLY&&console.log("__new radical p3: "+p3.toString()),DEBUG_MULTIPLY&&console.log("__new radical p4: "+p4.toString()),push(one),subtract(),dontCreateNewRadicalsInDenominatorWhenEvalingMultiplication&&isinteger(p3)&&!isinteger(stack[tos-1])&&isnegativenumber(stack[tos-1])){pop(),pop(),pop(),push(p1),push(p3),divide(),p1=pop();break}DEBUG_MULTIPLY&&console.log("__new radical exponent: "+stack[tos-1]),list(3),stack[e]=pop()}return push(p1),push(p2),divide(),stack[t]=pop(),restore()}}},__is_radical_number=function(t){return car(t)===symbol(POWER)&&isNumericAtom(cadr(t))&&isfraction(caddr(t))&&!isminusone(cadr(t))},NROOTS_YMAX=101,NROOTS_DELTA=1e-6,NROOTS_EPSILON=1e-9,NROOTS_ABS=function(t){return Math.sqrt(t.r*t.r+t.i*t.i)},NROOTS_RANDOM=function(){return 4*Math.random()-2},numericRootOfPolynomial=(function(){class t{}return t.prototype.r=0,t.prototype.i=0,t}).call(this),nroots_a=new numericRootOfPolynomial,nroots_b=new numericRootOfPolynomial,nroots_x=new numericRootOfPolynomial,nroots_y=new numericRootOfPolynomial,nroots_fa=new numericRootOfPolynomial,nroots_fb=new numericRootOfPolynomial,nroots_dx=new numericRootOfPolynomial,nroots_df=new numericRootOfPolynomial,nroots_c=[],initNRoots=o=0,ref=NROOTS_YMAX;0<=ref?o<ref:o>ref;initNRoots=0<=ref?++o:--o)nroots_c[initNRoots]=new numericRootOfPolynomial;for(Eval_nroots=function(){var t,e,r,i,n,s,a,l,u;for(t=0,e=0,n=0,a=0,push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),p2=pop(),p2===symbol(NIL)?guess():push(p2),p2=pop(),p1=pop(),ispolyexpandedform(p1,p2)||stop("nroots: polynomial?"),t=tos,a=coeff(p2,p1),a>NROOTS_YMAX&&stop("nroots: degree?"),e=r=0,l=a;0<=l?r<l:r>l;e=0<=l?++r:--r)push(stack[t+e]),real(),yyfloat(),Eval(),p1=pop(),push(stack[t+e]),imag(),yyfloat(),Eval(),p2=pop(),(!isdouble(p1)||!isdouble(p2))&&stop("nroots: coefficients?"),nroots_c[e].r=p1.d,nroots_c[e].i=p2.d;for(moveTos(t),monic(a),n=i=a;i>1;n=i+=-1)findroot(n),Math.abs(nroots_a.r)<NROOTS_DELTA&&(nroots_a.r=0),Math.abs(nroots_a.i)<NROOTS_DELTA&&(nroots_a.i=0),push_double(nroots_a.r),push_double(nroots_a.i),push(imaginaryunit),multiply(),add(),NROOTS_divpoly(n);if(a=tos-t,a>1){for(sort_stack(a),p1=alloc_tensor(a),p1.tensor.ndim=1,p1.tensor.dim[0]=a,e=s=0,u=a;0<=u?s<u:s>u;e=0<=u?++s:--s)p1.tensor.elem[e]=stack[t+e];return moveTos(t),push(p1)}},monic=function(t){var e,r,i,n;for(r=0,n=0,nroots_y.r=nroots_c[t-1].r,nroots_y.i=nroots_c[t-1].i,n=nroots_y.r*nroots_y.r+nroots_y.i*nroots_y.i,r=e=0,i=t-1;0<=i?e<i:e>i;r=0<=i?++e:--e)nroots_c[r].r=(nroots_c[r].r*nroots_y.r+nroots_c[r].i*nroots_y.i)/n,nroots_c[r].i=(nroots_c[r].i*nroots_y.r-nroots_c[r].r*nroots_y.i)/n;return nroots_c[t-1].r=1,nroots_c[t-1].i=0},findroot=function(t){var e,r,i,n;if(n=0,NROOTS_ABS(nroots_c[0])<NROOTS_DELTA){nroots_a.r=0,nroots_a.i=0;return}for(e=0;e<100;++e)for(nroots_a.r=NROOTS_RANDOM(),nroots_a.i=NROOTS_RANDOM(),compute_fa(t),nroots_b.r=nroots_a.r,nroots_b.i=nroots_a.i,nroots_fb.r=nroots_fa.r,nroots_fb.i=nroots_fa.i,nroots_a.r=NROOTS_RANDOM(),nroots_a.i=NROOTS_RANDOM(),r=0;r<1e3;++r){if(compute_fa(t),i=NROOTS_ABS(nroots_fa),DEBUG&&console.log("nrabs: "+i),i<NROOTS_EPSILON)return;if(NROOTS_ABS(nroots_fa)<NROOTS_ABS(nroots_fb)&&(nroots_x.r=nroots_a.r,nroots_x.i=nroots_a.i,nroots_a.r=nroots_b.r,nroots_a.i=nroots_b.i,nroots_b.r=nroots_x.r,nroots_b.i=nroots_x.i,nroots_x.r=nroots_fa.r,nroots_x.i=nroots_fa.i,nroots_fa.r=nroots_fb.r,nroots_fa.i=nroots_fb.i,nroots_fb.r=nroots_x.r,nroots_fb.i=nroots_x.i),nroots_dx.r=nroots_b.r-nroots_a.r,nroots_dx.i=nroots_b.i-nroots_a.i,nroots_df.r=nroots_fb.r-nroots_fa.r,nroots_df.i=nroots_fb.i-nroots_fa.i,n=nroots_df.r*nroots_df.r+nroots_df.i*nroots_df.i,n===0)break;nroots_y.r=(nroots_dx.r*nroots_df.r+nroots_dx.i*nroots_df.i)/n,nroots_y.i=(nroots_dx.i*nroots_df.r-nroots_dx.r*nroots_df.i)/n,nroots_a.r=nroots_b.r-(nroots_y.r*nroots_fb.r-nroots_y.i*nroots_fb.i),nroots_a.i=nroots_b.i-(nroots_y.r*nroots_fb.i+nroots_y.i*nroots_fb.r)}return stop("nroots: convergence error")},compute_fa=function(t){var e,r,i,n,s;for(r=0,s=0,nroots_x.r=nroots_a.r,nroots_x.i=nroots_a.i,nroots_fa.r=nroots_c[0].r+nroots_c[1].r*nroots_x.r-nroots_c[1].i*nroots_x.i,nroots_fa.i=nroots_c[0].i+nroots_c[1].r*nroots_x.i+nroots_c[1].i*nroots_x.r,n=[],r=e=2,i=t;2<=i?e<i:e>i;r=2<=i?++e:--e)s=nroots_a.r*nroots_x.r-nroots_a.i*nroots_x.i,nroots_x.i=nroots_a.r*nroots_x.i+nroots_a.i*nroots_x.r,nroots_x.r=s,nroots_fa.r+=nroots_c[r].r*nroots_x.r-nroots_c[r].i*nroots_x.i,n.push(nroots_fa.i+=nroots_c[r].r*nroots_x.i+nroots_c[r].i*nroots_x.r);return n},NROOTS_divpoly=function(t){var e,r,i,n,s,a;for(i=0,i=e=n=t-1;n<=0?e<0:e>0;i=n<=0?++e:--e)nroots_c[i-1].r+=nroots_c[i].r*nroots_a.r-nroots_c[i].i*nroots_a.i,nroots_c[i-1].i+=nroots_c[i].i*nroots_a.r+nroots_c[i].r*nroots_a.i;for(NROOTS_ABS(nroots_c[0])>NROOTS_DELTA&&stop("nroots: residual error"),a=[],i=r=0,s=t-1;0<=s?r<s:r>s;i=0<=s?++r:--r)nroots_c[i].r=nroots_c[i+1].r,a.push(nroots_c[i].i=nroots_c[i+1].i);return a},Eval_numerator=function(){return push(cadr(p1)),Eval(),numerator()},numerator=function(){var t,e;if(t=0,e=pop(),car(e)===symbol(ADD)&&(push(e),rationalize(),e=pop()),car(e)===symbol(MULTIPLY)&&!isplusone(car(cdr(e)))){for(t=tos,e=cdr(e);iscons(e);)push(car(e)),numerator(),e=cdr(e);return multiply_all(tos-t)}else return isrational(e)?(push(e),mp_numerator()):car(e)===symbol(POWER)&&isnegativeterm(caddr(e))?push(one):push(e)},Eval_outer=function(){var t;for(p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),t=[];iscons(p1);)push(car(p1)),Eval(),outer(),t.push(p1=cdr(p1));return t},outer=function(){return save(),p2=pop(),p1=pop(),istensor(p1)&&istensor(p2)?yyouter():(push(p1),push(p2),istensor(p1)?tensor_times_scalar():istensor(p2)?scalar_times_tensor():multiply()),restore()},yyouter=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h;for(t=0,r=0,n=0,l=0,u=0,l=p1.tensor.ndim+p2.tensor.ndim,l>MAXDIM&&stop("outer: rank of result exceeds maximum"),u=p1.tensor.nelem*p2.tensor.nelem,p3=alloc_tensor(u),p3.tensor.ndim=l,t=e=0,p=p1.tensor.ndim;0<=p?e<p:e>p;t=0<=p?++e:--e)p3.tensor.dim[t]=p1.tensor.dim[t];for(r=t,t=i=0,f=p2.tensor.ndim;0<=f?i<f:i>f;t=0<=f?++i:--i)p3.tensor.dim[r+t]=p2.tensor.dim[t];for(n=0,t=s=0,c=p1.tensor.nelem;0<=c?s<c:s>c;t=0<=c?++s:--s)for(r=a=0,h=p2.tensor.nelem;0<=h?a<h:a>h;r=0<=h?++a:--a)push(p1.tensor.elem[t]),push(p2.tensor.elem[r]),multiply(),p3.tensor.elem[n++]=pop();return push(p3)},partition=function(){for(save(),p2=pop(),p1=pop(),push_integer(1),p3=pop(),p4=p3,p1=cdr(p1);iscons(p1);)Find(car(p1),p2)?(push(p4),push(car(p1)),multiply(),p4=pop()):(push(p3),push(car(p1)),multiply(),p3=pop()),p1=cdr(p1);return push(p3),push(p4),restore()},Eval_silentpattern=function(){return Eval_pattern(),pop(),push_symbol(NIL)},Eval_pattern=function(){var t,e,r,i,n;return iscons(cdr(p1))||stop("pattern needs at least a template and a transformed version"),t=car(cdr(p1)),r=car(cdr(cdr(p1))),r===symbol(NIL)&&stop("pattern needs at least a template and a transformed version"),iscons(cdr(cdr(p1)))?n=car(cdr(cdr(cdr(p1)))):n=symbol(NIL),equal(t,r)&&stop("recursive pattern"),i="template: "+print_list(t),i+=" tests: "+print_list(n),DEBUG&&console.log("pattern stringkey: "+i),e=userSimplificationsInStringForm.indexOf(i),e===-1?(userSimplificationsInStringForm.push(i),userSimplificationsInListForm.push(cdr(p1))):(DEBUG&&console.log("pattern already exists, replacing. "+cdr(p1)),userSimplificationsInStringForm[e]=i,userSimplificationsInListForm[e]=cdr(p1)),push_symbol(PATTERN),push(cdr(p1)),list(2)},do_clearPatterns=function(){return userSimplificationsInListForm=[],userSimplificationsInStringForm=[]},Eval_clearpatterns=function(){return do_clearPatterns(),push_symbol(NIL)},Eval_patternsinfo=function(){var t;return t=patternsinfo(),t!==""?push(new_string(t)):push_symbol(NIL)},patternsinfo=function(){var t,e,r;for(r="",t=0,e=userSimplificationsInListForm.length;t<e;t++)userSimplificationsInListForm[t],r+=userSimplificationsInListForm+`
`;return r},Eval_polar=function(){return push(cadr(p1)),Eval(),polar()},polar=function(){return evaluatingPolar++,save(),p1=pop(),push(p1),abs(),push(imaginaryunit),push(p1),arg(),multiply(),exponential(),multiply(),evaluatingPolar--,restore()},n_factor_number=0,factor_number=function(){var t;if(t=0,save(),p1=pop(),equaln(p1,0)||equaln(p1,1)||equaln(p1,-1)){push(p1),restore();return}return n_factor_number=p1.q.a,t=tos,factor_a(),tos-t>1&&(list(tos-t),push_symbol(MULTIPLY),swap(),cons()),restore()},factor_a=function(){var t,e;for(e=0,n_factor_number.isNegative()&&(n_factor_number=setSignTo(n_factor_number,1),push_integer(-1)),e=t=0;t<1e4;e=++t)if(try_kth_prime(e),n_factor_number.compare(1)===0)return;return factor_b()},try_kth_prime=function(t){var e,r,i,n;for(e=0,r=mint(primetab[t]),e=0;;){if(n_factor_number.compare(1)===0){e&&push_factor(r,e);return}if([i,n]=mdivrem(n_factor_number,r),n.isZero())e++,n_factor_number=i;else break}if(e&&push_factor(r,e),mcmp(i,r)===-1)return push_factor(n_factor_number,1),n_factor_number=mint(1)},factor_b=function(){var t,e,r,i,n,s,a;for(r=0,i=0,t=mint(1),s=mint(5),a=mint(2),r=1,i=1;;){if(mprime(n_factor_number))return push_factor(n_factor_number,1),0;for(;;){if(esc_flag&&stop("esc"),n=msub(a,s),n=setSignTo(n,1),e=mgcd(n,n_factor_number),MEQUAL(e,1)){--r===0&&(a=s,i*=2,r=i),n=mmul(s,s),s=madd(n,t),n=mmod(s,n_factor_number),s=n;continue}if(push_factor(e,1),mcmp(e,n_factor_number)===0)return-1;n=mdiv(n_factor_number,e),n_factor_number=n,n=mmod(s,n_factor_number),s=n,n=mmod(a,n_factor_number),a=n;break}}},push_factor=function(t,e){if(p1=new U,p1.k=NUM,p1.q.a=t,p1.q.b=mint(1),push(p1),e>1)return push_symbol(POWER),swap(),p1=new U,p1.k=NUM,p1.q.a=mint(e),p1.q.b=mint(1),push(p1),list(3)},DEBUG_POWER=!1,Eval_power=function(){if(DEBUG_POWER)debugger;return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),power()},power=function(){return save(),yypower(),restore()},yypower=function(){var t,e,r,i,n,s,a;if(DEBUG_POWER)debugger;if(a=0,p2=pop(),p1=pop(),i=p2,r=p1,DEBUG_POWER&&console.log("POWER: "+p1+" ^ "+p2),equal(p1,one)||isZeroAtomOrTensor(p2)){evaluatingAsFloats?push_double(1):push(one),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(equal(p2,one)){push(p1),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(isminusone(p1)&&isminusone(p2)){evaluatingAsFloats?push_double(1):push(one),negate(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(isminusone(p1)&&isoneovertwo(p2)){push(imaginaryunit),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(isminusone(p1)&&isminusoneovertwo(p2)){push(imaginaryunit),negate(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(isminusone(p1)&&!isdouble(p1)&&isrational(p2)&&!isinteger(p2)&&ispositivenumber(p2)&&!evaluatingAsFloats){DEBUG_POWER&&console.log("   power: -1 ^ rational"),DEBUG_POWER&&console.log(" trick: p2.q.a , p2.q.b "+p2.q.a+" , "+p2.q.b),p2.q.a<p2.q.b?(push_symbol(POWER),push(p1),push(p2),list(3)):(push_symbol(MULTIPLY),push(p1),push_symbol(POWER),push(p1),push_rational(p2.q.a.mod(p2.q.b),p2.q.b),list(3),list(3),DEBUG_POWER&&console.log(" trick applied : "+stack[tos-1])),rect(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(isrational(p1)&&isrational(p2)){DEBUG_POWER&&console.log("   power: isrational(p1) && isrational(p2)"),push(p1),push(p2),qpow(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(isNumericAtom(p1)&&isNumericAtom(p2)){DEBUG_POWER&&console.log("   power: both base and exponent are either rational or double "),DEBUG_POWER&&console.log("POWER - isNumericAtom(p1) && isNumericAtom(p2)"),push(p1),push(p2),dpow(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(istensor(p1)){DEBUG_POWER&&console.log("   power: istensor(p1) "),power_tensor(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(car(p1)===symbol(ABS)&&iseveninteger(p2)&&!isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))){DEBUG_POWER&&console.log("   power: even power of absolute of real value "),push(cadr(p1)),push(p2),power(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(p1===symbol(E)&&car(p2)===symbol(LOG)){push(cadr(p2)),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(p1===symbol(E)&&isdouble(p2)){DEBUG_POWER&&console.log("   power: p1 == symbol(E) && isdouble(p2) "),push_double(Math.exp(p2.d)),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(p1===symbol(E)&&Find(p2,imaginaryunit)!==0&&Find(p2,symbol(PI))!==0&&!evaluatingPolar&&(push_symbol(POWER),push(p1),push(p2),list(3),DEBUG_POWER&&console.log("   power: turning complex exponential to rect: "+stack[tos-1]),rect(),e=pop(),Find(e,symbol(PI))===0)){DEBUG_POWER&&console.log("   power: turned complex exponential to rect: "+e),push(e);return}if(car(p1)===symbol(MULTIPLY)&&isinteger(p2)){for(DEBUG_POWER&&console.log("   power: (a * b) ^ c  ->  (a ^ c) * (b ^ c) "),p1=cdr(p1),push(car(p1)),push(p2),power(),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),power(),multiply(),p1=cdr(p1);DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(s=!1,isNumericAtom(cadr(p1))&&(s=sign(compare_numbers(cadr(p1),zero))),car(p1)===symbol(POWER)&&(isinteger(p2)||s)){push(cadr(p1)),push(caddr(p1)),push(p2),multiply(),power(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(t=!1,iseveninteger(caddr(p1))&&(push(caddr(p1)),push(p2),multiply(),n=pop(),isone(n)&&(t=!0)),car(p1)===symbol(POWER)&&t){DEBUG_POWER&&console.log("   power: car(p1) == symbol(POWER) && b_isEven_and_c_isItsInverse "),push(cadr(p1)),abs(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(expanding&&isadd(p1)&&isNumericAtom(p2)&&(push(p2),a=pop_integer(),a>1&&!isNaN(a))){DEBUG_POWER&&console.log("   power: expanding && isadd(p1) && isNumericAtom(p2) "),power_sum(a),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(trigmode===1&&car(p1)===symbol(SIN)&&iseveninteger(p2)){DEBUG_POWER&&console.log("   power: trigmode == 1 && car(p1) == symbol(SIN) && iseveninteger(p2) "),push_integer(1),push(cadr(p1)),cosine(),push_integer(2),power(),subtract(),push(p2),push_rational(1,2),multiply(),power(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(trigmode===2&&car(p1)===symbol(COS)&&iseveninteger(p2)){DEBUG_POWER&&console.log("   power: trigmode == 2 && car(p1) == symbol(COS) && iseveninteger(p2) "),push_integer(1),push(cadr(p1)),sine(),push_integer(2),power(),subtract(),push(p2),push_rational(1,2),multiply(),power(),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(iscomplexnumber(p1)){if(DEBUG_POWER&&console.log(" power - handling the case (a + ib) ^ n"),isinteger(p2)){push(p1),conjugate(),p3=pop(),push(p3),push(p3),push(p1),multiply(),divide(),isone(p2)||(push(p2),negate(),power()),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}if(isNumericAtom(p2)){push(p1),abs(),push(p2),power(),push_integer(-1),push(p1),arg(),push(p2),multiply(),evaluatingAsFloats||iscomplexnumberdouble(p1)&&isdouble(p2)?push_double(Math.PI):push(symbol(PI)),divide(),power(),multiply(),avoidCalculatingPowersIntoArctans&&Find(stack[tos-1],symbol(ARCTAN))&&(pop(),push_symbol(POWER),push(p1),push(p2),list(3)),DEBUG_POWER&&console.log("   power of "+r+" ^ "+i+": "+stack[tos-1]);return}}if(simplify_polar()){DEBUG_POWER&&console.log("   power: using simplify_polar");return}if(DEBUG_POWER&&console.log("   power: nothing can be done "),push_symbol(POWER),push(p1),push(p2),list(3),DEBUG_POWER)return console.log("   power of "+r+" ^ "+i+": "+stack[tos-1])},power_sum=function(t){var e,r,i,n,s,a,l,u,p,f;for(e=[],r=0,n=0,a=0,a=length(p1)-1,push_frame(a*(t+1)),p1=cdr(p1),r=i=0,u=a;0<=u?i<u:i>u;r=0<=u?++i:--i){for(n=s=0,p=t;0<=p?s<=p:s>=p;n=0<=p?++s:--s)push(car(p1)),push_integer(n),power(),stack[frame+r*(t+1)+n]=pop();p1=cdr(p1)}for(push_integer(t),factorial(),p1=pop(),r=l=0,f=a;0<=f?l<f:l>f;r=0<=f?++l:--l)e[r]=0;return push(zero),multinomial_sum(a,t,e,0,t),pop_frame(a*(t+1))},multinomial_sum=function(t,e,r,i,n){var s,a,l,u,p,f,c;if(a=0,i<t-1){for(a=s=0,p=n;0<=p?s<=p:s>=p;a=0<=p?++s:--s)r[i]=a,multinomial_sum(t,e,r,i+1,n-a);return}for(r[i]=n,push(p1),a=l=0,f=t;0<=f?l<f:l>f;a=0<=f?++l:--l)push_integer(r[a]),factorial(),divide();for(a=u=0,c=t;0<=c?u<c:u>c;a=0<=c?++u:--u)push(stack[frame+a*(e+1)+r[a]]),multiply();return add()},simplify_polar=function(){var t;switch(t=0,t=isquarterturn(p2),t){case 0:break;case 1:return push_integer(1),1;case 2:return push_integer(-1),1;case 3:return push(imaginaryunit),1;case 4:return push(imaginaryunit),negate(),1}if(car(p2)===symbol(ADD)){for(p3=cdr(p2);iscons(p3)&&(t=isquarterturn(car(p3)),!t);)p3=cdr(p3);switch(t){case 0:return 0;case 1:push_integer(1);break;case 2:push_integer(-1);break;case 3:push(imaginaryunit);break;case 4:push(imaginaryunit),negate()}return push(p2),push(car(p3)),subtract(),exponential(),multiply(),1}return 0},Eval_prime=function(){return push(cadr(p1)),Eval(),prime()},prime=function(){var t;return t=0,t=pop_integer(),(t<1||t>MAXPRIMETAB)&&stop("prime: Argument out of range."),t=primetab[t-1],push_integer(t)},power_str="^",codeGen=!1,Eval_print=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),printMode),push(symbol(NIL))},Eval_print2dascii=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_2DASCII),push(symbol(NIL))},Eval_printcomputer=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_COMPUTER),push(symbol(NIL))},Eval_printlatex=function(){return stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_LATEX),push(symbol(NIL))},Eval_printhuman=function(){var t;return t=test_flag,test_flag=0,stringsEmittedByUserPrintouts+=_print(cdr(p1),PRINTMODE_HUMAN),test_flag=t,push(symbol(NIL))},Eval_printlist=function(){var t;return t=_print(cdr(p1),PRINTMODE_LIST),stringsEmittedByUserPrintouts+=t,push(symbol(NIL))},_print=function(t,e){var r,i;for(r="";iscons(t);)push(car(t)),Eval(),p2=pop(),i=printMode,e===PRINTMODE_COMPUTER?(printMode=PRINTMODE_COMPUTER,r=printline(p2),rememberPrint(r,LAST_FULL_PRINT)):e===PRINTMODE_HUMAN?(printMode=PRINTMODE_HUMAN,r=printline(p2),rememberPrint(r,LAST_PLAIN_PRINT)):e===PRINTMODE_2DASCII?(printMode=PRINTMODE_2DASCII,r=print2dascii(p2),rememberPrint(r,LAST_2DASCII_PRINT)):e===PRINTMODE_LATEX?(printMode=PRINTMODE_LATEX,r=printline(p2),rememberPrint(r,LAST_LATEX_PRINT)):e===PRINTMODE_LIST&&(printMode=PRINTMODE_LIST,r=print_list(p2),rememberPrint(r,LAST_LIST_PRINT)),printMode=i,t=cdr(t);return DEBUG&&console.log("emttedString from display: "+stringsEmittedByUserPrintouts),r},rememberPrint=function(t,e){var r;return scan('"'+t+'"'),r=pop(),set_binding(symbol(e),r)},print_str=function(t){return DEBUG&&console.log("emttedString from print_str: "+stringsEmittedByUserPrintouts),t},print_char=function(t){return t},collectLatexStringFromReturnValue=function(t){var e,r,i;return e=printMode,printMode=PRINTMODE_LATEX,r=codeGen,codeGen=!1,i=print_expr(t),i=i.replace(/_/g,"\\_"),printMode=e,codeGen=r,DEBUG&&console.log("emttedString from collectLatexStringFromReturnValue: "+stringsEmittedByUserPrintouts),i},printline=function(t){var e;return e="",e+=print_expr(t),e},print_base_of_denom=function(t){var e;return e="",isfraction(t)||car(t)===symbol(ADD)||car(t)===symbol(MULTIPLY)||car(t)===symbol(POWER)||lessp(t,zero)?(e+=print_char("("),e+=print_expr(t),e+=print_char(")")):e+=print_expr(t),e},print_expo_of_denom=function(t){var e;return e="",isfraction(t)||car(t)===symbol(ADD)||car(t)===symbol(MULTIPLY)||car(t)===symbol(POWER)?(e+=print_char("("),e+=print_expr(t),e+=print_char(")")):e+=print_expr(t),e},print_denom=function(t,e){var r;return r="",save(),p1=cadr(t),p2=caddr(t),isminusone(p2)?(r+=print_base_of_denom(p1),restore(),r):(e===1&&(r+=print_char("(")),push(p2),negate(),p2=pop(),r+=print_power(p1,p2),e===1&&(r+=print_char(")")),restore(),r)},print_a_over_b=function(t){var e,r,i;for(e="",flag=0,i=0,r=0,save(),i=0,r=0,p1=cdr(t),p2=car(p1),isrational(p2)?(push(p2),mp_numerator(),absval(),p3=pop(),push(p2),mp_denominator(),p4=pop(),isplusone(p3)||i++,isplusone(p4)||r++,p1=cdr(p1)):(p3=one,p4=one);iscons(p1);)p2=car(p1),is_denominator(p2)?r++:i++,p1=cdr(p1);if(printMode===PRINTMODE_LATEX&&(e+=print_str("\\frac{")),i===0)e+=print_char("1");else for(flag=0,p1=cdr(t),isrational(car(p1))&&(p1=cdr(p1)),isplusone(p3)||(e+=print_factor(p3),flag=1);iscons(p1);)p2=car(p1),is_denominator(p2)||(flag&&(e+=print_multiply_sign()),e+=print_factor(p2),flag=1),p1=cdr(p1);for(printMode===PRINTMODE_LATEX?e+=print_str("}{"):printMode===PRINTMODE_HUMAN&&!test_flag?e+=print_str(" / "):e+=print_str("/"),r>1&&printMode!==PRINTMODE_LATEX&&(e+=print_char("(")),flag=0,p1=cdr(t),isrational(car(p1))&&(p1=cdr(p1)),isplusone(p4)||(e+=print_factor(p4),flag=1);iscons(p1);)p2=car(p1),is_denominator(p2)&&(flag&&(e+=print_multiply_sign()),e+=print_denom(p2,r),flag=1),p1=cdr(p1);return r>1&&printMode!==PRINTMODE_LATEX&&(e+=print_char(")")),printMode===PRINTMODE_LATEX&&(e+=print_str("}")),restore(),e},print_expr=function(t){var e;if(e="",isadd(t))for(t=cdr(t),sign_of_term(car(t))==="-"&&(e+=print_str("-")),e+=print_term(car(t)),t=cdr(t);iscons(t);)sign_of_term(car(t))==="+"?printMode===PRINTMODE_HUMAN&&!test_flag?e+=print_str(" + "):e+=print_str("+"):printMode===PRINTMODE_HUMAN&&!test_flag?e+=print_str(" - "):e+=print_str("-"),e+=print_term(car(t)),t=cdr(t);else sign_of_term(t)==="-"&&(e+=print_str("-")),e+=print_term(t);return e},sign_of_term=function(t){var e;return e="",car(t)===symbol(MULTIPLY)&&isNumericAtom(cadr(t))&&lessp(cadr(t),zero)||isNumericAtom(t)&&lessp(t,zero)?e+="-":e+="+",e},print_term=function(t){var e,r,i,n,s;if(e="",car(t)===symbol(MULTIPLY)&&any_denominators(t))return e+=print_a_over_b(t),e;if(car(t)===symbol(MULTIPLY)){for(t=cdr(t),isminusone(car(t))&&(t=cdr(t)),s=!1,isNumericAtom(car(t))&&(s=!0),i=!1,printMode===PRINTMODE_LATEX&&iscons(cdr(t))&&isNumberOneOverSomething(car(t))&&(i=!0,r=car(t).q.b.toString()),i?(n=e,e=""):e+=print_factor(car(t)),t=cdr(t);iscons(t);)printMode===PRINTMODE_LATEX&&s&&caar(t)===symbol(POWER)&&isNumericAtom(car(cdr(car(t))))&&(isfraction(car(cdr(cdr(car(t)))))||(e+=" \\cdot ")),e+=print_multiply_sign(),e+=print_factor(car(t),!1,!0),s=!1,isNumericAtom(car(t))&&(s=!0),t=cdr(t);i&&(e=n+"\\frac{"+e+"}{"+r+"}")}else e+=print_factor(t);return e},print_subexpr=function(t){var e;return e="",e+=print_char("("),e+=print_expr(t),e+=print_char(")"),e},print_factorial_function=function(t){var e;return e="",t=cadr(t),isfraction(t)||car(t)===symbol(ADD)||car(t)===symbol(MULTIPLY)||car(t)===symbol(POWER)||car(t)===symbol(FACTORIAL)?e+=print_subexpr(t):e+=print_expr(t),e+=print_char("!"),e},print_ABS_latex=function(t){var e;return e="",e+=print_str("\\left |"),e+=print_expr(cadr(t)),e+=print_str(" \\right |"),e},print_BINOMIAL_latex=function(t){var e;return e="",e+=print_str("\\binom{"),e+=print_expr(cadr(t)),e+=print_str("}{"),e+=print_expr(caddr(t)),e+=print_str("} "),e},print_DOT_latex=function(t){var e;return e="",e+=print_expr(cadr(t)),e+=print_str(" \\cdot "),e+=print_expr(caddr(t)),e},print_DOT_codegen=function(t){var e;return e="dot(",e+=print_expr(cadr(t)),e+=", ",e+=print_expr(caddr(t)),e+=")",e},print_SIN_codegen=function(t){var e;return e="Math.sin(",e+=print_expr(cadr(t)),e+=")",e},print_COS_codegen=function(t){var e;return e="Math.cos(",e+=print_expr(cadr(t)),e+=")",e},print_TAN_codegen=function(t){var e;return e="Math.tan(",e+=print_expr(cadr(t)),e+=")",e},print_ARCSIN_codegen=function(t){var e;return e="Math.asin(",e+=print_expr(cadr(t)),e+=")",e},print_ARCCOS_codegen=function(t){var e;return e="Math.acos(",e+=print_expr(cadr(t)),e+=")",e},print_ARCTAN_codegen=function(t){var e;return e="Math.atan(",e+=print_expr(cadr(t)),e+=")",e},print_SQRT_latex=function(t){var e;return e="",e+=print_str("\\sqrt{"),e+=print_expr(cadr(t)),e+=print_str("} "),e},print_TRANSPOSE_latex=function(t){var e;return e="",e+=print_str("{"),iscons(cadr(t))&&(e+=print_str("(")),e+=print_expr(cadr(t)),iscons(cadr(t))&&(e+=print_str(")")),e+=print_str("}"),e+=print_str("^T"),e},print_TRANSPOSE_codegen=function(t){var e;return e="",e+=print_str("transpose("),e+=print_expr(cadr(t)),e+=print_str(")"),e},print_UNIT_codegen=function(t){var e;return e="",e+=print_str("identity("),e+=print_expr(cadr(t)),e+=print_str(")"),e},print_INV_latex=function(t){var e;return e="",e+=print_str("{"),iscons(cadr(t))&&(e+=print_str("(")),e+=print_expr(cadr(t)),iscons(cadr(t))&&(e+=print_str(")")),e+=print_str("}"),e+=print_str("^{-1}"),e},print_INV_codegen=function(t){var e;return e="",e+=print_str("inv("),e+=print_expr(cadr(t)),e+=print_str(")"),e},print_DEFINT_latex=function(t){var e,r,i,n,s,a,l,u,p;for(e="",r=car(cdr(t)),t=cdr(t),a=t,s=0;iscons(cdr(cdr(t)));)s++,u=cdr(cdr(t)),e+=print_str("\\int^{"),e+=print_expr(car(cdr(u))),e+=print_str("}_{"),e+=print_expr(car(u)),e+=print_str("} \\! "),t=cdr(u);for(e+=print_expr(r),e+=print_str(" \\,"),t=a,i=n=1,l=s;1<=l?n<=l:n>=l;i=1<=l?++n:--n)p=cdr(t),e+=print_str(" \\mathrm{d} "),e+=print_expr(car(p)),i<s&&(e+=print_str(" \\, ")),t=cdr(cdr(p));return e},print_tensor=function(t){var e;return e="",e+=print_tensor_inner(t,0,0)[1],e},print_tensor_inner=function(t,e,r){var i,n,s,a,l,u,p;if(i="",i+=print_str("["),e<t.tensor.ndim-1)for(n=s=0,l=t.tensor.dim[e];0<=l?s<l:s>l;n=0<=l?++s:--s)[r,p]=print_tensor_inner(t,e+1,r),i+=p,n!==t.tensor.dim[e]-1&&(i+=print_str(","));else for(n=a=0,u=t.tensor.dim[e];0<=u?a<u:a>u;n=0<=u?++a:--a)i+=print_expr(t.tensor.elem[r]),n!==t.tensor.dim[e]-1&&(i+=print_str(",")),r++;return i+=print_str("]"),[r,i]},print_tensor_latex=function(t){var e;return e="",t.tensor.ndim<=2&&(e+=print_tensor_inner_latex(!0,t,0,0)[1]),e},print_tensor_inner_latex=function(t,e,r,i){var n,s,a,l,u,p,f;if(n="",t&&(n+="\\begin{bmatrix} "),r<e.tensor.ndim-1)for(s=a=0,u=e.tensor.dim[r];0<=u?a<u:a>u;s=0<=u?++a:--a)[i,f]=print_tensor_inner_latex(0,e,r+1,i),n+=f,s!==e.tensor.dim[r]-1&&(n+=print_str(" \\\\ "));else for(s=l=0,p=e.tensor.dim[r];0<=p?l<p:l>p;s=0<=p?++l:--l)n+=print_expr(e.tensor.elem[i]),s!==e.tensor.dim[r]-1&&(n+=print_str(" & ")),i++;return t&&(n+=" \\end{bmatrix}"),[i,n]},print_SUM_latex=function(t){var e;return e="\\sum_{",e+=print_expr(caddr(t)),e+="=",e+=print_expr(cadddr(t)),e+="}^{",e+=print_expr(caddddr(t)),e+="}{",e+=print_expr(cadr(t)),e+="}",e},print_SUM_codegen=function(t){var e,r,i,n,s;return r=cadr(t),s=caddr(t),i=cadddr(t),n=caddddr(t),e="(function(){ var "+s+";  var holderSum = 0;  var lowerlimit = "+print_expr(i)+";  var upperlimit = "+print_expr(n)+";  for ("+s+" = lowerlimit; "+s+" < upperlimit; "+s+"++) {    holderSum += "+print_expr(r)+"; }  return holderSum;})()",e},print_TEST_latex=function(t){var e;for(e="\\left\\{ \\begin{array}{ll}",t=cdr(t);iscons(t);){if(cdr(t)===symbol(NIL)){e+="{",e+=print_expr(car(t)),e+="} & otherwise ",e+=" \\\\\\\\";break}e+="{",e+=print_expr(cadr(t)),e+="} & if & ",e+=print_expr(car(t)),e+=" \\\\\\\\",t=cddr(t)}return e=e.substring(0,e.length-4),e+="\\end{array} \\right."},print_TEST_codegen=function(t){var e,r;for(e="(function(){",t=cdr(t),r=0;iscons(t);){if(cdr(t)===symbol(NIL)){e+="else {",e+="return ("+print_expr(car(t))+");",e+="}";break}r&&(e+=" else "),e+="if ("+print_expr(car(t))+"){",e+="return ("+print_expr(cadr(t))+");",e+="}",r++,t=cddr(t)}return e+="})()",e},print_TESTLT_latex=function(t){var e;return e="{",e+=print_expr(cadr(t)),e+="}",e+=" < ",e+="{",e+=print_expr(caddr(t)),e+="}"},print_TESTLE_latex=function(t){var e;return e="{",e+=print_expr(cadr(t)),e+="}",e+=" \\leq ",e+="{",e+=print_expr(caddr(t)),e+="}"},print_TESTGT_latex=function(t){var e;return e="{",e+=print_expr(cadr(t)),e+="}",e+=" > ",e+="{",e+=print_expr(caddr(t)),e+="}"},print_TESTGE_latex=function(t){var e;return e="{",e+=print_expr(cadr(t)),e+="}",e+=" \\geq ",e+="{",e+=print_expr(caddr(t)),e+="}"},print_TESTEQ_latex=function(t){var e;return e="{",e+=print_expr(cadr(t)),e+="}",e+=" = ",e+="{",e+=print_expr(caddr(t)),e+="}"},print_FOR_codegen=function(t){var e,r,i,n,s;return r=cadr(t),s=caddr(t),i=cadddr(t),n=caddddr(t),e="(function(){ var "+s+";  var lowerlimit = "+print_expr(i)+";  var upperlimit = "+print_expr(n)+";  for ("+s+" = lowerlimit; "+s+" < upperlimit; "+s+"++) {    "+print_expr(r)+" } })()",e},print_DO_codegen=function(t){var e;for(e="",t=cdr(t);iscons(t);)e+=print_expr(car(t)),t=cdr(t);return e},print_SETQ_codegen=function(t){var e;return e="",e+=print_expr(cadr(t)),e+=" = ",e+=print_expr(caddr(t)),e+="; ",e},print_PRODUCT_latex=function(t){var e;return e="\\prod_{",e+=print_expr(caddr(t)),e+="=",e+=print_expr(cadddr(t)),e+="}^{",e+=print_expr(caddddr(t)),e+="}{",e+=print_expr(cadr(t)),e+="}",e},print_PRODUCT_codegen=function(t){var e,r,i,n,s;return r=cadr(t),s=caddr(t),i=cadddr(t),n=caddddr(t),e="(function(){ var "+s+";  var holderProduct = 1;  var lowerlimit = "+print_expr(i)+";  var upperlimit = "+print_expr(n)+";  for ("+s+" = lowerlimit; "+s+" < upperlimit; "+s+"++) {    holderProduct *= "+print_expr(r)+"; }  return holderProduct;})()",e},print_power=function(t,e){var r,i,n,s;if(r="",DEBUG&&console.log("power base: "+t+"  exponent: "+e),isoneovertwo(e))if(equaln(t,2)){if(codeGen)return r+=print_str("Math.SQRT2"),r}else{if(printMode===PRINTMODE_LATEX)return r+=print_str("\\sqrt{"),r+=print_expr(t),r+=print_str("}"),r;if(codeGen)return r+=print_str("Math.sqrt("),r+=print_expr(t),r+=print_str(")"),r}if(equaln(get_binding(symbol(PRINT_LEAVE_E_ALONE)),1)&&t===symbol(E))return codeGen?(r+=print_str("Math.exp("),r+=print_expo_of_denom(e),r+=print_str(")"),r):(printMode===PRINTMODE_LATEX?(r+=print_str("e^{"),r+=print_expr(e),r+=print_str("}")):(r+=print_str("exp("),r+=print_expr(e),r+=print_str(")")),r);if(codeGen)return r+=print_str("Math.pow("),r+=print_base_of_denom(t),r+=print_str(", "),r+=print_expo_of_denom(e),r+=print_str(")"),r;if(equaln(get_binding(symbol(PRINT_LEAVE_X_ALONE)),0)||t.printname!=="x"){if(t!==symbol(E)){if(isminusone(e))return printMode===PRINTMODE_LATEX?r+=print_str("\\frac{1}{"):printMode===PRINTMODE_HUMAN&&!test_flag?r+=print_str("1 / "):r+=print_str("1/"),iscons(t)&&printMode!==PRINTMODE_LATEX?(r+=print_str("("),r+=print_expr(t),r+=print_str(")")):r+=print_expr(t),printMode===PRINTMODE_LATEX&&(r+=print_str("}")),r;if(isnegativeterm(e))return printMode===PRINTMODE_LATEX?r+=print_str("\\frac{1}{"):printMode===PRINTMODE_HUMAN&&!test_flag?r+=print_str("1 / "):r+=print_str("1/"),push(e),push_integer(-1),multiply(),n=pop(),iscons(t)&&printMode!==PRINTMODE_LATEX?(r+=print_str("("),r+=print_power(t,n),r+=print_str(")")):r+=print_power(t,n),printMode===PRINTMODE_LATEX&&(r+=print_str("}")),r}if(isfraction(e)&&printMode===PRINTMODE_LATEX)return r+=print_str("\\sqrt"),push(e),denominator(),i=pop(),isplustwo(i)||(r+=print_str("["),r+=print_expr(i),r+=print_str("]")),r+=print_str("{"),push(e),numerator(),s=pop(),e=s,r+=print_power(t,e),r+=print_str("}"),r}return printMode===PRINTMODE_LATEX&&isplusone(e)?r+=print_expr(t):(isadd(t)||isnegativenumber(t)?(r+=print_str("("),r+=print_expr(t),r+=print_str(")")):car(t)===symbol(MULTIPLY)||car(t)===symbol(POWER)?(printMode!==PRINTMODE_LATEX&&(r+=print_str("(")),r+=print_factor(t,!0),printMode!==PRINTMODE_LATEX&&(r+=print_str(")"))):isNumericAtom(t)&&(lessp(t,zero)||isfraction(t))?(r+=print_str("("),r+=print_factor(t),r+=print_str(")")):r+=print_factor(t),printMode===PRINTMODE_HUMAN&&!test_flag?r+=print_str(power_str):r+=print_str("^"),printMode===PRINTMODE_LATEX?print_expr(e).length>1?(r+=print_str("{"),r+=print_expr(e),r+=print_str("}")):r+=print_expr(e):iscons(e)||isfraction(e)||isNumericAtom(e)&&lessp(e,zero)?(r+=print_str("("),r+=print_expr(e),r+=print_str(")")):r+=print_factor(e)),r},print_index_function=function(t){var e;if(e="",t=cdr(t),caar(t)===symbol(ADD)||caar(t)===symbol(MULTIPLY)||caar(t)===symbol(POWER)||caar(t)===symbol(FACTORIAL)?e+=print_subexpr(car(t)):e+=print_expr(car(t)),e+=print_str("["),t=cdr(t),iscons(t))for(e+=print_expr(car(t)),t=cdr(t);iscons(t);)e+=print_str(","),e+=print_expr(car(t)),t=cdr(t);return e+=print_str("]"),e},print_factor=function(t,e,r){var i,n,s,a,l,u;if(i="",isNumericAtom(t))return r&&lessp(t,zero)&&(i+="("),i+=print_number(t,r),r&&lessp(t,zero)&&(i+=")"),i;if(isstr(t))return i+=print_str('"'),i+=print_str(t.str),i+=print_str('"'),i;if(istensor(t))return printMode===PRINTMODE_LATEX?i+=print_tensor_latex(t):i+=print_tensor(t),i;if(car(t)===symbol(MULTIPLY))return e||(sign_of_term(t)==="-"||printMode!==PRINTMODE_LATEX)&&(printMode===PRINTMODE_LATEX?i+=print_str(" \\left ("):i+=print_str("(")),i+=print_expr(t),e||(sign_of_term(t)==="-"||printMode!==PRINTMODE_LATEX)&&(printMode===PRINTMODE_LATEX?i+=print_str(" \\right ) "):i+=print_str(")")),i;if(isadd(t))return e||(i+=print_str("(")),i+=print_expr(t),e||(i+=print_str(")")),i;if(car(t)===symbol(POWER))return n=cadr(t),s=caddr(t),i+=print_power(n,s),i;if(car(t)===symbol(FUNCTION))return a=cadr(t),codeGen||(l=caddr(t),i+=print_str("function "),DEBUG&&console.log("emittedString from print_factor "+stringsEmittedByUserPrintouts),u=print_list(l),i+=u,i+=print_str(" -> ")),i+=print_expr(a),i;if(car(t)===symbol(PATTERN))return i+=print_expr(caadr(t)),printMode===PRINTMODE_LATEX?i+=print_str(" \\rightarrow "):printMode===PRINTMODE_HUMAN&&!test_flag?i+=print_str(" -> "):i+=print_str("->"),i+=print_expr(car(cdr(cadr(t)))),i;if(car(t)===symbol(INDEX)&&issymbol(cadr(t)))return i+=print_index_function(t),i;if(car(t)===symbol(FACTORIAL))return i+=print_factorial_function(t),i;if(car(t)===symbol(ABS)&&printMode===PRINTMODE_LATEX)return i+=print_ABS_latex(t),i;if(car(t)===symbol(SQRT)&&printMode===PRINTMODE_LATEX)return i+=print_SQRT_latex(t),i;if(car(t)===symbol(TRANSPOSE)){if(printMode===PRINTMODE_LATEX)return i+=print_TRANSPOSE_latex(t),i;if(codeGen)return i+=print_TRANSPOSE_codegen(t),i}else if(car(t)===symbol(UNIT)){if(codeGen)return i+=print_UNIT_codegen(t),i}else if(car(t)===symbol(INV)){if(printMode===PRINTMODE_LATEX)return i+=print_INV_latex(t),i;if(codeGen)return i+=print_INV_codegen(t),i}else{if(car(t)===symbol(BINOMIAL)&&printMode===PRINTMODE_LATEX)return i+=print_BINOMIAL_latex(t),i;if(car(t)===symbol(DEFINT)&&printMode===PRINTMODE_LATEX)return i+=print_DEFINT_latex(t),i;if(isinnerordot(t)){if(printMode===PRINTMODE_LATEX)return i+=print_DOT_latex(t),i;if(codeGen)return i+=print_DOT_codegen(t),i}else if(car(t)===symbol(SIN)){if(codeGen)return i+=print_SIN_codegen(t),i}else if(car(t)===symbol(COS)){if(codeGen)return i+=print_COS_codegen(t),i}else if(car(t)===symbol(TAN)){if(codeGen)return i+=print_TAN_codegen(t),i}else if(car(t)===symbol(ARCSIN)){if(codeGen)return i+=print_ARCSIN_codegen(t),i}else if(car(t)===symbol(ARCCOS)){if(codeGen)return i+=print_ARCCOS_codegen(t),i}else if(car(t)===symbol(ARCTAN)){if(codeGen)return i+=print_ARCTAN_codegen(t),i}else if(car(t)===symbol(SUM)){if(printMode===PRINTMODE_LATEX)return i+=print_SUM_latex(t),i;if(codeGen)return i+=print_SUM_codegen(t),i}else if(car(t)===symbol(PRODUCT)){if(printMode===PRINTMODE_LATEX)return i+=print_PRODUCT_latex(t),i;if(codeGen)return i+=print_PRODUCT_codegen(t),i}else if(car(t)===symbol(FOR)){if(codeGen)return i+=print_FOR_codegen(t),i}else if(car(t)===symbol(DO)){if(codeGen)return i+=print_DO_codegen(t),i}else if(car(t)===symbol(TEST)){if(codeGen)return i+=print_TEST_codegen(t),i;if(printMode===PRINTMODE_LATEX)return i+=print_TEST_latex(t),i}else if(car(t)===symbol(TESTLT)){if(codeGen)return i+="(("+print_expr(cadr(t))+") < ("+print_expr(caddr(t))+"))",i;if(printMode===PRINTMODE_LATEX)return i+=print_TESTLT_latex(t),i}else if(car(t)===symbol(TESTLE)){if(codeGen)return i+="(("+print_expr(cadr(t))+") <= ("+print_expr(caddr(t))+"))",i;if(printMode===PRINTMODE_LATEX)return i+=print_TESTLE_latex(t),i}else if(car(t)===symbol(TESTGT)){if(codeGen)return i+="(("+print_expr(cadr(t))+") > ("+print_expr(caddr(t))+"))",i;if(printMode===PRINTMODE_LATEX)return i+=print_TESTGT_latex(t),i}else if(car(t)===symbol(TESTGE)){if(codeGen)return i+="(("+print_expr(cadr(t))+") >= ("+print_expr(caddr(t))+"))",i;if(printMode===PRINTMODE_LATEX)return i+=print_TESTGE_latex(t),i}else if(car(t)===symbol(TESTEQ)){if(codeGen)return i+="(("+print_expr(cadr(t))+") === ("+print_expr(caddr(t))+"))",i;if(printMode===PRINTMODE_LATEX)return i+=print_TESTEQ_latex(t),i}else if(car(t)===symbol(FLOOR)){if(codeGen)return i+="Math.floor("+print_expr(cadr(t))+")",i;if(printMode===PRINTMODE_LATEX)return i+=" \\lfloor {"+print_expr(cadr(t))+"} \\rfloor ",i}else if(car(t)===symbol(CEILING)){if(codeGen)return i+="Math.ceiling("+print_expr(cadr(t))+")",i;if(printMode===PRINTMODE_LATEX)return i+=" \\lceil {"+print_expr(cadr(t))+"} \\rceil ",i}else if(car(t)===symbol(ROUND)){if(codeGen)return i+="Math.round("+print_expr(cadr(t))+")",i}else if(car(t)===symbol(SETQ))return codeGen?(i+=print_SETQ_codegen(t),i):(i+=print_expr(cadr(t)),i+=print_str("="),i+=print_expr(caddr(t)),i)}if(iscons(t)){if(i+=print_factor(car(t)),t=cdr(t),e||(i+=print_str("(")),iscons(t))for(i+=print_expr(car(t)),t=cdr(t);iscons(t);)i+=print_str(","),i+=print_expr(car(t)),t=cdr(t);return e||(i+=print_str(")")),i}return t===symbol(DERIVATIVE)?i+=print_char("d"):t===symbol(E)?codeGen?i+=print_str("Math.E"):i+=print_str("e"):t===symbol(PI)?printMode===PRINTMODE_LATEX?i+=print_str("\\pi"):i+=print_str("pi"):i+=print_str(get_printname(t)),i},print_list=function(t){var e;switch(e="",t.k){case CONS:if(e+="(",e+=print_list(car(t)),t===cdr(t)&&t!==symbol(NIL)){console.log("oh no recursive!");debugger}for(t=cdr(t);iscons(t);)if(e+=" ",e+=print_list(car(t)),t=cdr(t),t===cdr(t)&&t!==symbol(NIL)){console.log("oh no recursive!");debugger}t!==symbol(NIL)&&(e+=" . ",e+=print_list(t)),e+=")";break;case STR:e+=t.str;break;case NUM:case DOUBLE:e+=print_number(t,!0);break;case SYM:e+=get_printname(t);break;default:e+="<tensor>"}return e},print_multiply_sign=function(){var t;if(t="",printMode===PRINTMODE_LATEX)if(printMode===PRINTMODE_HUMAN&&!test_flag)t+=print_str(" ");else return t;return printMode===PRINTMODE_HUMAN&&!test_flag&&!codeGen?t+=print_str(" "):t+=print_str("*"),t},is_denominator=function(t){return car(t)===symbol(POWER)&&cadr(t)!==symbol(E)&&isnegativeterm(caddr(t))?1:0},any_denominators=function(t){var e;for(t=cdr(t);iscons(t);){if(e=car(t),is_denominator(e))return 1;t=cdr(t)}return 0},YMAX=1e4,glyph=(function(){class t{}return t.prototype.c=0,t.prototype.x=0,t.prototype.y=0,t}).call(this),chartab=[],charTabIndex=i1=0,ref1=YMAX;0<=ref1?i1<ref1:i1>ref1;charTabIndex=0<=ref1?++i1:--i1)chartab[charTabIndex]=new glyph;for(yindex=0,level=0,emit_x=0,expr_level=0,printchar_nowrap=function(t){var e;return e="",e+=t,e},printchar=function(t){return printchar_nowrap(t)},print2dascii=function(t){var e,r,i,n;if(r=0,i=0,n=0,save(),yindex=0,level=0,emit_x=0,emit_top_expr(t),[r,i,n]=get_size(0,yindex),i>100){printline(t),restore();return}return e=print_glyphs(),restore(),e},emit_top_expr=function(t){if(car(t)===symbol(SETQ)){emit_expr(cadr(t)),__emit_str(" = "),emit_expr(caddr(t));return}return istensor(t)?emit_tensor(t):emit_expr(t)},will_be_displayed_as_fraction=function(t){if(level>0)return 0;if(isfraction(t))return 1;if(car(t)!==symbol(MULTIPLY))return 0;if(isfraction(cadr(t)))return 1;for(;iscons(t);){if(isdenominator(car(t)))return 1;t=cdr(t)}return 0},emit_expr=function(t){if(expr_level++,car(t)===symbol(ADD))for(t=cdr(t),__is_negative(car(t))&&(__emit_char("-"),will_be_displayed_as_fraction(car(t))&&__emit_char(" ")),emit_term(car(t)),t=cdr(t);iscons(t);)__is_negative(car(t))?(__emit_char(" "),__emit_char("-"),__emit_char(" ")):(__emit_char(" "),__emit_char("+"),__emit_char(" ")),emit_term(car(t)),t=cdr(t);else __is_negative(t)&&(__emit_char("-"),will_be_displayed_as_fraction(t)&&__emit_char(" ")),emit_term(t);return expr_level--},emit_unsigned_expr=function(t){var e;if(car(t)===symbol(ADD)){for(t=cdr(t),emit_term(car(t)),t=cdr(t),e=[];iscons(t);)__is_negative(car(t))?(__emit_char(" "),__emit_char("-"),__emit_char(" ")):(__emit_char(" "),__emit_char("+"),__emit_char(" ")),emit_term(car(t)),e.push(t=cdr(t));return e}else return emit_term(t)},__is_negative=function(t){return isnegativenumber(t)||car(t)===symbol(MULTIPLY)&&isnegativenumber(cadr(t))?1:0},emit_term=function(t){var e;return car(t)===symbol(MULTIPLY)?(e=count_denominators(t),e&&level===0?emit_fraction(t,e):emit_multiply(t,e)):emit_factor(t)},isdenominator=function(t){return car(t)===symbol(POWER)&&cadr(t)!==symbol(E)&&__is_negative(caddr(t))?1:0},count_denominators=function(t){var e,r;for(e=0,t=cdr(t);iscons(t);)r=car(t),isdenominator(r)&&e++,t=cdr(t);return e},emit_multiply=function(t,e){var r;if(e===0){for(t=cdr(t),(isplusone(car(t))||isminusone(car(t)))&&(t=cdr(t)),emit_factor(car(t)),t=cdr(t),r=[];iscons(t);)__emit_char(" "),emit_factor(car(t)),r.push(t=cdr(t));return r}else return emit_numerators(t),__emit_char("/"),e>1||isfraction(cadr(t))?(__emit_char("("),emit_denominators(t),__emit_char(")")):emit_denominators(t)},emit_fraction=function(t,e){var r,i,n,s,a;for(r=0,i=0,n=0,s=0,a=0,save(),p3=one,p4=one,isrational(cadr(t))&&(push(cadr(t)),mp_numerator(),absval(),p3=pop(),push(cadr(t)),mp_denominator(),p4=pop()),isdouble(cadr(t))&&(push(cadr(t)),absval(),p3=pop()),isplusone(p3)?s=0:s=1,p1=cdr(t),isNumericAtom(car(p1))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)||s++,p1=cdr(p1);for(a=emit_x,i=yindex,r=0,isplusone(p3)||(emit_number(p3,0),r++),p1=cdr(t),isNumericAtom(car(p1))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)||(r>0&&__emit_char(" "),s===1?emit_expr(p2):emit_factor(p2),r++),p1=cdr(p1);for(r===0&&__emit_char("1"),n=yindex,r=0,isplusone(p4)||(emit_number(p4,0),r++,e++),p1=cdr(t),isrational(car(p1))&&(p1=cdr(p1));iscons(p1);)p2=car(p1),isdenominator(p2)&&(r>0&&__emit_char(" "),emit_denominator(p2,e),r++),p1=cdr(p1);return fixup_fraction(a,i,n),restore()},emit_numerators=function(t){var e;for(save(),e=0,p1=one,t=cdr(t),isrational(car(t))?(push(car(t)),mp_numerator(),absval(),p1=pop(),t=cdr(t)):isdouble(car(t))&&(push(car(t)),absval(),p1=pop(),t=cdr(t)),e=0,isplusone(p1)||(emit_number(p1,0),e++);iscons(t);)isdenominator(car(t))||(e>0&&__emit_char(" "),emit_factor(car(t)),e++),t=cdr(t);return e===0&&__emit_char("1"),restore()},emit_denominators=function(t){var e;for(save(),e=0,t=cdr(t),isfraction(car(t))&&(push(car(t)),mp_denominator(),p1=pop(),emit_number(p1,0),e++,t=cdr(t));iscons(t);)isdenominator(car(t))&&(e>0&&__emit_char(" "),emit_denominator(car(t),0),e++),t=cdr(t);return restore()},emit_factor=function(t){if(istensor(t)){emit_flat_tensor(t);return}if(isdouble(t)){emit_number(t,0);return}if(car(t)===symbol(ADD)||car(t)===symbol(MULTIPLY)){emit_subexpr(t);return}if(car(t)===symbol(POWER)){emit_power(t);return}if(iscons(t)){emit_function(t);return}if(isNumericAtom(t)){level===0?emit_numerical_fraction(t):emit_number(t,0);return}if(issymbol(t)){emit_symbol(t);return}isstr(t)&&emit_string(t)},emit_numerical_fraction=function(t){var e,r,i;if(e=0,r=0,i=0,save(),push(t),mp_numerator(),absval(),p3=pop(),push(t),mp_denominator(),p4=pop(),isplusone(p4)){emit_number(p3,0),restore();return}return i=emit_x,e=yindex,emit_number(p3,0),r=yindex,emit_number(p4,0),fixup_fraction(i,e,r),restore()},isfactor=function(t){return iscons(t)&&car(t)!==symbol(ADD)&&car(t)!==symbol(MULTIPLY)&&car(t)!==symbol(POWER)||issymbol(t)?1:isfraction(t)||isnegativenumber(t)?0:isNumericAtom(t)?1:0},emit_power=function(t){var e,r,i;if(e=0,r=0,i=0,cadr(t)===symbol(E)){__emit_str("exp("),emit_expr(caddr(t)),__emit_char(")");return}if(level>0){isminusone(caddr(t))?(__emit_char("1"),__emit_char("/"),isfactor(cadr(t))?emit_factor(cadr(t)):emit_subexpr(cadr(t))):(isfactor(cadr(t))?emit_factor(cadr(t)):emit_subexpr(cadr(t)),__emit_char("^"),isfactor(caddr(t))?emit_factor(caddr(t)):emit_subexpr(caddr(t)));return}if(__is_negative(caddr(t))){i=emit_x,e=yindex,__emit_char("1"),r=yindex,emit_denominator(t,1),fixup_fraction(i,e,r);return}return e=yindex,isfactor(cadr(t))?emit_factor(cadr(t)):emit_subexpr(cadr(t)),r=yindex,level++,emit_expr(caddr(t)),level--,fixup_power(e,r)},emit_denominator=function(t,e){var r,i;if(r=0,i=0,isminusone(caddr(t))){e===1?emit_expr(cadr(t)):emit_factor(cadr(t));return}return r=yindex,isfactor(cadr(t))?emit_factor(cadr(t)):emit_subexpr(cadr(t)),i=yindex,level++,emit_unsigned_expr(caddr(t)),level--,fixup_power(r,i)},emit_function=function(t){if(car(t)===symbol(INDEX)&&issymbol(cadr(t))){emit_index_function(t);return}if(car(t)===symbol(FACTORIAL)){emit_factorial_function(t);return}if(car(t)===symbol(DERIVATIVE)?__emit_char("d"):emit_symbol(car(t)),__emit_char("("),t=cdr(t),iscons(t))for(emit_expr(car(t)),t=cdr(t);iscons(t);)__emit_char(","),emit_expr(car(t)),t=cdr(t);return __emit_char(")")},emit_index_function=function(t){if(t=cdr(t),caar(t)===symbol(ADD)||caar(t)===symbol(MULTIPLY)||caar(t)===symbol(POWER)||caar(t)===symbol(FACTORIAL)?emit_subexpr(car(t)):emit_expr(car(t)),__emit_char("["),t=cdr(t),iscons(t))for(emit_expr(car(t)),t=cdr(t);iscons(t);)__emit_char(","),emit_expr(car(t)),t=cdr(t);return __emit_char("]")},emit_factorial_function=function(t){return t=cadr(t),isfraction(t)||car(t)===symbol(ADD)||car(t)===symbol(MULTIPLY)||car(t)===symbol(POWER)||car(t)===symbol(FACTORIAL)?emit_subexpr(t):emit_expr(t),__emit_char("!")},emit_subexpr=function(t){return __emit_char("("),emit_expr(t),__emit_char(")")},emit_symbol=function(t){var e,r,i,n,s;if(e=0,t===symbol(E)){__emit_str("exp(1)");return}for(i=get_printname(t),s=[],e=r=0,n=i.length;0<=n?r<n:r>n;e=0<=n?++r:--r)s.push(__emit_char(i[e]));return s},emit_string=function(t){var e,r,i,n;for(e=0,i=t.str,__emit_char('"'),e=r=0,n=i.length;0<=n?r<n:r>n;e=0<=n?++r:--r)__emit_char(i[e]);return __emit_char('"')},fixup_fraction=function(t,e,r){var i,n,s,a,l,u,p,f,c,h,d,m,_;for(i=0,n=0,f=0,d=0,s=0,c=0,m=0,a=0,h=0,_=0,[s,c,m]=get_size(e,r),[a,h,_]=get_size(r,yindex),h>c?i=(h-c)/2:i=0,i++,d=m+s-1,n=-d-1,move(e,r,i,n),h>c?i=-c:i=-c+(c-h)/2,i++,n=-_+1,move(r,yindex,i,n),h>c?f=h:f=c,f+=2,emit_x=t,p=[],l=0,u=f;0<=u?l<u:l>u;0<=u?++l:--l)p.push(__emit_char("-"));return p},fixup_power=function(t,e){var r,i,n,s,a,l,u;return r=0,i=0,s=0,l=0,n=0,a=0,u=0,[i,s,l]=get_size(t,e),[n,a,u]=get_size(e,yindex),r=-u-n+1,r+=l-1,move(e,yindex,0,r)},move=function(t,e,r,i){var n,s,a,l,u;for(n=0,u=[],n=s=a=t,l=e;a<=l?s<l:s>l;n=a<=l?++s:--s)chartab[n].x+=r,u.push(chartab[n].y+=i);return u},get_size=function(t,e){var r,i,n,s,a,l,u,p,f,c,h;for(i=0,l=chartab[t].x,s=chartab[t].x,u=chartab[t].y,a=chartab[t].y,i=n=p=t+1,f=e;p<=f?n<f:n>f;i=p<=f?++n:--n)chartab[i].x<l&&(l=chartab[i].x),chartab[i].x>s&&(s=chartab[i].x),chartab[i].y<u&&(u=chartab[i].y),chartab[i].y>a&&(a=chartab[i].y);return r=a-u+1,c=s-l+1,h=u,[r,c,h]},__emit_char=function(t){if(yindex!==YMAX){if(chartab[yindex]==null)debugger;return chartab[yindex].c=t,chartab[yindex].x=emit_x,chartab[yindex].y=0,yindex++,emit_x++}},__emit_str=function(t){var e,r,i,n;for(e=0,n=[],e=r=0,i=t.length;0<=i?r<i:r>i;e=0<=i?++r:--r)n.push(__emit_char(t[e]));return n},emit_number=function(t,e){var r,i,n,s,a,l,u,p,f,c;switch(c="",r=0,t.k){case NUM:for(c=t.q.a.toString(),c[0]==="-"&&e===0&&(c=c.substring(1)),r=i=0,a=c.length;0<=a?i<a:i>a;r=0<=a?++i:--i)__emit_char(c[r]);if(c=t.q.b.toString(),c==="1")break;for(__emit_char("/"),p=[],r=n=0,l=c.length;0<=l?n<l:n>l;r=0<=l?++n:--n)p.push(__emit_char(c[r]));return p;case DOUBLE:for(c=doubleToReasonableString(t.d),c[0]==="-"&&e===0&&(c=c.substring(1)),f=[],r=s=0,u=c.length;0<=u?s<u:s>u;r=0<=u?++s:--s)f.push(__emit_char(c[r]));return f}},cmpGlyphs=function(t,e){return t.y<e.y?-1:t.y>e.y?1:t.x<e.x?-1:t.x>e.x?1:0},print_glyphs=function(){var t,e,r,i,n,s,a;for(e=0,t="",n=chartab.slice(0,yindex),n.sort(cmpGlyphs),chartab=[].concat(n).concat(chartab.slice(yindex)),s=0,a=chartab[0].y,e=r=0,i=yindex;0<=i?r<i:r>i;e=0<=i?++r:--r){for(;chartab[e].y>a;)t+=printchar(`
`),s=0,a++;for(;chartab[e].x>s;)t+=printchar_nowrap(" "),s++;t+=printchar_nowrap(chartab[e].c),s++}return t},N=100,oneElement=(function(){class t{}return t.prototype.x=0,t.prototype.y=0,t.prototype.h=0,t.prototype.w=0,t.prototype.index=0,t.prototype.count=0,t}).call(this),elem=[],elelmIndex=j1=0;j1<1e4;elelmIndex=++j1)elem[elelmIndex]=new oneElement;SPACE_BETWEEN_COLUMNS=3,SPACE_BETWEEN_ROWS=1,emit_tensor=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O;if(l=0,f=0,d=0,h=0,I=0,O=0,a=0,T=0,r=0,i=0,n=0,s=0,S=0,e=0,t.tensor.ndim>2){emit_flat_tensor(t);return}if(d=t.tensor.dim[0],t.tensor.ndim===2?h=t.tensor.dim[1]:h=1,f=d*h,f>N){emit_flat_tensor(t);return}for(I=emit_x,l=u=0,_=f;0<=_?u<_:u>_;l=0<=_?++u:--u)elem[l].index=yindex,elem[l].x=emit_x,emit_expr(t.tensor.elem[l]),elem[l].count=yindex-elem[l].index,[elem[l].h,elem[l].w,elem[l].y]=get_size(elem[l].index,yindex);for(n=0,s=0,l=p=0,g=f;0<=g?p<g:p>g;l=0<=g?++p:--p)elem[l].h>n&&(n=elem[l].h),elem[l].w>s&&(s=elem[l].w);for(a=d*n+(d-1)*SPACE_BETWEEN_ROWS,T=h*s+(h-1)*SPACE_BETWEEN_COLUMNS,O=-(a/2),S=c=0,b=d;0<=b?c<b:c>b;S=0<=b?++c:--c)for(e=m=0,x=h;0<=x?m<x:m>x;e=0<=x?++m:--m)l=S*h+e,r=I-elem[l].x,i=O-elem[l].y,move(elem[l].index,elem[l].index+elem[l].count,r,i),r=0,e>0&&(r=e*(s+SPACE_BETWEEN_COLUMNS)),i=0,S>0&&(i=S*(n+SPACE_BETWEEN_ROWS)),r+=(s-elem[l].w)/2,i+=(n-elem[l].h)/2,move(elem[l].index,elem[l].index+elem[l].count,r,i);return emit_x=I+T},emit_flat_tensor=function(t){return emit_tensor_inner(t,0,0)},emit_tensor_inner=function(t,e,r){var i,n,s;for(i=0,__emit_char("("),i=n=0,s=t.tensor.dim[e];0<=s?n<s:n>s;i=0<=s?++n:--n)e+1===t.tensor.ndim?(emit_expr(t.tensor.elem[r]),r=r+1):r=emit_tensor_inner(t,e+1,r),i+1<t.tensor.dim[e]&&__emit_char(",");return __emit_char(")"),r},Eval_product=function(){var t,e,r,i,n,s,a,l,u;if(e=0,i=0,n=0,t=cadr(p1),r=caddr(p1),issymbol(r)||stop("sum: 2nd arg?"),push(cadddr(p1)),Eval(),i=pop_integer(),isNaN(i)){push(p1);return}if(push(caddddr(p1)),Eval(),n=pop_integer(),isNaN(n)){push(p1);return}for(a=get_binding(r),push_integer(1),e=s=l=i,u=n;l<=u?s<=u:s>=u;e=l<=u?++s:--s)push_integer(e),p5=pop(),set_binding(r,p5),push(t),Eval(),DEBUG&&(console.log("product - factor 1: "+stack[tos-1].toString()),console.log("product - factor 2: "+stack[tos-2].toString())),multiply(),DEBUG&&console.log("product - result: "+stack[tos-1].toString());return set_binding(r,a)},qadd=function(){var t,e,r,i,n,s,a,l;if(s=pop(),n=pop(),e=mmul(n.q.a,s.q.b),r=mmul(n.q.b,s.q.a),a=madd(e,r),MZERO(a)){push(zero);return}return i=mmul(n.q.b,s.q.b),t=mgcd(a,i),t=makeSignSameAs(t,i),l=new U,l.k=NUM,l.q.a=mdiv(a,t),l.q.b=mdiv(i,t),push(l)},qdiv=function(){var t,e,r;if(save(),p2=pop(),p1=pop(),MZERO(p2.q.a)&&stop("divide by zero"),MZERO(p1.q.a)){push(zero),restore();return}return t=mmul(p1.q.a,p2.q.b),e=mmul(p1.q.b,p2.q.a),r=mgcd(t,e),r=makeSignSameAs(r,e),p1=new U,p1.k=NUM,p1.q.a=mdiv(t,r),p1.q.b=mdiv(e,r),push(p1),restore()},qmul=function(){var t,e,r;if(save(),p2=pop(),p1=pop(),MZERO(p1.q.a)||MZERO(p2.q.a)){push(zero),restore();return}return t=mmul(p1.q.a,p2.q.a),e=mmul(p1.q.b,p2.q.b),r=mgcd(t,e),r=makeSignSameAs(r,e),p1=new U,p1.k=NUM,p1.q.a=mdiv(t,r),p1.q.b=mdiv(e,r),push(p1),restore()},qpow=function(){return save(),qpowf(),restore()},qpowf=function(){var t,e,r,i,n,s;if(r=0,p2=pop(),p1=pop(),isplusone(p1)||isZeroAtomOrTensor(p2)){push_integer(1);return}if(isminusone(p1)&&isoneovertwo(p2)){push(imaginaryunit);return}if(isZeroAtomOrTensor(p1)){isnegativenumber(p2)&&stop("divide by zero"),push(zero);return}if(isplusone(p2)){push(p1);return}if(isinteger(p2)){if(push(p2),r=pop_integer(),isNaN(r)){push_symbol(POWER),push(p1),push(p2),list(3);return}n=mpow(p1.q.a,Math.abs(r)),s=mpow(p1.q.b,Math.abs(r)),r<0&&(i=n,n=s,s=i,n=makeSignSameAs(n,s),s=makePositive(s)),p3=new U,p3.k=NUM,p3.q.a=n,p3.q.b=s,push(p3);return}if(isminusone(p1)){push(p2),normalize_angle();return}if(isnegativenumber(p1)){push(p1),negate(),push(p2),qpow(),push_integer(-1),push(p2),qpow(),multiply();return}if(!isinteger(p1)){push(p1),mp_numerator(),push(p2),qpow(),push(p1),mp_denominator(),push(p2),negate(),qpow(),multiply();return}if(is_small_integer(p1)){push(p1),push(p2),quickfactor();return}if(!isSmall(p2.q.a)||!isSmall(p2.q.b)){push_symbol(POWER),push(p1),push(p2),list(3);return}if(t=p2.q.a,e=p2.q.b,n=mroot(p1.q.a,e),n===0){push_symbol(POWER),push(p1),push(p2),list(3);return}return s=mpow(n,t),p3=new U,p3.k=NUM,p2.q.a.isNegative()?(p3.q.a=bigInt(1),p3.q.b=s):(p3.q.a=s,p3.q.b=bigInt(1)),push(p3)},normalize_angle=function(){if(save(),p1=pop(),isinteger(p1)){p1.q.a.isOdd()?push_integer(-1):push_integer(1),restore();return}return push(p1),bignum_truncate(),p2=pop(),isnegativenumber(p1)&&(push(p2),push_integer(-1),add(),p2=pop()),push(p1),push(p2),subtract(),p3=pop(),push_symbol(POWER),push_integer(-1),push(p3),list(3),p2.q.a.isOdd()&&negate(),restore()},is_small_integer=function(t){return isSmall(t.q.a)},quickfactor=function(){var t,e,r,i,n,s;for(e=0,save(),p2=pop(),p1=pop(),t=tos,push(p1),factor_small_number(),i=tos-t,s=t,e=r=0,n=i;r<n;e=r+=2)push(stack[s+e]),push(stack[s+e+1]),push(p2),multiply(),quickpower();return multiply_all(tos-t-i),p1=pop(),moveTos(t),push(p1),restore()},quickpower=function(){var t;if(t=0,save(),p2=pop(),p1=pop(),push(p2),bignum_truncate(),p3=pop(),push(p2),push(p3),subtract(),p4=pop(),isZeroAtomOrTensor(p4)||(push_symbol(POWER),push(p1),push(p4),list(3)),push(p3),t=pop_integer(),isNaN(t)){push_symbol(POWER),push(p1),push(p3),list(3),restore();return}if(t===0){restore();return}return push(p1),bignum_power_number(t),restore()},Eval_quotient=function(){return push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),push(cadddr(p1)),Eval(),p1=pop(),p1===symbol(NIL)&&(p1=symbol(SYMBOL_X)),push(p1),divpoly()},divpoly=function(){var t,e,r,i,n,s,a,l,u;for(r=0,i=0,s=0,a=0,u=0,save(),p3=pop(),p2=pop(),p1=pop(),r=tos,t=tos,s=coeff(p3,p1)-1,e=tos,a=coeff(p3,p2)-1,u=s-a,push_integer(0),p5=pop();u>=0;){for(push(stack[t+s]),push(stack[e+a]),divide(),p4=pop(),i=n=0,l=a;0<=l?n<=l:n>=l;i=0<=l?++n:--n)push(stack[t+u+i]),push(stack[e+i]),push(p4),multiply(),subtract(),stack[t+u+i]=pop();push(p5),push(p4),push(p3),push_integer(u),power(),multiply(),add(),p5=pop(),s--,u--}return moveTos(r),push(p5),restore()},DEBUG_RATIONALIZE=!1,Eval_rationalize=function(){return push(cadr(p1)),Eval(),rationalize()},rationalize=function(){var t;return t=expanding,yyrationalize(),expanding=t},yyrationalize=function(){var t,e,r;if(r=pop(),istensor(r)){__rationalize_tensor(r);return}if(expanding=0,car(r)!==symbol(ADD)){push(r);return}for(DEBUG_RATIONALIZE&&console.log("rationalize: this is the input expr: "+r),push(one),multiply_denominators(r),t=pop(),DEBUG_RATIONALIZE&&console.log("rationalize: this is the new denominator: "+t),push(zero),e=cdr(r);iscons(e);)DEBUG_RATIONALIZE&&console.log("term: "+car(e)),push(t),push(car(e)),multiply(),add(),e=cdr(e);if(DEBUG_RATIONALIZE&&console.log("rationalize: original terms times new denominator: "+stack[tos-1]),Condense(),DEBUG_RATIONALIZE&&console.log("rationalize: after factoring: "+stack[tos-1]),push(t),divide(),DEBUG_RATIONALIZE)return console.log("rationalize: after dividing by new denom. (and we're done): "+stack[tos-1])},multiply_denominators=function(t){var e;if(car(t)===symbol(ADD)){for(t=cdr(t),e=[];iscons(t);)multiply_denominators_term(car(t)),e.push(t=cdr(t));return e}else return multiply_denominators_term(t)},multiply_denominators_term=function(t){var e;if(car(t)===symbol(MULTIPLY)){for(t=cdr(t),e=[];iscons(t);)multiply_denominators_factor(car(t)),e.push(t=cdr(t));return e}else return multiply_denominators_factor(t)},multiply_denominators_factor=function(t){if(car(t)===symbol(POWER)){if(push(t),t=caddr(t),isnegativenumber(t)){inverse(),__lcm();return}if(car(t)===symbol(MULTIPLY)&&isnegativenumber(cadr(t))){inverse(),__lcm();return}return pop()}},__rationalize_tensor=function(t){var e,r,i,n;if(e=0,push(t),Eval(),t=pop(),!istensor(t)){push(t);return}for(i=t.tensor.nelem,e=r=0,n=i;0<=n?r<n:r>n;e=0<=n?++r:--r)push(t.tensor.elem[e]),rationalize(),t.tensor.elem[e]=pop();return check_tensor_dimensions(t),push(t)},__lcm=function(){return save(),p1=pop(),p2=pop(),push(p1),push(p2),multiply(),push(p1),push(p2),gcd(),divide(),restore()},Eval_real=function(){return push(cadr(p1)),Eval(),real()},real=function(){return save(),rect(),p1=pop(),push(p1),push(p1),conjugate(),add(),push_integer(2),divide(),restore()},DEBUG_RECT=!1,Eval_rect=function(){return push(cadr(p1)),Eval(),rect()},rect=function(){var t;if(save(),p1=pop(),t=p1,DEBUG_RECT&&console.log("RECT of "+t),DEBUG_RECT&&console.log("any clock forms in : "+t+" ? "+findPossibleClockForm(t)),issymbol(p1))DEBUG_RECT&&console.log(" rect: simple symbol: "+t),isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))?(push_symbol(YYRECT),push(p1),list(2)):push(p1);else if(!isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES)))&&!findPossibleExponentialForm(p1)&&!findPossibleClockForm(p1)&&!(Find(p1,symbol(SIN))&&Find(p1,symbol(COS))&&Find(p1,imaginaryunit)))DEBUG_RECT&&console.log(" rect: simple symbol: "+t),push(p1);else if(car(p1)===symbol(MULTIPLY)&&isimaginaryunit(cadr(p1))&&!isZeroAtomOrTensor(get_binding(symbol(ASSUME_REAL_VARIABLES))))push(p1);else if(car(p1)===symbol(ADD))for(DEBUG_RECT&&console.log(" rect - "+t+" is a sum "),push_integer(0),p1=cdr(p1);iscons(p1);)push(car(p1)),rect(),add(),p1=cdr(p1);else DEBUG_RECT&&console.log(" rect - "+t+" is NOT a sum "),push(p1),abs(),DEBUG_RECT&&console.log(" rect - "+t+" abs: "+stack[tos-1].toString()),push(p1),arg(),DEBUG_RECT&&console.log(" rect - "+t+" arg of "+p1+" : "+stack[tos-1].toString()),p1=pop(),push(p1),cosine(),DEBUG_RECT&&console.log(" rect - "+t+" cosine: "+stack[tos-1].toString()),push(imaginaryunit),push(p1),sine(),DEBUG_RECT&&console.log(" rect - "+t+" sine: "+stack[tos-1].toString()),multiply(),DEBUG_RECT&&console.log(" rect - "+t+" i * sine: "+stack[tos-1].toString()),add(),DEBUG_RECT&&console.log(" rect - "+t+" cos + i * sine: "+stack[tos-1].toString()),multiply();if(restore(),DEBUG_RECT)return console.log("rect of "+t+" : "+stack[tos-1])},Eval_roots=function(){return p2=cadr(p1),car(p2)===symbol(SETQ)||car(p2)===symbol(TESTEQ)?(push(cadr(p2)),Eval(),push(caddr(p2)),Eval(),subtract()):(push(p2),Eval(),p2=pop(),car(p2)===symbol(SETQ)||car(p2)===symbol(TESTEQ)?(push(cadr(p2)),Eval(),push(caddr(p2)),Eval(),subtract()):push(p2)),push(caddr(p1)),Eval(),p2=pop(),p2===symbol(NIL)?guess():push(p2),p2=pop(),p1=pop(),ispolyexpandedform(p1,p2)||stop("roots: 1st argument is not a polynomial in the variable "+p2),push(p1),push(p2),roots()},hasImaginaryCoeff=function(t){var e,r,i;for(r=!1,e=i=t;i>0;e=i+=-1)if(iscomplexnumber(stack[tos-e])){r=!0;break}return r},isSimpleRoot=function(t){var e,r,i;if(t>2){for(r=!0,isZeroAtomOrTensor(stack[tos-t])&&(r=!1),e=i=t-1;i>1;e=i+=-1)if(!isZeroAtomOrTensor(stack[tos-e])){r=!1;break}}else r=!1;return r},normalisedCoeff=function(t,e){var r,i,n,s,a,l,u,p;for(n=coeff(t,e),r=stack[tos-1],l=[],i=s=1,u=n;1<=u?s<=u:s>=u;i=1<=u?++s:--s)l.push(pop());for(i=a=p=n-1;p<=0?a<=0:a>=0;i=p<=0?++a:--a)push(l[i]),push(r),divide();return n},roots=function(){var t,e,r,i,n,s,a,l;if(t=0,e=0,a=0,DEBUG&&console.log("roots: "+stack[tos-1].toString()+" "+stack[tos-2].toString()),save(),recursionLevelNestedRadicalsRemoval>1){pop(),pop(),push(symbol(NIL)),restore();return}if(t=tos-2,DEBUG&&console.log("roots checking if "+stack[tos-1].toString()+" is a case of simple roots"),p2=pop(),p1=pop(),push(p1),push(p2),r=normalisedCoeff(p2,p1),isSimpleRoot(r)?(DEBUG&&console.log("yes, "+stack[tos-1].toString()+" is a case of simple roots"),n=stack[tos-r],s=stack[tos-1],moveTos(tos-r),pop(),pop(),getSimpleRoots(r,s,n)):(moveTos(tos-r),roots2()),a=tos-t,a===0&&stop("roots: the polynomial is not factorable, try nroots"),a===1){restore();return}for(sort_stack(a),p1=alloc_tensor(a),p1.tensor.ndim=1,p1.tensor.dim[0]=a,e=i=0,l=a;0<=l?i<l:i>l;e=0<=l?++i:--i)p1.tensor.elem[e]=stack[t+e];return moveTos(t),push(p1),restore(),!1},getSimpleRoots=function(t,e,r){var i,n,s,a,l,u,p;if(DEBUG&&console.log("getSimpleRoots"),save(),t=t-1,push(r),push_rational(1,t),power(),push(e),push_rational(1,t),power(),divide(),n=pop(),t%2===0)for(p=s=1,l=t;s<=l;p=s+=2)push(n),push_integer(-1),push_rational(p,t),power(),multiply(),i=pop(),push(i),push(i),negate();else for(p=a=1,u=t;1<=u?a<=u:a>=u;p=1<=u?++a:--a)push(n),push_integer(-1),push_rational(p,t),power(),multiply(),p%2===0&&negate();return restore()},roots2=function(){var t;if(save(),DEBUG&&console.log("roots2: "+stack[tos-1].toString()+" "+stack[tos-2].toString()),p2=pop(),p1=pop(),push(p1),push(p2),t=normalisedCoeff(p2,p1),hasImaginaryCoeff(t)?(moveTos(tos-t),pop(),pop()):(moveTos(tos-t),factorpoly(),p1=pop()),car(p1)===symbol(MULTIPLY))for(p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),roots3(),p1=cdr(p1);else push(p1),push(p2),roots3();return restore()},roots3=function(){var t;return save(),p2=pop(),p1=pop(),car(p1)===symbol(POWER)&&ispolyexpandedform(cadr(p1),p2)&&isposint(caddr(p1))?(t=normalisedCoeff(p2,cadr(p1)),mini_solve(t)):ispolyexpandedform(p1,p2)&&(t=normalisedCoeff(p2,p1),mini_solve(t)),restore()},mini_solve=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le,ce,se,de,fe,X,he,ne,ge,Ee,be,_e,ye,Te,xe,Se,W,ue,w,F,V,K,A,re,y,v,k,D,z,q;if(save(),t===2){p3=pop(),p4=pop(),push(p4),push(p3),divide(),negate(),restore();return}if(t===3){p3=pop(),p4=pop(),p5=pop(),push(p4),push_integer(2),power(),push_integer(4),push(p3),multiply(),push(p5),multiply(),subtract(),push_rational(1,2),power(),p6=pop(),push(p6),push(p4),subtract(),push(p3),push_integer(2),multiply(),divide(),push(p6),push(p4),add(),negate(),push(p3),divide(),push_rational(1,2),multiply(),restore();return}if(t===4||t===5){if(p3=pop(),p4=pop(),p5=pop(),p6=pop(),push(p5),push(p5),multiply(),H=pop(),push(H),push(p5),multiply(),ee=pop(),push(p4),push(p4),multiply(),P=pop(),push(P),push(p4),multiply(),G=pop(),push(G),push(p6),multiply(),B=pop(),push(B),push_integer(-4),multiply(),me=pop(),push(G),push_integer(2),multiply(),n=pop(),push(p3),push(p3),multiply(),b=pop(),push(b),push(p3),multiply(),T=pop(),push_integer(3),push(p3),multiply(),s=pop(),push(b),push(p6),multiply(),x=pop(),push(x),push(p6),multiply(),S=pop(),push(x),push_integer(27),multiply(),i=pop(),push(S),push_integer(-27),multiply(),ae=pop(),push(s),push_integer(2),multiply(),pop(),push(p3),push(p5),multiply(),L=pop(),push(L),push(p4),multiply(),I=pop(),push(I),push(p6),multiply(),O=pop(),push(L),push_integer(3),multiply(),l=pop(),push_integer(-4),push(p3),push(ee),multiply(),multiply(),oe=pop(),push(I),push_integer(9),multiply(),negate(),le=pop(),push(O),push_integer(18),multiply(),r=pop(),push(P),push(l),subtract(),d=pop(),push(P),push(H),multiply(),C=pop(),push(p4),negate(),push(s),divide(),ce=pop(),t===4){if(DEBUG&&console.log(">>>>>>>>>>>>>>>> actually using cubic formula <<<<<<<<<<<<<<< "),DEBUG&&console.log("cubic: D0: "+d.toString()),push(d),push_integer(3),power(),push_integer(4),multiply(),u=pop(),push(d),simplify(),absValFloat(),m=pop(),DEBUG&&console.log("cubic: D0 as float: "+m.toString()),push(r),push(me),push(C),push(oe),push(ae),add(),add(),add(),add(),simplify(),absValFloat(),te=pop(),DEBUG&&console.log("cubic: DETERMINANT: "+te.toString()),push(n),push(le),push(i),add(),add(),_=pop(),DEBUG&&console.log("cubic: D1: "+_.toString()),push(_),push_integer(2),power(),push(u),subtract(),push_rational(1,2),power(),simplify(),g=pop(),isZeroAtomOrTensor(te))if(isZeroAtomOrTensor(m)){DEBUG&&console.log(" cubic: DETERMINANT IS ZERO and delta0 is zero"),push(ce),restore();return}else{DEBUG&&console.log(" cubic: DETERMINANT IS ZERO and delta0 is not zero"),push(p3),push(p6),push_integer(9),multiply(),multiply(),push(p4),push(p5),multiply(),subtract(),push(d),push_integer(2),multiply(),divide(),D=pop(),push(D),push(D),push(I),push_integer(4),multiply(),push(p3),push(p3),push(p6),push_integer(9),multiply(),multiply(),multiply(),negate(),push(G),negate(),add(),add(),push(p3),push(d),multiply(),divide(),restore();return}for(e=!1,Te=!1;!e;)push(g),Te&&negate(),push(_),add(),push_rational(1,2),multiply(),push_rational(1,3),power(),simplify(),f=pop(),DEBUG&&console.log("cubic: C: "+f.toString()),push(f),simplify(),absValFloat(),h=pop(),DEBUG&&console.log("cubic: C as absval and float: "+h.toString()),isZeroAtomOrTensor(h)?(DEBUG&&console.log(" cubic: C IS ZERO flipping the sign"),Te=!0):e=!0;push(f),push(s),multiply(),a=pop(),push(a),push_integer(2),multiply(),p=pop(),push(imaginaryunit),push_integer(3),push_rational(1,2),power(),multiply(),xe=pop(),push_integer(1),push(xe),add(),A=pop(),push_integer(1),push(xe),subtract(),K=pop(),push(f),push(s),divide(),c=pop(),push(ce),push(c),negate(),push(d),push(a),divide(),negate(),add(),add(),simplify(),push(ce),push(c),push(A),multiply(),push_integer(2),divide(),push(K),push(d),multiply(),push(p),divide(),add(),add(),simplify(),push(ce),push(c),push(K),multiply(),push_integer(2),divide(),push(A),push(d),multiply(),push(p),divide(),add(),add(),simplify(),restore();return}if(t===5){if(DEBUG&&console.log(">>>>>>>>>>>>>>>> actually using quartic formula <<<<<<<<<<<<<<< "),p7=pop(),isZeroAtomOrTensor(p4)&&isZeroAtomOrTensor(p6)&&!isZeroAtomOrTensor(p5)&&!isZeroAtomOrTensor(p7)){for(DEBUG&&console.log("biquadratic case"),push(p3),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push(p5),push(symbol(SECRETX)),multiply(),push(p7),add(),add(),push(symbol(SECRETX)),roots(),ne=pop(),re=ne.tensor.elem,Se=0,W=re.length;Se<W;Se++)ye=re[Se],push(ye),push_rational(1,2),power(),simplify(),push(ye),push_rational(1,2),power(),negate(),simplify();restore();return}if(push(p6),push(p6),multiply(),j=pop(),push(p7),push(p7),multiply(),J=pop(),push(J),push(p7),multiply(),Z=pop(),push_integer(256),push(T),push(Z),multiply(),multiply(),push_integer(-192),push(x),push(J),push(p4),multiply(),multiply(),multiply(),push_integer(-128),push(b),push(H),push(J),multiply(),multiply(),multiply(),push_integer(144),push(S),push(p5),push(p7),multiply(),multiply(),multiply(),push(ae),push(j),multiply(),push_integer(144),push(I),push(p4),push(J),multiply(),multiply(),multiply(),push_integer(-6),push(p3),push(P),push(j),push(p7),multiply(),multiply(),multiply(),multiply(),push_integer(-80),push(O),push(p5),push(p7),multiply(),multiply(),multiply(),push_integer(18),push(O),push(j),multiply(),multiply(),push_integer(16),push(L),push(ee),push(p7),multiply(),multiply(),multiply(),push_integer(-4),push(L),push(H),push(j),multiply(),multiply(),multiply(),push_integer(-27),push(G),push(p4),push(J),multiply(),multiply(),multiply(),push_integer(18),push(B),push(p5),push(p7),multiply(),multiply(),multiply(),push(me),push(j),multiply(),push_integer(-4),push(C),push(p5),push(p7),multiply(),multiply(),multiply(),push(C),push(j),multiply(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),add(),te=pop(),DEBUG&&console.log("R_determinant: "+te.toString()),push(H),push_integer(-3),push(p4),push(p6),multiply(),multiply(),push_integer(12),push(p3),push(p7),multiply(),multiply(),add(),add(),d=pop(),DEBUG&&console.log("R_DELTA0: "+d.toString()),push_integer(2),push(ee),multiply(),push_integer(-9),push(p4),push(p5),push(p6),multiply(),multiply(),multiply(),push_integer(27),push(P),push(p7),multiply(),multiply(),push_integer(27),push(p3),push(j),multiply(),multiply(),push_integer(-72),push(L),push(p7),multiply(),multiply(),add(),add(),add(),add(),_=pop(),DEBUG&&console.log("R_DELTA1: "+_.toString()),push_integer(8),push(L),multiply(),push_integer(-3),push(P),multiply(),add(),push_integer(8),push(b),multiply(),divide(),se=pop(),DEBUG&&console.log("p: "+se.toString()),push(G),push_integer(-4),push(I),multiply(),push_integer(8),push(x),multiply(),add(),add(),push_integer(8),push(T),multiply(),divide(),de=pop(),DEBUG&&console.log("q: "+de.toString()),DEBUG&&console.log("tos 1 "+tos),isZeroAtomOrTensor(p4)){for(se=p5,de=p6,fe=p7,push_rational(5,2),push(se),multiply(),ge=pop(),push_integer(2),push(se),push_integer(2),power(),multiply(),push(fe),subtract(),Ee=pop(),push(se),push_integer(3),power(),push_integer(2),divide(),push_rational(-1,2),push(se),push(fe),multiply(),multiply(),push_rational(-1,8),push(de),push_integer(2),power(),multiply(),add(),add(),be=pop(),push(symbol(SECRETX)),push_integer(3),power(),push(ge),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push(Ee),push(symbol(SECRETX)),multiply(),push(be),add(),add(),add(),DEBUG&&console.log("resolventCubic: "+stack[tos-1].toString()),push(symbol(SECRETX)),roots(),k=pop(),DEBUG&&console.log("resolventCubicSolutions: "+k),pe=null,v=k.tensor.elem,V=0,w=v.length;V<w;V++)if(ye=v[V],DEBUG&&console.log("examining solution: "+ye),push(ye),push_integer(2),multiply(),push(se),add(),absValFloat(),q=pop(),DEBUG&&console.log("abs value is: "+ye),!isZeroAtomOrTensor(q)){pe=ye;break}DEBUG&&console.log("chosen solution: "+pe),push(pe),push_integer(2),multiply(),push(se),add(),push_rational(1,2),power(),simplify(),z=pop(),push(de),push_integer(2),multiply(),push(z),divide(),simplify(),he=pop(),push(se),push_integer(3),multiply(),push(pe),push_integer(2),multiply(),add(),X=pop(),push(z),push(X),push(he),add(),negate(),push_rational(1,2),power(),simplify(),add(),push_integer(2),divide(),push(z),push(X),push(he),add(),negate(),push_rational(1,2),power(),simplify(),subtract(),push_integer(2),divide(),push(z),negate(),push(X),push(he),subtract(),negate(),push_rational(1,2),power(),simplify(),add(),push_integer(2),divide(),push(z),negate(),push(X),push(he),subtract(),negate(),push_rational(1,2),power(),simplify(),subtract(),push_integer(2),divide(),restore();return}else{for(DEBUG&&console.log("tos 2 "+tos),push_integer(8),push(p5),push(p3),multiply(),multiply(),push_integer(-3),push(p4),push_integer(2),power(),multiply(),add(),push_integer(8),push(p3),push_integer(2),power(),multiply(),divide(),se=pop(),DEBUG&&console.log("p for depressed quartic: "+se.toString()),push(p4),push_integer(3),power(),push_integer(-4),push(p3),push(p4),push(p5),multiply(),multiply(),multiply(),push_integer(8),push(p6),push(p3),push_integer(2),power(),multiply(),multiply(),add(),add(),push_integer(8),push(p3),push_integer(3),power(),multiply(),divide(),de=pop(),DEBUG&&console.log("q for depressed quartic: "+de.toString()),push(p4),push_integer(4),power(),push_integer(-3),multiply(),push_integer(256),push(T),push(p7),multiply(),multiply(),push_integer(-64),push(x),push(p4),multiply(),multiply(),push_integer(16),push(P),push(p3),push(p5),multiply(),multiply(),multiply(),add(),add(),add(),push_integer(256),push(p3),push_integer(4),power(),multiply(),divide(),fe=pop(),DEBUG&&console.log("r for depressed quartic: "+fe.toString()),DEBUG&&console.log("tos 4 "+tos),push(symbol(SECRETX)),push_integer(4),power(),DEBUG&&console.log("4 * x^4: "+stack[tos-1].toString()),push(se),push(symbol(SECRETX)),push_integer(2),power(),multiply(),DEBUG&&console.log("R_p * x^2: "+stack[tos-1].toString()),push(de),push(symbol(SECRETX)),multiply(),DEBUG&&console.log("R_q * x: "+stack[tos-1].toString()),push(fe),DEBUG&&console.log("R_r: "+stack[tos-1].toString()),add(),add(),add(),simplify(),DEBUG&&console.log("solving depressed quartic: "+stack[tos-1].toString()),push(symbol(SECRETX)),roots(),_e=pop(),DEBUG&&console.log("depressedSolutions: "+_e),y=_e.tensor.elem,F=0,ue=y.length;F<ue;F++)ye=y[F],push(ye),push(p4),push_integer(4),push(p3),multiply(),divide(),subtract(),simplify(),DEBUG&&console.log("solution from depressed: "+stack[tos-1].toString());restore();return}}}return moveTos(tos-t),restore()},Eval_round=function(){return push(cadr(p1)),Eval(),yround()},yround=function(){return save(),yyround(),restore()},yyround=function(){var t;if(t=0,p1=pop(),!isNumericAtom(p1)){push_symbol(ROUND),push(p1),list(2);return}if(isdouble(p1)){t=Math.round(p1.d),push_double(t);return}if(isinteger(p1)){push(p1);return}return push(p1),yyfloat(),p1=pop(),push_integer(Math.round(p1.d))},T_INTEGER=1001,T_DOUBLE=1002,T_SYMBOL=1003,T_FUNCTION=1004,T_NEWLINE=1006,T_STRING=1007,T_GTEQ=1008,T_LTEQ=1009,T_EQ=1010,T_NEQ=1011,T_QUOTASSIGN=1012,token="",newline_flag=0,meta_mode=0,input_str=0,scan_str=0,token_str=0,token_buf=0,lastFoundSymbol=null,symbolsRightOfAssignment=null,symbolsLeftOfAssignment=null,isSymbolLeftOfAssignment=null,scanningParameters=null,functionInvokationsScanningStack=null,skipRootVariableToBeSolved=!1,assignmentFound=null,scanned="",scan=function(t){return DEBUG&&console.log("#### scanning "+t),lastFoundSymbol=null,symbolsRightOfAssignment=[],symbolsLeftOfAssignment=[],isSymbolLeftOfAssignment=!0,scanningParameters=[],functionInvokationsScanningStack=[""],assignmentFound=!1,scanned=t,meta_mode=0,expanding++,input_str=0,scan_str=0,get_next_token(),token===""?(push(symbol(NIL)),expanding--,0):(scan_stmt(),expanding--,assignmentFound||(symbolsInExpressionsWithoutAssignments=symbolsInExpressionsWithoutAssignments.concat(symbolsLeftOfAssignment)),token_str-input_str)},scan_meta=function(t){return scanned=t,meta_mode=1,expanding++,input_str=0,scan_str=0,get_next_token(),token===""?(push(symbol(NIL)),expanding--,0):(scan_stmt(),expanding--,token_str-input_str)},scan_stmt=function(){var t,e,r,i,n,s,a,l,u;if(scan_relation(),t=!1,token===T_QUOTASSIGN&&(t=!0),(token===T_QUOTASSIGN||token==="=")&&(u=lastFoundSymbol,DEBUG&&console.log("assignment!"),assignmentFound=!0,isSymbolLeftOfAssignment=!1,get_next_token(),push_symbol(SETQ),swap(),t&&push_symbol(QUOTE),scan_relation(),t&&list(2),list(3),isSymbolLeftOfAssignment=!0,codeGen)){if(i=symbolsRightOfAssignment.indexOf(u),i!==-1&&(symbolsRightOfAssignment.splice(i,1),symbolsHavingReassignments.push(u)),DEBUG)for(console.log("locally, "+u+" depends on: "),n=0,s=symbolsRightOfAssignment.length;n<s;n++)r=symbolsRightOfAssignment[n],console.log("  "+r);for(symbolsDependencies[u]==null&&(symbolsDependencies[u]=[]),e=symbolsDependencies[u],l=0,a=symbolsRightOfAssignment.length;l<a;l++)r=symbolsRightOfAssignment[l],e.indexOf(r)===-1&&e.push(r);return symbolsRightOfAssignment=[]}},scan_relation=function(){switch(scan_expression(),token){case T_EQ:return push_symbol(TESTEQ),swap(),get_next_token(),scan_expression(),list(3);case T_NEQ:return push_symbol(NOT),swap(),push_symbol(TESTEQ),swap(),get_next_token(),scan_expression(),list(3),list(2);case T_LTEQ:return push_symbol(TESTLE),swap(),get_next_token(),scan_expression(),list(3);case T_GTEQ:return push_symbol(TESTGE),swap(),get_next_token(),scan_expression(),list(3);case"<":return push_symbol(TESTLT),swap(),get_next_token(),scan_expression(),list(3);case">":return push_symbol(TESTGT),swap(),get_next_token(),scan_expression(),list(3)}},scan_expression=function(){var t;switch(t=tos,token){case"+":get_next_token(),scan_term();break;case"-":get_next_token(),scan_term(),negate();break;default:scan_term()}for(;newline_flag===0&&(token==="+"||token==="-");)token==="+"?(get_next_token(),scan_term()):(get_next_token(),scan_term(),negate());if(tos-t>1)return list(tos-t),push_symbol(ADD),swap(),cons()},is_factor=function(){if((typeof token.charCodeAt=="function"?token.charCodeAt(0):void 0)===dotprod_unicode)return 1;switch(token){case"*":case"/":return 1;case"(":case T_SYMBOL:case T_FUNCTION:case T_INTEGER:case T_DOUBLE:case T_STRING:return newline_flag?(scan_str=token_str,0):1}return 0},simplify_1_in_products=function(t,e){if(t>e&&isrational(stack[t-1])&&equaln(stack[t-1],1))return pop()},multiply_consecutive_constants=function(t,e){if(t>e+1&&isNumericAtom(stack[t-2])&&isNumericAtom(stack[t-1]))return multiply()},scan_term=function(){var t;for(t=tos,scan_factor(),parse_time_simplifications&&simplify_1_in_products(tos,t);is_factor();)token==="*"?(get_next_token(),scan_factor()):token==="/"?(simplify_1_in_products(tos,t),get_next_token(),scan_factor(),inverse()):(typeof token.charCodeAt=="function"?token.charCodeAt(0):void 0)===dotprod_unicode?(get_next_token(),push_symbol(INNER),swap(),scan_factor(),list(3)):scan_factor(),parse_time_simplifications&&(multiply_consecutive_constants(tos,t),simplify_1_in_products(tos,t));if(t===tos)return push_integer(1);if(tos-t>1)return list(tos-t),push_symbol(MULTIPLY),swap(),cons()},scan_power=function(){if(token==="^")return get_next_token(),push_symbol(POWER),swap(),scan_factor(),list(3)},scan_index=function(t){for(get_next_token(),push_symbol(INDEX),swap(),scan_expression();token===",";)get_next_token(),scan_expression();return token!=="]"&&scan_error("] expected"),get_next_token(),list(tos-t)},scan_factor=function(){var t,e;for(e=tos,t=!1,token==="("?scan_subexpr():token===T_SYMBOL?scan_symbol():token===T_FUNCTION?scan_function_call_with_function_name():token==="["?scan_tensor():token===T_INTEGER?(t=!0,bignum_scan_integer(token_buf),get_next_token()):token===T_DOUBLE?(t=!0,bignum_scan_float(token_buf),get_next_token()):token===T_STRING?scan_string():scan_error("syntax error");token==="["||token==="("&&newline_flag===0&&!t;)token==="["?scan_index(e):token==="("&&scan_function_call_without_function_name();for(;token==="!";)get_next_token(),push_symbol(FACTORIAL),swap(),list(2);for(;(typeof token.charCodeAt=="function"?token.charCodeAt(0):void 0)===transpose_unicode;)get_next_token(),push_symbol(TRANSPOSE),swap(),list(2);return scan_power()},addSymbolRightOfAssignment=function(t){var e,r,i,n;if(predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(t)===-1&&symbolsRightOfAssignment.indexOf(t)===-1&&symbolsRightOfAssignment.indexOf("'"+t)===-1&&!skipRootVariableToBeSolved){for(DEBUG&&console.log("... adding symbol: "+t+" to the set of the symbols right of assignment"),i="",e=r=1,n=functionInvokationsScanningStack.length;1<=n?r<n:r>n;e=1<=n?++r:--r)functionInvokationsScanningStack[e]!==""&&(i+=functionInvokationsScanningStack[e]+"_"+e+"_");return t=i+t,symbolsRightOfAssignment.push(t)}},addSymbolLeftOfAssignment=function(t){var e,r,i,n;if(predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(t)===-1&&symbolsLeftOfAssignment.indexOf(t)===-1&&symbolsLeftOfAssignment.indexOf("'"+t)===-1&&!skipRootVariableToBeSolved){for(DEBUG&&console.log("... adding symbol: "+t+" to the set of the symbols left of assignment"),i="",e=r=1,n=functionInvokationsScanningStack.length;1<=n?r<n:r>n;e=1<=n?++r:--r)functionInvokationsScanningStack[e]!==""&&(i+=functionInvokationsScanningStack[e]+"_"+e+"_");return t=i+t,symbolsLeftOfAssignment.push(t)}},scan_symbol=function(){if(token!==T_SYMBOL&&scan_error("symbol expected"),meta_mode&&token_buf.length===1)switch(token_buf[0]){case"a":push(symbol(METAA));break;case"b":push(symbol(METAB));break;case"x":push(symbol(METAX));break;default:push(usr_symbol(token_buf))}else push(usr_symbol(token_buf));return scanningParameters.length===0?(DEBUG&&console.log("out of scanning parameters, processing "+token_buf),lastFoundSymbol=token_buf,isSymbolLeftOfAssignment&&addSymbolLeftOfAssignment(token_buf)):(DEBUG&&console.log("still scanning parameters, skipping "+token_buf),isSymbolLeftOfAssignment&&addSymbolRightOfAssignment("'"+token_buf)),DEBUG&&console.log("found symbol: "+token_buf+" left of assignment: "+isSymbolLeftOfAssignment),isSymbolLeftOfAssignment||addSymbolRightOfAssignment(token_buf),get_next_token()},scan_string=function(){return push(new_string(token_buf)),get_next_token()},scan_function_call_with_function_name=function(){var t,e,r,i,n,s;if(DEBUG&&console.log("-- scan_function_call_with_function_name start"),i=1,n=new U,n=usr_symbol(token_buf),push(n),t=token_buf,(t==="roots"||t==="defint"||t==="sum"||t==="product"||t==="for")&&functionInvokationsScanningStack.push(token_buf),lastFoundSymbol=token_buf,isSymbolLeftOfAssignment||addSymbolRightOfAssignment(token_buf),get_next_token(),get_next_token(),scanningParameters.push(!0),token!==")"){for(scan_stmt(),i++;token===",";)get_next_token(),i===2&&functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("roots")!==-1&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(a){return!new RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(a)}),skipRootVariableToBeSolved=!0),i===2&&functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("sum")!==-1&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(a){return!new RegExp("sum_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(a)}),skipRootVariableToBeSolved=!0),i===2&&functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("product")!==-1&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(a){return!new RegExp("product_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(a)}),skipRootVariableToBeSolved=!0),i===2&&functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("for")!==-1&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(a){return!new RegExp("for_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(a)}),skipRootVariableToBeSolved=!0),functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("defint")!==-1&&(i===2||i>2&&(i-2)%3===0)&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(a){return!new RegExp("defint_"+(functionInvokationsScanningStack.length-1)+"_"+token_buf).test(a)}),skipRootVariableToBeSolved=!0),scan_stmt(),skipRootVariableToBeSolved=!1,i++;i===2&&functionInvokationsScanningStack[functionInvokationsScanningStack.length-1].indexOf("roots")!==-1&&(symbolsRightOfAssignment=symbolsRightOfAssignment.filter(function(a){return!new RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_x").test(a)}))}for(scanningParameters.pop(),e=r=0,s=symbolsRightOfAssignment.length;0<=s?r<=s:r>=s;e=0<=s?++r:--r)symbolsRightOfAssignment[e]!=null&&(t==="roots"&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("roots_"+(functionInvokationsScanningStack.length-1)+"_"),"")),t==="defint"&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("defint_"+(functionInvokationsScanningStack.length-1)+"_"),"")),t==="sum"&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("sum_"+(functionInvokationsScanningStack.length-1)+"_"),"")),t==="product"&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("product_"+(functionInvokationsScanningStack.length-1)+"_"),"")),t==="for"&&(symbolsRightOfAssignment[e]=symbolsRightOfAssignment[e].replace(new RegExp("for_"+(functionInvokationsScanningStack.length-1)+"_"),"")));if(token!==")"&&scan_error(") expected"),get_next_token(),list(i),(t==="roots"||t==="defint"||t==="sum"||t==="product"||t==="for")&&functionInvokationsScanningStack.pop(),t===symbol(PATTERN).printname&&(patternHasBeenFound=!0),DEBUG)return console.log("-- scan_function_call_with_function_name end")},scan_function_call_without_function_name=function(){var t;if(DEBUG&&console.log("-- scan_function_call_without_function_name start"),push_symbol(EVAL),swap(),list(2),t=1,get_next_token(),scanningParameters.push(!0),token!==")")for(scan_stmt(),t++;token===",";)get_next_token(),scan_stmt(),t++;if(scanningParameters.pop(),token!==")"&&scan_error(") expected"),get_next_token(),list(t),DEBUG)return console.log("-- scan_function_call_without_function_name end: "+stack[tos-1])},scan_subexpr=function(){return token!=="("&&scan_error("( expected"),get_next_token(),scan_stmt(),token!==")"&&scan_error(") expected"),get_next_token()},scan_tensor=function(){var t;for(t=0,token!=="["&&scan_error("[ expected"),get_next_token(),scan_stmt(),t=1;token===",";)get_next_token(),scan_stmt(),t++;return build_tensor(t),token!=="]"&&scan_error("] expected"),get_next_token()},scan_error=function(t){for(errorMessage="";input_str!==scan_str&&!((scanned[input_str]===`
`||scanned[input_str]==="\r")&&input_str+1===scan_str);)errorMessage+=scanned[input_str++];for(errorMessage+=" ? ";scanned[input_str]&&scanned[input_str]!==`
`&&scanned[input_str]!=="\r";)errorMessage+=scanned[input_str++];return errorMessage+=`
`,stop(t)},build_tensor=function(t){var e,r,i;for(e=0,save(),p2=alloc_tensor(t),p2.tensor.ndim=1,p2.tensor.dim[0]=t,e=r=0,i=t;0<=i?r<i:r>i;e=0<=i?++r:--r)p2.tensor.elem[e]=stack[tos-t+e];return check_tensor_dimensions(p2),moveTos(tos-t),push(p2),restore()},get_next_token=function(){for(newline_flag=0;get_token(),token===T_NEWLINE;)newline_flag=1;if(DEBUG)return console.log("get_next_token token: "+token)},get_token=function(){for(;isspace(scanned[scan_str]);){if(scanned[scan_str]===`
`||scanned[scan_str]==="\r"){token=T_NEWLINE,scan_str++;return}scan_str++}if(token_str=scan_str,scan_str===scanned.length){token="";return}if(isdigit(scanned[scan_str])||scanned[scan_str]==="."){for(;isdigit(scanned[scan_str]);)scan_str++;if(scanned[scan_str]==="."){for(scan_str++;isdigit(scanned[scan_str]);)scan_str++;if(scanned[scan_str]==="e"&&(scanned[scan_str+1]==="+"||scanned[scan_str+1]==="-"||isdigit(scanned[scan_str+1])))for(scan_str+=2;isdigit(scanned[scan_str]);)scan_str++;token=T_DOUBLE}else token=T_INTEGER;update_token_buf(token_str,scan_str);return}if(isalpha(scanned[scan_str])){for(;isalnumorunderscore(scanned[scan_str]);)scan_str++;scanned[scan_str]==="("?token=T_FUNCTION:token=T_SYMBOL,update_token_buf(token_str,scan_str);return}if(scanned[scan_str]==='"'){for(scan_str++;scanned[scan_str]!=='"';)scan_str===scanned.length-1&&(scan_str++,scan_error("runaway string"),scan_str--),scan_str++;scan_str++,token=T_STRING,update_token_buf(token_str+1,scan_str-1);return}if(scanned[scan_str]==="#"||scanned[scan_str]==="-"&&scanned[scan_str+1]==="-"){for(;scanned[scan_str]&&scanned[scan_str]!==`
`&&scanned[scan_str]!=="\r";)scan_str++;scanned[scan_str]&&scan_str++,token=T_NEWLINE;return}if(scanned[scan_str]===":"&&scanned[scan_str+1]==="="){scan_str+=2,token=T_QUOTASSIGN;return}if(scanned[scan_str]==="="&&scanned[scan_str+1]==="="){scan_str+=2,token=T_EQ;return}if(scanned[scan_str]==="!"&&scanned[scan_str+1]==="="){scan_str+=2,token=T_NEQ;return}if(scanned[scan_str]==="<"&&scanned[scan_str+1]==="="){scan_str+=2,token=T_LTEQ;return}if(scanned[scan_str]===">"&&scanned[scan_str+1]==="="){scan_str+=2,token=T_GTEQ;return}return token=scanned[scan_str++]},update_token_buf=function(t,e){return token_buf=scanned.substring(t,e)},$.scan=scan,Eval_sgn=function(){return push(cadr(p1)),Eval(),sgn()},sgn=function(){return save(),yysgn(),restore()},yysgn=function(){if(p1=pop(),isdouble(p1))if(p1.d>0){push_integer(1);return}else if(p1.d===0){push_integer(1);return}else{push_integer(-1);return}if(isrational(p1))if(MSIGN(mmul(p1.q.a,p1.q.b))===-1){push_integer(-1);return}else if(MZERO(mmul(p1.q.a,p1.q.b))){push_integer(0);return}else{push_integer(1);return}if(iscomplexnumber(p1)){push_integer(-1),push(p1),absval(),power(),push(p1),multiply();return}if(isnegativeterm(p1)){push_symbol(SGN),push(p1),negate(),list(2),push_integer(-1),multiply();return}return push_symbol(SGN),push(p1),list(2)},Eval_shape=function(){return push(cadr(p1)),Eval(),shape()},shape=function(){var t,e,r,i,n,s,a,l;for(r=0,s=0,t=[],e=[],r=i=0,a=MAXDIM;0<=a?i<a:i>a;r=0<=a?++i:--i)t[r]=0,e[r]=0;if(save(),p1=pop(),!istensor(p1)){isZeroAtomOrTensor(p1)||stop("transpose: tensor expected, 1st arg is not a tensor"),push(zero),restore();return}for(s=p1.tensor.ndim,p2=alloc_tensor(s),p2.tensor.ndim=1,p2.tensor.dim[0]=s,r=n=0,l=s;0<=l?n<l:n>l;r=0<=l?++n:--n)push_integer(p1.tensor.dim[r]),p2.tensor.elem[r]=pop();return push(p2),restore()},simfac=function(){var t;if(t=0,save(),p1=pop(),car(p1)===symbol(ADD)){for(t=tos,p1=cdr(p1);p1!==symbol(NIL);)push(car(p1)),simfac_term(),p1=cdr(p1);add_all(tos-t)}else push(p1),simfac_term();return restore()},simfac_term=function(){var t;if(t=0,save(),p1=pop(),car(p1)!==symbol(MULTIPLY)){push(p1),restore();return}for(t=tos,p1=cdr(p1);p1!==symbol(NIL);)push(car(p1)),p1=cdr(p1);for(;yysimfac(t););return multiply_all_noexpand(tos-t),restore()},yysimfac=function(t){var e,r,i,n,s,a,l,u;for(e=0,r=0,e=i=s=t,a=tos;s<=a?i<a:i>a;e=s<=a?++i:--i)for(p1=stack[e],r=n=l=t,u=tos;l<=u?n<u:n>u;r=l<=u?++n:--n)if(e!==r){if(p2=stack[r],car(p1)===symbol(FACTORIAL)&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&equal(cadr(p1),cadr(p2)))return push(cadr(p1)),push(one),subtract(),factorial(),stack[e]=pop(),stack[r]=one,1;if(car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)&&equal(p1,cadadr(p2)))return push(p1),push_integer(-1),add(),factorial(),reciprocate(),stack[e]=pop(),stack[r]=one,1;if(car(p2)===symbol(FACTORIAL)&&(push(p1),push(cadr(p2)),subtract(),p3=pop(),isplusone(p3)))return push(p1),factorial(),stack[e]=pop(),stack[r]=one,1;if(car(p1)===symbol(POWER)&&isminusone(caddr(p1))&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)&&(push(cadr(p1)),push(cadr(cadr(p2))),subtract(),p3=pop(),isplusone(p3)))return push(cadr(p1)),factorial(),reciprocate(),stack[e]=pop(),stack[r]=one,1;if(car(p1)===symbol(FACTORIAL)&&car(p2)===symbol(POWER)&&isminusone(caddr(p2))&&caadr(p2)===symbol(FACTORIAL)){if(push(cadr(p1)),push(cadr(cadr(p2))),subtract(),p3=pop(),isplusone(p3))return stack[e]=cadr(p1),stack[r]=one,1;if(isminusone(p3))return push(cadr(cadr(p2))),reciprocate(),stack[e]=pop(),stack[r]=one,1;if(equaln(p3,2))return stack[e]=cadr(p1),push(cadr(p1)),push_integer(-1),add(),stack[r]=pop(),1;if(equaln(p3,-2))return push(cadr(cadr(p2))),reciprocate(),stack[e]=pop(),push(cadr(cadr(p2))),push_integer(-1),add(),reciprocate(),stack[r]=pop(),1}}return 0},DEBUG_SIMPLIFY=!1,Eval_simplify=function(){return push(cadr(p1)),runUserDefinedSimplifications(),Eval(),simplify()},runUserDefinedSimplifications=function(){var t,e,r,i,n,s,a,l,u,p;if(userSimplificationsInListForm.length!==0&&!Find(cadr(p1),symbol(INTEGRAL))){for(u=expanding,expanding=!1,DEBUG_SIMPLIFY&&console.log("runUserDefinedSimplifications passed: "+stack[tos-1].toString()),Eval(),DEBUG_SIMPLIFY&&console.log("runUserDefinedSimplifications after eval no expanding: "+stack[tos-1].toString()),expanding=u,p1=stack[tos-1],DEBUG_SIMPLIFY&&console.log("patterns to be checked: "),i=0,n=userSimplificationsInListForm.length;i<n;i++)r=userSimplificationsInListForm[i],DEBUG_SIMPLIFY&&console.log("..."+r);for(t=!0,l=0;t&&l<MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES;)for(t=!1,l++,a=0,s=userSimplificationsInListForm.length;a<s;a++){for(r=userSimplificationsInListForm[a],p=!0,e=0;p&&e<MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE;)e++,DEBUG_SIMPLIFY&&console.log("simplify - tos: "+tos+" checking pattern: "+r+" on: "+p1),push_symbol(NIL),p=transform(r,!0),p&&(t=!0),p1=stack[tos-1],DEBUG_SIMPLIFY&&console.log("p1 at this stage of simplification: "+p1);e===MAX_CONSECUTIVE_APPLICATIONS_OF_SINGLE_RULE&&stop("maximum application of single transformation rule exceeded: "+r)}if(l===MAX_CONSECUTIVE_APPLICATIONS_OF_ALL_RULES&&stop("maximum application of all transformation rules exceeded "),DEBUG_SIMPLIFY&&console.log("METAX = "+get_binding(symbol(METAX))),DEBUG_SIMPLIFY&&console.log("METAA = "+get_binding(symbol(METAA))),DEBUG_SIMPLIFY)return console.log("METAB = "+get_binding(symbol(METAB)))}},simplifyForCodeGeneration=function(){return save(),runUserDefinedSimplifications(),codeGen=!0,simplify_main(),codeGen=!1,restore()},simplify=function(){return save(),simplify_main(),restore()},simplify_main=function(){var args,fbody;if(p1=pop(),codeGen&&car(p1)===symbol(FUNCTION)&&(fbody=cadr(p1),push(fbody),eval(),simplify(),p3=pop(),args=caddr(p1),push_symbol(FUNCTION),push(p3),push(args),list(3),p1=pop()),istensor(p1)){simplify_tensor();return}if(Find(p1,symbol(FACTORIAL))&&(push(p1),simfac(),p2=pop(),push(p1),rationalize(),simfac(),p3=pop(),count(p2)<count(p3)?p1=p2:p1=p3),f10(),DEBUG_SIMPLIFY&&console.log("f10: "+p1.toString()),f1(),DEBUG_SIMPLIFY&&console.log("f1: "+p1.toString()),f2(),DEBUG_SIMPLIFY&&console.log("f2: "+p1.toString()),f3(),DEBUG_SIMPLIFY&&console.log("f3: "+p1.toString()),f4(),DEBUG_SIMPLIFY&&console.log("f4: "+p1.toString()),f5(),DEBUG_SIMPLIFY&&console.log("f5: "+p1.toString()),f9(),DEBUG_SIMPLIFY&&console.log("f9: "+p1.toString()),simplify_polarRect(),do_simplify_nested_radicals&&simplify_nested_radicals()){DEBUG_SIMPLIFY&&console.log("de-nesting successful into: "+p1.toString()),push(p1),simplify();return}return simplify_rectToClock(),simplify_rational_expressions(),push(p1)},simplify_tensor=function(){var t,e,r,i,n;for(t=0,p2=alloc_tensor(p1.tensor.nelem),p2.tensor.ndim=p1.tensor.ndim,t=e=0,i=p1.tensor.ndim;0<=i?e<i:e>i;t=0<=i?++e:--e)p2.tensor.dim[t]=p1.tensor.dim[t];for(t=r=0,n=p1.tensor.nelem;0<=n?r<n:r>n;t=0<=n?++r:--r)push(p1.tensor.elem[t]),simplify(),p2.tensor.elem[t]=pop();return check_tensor_dimensions(p2),isZeroAtomOrTensor(p2)&&(p2=zero),push(p2)},f1=function(){if(car(p1)===symbol(ADD)&&(push(p1),rationalize(),p2=pop(),count(p2)<count(p1)))return p1=p2},f2=function(){if(car(p1)===symbol(ADD)&&(push(p1),Condense(),p2=pop(),count(p2)<=count(p1)))return p1=p2},f3=function(){if(push(p1),rationalize(),negate(),rationalize(),negate(),rationalize(),p2=pop(),count(p2)<count(p1))return p1=p2},f10=function(){var t,e,r,i;if(r=car(p1),cdr(p1),(r===symbol(MULTIPLY)||isinnerordot(p1))&&car(car(cdr(p1)))===symbol(TRANSPOSE)&&car(car(cdr(cdr(p1))))===symbol(TRANSPOSE)&&(DEBUG_SIMPLIFY&&console.log("maybe collecting a transpose "+p1),t=cadr(car(cdr(p1))),e=cadr(car(cdr(cdr(p1)))),r===symbol(MULTIPLY)?(push(t),push(e),multiply()):isinnerordot(p1)&&(push(e),push(t),inner()),push_integer(1),push_integer(2),i=expanding,expanding=!1,transpose(),expanding=i,p2=pop(),count(p2)<count(p1)&&(p1=p2),DEBUG_SIMPLIFY))return console.log("collecting a transpose "+p2)},f4=function(){if(!isZeroAtomOrTensor(p1)&&(push(p1),rationalize(),inverse(),rationalize(),inverse(),rationalize(),p2=pop(),count(p2)<count(p1)))return p1=p2},simplify_trig=function(){return save(),p1=pop(),f5(),push(p1),restore()},f5=function(){if(!(Find(p1,symbol(SIN))===0&&Find(p1,symbol(COS))===0)&&(p2=p1,trigmode=1,push(p2),Eval(),p3=pop(),trigmode=2,push(p2),Eval(),p4=pop(),trigmode=0,(count(p4)<count(p3)||nterms(p4)<nterms(p3))&&(p3=p4),count(p3)<count(p1)||nterms(p3)<nterms(p1)))return p1=p3},f9=function(){var t,e;if(car(p1)===symbol(ADD)){for(push_integer(0),p2=cdr(p1);iscons(p2);)push(car(p2)),simplify(),add(),t=p1,e=p2,p1=pop(),simplify_rational_expressions(),push(p1),p1=t,p2=e,p2=cdr(p2);if(p2=pop(),count(p2)<count(p1))return p1=p2}},simplify_rational_expressions=function(){var t,e,r,i;if(push(p1),denominator(),t=pop(),!isone(t)&&(push(p1),numerator(),e=pop(),!isone(e)&&(r=areunivarpolysfactoredorexpandedform(e,t))&&(push(e),push(t),gcd(),push(r),factor(),i=pop(),!isone(i)&&(push(e),push(r),factor(),push(i),inverse(),multiply_noexpand(),simplify(),stack[tos-1].toString(),push(t),push(r),factor(),push(i),inverse(),multiply_noexpand(),simplify(),stack[tos-1].toString(),divide(),Condense(),stack[tos-1].toString(),p2=pop(),count(p2)<count(p1)))))return p1=p2},simplify_rectToClock=function(){if(!(Find(p1,symbol(SIN))===0&&Find(p1,symbol(COS))===0)&&(push(p1),Eval(),clockform(),p2=pop(),DEBUG_SIMPLIFY&&console.log("before simplification clockform: "+p1+" after: "+p2),count(p2)<count(p1)))return p1=p2},simplify_polarRect=function(){if(push(p1),polarRectAMinusOneBase(),Eval(),p2=pop(),count(p2)<count(p1))return p1=p2},polarRectAMinusOneBase=function(){var t;if(save(),p1=pop(),isimaginaryunit(p1)){push(p1),restore();return}if(equal(car(p1),symbol(POWER))&&isminusone(cadr(p1)))push(one),negate(),push(caddr(p1)),polarRectAMinusOneBase(),power(),polar(),rect();else if(iscons(p1)){for(t=tos;iscons(p1);)push(car(p1)),polarRectAMinusOneBase(),p1=cdr(p1);list(tos-t)}else push(p1);restore()},nterms=function(t){return car(t)!==symbol(ADD)?1:length(t)-1},simplify_nested_radicals=function(){var t,e,r,i;return recursionLevelNestedRadicalsRemoval>0?(DEBUG_SIMPLIFY&&console.log("denesting bailing out because of too much recursion"),!1):(push(p1),i=take_care_of_nested_radicals(),r=stack[tos-1],t=expanding,expanding=0,yycondense(),expanding=t,e=pop(),countOccurrencesOfSymbol(symbol(POWER),r)<countOccurrencesOfSymbol(symbol(POWER),e)?push(r):push(e),p1=pop(),i)},take_care_of_nested_radicals=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le;if(recursionLevelNestedRadicalsRemoval>0)return DEBUG_SIMPLIFY&&console.log("denesting bailing out because of too much recursion"),!1;if(save(),p1=pop(),equal(car(p1),symbol(POWER)))if(s=cadr(p1),c=caddr(p1),!isminusone(c)&&equal(car(s),symbol(ADD))&&isfraction(c)&&(equalq(c,1,3)||equalq(c,1,2))){for(h=cadr(s),push(h),take_care_of_nested_radicals(),pop(),ae=caddr(s),push(ae),take_care_of_nested_radicals(),pop(),G=0,p=s;cdr(p)!==symbol(NIL);)G++,p=cdr(p);if(G>2)return push(p1),restore(),!1;if(u=null,l=[],me=[],car(ae)===symbol(MULTIPLY)){if(oe=cdr(ae),iscons(oe))for(;iscons(oe);)J=car(oe),car(J)===symbol(POWER)?(_=cadr(J),g=caddr(J),equalq(g,1,2)&&(u==null?(u=g,l.push(_)):equal(g,u)&&l.push(_))):me.push(J),oe=cdr(oe)}else car(ae)===symbol(POWER)&&(_=cadr(ae),g=caddr(ae),u==null&&equalq(g,1,2)&&(u=g,l.push(_)));if(l.length===0)return push(p1),restore(),!1;for(t=h,push_integer(1),b=0,x=l.length;b<x;b++)m=l[b],push(m),multiply();for(r=pop(),push_integer(1),P=0,S=me.length;P<S;P++)m=me[P],push(m),multiply();if(e=pop(),equalq(c,1,3)){if(push(t),negate(),push(r),multiply(),push(e),divide(),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return push(p1),restore(),!1;if(push(a),push_integer(3),push(r),multiply(),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return pop(),push(p1),restore(),!1;if(push(a),push(symbol(SECRETX)),multiply(),push_integer(-3),push(t),multiply(),push(e),divide(),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return pop(),pop(),push(p1),restore(),!1;push(a),push(symbol(SECRETX)),push_integer(2),power(),multiply(),push_integer(1),push(symbol(SECRETX)),push_integer(3),power(),multiply(),add(),add(),add()}else if(equalq(c,1,2)){if(push(r),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return push(p1),restore(),!1;if(push(a),push_integer(-2),push(t),multiply(),push(e),divide(),a=pop(),push(a),real(),yyfloat(),Math.abs(pop().d)>Math.pow(2,32))return pop(),push(p1),restore(),!1;push(a),push(symbol(SECRETX)),multiply(),push_integer(1),push(symbol(SECRETX)),push_integer(2),power(),multiply(),add(),add()}if(push(symbol(SECRETX)),recursionLevelNestedRadicalsRemoval++,roots(),recursionLevelNestedRadicalsRemoval--,equal(stack[tos-1],symbol(NIL)))return DEBUG_SIMPLIFY&&console.log("roots bailed out because of too much recursion"),pop(),push(p1),restore(),!1;for(te=[],pe=stack[tos-1].tensor.elem,C=0,T=pe.length;C<T;C++)f=pe[C],Find(f,symbol(POWER))||te.push(f);if(pop(),te.length===0)return push(p1),restore(),!1;for(j=[],Z=[],B=0,I=te.length;B<I;B++)m=te[B],push(m),real(),yyfloat(),j.push(m),Z.push(pop().d);return le=Z.indexOf(Math.max.apply(Math,Z)),i=j[le],equalq(c,1,3)?(push(t),push(i),push_integer(3),power(),push_integer(3),push(r),multiply(),push(i),multiply(),add(),divide(),push_rational(1,3),power()):equalq(c,1,2)&&(push(t),push(i),push_integer(2),power(),push(r),add(),divide(),push_rational(1,2),power()),L=pop(),L==null?(push(p1),restore(),!1):(push(L),push(i),multiply(),equalq(c,1,3)?(O=pop(),push(L),push(r),push_rational(1,2),power(),multiply(),push(O),add(),simplify()):equalq(c,1,2)&&(O=pop(),push(L),push(r),push_rational(1,2),power(),multiply(),push(O),add(),simplify(),H=pop(),push(H),real(),yyfloat(),ee=pop(),isnegativenumber(ee)?(push(L),negate(),L=pop(),push(O),negate(),O=pop(),push(L),push(r),push_rational(1,2),power(),multiply(),push(O),add(),simplify()):push(H)),p1=pop(),push(p1),restore(),!0)}else return push(p1),restore(),!1;else if(iscons(p1)){for(d=tos,n=!1;iscons(p1);)push(car(p1)),n=n||take_care_of_nested_radicals(),p1=cdr(p1);return list(tos-d),restore(),n}else return push(p1),restore(),!1},Eval_sin=function(){return push(cadr(p1)),Eval(),sine()},sine=function(){return save(),p1=pop(),car(p1)===symbol(ADD)?sine_of_angle_sum():sine_of_angle(),restore()},sine_of_angle_sum=function(){for(p2=cdr(p1);iscons(p2);){if(p4=car(p2),isnpi(p4)){push(p1),push(p4),subtract(),p3=pop(),push(p3),sine(),push(p4),cosine(),multiply(),push(p3),cosine(),push(p4),sine(),multiply(),add();return}p2=cdr(p2)}return sine_of_angle()},sine_of_angle=function(){var t,e;if(car(p1)===symbol(ARCSIN)){push(cadr(p1));return}if(isdouble(p1)){t=Math.sin(p1.d),Math.abs(t)<1e-10&&(t=0),push_double(t);return}if(isnegative(p1)){push(p1),negate(),sine(),negate();return}if(car(p1)===symbol(ARCTAN)){push(cadr(p1)),push_integer(1),push(cadr(p1)),push_integer(2),power(),add(),push_rational(-1,2),power(),multiply();return}if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),e=pop_integer(),e<0||isNaN(e)){push(symbol(SIN)),push(p1),list(2);return}switch(e%360){case 0:case 180:return push_integer(0);case 30:case 150:return push_rational(1,2);case 210:case 330:return push_rational(-1,2);case 45:case 135:return push_rational(1,2),push_integer(2),push_rational(1,2),power(),multiply();case 225:case 315:return push_rational(-1,2),push_integer(2),push_rational(1,2),power(),multiply();case 60:case 120:return push_rational(1,2),push_integer(3),push_rational(1,2),power(),multiply();case 240:case 300:return push_rational(-1,2),push_integer(3),push_rational(1,2),power(),multiply();case 90:return push_integer(1);case 270:return push_integer(-1);default:return push(symbol(SIN)),push(p1),list(2)}},Eval_sinh=function(){return push(cadr(p1)),Eval(),ysinh()},ysinh=function(){return save(),yysinh(),restore()},yysinh=function(){var t;if(t=0,p1=pop(),car(p1)===symbol(ARCSINH)){push(cadr(p1));return}if(isdouble(p1)){t=Math.sinh(p1.d),Math.abs(t)<1e-10&&(t=0),push_double(t);return}if(isZeroAtomOrTensor(p1)){push(zero);return}return push_symbol(SINH),push(p1),list(2)},subst=function(){var t,e,r,i,n,s,a,l,u;if(save(),n=pop(),a=pop(),a===symbol(NIL)||n===symbol(NIL)){restore();return}if(t=pop(),istensor(t)){for(s=alloc_tensor(t.tensor.nelem),s.tensor.ndim=t.tensor.ndim,e=r=0,l=t.tensor.ndim;0<=l?r<l:r>l;e=0<=l?++r:--r)s.tensor.dim[e]=t.tensor.dim[e];for(e=i=0,u=t.tensor.nelem;0<=u?i<u:i>u;e=0<=u?++i:--i)push(t.tensor.elem[e]),push(a),push(n),subst(),s.tensor.elem[e]=pop(),check_tensor_dimensions(s);push(s)}else equal(t,a)?push(n):iscons(t)?(push(car(t)),push(a),push(n),subst(),push(cdr(t)),push(a),push(n),subst(),cons()):push(t);return restore()},Eval_sum=function(){var t,e,r,i,n,s,a,l;if(e=0,i=0,n=0,t=cadr(p1),r=caddr(p1),issymbol(r)||stop("sum: 2nd arg?"),push(cadddr(p1)),Eval(),i=pop_integer(),isNaN(i)){push(p1);return}if(push(caddddr(p1)),Eval(),n=pop_integer(),isNaN(n)){push(p1);return}for(p4=get_binding(r),push_integer(0),e=s=a=i,l=n;a<=l?s<=l:s>=l;e=a<=l?++s:--s)push_integer(e),p5=pop(),set_binding(r,p5),push(t),Eval(),add();return set_binding(r,p4)},Eval_tan=function(){return push(cadr(p1)),Eval(),tangent()},tangent=function(){return save(),yytangent(),restore()},yytangent=function(){var t,e;if(e=0,t=0,p1=pop(),car(p1)===symbol(ARCTAN)){push(cadr(p1));return}if(isdouble(p1)){t=Math.tan(p1.d),Math.abs(t)<1e-10&&(t=0),push_double(t);return}if(isnegative(p1)){push(p1),negate(),tangent(),negate();return}if(push(p1),push_integer(180),multiply(),evaluatingAsFloats?push_double(Math.PI):push_symbol(PI),divide(),e=pop_integer(),e<0||isNaN(e)){push(symbol(TAN)),push(p1),list(2);return}switch(e%360){case 0:case 180:return push_integer(0);case 30:case 210:return push_rational(1,3),push_integer(3),push_rational(1,2),power(),multiply();case 150:case 330:return push_rational(-1,3),push_integer(3),push_rational(1,2),power(),multiply();case 45:case 225:return push_integer(1);case 135:case 315:return push_integer(-1);case 60:case 240:return push_integer(3),push_rational(1,2),power();case 120:case 300:return push_integer(3),push_rational(1,2),power(),negate();default:return push(symbol(TAN)),push(p1),list(2)}},Eval_tanh=function(){var t;if(t=0,push(cadr(p1)),Eval(),p1=pop(),car(p1)===symbol(ARCTANH)){push(cadr(p1));return}if(isdouble(p1)){t=Math.tanh(p1.d),Math.abs(t)<1e-10&&(t=0),push_double(t);return}if(isZeroAtomOrTensor(p1)){push(zero);return}return push_symbol(TANH),push(p1),list(2)},Eval_taylor=function(){return p1=cdr(p1),push(car(p1)),Eval(),p1=cdr(p1),push(car(p1)),Eval(),p2=pop(),p2===symbol(NIL)?guess():push(p2),p1=cdr(p1),push(car(p1)),Eval(),p2=pop(),p2===symbol(NIL)?push_integer(24):push(p2),p1=cdr(p1),push(car(p1)),Eval(),p2=pop(),p2===symbol(NIL)?push_integer(0):push(p2),taylor()},taylor=function(){var t,e,r,i;if(t=0,e=0,save(),p4=pop(),p3=pop(),p2=pop(),p1=pop(),push(p3),e=pop_integer(),isNaN(e)){push_symbol(TAYLOR),push(p1),push(p2),push(p3),push(p4),list(5),restore();return}for(push(p1),push(p2),push(p4),subst(),Eval(),push_integer(1),p5=pop(),t=r=1,i=e;(1<=i?r<=i:r>=i)&&(push(p1),push(p2),derivative(),p1=pop(),!isZeroAtomOrTensor(p1));t=1<=i?++r:--r)push(p5),push(p2),push(p4),subtract(),multiply(),p5=pop(),push(p1),push(p2),push(p4),subst(),Eval(),push(p5),multiply(),push_integer(t),factorial(),divide(),add();return restore()},Eval_tensor=function(){var t,e,r,i,n,s,a,l,u;for(r=0,s=0,a=0,check_tensor_dimensions(p1),a=p1.tensor.nelem,s=p1.tensor.ndim,p2=alloc_tensor(a),p2.tensor.ndim=s,r=i=0,l=s;0<=l?i<l:i>l;r=0<=l?++i:--i)p2.tensor.dim[r]=p1.tensor.dim[r];for(t=p1.tensor.elem,e=p2.tensor.elem,check_tensor_dimensions(p2),r=n=0,u=a;0<=u?n<u:n>u;r=0<=u?++n:--n)push(t[r]),Eval(),e[r]=pop();return check_tensor_dimensions(p1),check_tensor_dimensions(p2),push(p2),promote_tensor()},tensor_plus_tensor=function(){var t,e,r,i,n,s,a,l,u,p,f,c;if(i=0,l=0,u=0,save(),p2=pop(),p1=pop(),l=p1.tensor.ndim,l!==p2.tensor.ndim){push(symbol(NIL)),restore();return}for(i=n=0,p=l;0<=p?n<p:n>p;i=0<=p?++n:--n)if(p1.tensor.dim[i]!==p2.tensor.dim[i]){push(symbol(NIL)),restore();return}for(u=p1.tensor.nelem,p3=alloc_tensor(u),p3.tensor.ndim=l,i=s=0,f=l;0<=f?s<f:s>f;i=0<=f?++s:--s)p3.tensor.dim[i]=p1.tensor.dim[i];for(t=p1.tensor.elem,e=p2.tensor.elem,r=p3.tensor.elem,i=a=0,c=u;0<=c?a<c:a>c;i=0<=c?++a:--a)push(t[i]),push(e[i]),add(),r[i]=pop();return push(p3),restore()},tensor_times_scalar=function(){var t,e,r,i,n,s,a,l,u;for(r=0,s=0,a=0,save(),p2=pop(),p1=pop(),s=p1.tensor.ndim,a=p1.tensor.nelem,p3=alloc_tensor(a),p3.tensor.ndim=s,r=i=0,l=s;0<=l?i<l:i>l;r=0<=l?++i:--i)p3.tensor.dim[r]=p1.tensor.dim[r];for(t=p1.tensor.elem,e=p3.tensor.elem,r=n=0,u=a;0<=u?n<u:n>u;r=0<=u?++n:--n)push(t[r]),push(p2),multiply(),e[r]=pop();return push(p3),restore()},scalar_times_tensor=function(){var t,e,r,i,n,s,a,l,u;for(r=0,s=0,a=0,save(),p2=pop(),p1=pop(),s=p2.tensor.ndim,a=p2.tensor.nelem,p3=alloc_tensor(a),p3.tensor.ndim=s,r=i=0,l=s;0<=l?i<l:i>l;r=0<=l?++i:--i)p3.tensor.dim[r]=p2.tensor.dim[r];for(t=p2.tensor.elem,e=p3.tensor.elem,r=n=0,u=a;0<=u?n<u:n>u;r=0<=u?++n:--n)push(p1),push(t[r]),multiply(),e[r]=pop();return push(p3),restore()},check_tensor_dimensions=function(t){if(t.tensor.nelem!==t.tensor.elem.length){console.log("something wrong in tensor dimensions");debugger}},d_tensor_tensor=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h;if(i=0,n=0,u=0,p=0,u=p1.tensor.ndim,p=p1.tensor.nelem,u+1>=MAXDIM){push_symbol(DERIVATIVE),push(p1),push(p2),list(3);return}for(p3=alloc_tensor(p*p2.tensor.nelem),p3.tensor.ndim=u+1,i=s=0,f=u;0<=f?s<f:s>f;i=0<=f?++s:--s)p3.tensor.dim[i]=p1.tensor.dim[i];for(p3.tensor.dim[u]=p2.tensor.dim[0],t=p1.tensor.elem,e=p2.tensor.elem,r=p3.tensor.elem,i=a=0,c=p;0<=c?a<c:a>c;i=0<=c?++a:--a)for(n=l=0,h=p2.tensor.nelem;0<=h?l<h:l>h;n=0<=h?++l:--l)push(t[i]),push(e[n]),derivative(),r[i*p2.tensor.nelem+n]=pop();return push(p3)},d_scalar_tensor=function(){var t,e,r,i,n;for(p3=alloc_tensor(p2.tensor.nelem),p3.tensor.ndim=1,p3.tensor.dim[0]=p2.tensor.dim[0],t=p2.tensor.elem,e=p3.tensor.elem,r=i=0,n=p2.tensor.nelem;0<=n?i<n:i>n;r=0<=n?++i:--i)push(p1),push(t[r]),derivative(),e[r]=pop();return push(p3)},d_tensor_scalar=function(){var t,e,r,i,n,s,a;for(r=0,p3=alloc_tensor(p1.tensor.nelem),p3.tensor.ndim=p1.tensor.ndim,r=i=0,s=p1.tensor.ndim;0<=s?i<s:i>s;r=0<=s?++i:--i)p3.tensor.dim[r]=p1.tensor.dim[r];for(t=p1.tensor.elem,e=p3.tensor.elem,r=n=0,a=p1.tensor.nelem;0<=a?n<a:n>a;r=0<=a?++n:--n)push(t[r]),push(p2),derivative(),e[r]=pop();return push(p3)},compare_tensors=function(t,e){var r,i,n,s,a;if(r=0,t.tensor.ndim<e.tensor.ndim)return-1;if(t.tensor.ndim>e.tensor.ndim)return 1;for(r=i=0,s=t.tensor.ndim;0<=s?i<s:i>s;r=0<=s?++i:--i){if(t.tensor.dim[r]<e.tensor.dim[r])return-1;if(t.tensor.dim[r]>e.tensor.dim[r])return 1}for(r=n=0,a=t.tensor.nelem;0<=a?n<a:n>a;r=0<=a?++n:--n)if(!equal(t.tensor.elem[r],e.tensor.elem[r]))return lessp(t.tensor.elem[r],e.tensor.elem[r])?-1:1;return 0},power_tensor=function(){var t,e,r,i,n,s,a,l;if(t=0,e=0,n=0,e=p1.tensor.ndim-1,p1.tensor.dim[0]!==p1.tensor.dim[e]){push_symbol(POWER),push(p1),push(p2),list(3);return}if(push(p2),n=pop_integer(),isNaN(n)){push_symbol(POWER),push(p1),push(p2),list(3);return}if(n===0){for(p1.tensor.ndim!==2&&stop("power(tensor,0) with tensor rank not equal to 2"),n=p1.tensor.dim[0],p1=alloc_tensor(n*n),p1.tensor.ndim=2,p1.tensor.dim[0]=n,p1.tensor.dim[1]=n,t=r=0,s=n;0<=s?r<s:r>s;t=0<=s?++r:--r)p1.tensor.elem[n*t+t]=one;check_tensor_dimensions(p1),push(p1);return}for(n<0&&(n=-n,push(p1),inv(),p1=pop()),push(p1),l=[],t=i=1,a=n;(1<=a?i<a:i>a)&&(push(p1),inner(),!isZeroAtomOrTensor(stack[tos-1]));t=1<=a?++i:--i)l.push(void 0);return l},copy_tensor=function(){var t,e,r,i,n;for(t=0,save(),p1=pop(),p2=alloc_tensor(p1.tensor.nelem),p2.tensor.ndim=p1.tensor.ndim,t=e=0,i=p1.tensor.ndim;0<=i?e<i:e>i;t=0<=i?++e:--e)p2.tensor.dim[t]=p1.tensor.dim[t];for(t=r=0,n=p1.tensor.nelem;0<=n?r<n:r>n;t=0<=n?++r:--r)p2.tensor.elem[t]=p1.tensor.elem[t];return check_tensor_dimensions(p1),check_tensor_dimensions(p2),push(p2),restore()},promote_tensor=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h,d,m;if(t=0,e=0,r=0,l=0,a=0,save(),p1=pop(),!istensor(p1)){push(p1),restore();return}for(p2=p1.tensor.elem[0],t=i=1,f=p1.tensor.nelem;1<=f?i<f:i>f;t=1<=f?++i:--i)compatible(p2,p1.tensor.elem[t])||stop("Cannot promote tensor due to inconsistent tensor components.");if(!istensor(p2)){push(p1),restore();return}for(a=p1.tensor.ndim+p2.tensor.ndim,a>MAXDIM&&stop("tensor rank > "+MAXDIM),l=p1.tensor.nelem*p2.tensor.nelem,p3=alloc_tensor(l),p3.tensor.ndim=a,t=n=0,c=p1.tensor.ndim;0<=c?n<c:n>c;t=0<=c?++n:--n)p3.tensor.dim[t]=p1.tensor.dim[t];for(e=s=0,h=p2.tensor.ndim;0<=h?s<h:s>h;e=0<=h?++s:--s)p3.tensor.dim[t+e]=p2.tensor.dim[e];for(r=0,t=u=0,d=p1.tensor.nelem;0<=d?u<d:u>d;t=0<=d?++u:--u)for(p2=p1.tensor.elem[t],e=p=0,m=p2.tensor.nelem;0<=m?p<m:p>m;e=0<=m?++p:--p)p3.tensor.elem[r++]=p2.tensor.elem[e];return check_tensor_dimensions(p2),check_tensor_dimensions(p3),push(p3),restore()},compatible=function(t,e){var r,i,n;if(!istensor(t)&&!istensor(e))return 1;if(!istensor(t)||!istensor(e)||t.tensor.ndim!==e.tensor.ndim)return 0;for(r=i=0,n=t.tensor.ndim;0<=n?i<n:i>n;r=0<=n?++i:--i)if(t.tensor.dim[r]!==e.tensor.dim[r])return 0;return 1},Eval_test=function(){var t,e;for(e=p1,p1=cdr(p1);iscons(p1);){if(cdr(p1)===symbol(NIL)){push(car(p1)),Eval();return}if(t=isZeroLikeOrNonZeroLikeOrUndetermined(car(p1)),t==null){push(e);return}else if(t){push(cadr(p1)),Eval();return}else p1=cddr(p1)}return push_integer(0)},Eval_testeq=function(){var t,e,r;if(e=p1,push(cadr(p1)),Eval(),push(caddr(p1)),Eval(),subtract(),r=pop(),t=isZeroLikeOrNonZeroLikeOrUndetermined(r),t){push_integer(0);return}else if(t!=null&&!t){push_integer(1);return}if(push(cadr(p1)),Eval(),simplify(),push(caddr(p1)),Eval(),simplify(),subtract(),r=pop(),t=isZeroLikeOrNonZeroLikeOrUndetermined(r),t){push_integer(0);return}else if(t!=null&&!t){push_integer(1);return}return push(e)},Eval_testge=function(){var t,e;if(e=p1,t=cmp_args(),t==null){push(e);return}return t>=0?push_integer(1):push_integer(0)},Eval_testgt=function(){var t,e;if(e=p1,t=cmp_args(),t==null){push(e);return}return t>0?push_integer(1):push_integer(0)},Eval_testle=function(){var t,e;if(e=p1,t=cmp_args(),t==null){push(e);return}return t<=0?push_integer(1):push_integer(0)},Eval_testlt=function(){var t,e;if(e=p1,t=cmp_args(),t==null){push(e);return}return t<0?push_integer(1):push_integer(0)},Eval_not=function(){var t,e;return e=p1,t=isZeroLikeOrNonZeroLikeOrUndetermined(cadr(p1)),t==null?push(e):push_integer(t?0:1)},Eval_and=function(){var t,e,r,i;for(i=p1,t=cdr(i),r=!1;iscons(t);)if(e=isZeroLikeOrNonZeroLikeOrUndetermined(car(t)),e==null)r=!0,t=cdr(t);else if(e)t=cdr(t);else if(!e){push_integer(0);return}return r?push(i):push_integer(1)},Eval_or=function(){var t,e,r,i;for(i=p1,e=cdr(i),r=!1;iscons(e);)if(t=isZeroLikeOrNonZeroLikeOrUndetermined(car(e)),t==null)r=!0,e=cdr(e);else if(t){push_integer(1);return}else t||(e=cdr(e));return r?push(i):push_integer(0)},cmp_args=function(){var t;if(t=0,push(cadr(p1)),Eval(),simplify(),push(caddr(p1)),Eval(),simplify(),subtract(),p1=pop(),p1.k!==NUM&&p1.k!==DOUBLE&&(push(p1),yyfloat(),Eval(),p1=pop()),isZeroAtomOrTensor(p1))return 0;switch(p1.k){case NUM:MSIGN(p1.q.a)===-1?t=-1:t=1;break;case DOUBLE:p1.d<0?t=-1:t=1;break;default:t=null}return t},transform=function(t,e){var r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x;if(g=0,save(),p1=null,p4=pop(),p3=pop(),DEBUG&&console.log("         !!!!!!!!!   transform on: "+p3),saveMetaBindings(),set_binding(symbol(METAX),p4),g=tos,push_integer(1),push(p3),push(p4),polyform(),push(p4),r=tos-2,decomp(e),f=tos-r,DEBUG)for(console.log("  "+f+" decomposed elements ====== "),n=s=0,c=f;0<=c?s<c:s>c;n=0<=c?++s:--s)console.log("  decomposition element "+n+": "+stack[tos-1-n]);if(b=!1,e){if(!isNumericAtom(p3))if(_=t,DEBUG&&console.log("applying transform: "+_),DEBUG&&console.log("scanning table entry "+_),push(_),push(symbol(SYMBOL_A_UNDERSCORE)),push(symbol(METAA)),subst(),push(symbol(SYMBOL_B_UNDERSCORE)),push(symbol(METAB)),subst(),push(symbol(SYMBOL_X_UNDERSCORE)),push(symbol(METAX)),subst(),p1=pop(),p5=car(p1),DEBUG&&console.log("template expression: "+p5),p6=cadr(p1),p7=cddr(p1),f_equals_a(g,e))b=!0;else{for(DEBUG&&console.log("p3 at this point: "+p3),x=[],DEBUG&&console.log("car(p3): "+car(p3)),h=p3,iscons(h)&&(x.push(car(p3)),h=cdr(p3));iscons(h);)d=car(h),h=cdr(h),DEBUG&&console.log("tos before recursive transform: "+tos),push(d),push_symbol(NIL),DEBUG&&console.log("testing: "+d),DEBUG&&console.log("about to try to simplify other term: "+d),m=transform(t,e),b=b||m,x.push(pop()),DEBUG&&console.log("tried to simplify other term: "+d+" ...successful?: "+m+" ...transformed: "+x[x.length-1]);if(x.length!==0){for(u=0,a=x.length;u<a;u++)n=x[u],push(n);list(x.length),p6=pop()}}}else for(p=0,l=t.length;p<l;p++){if(i=t[p],DEBUG&&(console.log("scanning table entry "+i),(i+"").indexOf("f(sqrt(a+b*x),2/3*1/b*sqrt((a+b*x)^3))")!==-1))debugger;if(i&&(scan_meta(i),p1=pop(),p5=cadr(p1),p6=caddr(p1),p7=cdddr(p1),f_equals_a(g,e))){b=!0;break}}return moveTos(g),b?(push(p6),Eval(),p1=pop(),b=!0):e?p1=p3:p1=symbol(NIL),restoreMetaBindings(),push(p1),restore(),b},saveMetaBindings=function(){return push(get_binding(symbol(METAA))),push(get_binding(symbol(METAB))),push(get_binding(symbol(METAX)))},restoreMetaBindings=function(){return set_binding(symbol(METAX),pop()),set_binding(symbol(METAB),pop()),set_binding(symbol(METAA),pop())},f_equals_a=function(t,e){var r,i,n,s,a,l,u,p,f;for(r=0,i=0,r=n=l=t,u=tos;l<=u?n<u:n>u;r=l<=u?++n:--n)for(set_binding(symbol(METAA),stack[r]),DEBUG&&console.log("  binding METAA to "+get_binding(symbol(METAA))),i=s=p=t,f=tos;p<=f?s<f:s>f;i=p<=f?++s:--s){for(set_binding(symbol(METAB),stack[i]),DEBUG&&console.log("  binding METAB to "+get_binding(symbol(METAB))),p1=p7;iscons(p1)&&(push(car(p1)),Eval(),p2=pop(),!isZeroAtomOrTensor(p2));)p1=cdr(p1);if(!iscons(p1)&&(push(p3),DEBUG&&console.log("about to evaluate template expression: "+p5+" binding METAA to "+get_binding(symbol(METAA))+" and binding METAB to "+get_binding(symbol(METAB))+" and binding METAX to "+get_binding(symbol(METAX))),push(p5),e&&(a=expanding,expanding=!1),Eval(),e&&(expanding=a),DEBUG&&console.log("  comparing "+stack[tos-1]+" to: "+stack[tos-2]),subtract(),p1=pop(),isZeroAtomOrTensor(p1)))return DEBUG&&(console.log("binding METAA to "+get_binding(symbol(METAA))),console.log("binding METAB to "+get_binding(symbol(METAB))),console.log("binding METAX to "+get_binding(symbol(METAX))),console.log("comparing "+p3+" to: "+p5)),1}return 0},Eval_transpose=function(){return push(cadr(p1)),Eval(),cddr(p1)===symbol(NIL)?(push_integer(1),push_integer(2)):(push(caddr(p1)),Eval(),push(cadddr(p1)),Eval()),transpose()},transpose=function(){var t,e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee;for(a=0,p=0,f=0,c=0,d=0,g=0,b=0,ee=0,r=[],i=[],a=h=0,I=MAXDIM;0<=I?h<I:h>I;a=0<=I?++h:--h)r[a]=0,i[a]=0;if(save(),p3=pop(),p2=pop(),p1=pop(),isNumericAtom(p1)){push(p1),restore();return}if((isplusone(p2)&&isplustwo(p3)||isplusone(p3)&&isplustwo(p2))&&isidentitymatrix(p1)){push(p1),restore();return}if(istranspose(p1)&&(l=car(cdr(cdr(p1))),u=car(cdr(cdr(cdr(p1)))),equal(l,p3)&&equal(u,p2)||equal(u,p3)&&equal(l,p2)||equal(l,symbol(NIL))&&equal(u,symbol(NIL))&&(isplusone(p3)&&isplustwo(p2)||isplusone(p2)&&isplustwo(p3)))){push(car(cdr(p1))),restore();return}if(expanding&&isadd(p1)){for(p1=cdr(p1),push(zero);iscons(p1);)push(car(p1)),push(p2),push(p3),transpose(),add(),p1=cdr(p1);restore();return}if(expanding&&ismultiply(p1)){for(p1=cdr(p1),push(one);iscons(p1);)push(car(p1)),push(p2),push(p3),transpose(),multiply(),p1=cdr(p1);restore();return}if(expanding&&isinnerordot(p1)){for(p1=cdr(p1),e=[];iscons(p1);)e.push([car(p1),p2,p3]),p1=cdr(p1);for(s=m=O=e.length-1;O<=0?m<=0:m>=0;s=O<=0?++m:--m)push(e[s][0]),push(e[s][1]),push(e[s][2]),transpose(),s!==e.length-1&&inner();restore();return}if(!istensor(p1)){if(!isZeroAtomOrTensor(p1)){push_symbol(TRANSPOSE),push(p1),(!isplusone(p2)||!isplustwo(p3))&&(!isplusone(p3)||!isplustwo(p2))?(push(p2),push(p3),list(4)):list(2),restore();return}push(zero),restore();return}if(g=p1.tensor.ndim,b=p1.tensor.nelem,g===1){push(p1),restore();return}for(push(p2),c=pop_integer(),push(p3),d=pop_integer(),(c<1||c>g||d<1||d>g)&&stop("transpose: index out of range"),c--,d--,p2=alloc_tensor(b),p2.tensor.ndim=g,a=_=0,L=g;0<=L?_<L:_>L;a=0<=L?++_:--_)p2.tensor.dim[a]=p1.tensor.dim[a];for(p2.tensor.dim[c]=p1.tensor.dim[d],p2.tensor.dim[d]=p1.tensor.dim[c],t=p1.tensor.elem,n=p2.tensor.elem,a=x=0,P=g;0<=P?x<P:x>P;a=0<=P?++x:--x)r[a]=0,i[a]=p1.tensor.dim[a];for(a=S=0,C=b;0<=C?S<C:S>C;a=0<=C?++S:--S){for(ee=r[c],r[c]=r[d],r[d]=ee,ee=i[c],i[c]=i[d],i[d]=ee,f=0,p=T=0,G=g;0<=G?T<G:T>G;p=0<=G?++T:--T)f=f*i[p]+r[p];for(ee=r[c],r[c]=r[d],r[d]=ee,ee=i[c],i[c]=i[d],i[d]=ee,n[f]=t[a],p=H=B=g-1;(B<=0?H<=0:H>=0)&&!(++r[p]<i[p]);p=B<=0?++H:--H)r[p]=0}return push(p2),restore()},Eval_user_function=function(){var t,e;if(DEBUG&&console.log("Eval_user_function evaluating: "+car(p1)),car(p1)===symbol(SYMBOL_D)&&get_binding(symbol(SYMBOL_D))===symbol(SYMBOL_D)){Eval_derivative();return}if(push(car(p1)),Eval(),t=pop(),isNumericAtom(t)?stop("expected function invocation, found multiplication instead. Use '*' symbol explicitly for multiplication."):istensor(t)?stop("expected function invocation, found tensor product instead. Use 'dot/inner' explicitly."):isstr(t)&&stop("expected function, found string instead."),p3=car(cdr(t)),p4=car(cdr(cdr(t))),p5=cdr(p1),car(t)!==symbol(FUNCTION)||t===car(p1)){for(e=tos,push(t),p1=p5;iscons(p1);)push(car(p1)),Eval(),p1=cdr(p1);list(tos-e);return}for(p1=p4,p2=p5,e=tos;iscons(p1)&&iscons(p2);)push(car(p1)),push(car(p2)),p1=cdr(p1),p2=cdr(p2);return list(tos-e),p6=pop(),push(p3),iscons(p6)&&(push(p6),rewrite_args()),Eval()},rewrite_args=function(){var t,e;if(e=0,save(),p2=pop(),p1=pop(),istensor(p1))return e=rewrite_args_tensor(),restore(),e;if(iscons(p1)){for(t=tos,car(p1)===car(p2)?(push_symbol(EVAL),push(car(cdr(p2))),list(2)):push(car(p1)),p1=cdr(p1);iscons(p1);)push(car(p1)),push(p2),e+=rewrite_args(),p1=cdr(p1);return list(tos-t),restore(),e}if(!issymbol(p1))return push(p1),restore(),0;for(p3=p2;iscons(p3);){if(p1===car(p3))return push(cadr(p3)),restore(),1;p3=cddr(p3)}return p3=get_binding(p1),push(p3),p1!==p3&&(push(p2),e=rewrite_args(),e===0&&(pop(),push(p1))),restore(),e},rewrite_args_tensor=function(){var t,e,r,i;for(r=0,t=0,push(p1),copy_tensor(),p1=pop(),t=e=0,i=p1.tensor.nelem;0<=i?e<i:e>i;t=0<=i?++e:--e)push(p1.tensor.elem[t]),push(p2),r+=rewrite_args(),p1.tensor.elem[t]=pop();return check_tensor_dimensions(p1),push(p1),r},Eval_zero=function(){var t,e,r,i,n,s,a,l;for(t=0,e=[],i=0,s=0,t=r=0,a=MAXDIM;0<=a?r<a:r>a;t=0<=a?++r:--r)e[t]=0;for(i=1,s=0,p2=cdr(p1);iscons(p2);){if(push(car(p2)),Eval(),t=pop_integer(),t<1||isNaN(t)){push(zero);return}i*=t,e[s++]=t,p2=cdr(p2)}if(s===0){push(zero);return}for(p1=alloc_tensor(i),p1.tensor.ndim=s,t=n=0,l=s;0<=l?n<l:n>l;t=0<=l?++n:--n)p1.tensor.dim[t]=e[t];return push(p1)},allocatedId=0,alloc_tensor=function(t){var e,r,i,n;for(e=0,i=new U,i.k=TENSOR,i.tensor=new tensor,i.tensor.nelem=t,e=r=0,n=t;0<=n?r<n:r>n;e=0<=n?++r:--r)i.tensor.elem[e]=zero;return i.tensor.allocatedId=allocatedId,allocatedId++,check_tensor_dimensions(i),i},Find=function(t,e){var r,i,n;if(r=0,equal(t,e))return 1;if(istensor(t)){for(r=i=0,n=t.tensor.nelem;0<=n?i<n:i>n;r=0<=n?++i:--i)if(Find(t.tensor.elem[r],e))return 1;return 0}for(;iscons(t);){if(Find(car(t),e))return 1;t=cdr(t)}return 0},findPossibleClockForm=function(t){var e,r,i;if(e=0,isimaginaryunit(t))return 0;if(car(t)===symbol(POWER)&&!isinteger(caddr(p1))&&Find(cadr(t),imaginaryunit)||car(t)===symbol(POWER)&&equaln(cadr(t),-1)&&!isinteger(caddr(p1)))return 1;if(istensor(t)){for(e=r=0,i=t.tensor.nelem;0<=i?r<i:r>i;e=0<=i?++r:--r)if(findPossibleClockForm(t.tensor.elem[e]))return 1;return 0}for(;iscons(t);){if(findPossibleClockForm(car(t)))return 1;t=cdr(t)}return 0},findPossibleExponentialForm=function(t){var e,r,i;if(e=0,car(t)===symbol(POWER)&&cadr(t)===symbol(E))return Find(caddr(t),imaginaryunit);if(istensor(t)){for(e=r=0,i=t.tensor.nelem;0<=i?r<i:r>i;e=0<=i?++r:--r)if(findPossibleExponentialForm(t.tensor.elem[e]))return 1;return 0}for(;iscons(t);){if(findPossibleExponentialForm(car(t)))return 1;t=cdr(t)}return 0},$.Find=Find,init=function(){var t,e,r;if(t=0,flag=0,reset_after_error(),chainOfUserSymbolsNotFunctionsBeingEvaluated=[],!flag){for(flag=1,t=e=0,r=NSYM;0<=r?e<r:e>r;t=0<=r?++e:--e)symtab[t]=new U,symtab[t].k=SYM,binding[t]=symtab[t],isSymbolReclaimable[t]=!1;return defn()}},defn_str=['version="'+version+'"',"e=exp(1)","i=sqrt(-1)","autoexpand=1","assumeRealVariables=1","trange=[-pi,pi]","xrange=[-10,10]","yrange=[-10,10]","last=0","trace=0","forceFixedPrintout=1","maxFixedPrintoutDigits=6","printLeaveEAlone=1","printLeaveXAlone=0","cross(u,v)=[u[2]*v[3]-u[3]*v[2],u[3]*v[1]-u[1]*v[3],u[1]*v[2]-u[2]*v[1]]","curl(v)=[d(v[3],y)-d(v[2],z),d(v[1],z)-d(v[3],x),d(v[2],x)-d(v[1],y)]","div(v)=d(v[1],x)+d(v[2],y)+d(v[3],z)","ln(x)=log(x)"],defn=function(){var t,e,r,i,n;for(p0=symbol(NIL),p1=symbol(NIL),p2=symbol(NIL),p3=symbol(NIL),p4=symbol(NIL),p5=symbol(NIL),p6=symbol(NIL),p7=symbol(NIL),p8=symbol(NIL),p9=symbol(NIL),std_symbol("abs",ABS),std_symbol("add",ADD),std_symbol("adj",ADJ),std_symbol("and",AND),std_symbol("approxratio",APPROXRATIO),std_symbol("arccos",ARCCOS),std_symbol("arccosh",ARCCOSH),std_symbol("arcsin",ARCSIN),std_symbol("arcsinh",ARCSINH),std_symbol("arctan",ARCTAN),std_symbol("arctanh",ARCTANH),std_symbol("arg",ARG),std_symbol("atomize",ATOMIZE),std_symbol("besselj",BESSELJ),std_symbol("bessely",BESSELY),std_symbol("binding",BINDING),std_symbol("binomial",BINOMIAL),std_symbol("ceiling",CEILING),std_symbol("check",CHECK),std_symbol("choose",CHOOSE),std_symbol("circexp",CIRCEXP),std_symbol("clear",CLEAR),std_symbol("clearall",CLEARALL),std_symbol("clearpatterns",CLEARPATTERNS),std_symbol("clock",CLOCK),std_symbol("coeff",COEFF),std_symbol("cofactor",COFACTOR),std_symbol("condense",CONDENSE),std_symbol("conj",CONJ),std_symbol("contract",CONTRACT),std_symbol("cos",COS),std_symbol("cosh",COSH),std_symbol("decomp",DECOMP),std_symbol("defint",DEFINT),std_symbol("deg",DEGREE),std_symbol("denominator",DENOMINATOR),std_symbol("det",DET),std_symbol("derivative",DERIVATIVE),std_symbol("dim",DIM),std_symbol("dirac",DIRAC),std_symbol("divisors",DIVISORS),std_symbol("do",DO),std_symbol("dot",DOT),std_symbol("draw",DRAW),std_symbol("dsolve",DSOLVE),std_symbol("erf",ERF),std_symbol("erfc",ERFC),std_symbol("eigen",EIGEN),std_symbol("eigenval",EIGENVAL),std_symbol("eigenvec",EIGENVEC),std_symbol("eval",EVAL),std_symbol("exp",EXP),std_symbol("expand",EXPAND),std_symbol("expcos",EXPCOS),std_symbol("expsin",EXPSIN),std_symbol("factor",FACTOR),std_symbol("factorial",FACTORIAL),std_symbol("factorpoly",FACTORPOLY),std_symbol("filter",FILTER),std_symbol("float",FLOATF),std_symbol("floor",FLOOR),std_symbol("for",FOR),std_symbol("function",FUNCTION),std_symbol("Gamma",GAMMA),std_symbol("gcd",GCD),std_symbol("hermite",HERMITE),std_symbol("hilbert",HILBERT),std_symbol("imag",IMAG),std_symbol("component",INDEX),std_symbol("inner",INNER),std_symbol("integral",INTEGRAL),std_symbol("inv",INV),std_symbol("invg",INVG),std_symbol("isinteger",ISINTEGER),std_symbol("isprime",ISPRIME),std_symbol("laguerre",LAGUERRE),std_symbol("lcm",LCM),std_symbol("leading",LEADING),std_symbol("legendre",LEGENDRE),std_symbol("log",LOG),std_symbol("lookup",LOOKUP),std_symbol("mod",MOD),std_symbol("multiply",MULTIPLY),std_symbol("not",NOT),std_symbol("nroots",NROOTS),std_symbol("number",NUMBER),std_symbol("numerator",NUMERATOR),std_symbol("operator",OPERATOR),std_symbol("or",OR),std_symbol("outer",OUTER),std_symbol("pattern",PATTERN),std_symbol("patternsinfo",PATTERNSINFO),std_symbol("polar",POLAR),std_symbol("power",POWER),std_symbol("prime",PRIME),std_symbol("print",PRINT),std_symbol("print2dascii",PRINT2DASCII),std_symbol("printcomputer",PRINTFULL),std_symbol("printlatex",PRINTLATEX),std_symbol("printlist",PRINTLIST),std_symbol("printhuman",PRINTPLAIN),std_symbol("printLeaveEAlone",PRINT_LEAVE_E_ALONE),std_symbol("printLeaveXAlone",PRINT_LEAVE_X_ALONE),std_symbol("product",PRODUCT),std_symbol("quote",QUOTE),std_symbol("quotient",QUOTIENT),std_symbol("rank",RANK),std_symbol("rationalize",RATIONALIZE),std_symbol("real",REAL),std_symbol("rect",YYRECT),std_symbol("roots",ROOTS),std_symbol("round",ROUND),std_symbol("equals",SETQ),std_symbol("sgn",SGN),std_symbol("silentpattern",SILENTPATTERN),std_symbol("simplify",SIMPLIFY),std_symbol("sin",SIN),std_symbol("sinh",SINH),std_symbol("shape",SHAPE),std_symbol("sqrt",SQRT),std_symbol("stop",STOP),std_symbol("subst",SUBST),std_symbol("sum",SUM),std_symbol("symbolsinfo",SYMBOLSINFO),std_symbol("tan",TAN),std_symbol("tanh",TANH),std_symbol("taylor",TAYLOR),std_symbol("test",TEST),std_symbol("testeq",TESTEQ),std_symbol("testge",TESTGE),std_symbol("testgt",TESTGT),std_symbol("testle",TESTLE),std_symbol("testlt",TESTLT),std_symbol("transpose",TRANSPOSE),std_symbol("unit",UNIT),std_symbol("zero",ZERO),std_symbol("nil",NIL),std_symbol("autoexpand",AUTOEXPAND),std_symbol("bake",BAKE),std_symbol("assumeRealVariables",ASSUME_REAL_VARIABLES),std_symbol("last",LAST),std_symbol("lastprint",LAST_PRINT),std_symbol("last2dasciiprint",LAST_2DASCII_PRINT),std_symbol("lastfullprint",LAST_FULL_PRINT),std_symbol("lastlatexprint",LAST_LATEX_PRINT),std_symbol("lastlistprint",LAST_LIST_PRINT),std_symbol("lastplainprint",LAST_PLAIN_PRINT),std_symbol("trace",TRACE),std_symbol("forceFixedPrintout",FORCE_FIXED_PRINTOUT),std_symbol("maxFixedPrintoutDigits",MAX_FIXED_PRINTOUT_DIGITS),std_symbol("~",YYE),std_symbol("$DRAWX",DRAWX),std_symbol("$METAA",METAA),std_symbol("$METAB",METAB),std_symbol("$METAX",METAX),std_symbol("$SECRETX",SECRETX),std_symbol("version",VERSION),std_symbol("pi",PI),std_symbol("a",SYMBOL_A),std_symbol("b",SYMBOL_B),std_symbol("c",SYMBOL_C),std_symbol("d",SYMBOL_D),std_symbol("i",SYMBOL_I),std_symbol("j",SYMBOL_J),std_symbol("n",SYMBOL_N),std_symbol("r",SYMBOL_R),std_symbol("s",SYMBOL_S),std_symbol("t",SYMBOL_T),std_symbol("x",SYMBOL_X),std_symbol("y",SYMBOL_Y),std_symbol("z",SYMBOL_Z),std_symbol("I",SYMBOL_IDENTITY_MATRIX),std_symbol("a_",SYMBOL_A_UNDERSCORE),std_symbol("b_",SYMBOL_B_UNDERSCORE),std_symbol("x_",SYMBOL_X_UNDERSCORE),std_symbol("$C1",C1),std_symbol("$C2",C2),std_symbol("$C3",C3),std_symbol("$C4",C4),std_symbol("$C5",C5),std_symbol("$C6",C6),defineSomeHandyConstants(),i=codeGen,codeGen=!1,e=r=0,n=defn_str.length;0<=n?r<n:r>n;e=0<=n?++r:--r)t=defn_str[e],scan(t),DEBUG&&(console.log("... evaling "+t),console.log("top of stack:"),console.log(print_list(stack[tos-1]))),Eval(),pop();return codeGen=i},defineSomeHandyConstants=function(){return zero=new_integer(0),one=new_integer(1),push_double(1),one_as_double=pop(),push_symbol(POWER),DEBUG&&console.log(print_list(stack[tos-1])),push_integer(-1),DEBUG&&console.log(print_list(stack[tos-1])),push_rational(1,2),DEBUG&&console.log(print_list(stack[tos-1])),list(3),DEBUG&&console.log(print_list(stack[tos-1])),imaginaryunit=pop()},mcmp=function(t,e){return t.compare(e)},strcmp=function(t,e){return t===e?0:t>e?1:-1},doubleToReasonableString=function(t){var e,r;return codeGen?""+t:(isZeroAtomOrTensor(get_binding(symbol(FORCE_FIXED_PRINTOUT)))?(r=""+t,printMode===PRINTMODE_LATEX?/\d*\.\d*e.*/gm.test(r)?r=r.replace(/e(.*)/gm,"\\mathrm{e}{$1}"):r=r.replace(/(\d+)e(.*)/gm,"$1.0\\mathrm{e}{$2}"):/\d*\.\d*e.*/gm.test(r)?r=r.replace(/e(.*)/gm,"*10^($1)"):r=r.replace(/(\d+)e(.*)/gm,"$1.0*10^($2)")):(push(get_binding(symbol(MAX_FIXED_PRINTOUT_DIGITS))),e=pop_integer(),r=""+t.toFixed(e),r=r.replace(/(\.\d*?[1-9])0+$/gm,"$1"),r=r.replace(/\.0+$/gm,""),r.indexOf(".")===-1&&(r+=".0"),parseFloat(r)!==t&&(r=t.toFixed(e)+"...")),r)},clear_term=function(){},isspace=function(t){return t==null?!1:t===" "||t==="	"||t===`
`||t==="\v"||t==="\f"||t==="\r"},isdigit=function(t){return t==null?!1:/^\d+$/.test(t)},isalpha=function(t){return t==null?!1:t.search(/[^A-Za-z]/)===-1},isalphaOrUnderscore=function(t){return t==null?!1:t.search(/[^A-Za-z_]/)===-1},isalnumorunderscore=function(t){return t==null?!1:isalphaOrUnderscore(t)||isdigit(t)},count=function(t){var e;if(iscons(t))for(e=0;iscons(t);)e+=count(car(t))+1,t=cdr(t);else e=1;return e},countOccurrencesOfSymbol=function(t,e){var r;if(r=0,iscons(e))for(;iscons(e);)r+=countOccurrencesOfSymbol(t,car(e)),e=cdr(e);else equal(t,e)&&(r=1);return r},countsize=function(t){var e,r,i,n;if(i=0,istensor(t))for(e=r=0,n=t.tensor.nelem;0<=n?r<n:r>n;e=0<=n?++r:--r)i+=t.tensor.elem[e];else if(iscons(t))for(;iscons(t);)i+=count(car(t))+1,t=cdr(t);else i=1;return i},stop=function(t){var e;throw errorMessage+="Stop: ",errorMessage+=t,e=errorMessage,errorMessage="",moveTos(0),new Error(e)},findDependenciesInScript=function(t,e){var r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le,ce,se,de,fe,X,he,ne,ge,Ee,be,_e,ye;for(DEBUG&&console.log("stringToBeParsed: "+t),ne=new Date().getTime(),codeGen=!0,symbolsDependencies={},symbolsHavingReassignments=[],symbolsInExpressionsWithoutAssignments=[],patternHasBeenFound=!1,m=0,i="",r="",G=0,l={affectsVariables:[],affectedBy:[]},fe=t;;){try{errorMessage="",check_stack(),DEBUG&&console.log("findDependenciesInScript: scanning"),G=scan(t.substring(m)),DEBUG&&console.log("scanned"),pop(),check_stack()}catch(Te){p=Te,PRINTOUTRESULT&&console.log(p),errorMessage=p+"",reset_after_error();break}if(G===0)break;m+=G}he="",DEBUG&&console.log("all local dependencies ----------------"),he+="All local dependencies: ";for(_ in symbolsDependencies){for(_e=symbolsDependencies[_],DEBUG&&console.log("variable "+_+" depends on: "),l.affectsVariables.push(_),he+=" variable "+_+" depends on: ",g=0,b=_e.length;g<b;g++)h=_e[g],DEBUG&&console.log("    "+h),h[0]!=="'"&&l.affectedBy.push(h),he+=h+", ";he+="; "}for(he+=". ",DEBUG&&console.log("Symbols with reassignments ----------------"),he+="Symbols with reassignments: ",C=0,x=symbolsHavingReassignments.length;C<x;C++)_=symbolsHavingReassignments[C],l.affectedBy.indexOf(_)===-1&&(l.affectedBy.push(_),he+=_+", ");for(he+=". ",DEBUG&&console.log("Symbols in expressions without assignments ----------------"),he+="Symbols in expressions without assignments: ",B=0,S=symbolsInExpressionsWithoutAssignments.length;B<S;B++)_=symbolsInExpressionsWithoutAssignments[B],l.affectedBy.indexOf(_)===-1&&(l.affectedBy.push(_),he+=_+", ");if(he+=". ",l.affectedBy.push("PATTERN_DEPENDENCY"),patternHasBeenFound&&(l.affectsVariables.push("PATTERN_DEPENDENCY"),he+=" - PATTERN_DEPENDENCY inserted - "),DEBUG&&console.log("All dependencies recursively ----------------"),he+="All dependencies recursively: ",de=["",""],c="",ae="",errorMessage===""&&!e){try{i="",r="",de=run(t,!0),i="",r=""}catch(Te){p=Te,PRINTOUTRESULT&&console.log(p),errorMessage=p+"",init()}if(errorMessage==="")for(_ in symbolsDependencies){for(codeGen=!0,DEBUG&&console.log("  variable "+_+" is: "+get_binding(usr_symbol(_)).toString()),codeGen=!1,DEBUG&&console.log("  variable "+_+" depends on: "),he+=" variable "+_+" depends on: ",oe=[],ye=[],s=[],recursiveDependencies(_,oe,[],ye,[],s),ee=0,T=ye.length;ee<T;ee++)h=ye[ee],DEBUG&&console.log("    --> cycle through "+h);for(Z=0,I=oe.length;Z<I;Z++)h=oe[Z],DEBUG&&console.log("    "+h),he+=h+", ";for(he+="; ",pe=0,O=s.length;pe<O;pe++)h=s[pe],he+=" "+h+", ";for(DEBUG&&console.log("  code generation:"+_+" is: "+get_binding(usr_symbol(_)).toString()),push(get_binding(usr_symbol(_))),le=[],ce=[],se=0,L=oe.length;se<L;se++)u=oe[se],u[0]==="'"&&(a=u.substring(1),te=usr_symbol(a),H=usr_symbol("AVOID_BINDING_TO_EXTERNAL_SCOPE_VALUE"+a),le.push(te),ce.push(H),push(te),push(H),subst(),DEBUG&&console.log("after substitution: "+stack[tos-1]));try{simplifyForCodeGeneration()}catch(Te){p=Te,PRINTOUTRESULT&&console.log(p),errorMessage=p+"",init()}for(d=X=0,me=le.length;0<=me?X<me:X>me;d=0<=me?++X:--X)push(ce[d]),push(le[d]),subst();if(clearRenamedVariablesToAvoidBindingToExternalScope(),errorMessage===""){if(ge=pop(),be=[],collectUserSymbols(ge,be),i="",r="",codeGen=!0,f=ge.toString(),codeGen=!1,j=printMode,printMode=PRINTMODE_LATEX,n=ge.toString(),printMode=j,ye.indexOf(_)!==-1)c+="// "+_+" is part of a cyclic dependency, no code generated.",ae+="#"+_+" is part of a cyclic dependency, no code generated.";else if(be=be.filter(function(Te){return predefinedSymbolsInGlobalScope_doNotTrackInDependencies.indexOf(Te+"")===-1}),be=be.filter(function(Te){return oe.indexOf(Te+"")!==-1||oe.indexOf("'"+Te)!==-1}),be.length!==0){for(J="(",Ee=0,P=be.length;Ee<P;Ee++)h=be[Ee],h.printname!==_&&(J+=h.printname+", ");J=J.replace(/, $/gm,""),J+=")",c+=_+" = function "+J+" { return ( "+f+" ); }",ae+=_+J+" = "+n}else c+=_+" = "+f+";",ae+=_+" = "+n;c+=`
`,ae+=`
`,DEBUG&&console.log("    "+c)}}}return c=c.replace(/\n$/gm,""),ae=ae.replace(/\n$/gm,""),symbolsDependencies={},symbolsHavingReassignments=[],patternHasBeenFound=!1,symbolsInExpressionsWithoutAssignments=[],DEBUG&&console.log("testable string: "+he),TIMING_DEBUGS&&console.log("findDependenciesInScript time for: "+fe+" : "+(new Date().getTime()-ne)+"ms"),[he,de[0],c,ae,de[1],errorMessage,l]},recursiveDependencies=function(t,e,r,i,n,s){var a,l,u,p,f,c,h,d;if(r.push(t),symbolsDependencies[n[n.length-1]]!=null&&symbolsDependencies[n[n.length-1]].indexOf("'"+t)!==-1)return DEBUG&&console.log("can't keep following the chain of "+t+" because it's actually a variable bound to a parameter"),e.indexOf("'"+t)===-1&&e.indexOf(t)===-1&&e.push(t),e;if(n.push(t),symbolsDependencies[t]==null)return e.indexOf(t)===-1&&e.push(t),e;for(d=symbolsDependencies[t],p=0,f=d.length;p<f;p++)if(l=d[p],n.indexOf(l)!==-1){for(DEBUG&&console.log("  found cycle:"),a="",h=0,c=n.length;h<c;h++)u=n[h],i.indexOf(u)===-1&&i.push(u),DEBUG&&console.log(u+" --> "),a+=u+" --> ";DEBUG&&console.log(" ... then "+l+" again"),a+=" ... then "+l+" again",s.push(a),i.indexOf(l)===-1&&i.push(l)}else recursiveDependencies(l,e,r,i,n,s),n.pop();return e},inited=!1,latexErrorSign="\\rlap{\\large\\color{red}\\bigtriangleup}{\\ \\ \\tiny\\color{red}!}",turnErrorMessageToLatex=function(t){return t=t.replace(/\n/g,""),t=t.replace(/_/g,"} \\_ \\text{"),t=t.replace(new RegExp(String.fromCharCode(transpose_unicode),"g"),"}{}^{T}\\text{"),t=t.replace(new RegExp(String.fromCharCode(dotprod_unicode),"g"),"}\\cdot \\text{"),t=t.replace("Stop:","}  \\quad \\text{Stop:"),t=t.replace("->","}  \\rightarrow \\text{"),t=t.replace("?","}\\enspace "+latexErrorSign+" \\enspace  \\text{"),t="$$\\text{"+t.replace(/\n/g,"")+"}$$",t},normaliseDots=function(t){return t=t.replace(new RegExp("⋅","g"),String.fromCharCode(dotprod_unicode)),t=t.replace(new RegExp("•","g"),String.fromCharCode(dotprod_unicode)),t=t.replace(new RegExp("・","g"),String.fromCharCode(dotprod_unicode)),t=t.replace(new RegExp("\uD800","g"),String.fromCharCode(dotprod_unicode)),t=t.replace(new RegExp("･","g"),String.fromCharCode(dotprod_unicode)),t},TIMING_DEBUGS=!1,run=function(t,e=!1){var r,i,n,s,a,l,u,p,f,c,h;if(c=new Date().getTime(),t=normaliseDots(t),t==="selftest"){selftest();return}for(inited||(inited=!0,init()),u=0,l=0,i="",r="";;){try{errorMessage="",check_stack(),u=scan(t.substring(l)),p1=pop(),check_stack()}catch(d){a=d,PRINTOUTRESULT&&console.log(a),i+=a.message,e&&(f=turnErrorMessageToLatex(a.message),r+=f),reset_after_error();break}if(u===0)break;l+=u,push(p1);try{stringsEmittedByUserPrintouts="",top_level_eval(),p2=pop(),check_stack(),isstr(p2)&&(DEBUG&&console.log(p2.str),DEBUG&&console.log(`
`)),p2===symbol(NIL)?(s=stringsEmittedByUserPrintouts,e&&(n="$$"+stringsEmittedByUserPrintouts+"$$")):(s=print_expr(p2),s+=`
`,e&&(n="$$"+collectLatexStringFromReturnValue(p2)+"$$",DEBUG&&console.log("collectedLatexResult: "+n))),i+=s,e&&(r+=n),PRINTOUTRESULT&&(DEBUG&&console.log("printline"),DEBUG&&console.log(s)),PRINTOUTRESULT&&(DEBUG&&console.log("display:"),print2dascii(p2)),e&&(r+=`
`)}catch(d){a=d,s=a.message,e&&(n=turnErrorMessageToLatex(a.message)),PRINTOUTRESULT&&console.log(s),i+=s,s!==""&&(i+=`
`),e&&(r+=n,r+=`
`),init()}}return i[i.length-1]===`
`&&(i=i.substring(0,i.length-1)),e&&r[r.length-1]===`
`&&(r=r.substring(0,r.length-1)),e?(DEBUG&&console.log("allReturnedLatexStrings: "+r),p=[i,r]):p=i,TIMING_DEBUGS&&(h="run time on: "+t+" : "+(new Date().getTime()-c)+"ms",console.log(h)),i="",r="",p},check_stack=function(){if(tos!==0){debugger;stop("stack error")}if(frame!==TOS){debugger;stop("frame error")}if(chainOfUserSymbolsNotFunctionsBeingEvaluated.length!==0){debugger;stop("symbols evaluation still ongoing?")}if(evaluatingAsFloats!==0){debugger;stop("numeric evaluation still ongoing?")}if(evaluatingPolar!==0){debugger;return stop("evaluation of polar still ongoing?")}},top_level_eval=function(){var t,e,r;if(DEBUG&&console.log("#### top level eval"),trigmode=0,r=symbol(AUTOEXPAND),isZeroAtomOrTensor(get_binding(r))?expanding=0:expanding=1,e=top(),Eval(),t=top(),t!==symbol(NIL)&&(set_binding(symbol(LAST),t),isZeroAtomOrTensor(get_binding(symbol(BAKE)))||(bake(),t=top()),!((e===symbol(SYMBOL_I)||e===symbol(SYMBOL_J))&&isimaginaryunit(t)))){if(isimaginaryunit(get_binding(symbol(SYMBOL_J))))return push(imaginaryunit),push_symbol(SYMBOL_J),subst();if(isimaginaryunit(get_binding(symbol(SYMBOL_I))))return push(imaginaryunit),push_symbol(SYMBOL_I),subst()}},check_esc_flag=function(){if(esc_flag)return stop("esc key")},clearAlgebraEnvironment=function(){return do_clearall()},computeDependenciesFromAlgebra=function(t){var e,r,i,n,s,a,l;if(DEBUG&&console.log("computeDependenciesFromAlgebra!!!"),r=!0,t=normaliseDots(t),!r){for(userSimplificationsInListForm=[],l="",i=0,n=userSimplificationsInListForm.length;i<n;i++)e=userSimplificationsInListForm[i],l+="silentpattern("+car(e)+","+car(cdr(e))+","+car(cdr(cdr(e)))+`)
`;do_clearall(),t=l+t,DEBUG&&console.log("codeFromAlgebraBlock including patterns: "+t)}if(DEBUG){for(console.log("computeDependenciesFromAlgebra: patterns in the list --------------- "),a=0,s=userSimplificationsInListForm.length;a<s;a++)e=userSimplificationsInListForm[a],console.log(car(e)+","+cdr(e)+")");console.log("...end of list --------------- ")}return findDependenciesInScript(t,!0)[6]},computeResultsAndJavaScriptFromAlgebra=function(t){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_;if(n=!0,m=new Date().getTime(),TIMING_DEBUGS&&console.log(" --------- computeResultsAndJavaScriptFromAlgebra input: "+t+" at: "+new Date),t=normaliseDots(t),h=t,DEBUG){for(console.log("computeResultsAndJavaScriptFromAlgebra: patterns in the list --------------- "),s=0,l=userSimplificationsInListForm.length;s<l;s++)i=userSimplificationsInListForm[s],console.log(car(i)+","+cdr(i)+")");console.log("...end of list --------------- ")}if(!n){for(userSimplificationsInListForm=[],_="",p=0,u=userSimplificationsInListForm.length;p<u;p++)i=userSimplificationsInListForm[p],_+="silentpattern("+car(i)+","+car(cdr(i))+","+car(cdr(cdr(i)))+`)
`;do_clearall(),t=_+t,DEBUG&&console.log("codeFromAlgebraBlock including patterns: "+t)}return[d,c,e,f,a,errorMessage,r]=findDependenciesInScript(t),(f!==""||errorMessage!=="")&&(c+=`
`+f,errorMessage!==""&&(c+=`
`+errorMessage),c=c.replace(/\n/g,`

`),a+=`
$$`+f+"$$",errorMessage!==""&&(a+=turnErrorMessageToLatex(errorMessage)),a=a.replace(/\n/g,`

`)),a=a.replace(/\n*/,""),a=a.replace(/\$\$\$\$\n*/g,""),e=e.replace(/Math\./g,""),e=e.replace(/\n/g,`

`),TIMING_DEBUGS&&console.log("computeResultsAndJavaScriptFromAlgebra time (total time from notebook and back) for: "+h+" : "+(new Date().getTime()-m)+"ms"),{code:e,result:a,latexResult:a,dependencyInfo:r}},(exports!==null?exports:this).run=run,(exports!==null?exports:this).findDependenciesInScript=findDependenciesInScript,(exports!==null?exports:this).computeDependenciesFromAlgebra=computeDependenciesFromAlgebra,(exports!==null?exports:this).computeResultsAndJavaScriptFromAlgebra=computeResultsAndJavaScriptFromAlgebra,(exports!==null?exports:this).clearAlgebraEnvironment=clearAlgebraEnvironment,tos=0,nil_symbols=0,push=function(t){if(t==null)debugger;if(t.isZero!=null)debugger;return t===symbol(NIL)&&(nil_symbols++,DEBUG&&console.log("pushing symbol(NIL) #"+nil_symbols)),tos>=frame&&stop("stack overflow"),stack[tos++]=t},moveTos=function(t){if(tos<=t){tos=t;return}for(;tos>t;)stack[tos]=null,tos--},top=function(){return stack[tos-1]},pop=function(){var t;if(tos===0){debugger;stop("stack underflow")}if(stack[tos-1]==null)debugger;return t=stack[--tos],stack[tos]=null,t},push_frame=function(t){var e,r,i,n;if(e=0,frame-=t,frame<tos){debugger;stop("frame overflow, circular reference?")}for(n=[],e=r=0,i=t;0<=i?r<i:r>i;e=0<=i?++r:--r)n.push(stack[frame+e]=symbol(NIL));return n},pop_frame=function(t){if(frame+=t,frame>TOS)return stop("frame underflow")},save=function(){if(frame-=10,frame<tos){debugger;stop("frame overflow, circular reference?")}return stack[frame+0]=p0,stack[frame+1]=p1,stack[frame+2]=p2,stack[frame+3]=p3,stack[frame+4]=p4,stack[frame+5]=p5,stack[frame+6]=p6,stack[frame+7]=p7,stack[frame+8]=p8,stack[frame+9]=p9},restore=function(){return frame>TOS-10&&stop("frame underflow"),p0=stack[frame+0],p1=stack[frame+1],p2=stack[frame+2],p3=stack[frame+3],p4=stack[frame+4],p5=stack[frame+5],p6=stack[frame+6],p7=stack[frame+7],p8=stack[frame+8],p9=stack[frame+9],frame+=10},swap=function(){var t,e;return t=pop(),e=pop(),push(t),push(e)},dupl=function(){var t;return t=pop(),push(t),push(t)},$.dupl=dupl,$.swap=swap,$.restore=restore,$.save=save,$.push=push,$.pop=pop,Eval_symbolsinfo=function(){var t;return t=symbolsinfo(),t!==""?push(new_string(t)):push_symbol(NIL)},symbolsinfo=function(){var t,e,r,i,n,s,a;for(s="",e=r=i=NIL+1,n=symtab.length;i<=n?r<n:r>n;e=i<=n?++r:--r){if(symtab[e].printname===""){if(isSymbolReclaimable[e]===!1)break;continue}a=symtab[e]+"",t=(binding[e]+"").substring(0,4),s+="symbol: "+a+" size: "+countsize(binding[e])+" value: "+t+`...
`}return s},std_symbol=function(t,e,r){var i;if(i=symtab[e],i==null)debugger;return i.printname=t,r!=null?i.latexPrint=r:i.latexPrint=t},usr_symbol=function(t){var e,r,i;for(e=0,e=r=0,i=NSYM;0<=i?r<i:r>i;e=0<=i?++r:--r){if(t===symtab[e].printname)return symtab[e];if(symtab[e].printname==="")break}return e===NSYM&&stop("symbol table overflow"),symtab[e]=new U,symtab[e].k=SYM,symtab[e].printname=t,binding[e]=symtab[e],isSymbolReclaimable[e]=!1,symtab[e]},get_printname=function(t){return t.k!==SYM&&stop("symbol error"),t.printname},set_binding=function(t,e){var r;if(t.k!==SYM&&stop("symbol error"),r=symtab.indexOf(t),symtab.indexOf(t,r+1)!==-1){console.log("ops, more than one element!");debugger}return DEBUG&&console.log("lookup >> set_binding lookup "+r),isSymbolReclaimable[r]=!1,binding[r]=e},get_binding=function(t){var e;if(t.k!==SYM&&stop("symbol error"),e=symtab.indexOf(t),symtab.indexOf(t,e+1)!==-1){console.log("ops, more than one element!");debugger}return DEBUG&&console.log("lookup >> get_binding lookup "+e),binding[e]},is_usr_symbol=function(t){var e;return t.k!==SYM?!1:(e=symnum(t),e>PI&&e!==SYMBOL_I&&e!==SYMBOL_IDENTITY_MATRIX)},lookupsTotal=0,symnum=function(t){var e;if(lookupsTotal++,t.k!==SYM&&stop("symbol error"),e=symtab.indexOf(t),symtab.indexOf(t,e+1)!==-1){console.log("ops, more than one element!");debugger}return DEBUG&&console.log("lookup >> symnum lookup "+e+" lookup # "+lookupsTotal),e},push_symbol=function(t){return push(symtab[t])},clear_symbols=function(){var t,e,r,i,n;for(n=[],t=e=r=NIL+1,i=NSYM;r<=i?e<i:e>i;t=r<=i?++e:--e){if(symtab[t].printname===""){if(isSymbolReclaimable[t]===!1)break;continue}symtab[t]=new U,symtab[t].k=SYM,binding[t]=symtab[t],n.push(isSymbolReclaimable[t]=!1)}return n},collectUserSymbols=function(t,e=[]){var r,i,n;if(is_usr_symbol(t)&&e.indexOf(t)===-1){e.push(t);return}if(istensor(t)){for(r=i=0,n=t.tensor.nelem;0<=n?i<n:i>n;r=0<=n?++i:--i)collectUserSymbols(t.tensor.elem[r],e);return}for(;iscons(t);)collectUserSymbols(car(t),e),t=cdr(t)},$.get_binding=get_binding,$.set_binding=set_binding,$.usr_symbol=usr_symbol,$.symbolsinfo=symbolsinfo,$.collectUserSymbols=collectUserSymbols,inited||(inited=!0,init()),$.init=init,parse_internal=function(t){return typeof t=="string"?scan(t):typeof t=="number"?t%1===0?push_integer(t):push_double(t):t instanceof U?push(t):(console.warn("unknown argument type",t),push(symbol(NIL)))},parse=function(t){var e,r;try{parse_internal(t),e=pop(),check_stack()}catch(i){throw r=i,reset_after_error(),r}return e},exec=function(t,...e){var r,i,n,s,a,l;for(n=get_binding(usr_symbol(t)),check_stack(),push(n),s=0,a=e.length;s<a;s++)r=e[s],parse_internal(r);list(1+e.length),p1=pop(),push(p1);try{top_level_eval(),l=pop(),check_stack()}catch(u){throw i=u,reset_after_error(),i}return l},$.exec=exec,$.parse=parse,function(){var t,e,r,i,n;for(t=["abs","add","adj","and","approxratio","arccos","arccosh","arcsin","arcsinh","arctan","arctanh","arg","atomize","besselj","bessely","binding","binomial","ceiling","check","choose","circexp","clear","clearall","clearpatterns","clock","coeff","cofactor","condense","conj","contract","cos","cosh","decomp","defint","deg","denominator","det","derivative","dim","dirac","divisors","do","dot","draw","dsolve","eigen","eigenval","eigenvec","erf","erfc","eval","exp","expand","expcos","expsin","factor","factorial","factorpoly","filter","float","floor","for","Gamma","gcd","hermite","hilbert","imag","component","inner","integral","inv","invg","isinteger","isprime","laguerre","lcm","leading","legendre","log","mod","multiply","not","nroots","number","numerator","operator","or","outer","pattern","patternsinfo","polar","power","prime","print","print2dascii","printcomputer","printlatex","printlist","printhuman","product","quote","quotient","rank","rationalize","real","rect","roots","round","equals","shape","sgn","silentpattern","simplify","sin","sinh","sqrt","stop","subst","sum","symbolsinfo","tan","tanh","taylor","test","testeq","testge","testgt","testle","testlt","transpose","unit","zero"],n=[],r=0,i=t.length;r<i;r++)e=t[r],n.push($[e]=exec.bind(this,e));return n}()}).call(algebrite)}(algebrite)),algebrite}var algebriteExports=requireAlgebrite();const Algebrite=getDefaultExportFromCjs(algebriteExports);use_dom_bind(),use_events(),use_events_mouse();const $beforeReconcile$$e=Symbol.for("#beforeReconcile"),$placeChild$$d=Symbol.for("#placeChild"),$afterVisit$$c=Symbol.for("#afterVisit"),$$up$$d=Symbol.for("##up"),$afterReconcile$$e=Symbol.for("#afterReconcile");var $4$7=Symbol(),$7$2=Symbol(),$9$1=Symbol(),$11$4=Symbol(),$12$1=Symbol(),$14$5=Symbol(),$17$6=Symbol(),$20$3=Symbol(),$24$4=Symbol(),$26$2=Symbol(),$29$5=Symbol(),$31$2=Symbol(),$35$4=Symbol(),$37$3=Symbol(),$40$1=Symbol(),$43$3=Symbol(),$45$4=Symbol(),$48$4=Symbol(),$50$1=Symbol(),$52=Symbol(),$54$3=Symbol(),$56$1=Symbol(),$57$5=Symbol(),$62$1=Symbol(),$66$2=Symbol();let c$0$e=Symbol();const ot=class ot extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.expression=e&&(n=e.expression)!==void 0?n:"",this.result=e&&(n=e.result)!==void 0?n:null,this.mode=e&&(n=e.mode)!==void 0?n:"Differentiator",this.variable=e&&(n=e.variable)!==void 0?n:null,this.lowerBound=e&&(n=e.lowerBound)!==void 0?n:null,this.upperBound=e&&(n=e.upperBound)!==void 0?n:null}clear(){return this.expression="",this.result=null,this.variable=null,this.lowerBound=null,this.upperBound=null}calculate(){try{if(this.mode=="Differentiator"&&this.expression){if(this.result=Algebrite.derivative(this.expression).toString(),this.variable){let e=this.result.replaceAll("x",this.variable).replaceAll("e"+this.variable+"p","exp");return this.result=Algebrite.run("eval("+e+")").toString()}}else if(this.mode=="Integrator"&&this.expression&&(this.result=Algebrite.integral(this.expression).toString()+" + C",this.lowerBound&&this.upperBound)){let e=this.result.replaceAll("x",this.upperBound).replaceAll("e"+this.upperBound+"p","exp"),r=this.result.replaceAll("x",this.lowerBound).replaceAll("e"+this.lowerBound+"p","exp");return this.result=Algebrite.run("eval("+e+") - eval("+r+")").toString()}}catch(e){return this.result="Error: "+e.message}}toggleMode(){return this.mode=this.mode=="Integrator"?"Differentiator":"Integrator",this.result=null}render(){var oe;var e=this,r,i,n,s,a,l=this._ns_||"",u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae;return n=this,n[$beforeReconcile$$e](),s=a=1,n[$4$7]===1||(s=a=0,n[$4$7]=1),(u=n[$7$2])||(n[$7$2]=u=createElement("div",n,`z1h8acwm-ah ${l}`,null)),(p=n[$9$1])||(n[$9$1]=p=createElement("h3",u,`z1h8acwm-ai ${l}`,null)),s||p[$placeChild$$d]("Symbolic "),f=this.mode,f===n[$12$1]&&s||(n[$11$4]=p[$placeChild$$d](n[$12$1]=f,256,n[$11$4])),h=d=1,(c=n[$14$5])||(h=d=0,n[$14$5]=c=createElement("input",u,`z1h8acwm-aj ${l}`,null)),n[$17$6]||(n[$17$6]=c.bind$("data",[this,"expression"])),h||(c.placeholder="Enter expression (e.g. sin(x) + x^2)"),h||!c.setup||c.setup(d),c[$afterVisit$$c](d),r=null,this.mode=="Differentiator"?(m=1,(r=n[$20$3])||(m=0,n[$20$3]=r=createElement("div",null,`z1h8acwm-ak ${l}`,null)),m||(r[$$up$$d]=u),(_=r[$24$4])||(r[$24$4]=_=createElement("label",r,`z1h8acwm-al ${l}`,null)),m||_[$placeChild$$d]("Variable: "),b=x=1,(g=r[$26$2])||(b=x=0,r[$26$2]=g=createElement("input",_,`z1h8acwm-am ${l}`,null)),r[$29$5]||(r[$29$5]=g.bind$("data",[this,"variable"])),b||(g.placeholder="Enter value of x"),b||!g.setup||g.setup(x),g[$afterVisit$$c](x)):this.mode=="Integrator"&&(S=1,(r=n[$31$2])||(S=0,n[$31$2]=r=createElement("div",null,`z1h8acwm-an ${l}`,null)),S||(r[$$up$$d]=u),(T=r[$35$4])||(r[$35$4]=T=createElement("label",r,`z1h8acwm-ao ${l}`,null)),S||T[$placeChild$$d]("Upper Limit: "),O=L=1,(I=r[$37$3])||(O=L=0,r[$37$3]=I=createElement("input",T,`z1h8acwm-ap ${l}`,null)),r[$40$1]||(r[$40$1]=I.bind$("data",[this,"upperBound"])),O||(I.placeholder="Enter Upper Limit"),O||!I.setup||I.setup(L),I[$afterVisit$$c](L),(P=r[$43$3])||(r[$43$3]=P=createElement("label",r,`z1h8acwm-aq ${l}`,null)),S||P[$placeChild$$d]("Lower Limit: "),G=B=1,(C=r[$45$4])||(G=B=0,r[$45$4]=C=createElement("input",P,`z1h8acwm-ar ${l}`,null)),r[$48$4]||(r[$48$4]=C.bind$("data",[this,"lowerBound"])),G||(C.placeholder="Enter Lower Limit"),G||!C.setup||C.setup(B),C[$afterVisit$$c](B)),n[$50$1]=u[$placeChild$$d](r,0,n[$50$1]),(H=n[$52])||(n[$52]=H=createElement("label",u,`z1h8acwm-as ${l}`,null)),s||H[$placeChild$$d]("Result: "),(ee=n[$54$3])||(n[$54$3]=ee=createElement("div",H,`z1h8acwm-at ${l}`,null)),j=(oe=this.result)!=null?oe:"Result will appear here",j===n[$57$5]&&s||(n[$56$1]=ee[$placeChild$$d](n[$57$5]=j,384,n[$56$1])),s||(te=createElement("div",u,`z1h8acwm-au ${l}`,null)),s||(J=createElement("button",te,`z1h8acwm-av ${l}`,"Calculate")),s||J.on$("click",{$_:[function(me,le){return e.calculate(me)}]},this),s||(Z=createElement("button",te,`z1h8acwm-aw ${l}`,"Clear")),s||Z.on$("click",{$_:[function(me,le){return e.clear(me)}]},this),ae=1,(pe=n[$62$1])||(ae=0,n[$62$1]=pe=createElement("button",te,`z1h8acwm-ax ${l}`,null)),ae||pe.on$("click",{$_:[function(me,le){return e.toggleMode(me)}]},this),ae||pe[$placeChild$$d]("Switch to "),i=null,this.mode=="Integrator"?i="Differentiator":i="Integrator",n[$66$2]=pe[$placeChild$$d](i,0,n[$66$2]),n[$afterReconcile$$e](a),n}};register$(ot,c$0$e,"DifferentiatorIntegrator",2),defineTag("differentiator-integrator-z1h8acwm-ay",ot,{cssid:"z1h8acwm-af"});let DifferentiatorIntegrator=ot;const $beforeReconcile$$d=Symbol.for("#beforeReconcile"),$$up$$c=Symbol.for("##up"),$appendChild$$4=Symbol.for("#appendChild"),$placeChild$$c=Symbol.for("#placeChild"),$afterReconcile$$d=Symbol.for("#afterReconcile");var $4$6=Symbol(),$6$1=Symbol(),$13$5=Symbol(),$15$4=Symbol(),$16$2=Symbol(),$17$5=Symbol(),$19$7=Symbol(),$21$3=Symbol(),$22$6=Symbol();let c$0$d=Symbol();const at=class at extends Component{get $ref(){let e=createElement("div",null,`z16m5821-ag ${this._ns_||""} $ref`,null);return Object.defineProperty(this,"$ref",{value:e}),e}[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.angle=e&&(n=e.angle)!==void 0?n:0,this.accelaration=e&&(n=e.accelaration)!==void 0?n:0,this.spinCount=e&&(n=e.spinCount)!==void 0?n:0,this.lastSpin=e&&(n=e.lastSpin)!==void 0?n:0}setup(){var e=this;return setInterval(function(){return e.animateSpin()},1),globalThis.document.addEventListener("keydown",function(r){if(r.code=="Space")return e.increaseSpeed();if(r.code=="ShiftLeft")return e.decreaseSpeed()})}increaseSpeed(){return this.accelaration+=.2}decreaseSpeed(){return this.accelaration>0?this.accelaration-=.2:this.accelaration=0}animateSpin(){return this.angle+=this.accelaration,this.angle-this.lastSpin>=360&&(this.spinCount+=1,this.lastSpin+=360),this.$ref.style.transform="rotate("+this.angle+"deg)",this.$ref.style.transition="transform 0.3s linear",commit(),this.accelaration>0?this.accelaration-=.005:this.accelaration=0}render(){var e,r,i,n,s=this._ns_||"",a,l,u,p;return e=this,e[$beforeReconcile$$d](),r=i=1,e[$4$6]===1||(r=i=0,e[$4$6]=1),(!r||i&2)&&e.flagSelf$("z16m5821-af"),(n=e[$6$1])||(e[$6$1]=(n=this.$ref,n[$$up$$c]=e,n)),r||createElement("div",n,`z16m5821-ah ${s}`,null),r||createElement("div",n,`z16m5821-ai ${s}`,null),r||createElement("div",n,`z16m5821-aj ${s}`,null),r||createElement("div",n,`z16m5821-ak ${s}`,null),r||e[$appendChild$$4](n),(a=e[$13$5])||(e[$13$5]=a=createElement("div",e,`z16m5821-al ${s}`,null)),r||a[$placeChild$$c]("Speed: "),renderContext.context=e[$16$2]||(e[$16$2]={_:a}),l=this.accelaration.toFixed(2),renderContext.context=null,l===e[$17$5]&&r||(e[$15$4]=a[$placeChild$$c](e[$17$5]=l,256,e[$15$4])),(u=e[$19$7])||(e[$19$7]=u=createElement("div",e,`z16m5821-am ${s}`,null)),r||u[$placeChild$$c]("Spins: "),p=this.spinCount,p===e[$22$6]&&r||(e[$21$3]=u[$placeChild$$c](e[$22$6]=p,256,e[$21$3])),e[$afterReconcile$$d](i),e}};register$(at,c$0$d,"FidgetSpinner",2),defineTag("fidget-spinner-z16m5821-an",at,{});let FidgetSpinner=at;function negIndex$__(t,e){return t[t.length+e]}use_events(),use_events_mouse(),use_styles();const $beforeReconcile$$c=Symbol.for("#beforeReconcile"),$$up$$b=Symbol.for("##up"),$afterVisit$$b=Symbol.for("#afterVisit"),$placeChild$$b=Symbol.for("#placeChild"),$afterReconcile$$c=Symbol.for("#afterReconcile");var $10$3=Symbol(),$13$4=Symbol(),$15$3=Symbol(),$18$4=Symbol(),$19$6=Symbol(),$21$2=Symbol(),$24$3=Symbol(),$25$5=Symbol(),$34$3=Symbol(),$36$1=Symbol(),$40=Symbol(),$42$1=Symbol(),$45$3=Symbol(),$47$1=Symbol(),$48$3=Symbol(),$50=Symbol(),$55=Symbol(),$57$4=Symbol(),$58$2=Symbol(),$60$3=Symbol();let gameOver=!1,birdY=200,birdVY=0,gravity=.4,jumpStrength=-6,pipes=[{x:400,y:350},{x:600,y:250},{x:800,y:350},{x:1e3,y:300},{x:1200,y:250}],score=0,gameStarted=!1,wingrotate=0;function jump(){if(!gameOver)return birdVY=jumpStrength,wingrotate=40,setTimeout(function(){return wingrotate=-20},100)}function reset(){return birdY=200,birdVY=0,score=0,gameOver=!1,gameStarted=!1,pipes=[{x:400,y:350},{x:600,y:250},{x:800,y:350},{x:1e3,y:300},{x:1200,y:250}]}function tick(){if(!gameOver){birdVY+=gravity,birdY+=birdVY;for(let t=0,e=iterable$(pipes),r=e.length;t<r;t++){let i=e[t];i.x-=2}if(pipes[0].x<-60){pipes.shift();let t=100+Math.random()*200;pipes.push({x:negIndex$__(pipes,-1).x+200,y:t}),score+=1}for(let t=0,e=iterable$(pipes),r=e.length;t<r;t++){let i=e[t];i.x<80&&i.x>0&&(birdY<i.y-150||birdY>i.y-40)&&(gameOver=!0)}return(birdY>460||birdY<0)&&(gameOver=!0),commit(),window.requestAnimationFrame(tick)}}let c$0$c=Symbol();const lt=class lt extends Component{setup(){return globalThis.document.addEventListener("keyup",function(e){if(e.code=="Space")return!gameStarted&&!gameOver&&(gameStarted=!0,tick()),jump()})}render(){var e,r,i,n,s=this._ns_||"",a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L;let P=Math.max(Math.min(birdVY*4,90),-30);r=this,r[$beforeReconcile$$c](),i=n=1,r[$10$3]===1||(i=n=0,r[$10$3]=1),(a=r[$13$4])||(r[$13$4]=a=createElement("div",r,`z1qy1pmo-ag ${s}`,null)),(l=r[$15$3])||(r[$15$3]=l=createElement("div",a,`z1qy1pmo-ah ${s}`,null)),birdY===r[$18$4]||l.css$var("--z1qy1pmo_ai",r[$18$4]=birdY,"px","t"),P===r[$19$6]||l.css$var("--z1qy1pmo_aj",r[$19$6]=P,"deg","rotate"),(u=r[$21$2])||(r[$21$2]=u=createElement("div",l,`z1qy1pmo-ak ${s}`,"🪽")),wingrotate===r[$24$3]||u.css$var("--z1qy1pmo_al",r[$24$3]=wingrotate,"deg","transform"),(p=r[$25$5])||(r[$25$5]=p=createIndexedList(0,a)),f=0,c=p.$;for(let C=0,G=iterable$(pipes),B=G.length;C<B;C++){let H=G[C];d=1,(h=c[f])||(d=0,c[f]=h=createElement("div",p,`z1qy1pmo-am ${s}`,null)),d||(h[$$up$$b]=p),m=H.x,m===h[$34$3]||h.css$var("--z1qy1pmo_an",h[$34$3]=m,"px","l"),m=H.y-150,m===h[$36$1]||h.css$var("--z1qy1pmo_ao",h[$36$1]=m,"px","h"),f++,g=1,(_=c[f])||(g=0,c[f]=_=createElement("div",p,`z1qy1pmo-ap ${s}`,null)),g||(_[$$up$$b]=p),b=H.x,b===_[$40]||_.css$var("--z1qy1pmo_aq",_[$40]=b,"px","l"),b=H.y,b===_[$42$1]||_.css$var("--z1qy1pmo_ar",_[$42$1]=b,"px","t"),f++}return p[$afterVisit$$b](f),(x=r[$45$3])||(r[$45$3]=x=createElement("div",a,`z1qy1pmo-as ${s}`,null)),i||x[$placeChild$$b]("Score: "),S=score,S===r[$48$3]&&i||(r[$47$1]=x[$placeChild$$b](r[$48$3]=S,256,r[$47$1])),e=null,gameOver&&(T=1,(e=r[$50])||(T=0,r[$50]=e=createElement("div",null,`z1qy1pmo-at ${s}`,null)),T||(e[$$up$$b]=a),T||createElement("p",e,`${s}`,"Game Over!"),(I=e[$55])||(e[$55]=I=createElement("p",e,`${s}`,null)),T||I[$placeChild$$b]("Your final score was: "),O=score,O===e[$58$2]&&T||(e[$57$4]=I[$placeChild$$b](e[$58$2]=O,256,e[$57$4])),T||(L=createElement("button",e,`z1qy1pmo-aw ${s}`,"Restart")),T||L.on$("click",{$_:[function(C,G){return reset()}]},this)),r[$60$3]=a[$placeChild$$b](e,0,r[$60$3]),r[$afterReconcile$$c](n),r}};register$(lt,c$0$c,"FlappyBird",2),defineTag("flappy-bird-z1qy1pmo-ax",lt,{});let FlappyBird=lt;use_events(),use_events_mouse(),use_dom_bind(),use_styles();const $beforeReconcile$$b=Symbol.for("#beforeReconcile"),$$up$$a=Symbol.for("##up"),$afterVisit$$a=Symbol.for("#afterVisit"),$placeChild$$a=Symbol.for("#placeChild"),$afterReconcile$$b=Symbol.for("#afterReconcile");var $10$2=Symbol(),$14$4=Symbol(),$17$4=Symbol(),$18$3=Symbol(),$19$5=Symbol(),$21$1=Symbol(),$22$5=Symbol(),$32$5=Symbol(),$34$2=Symbol(),$36=Symbol(),$39$2=Symbol(),$43$2=Symbol(),$49$2=Symbol(),$54$2=Symbol(),$56=Symbol(),$57$3=Symbol(),$61$2=Symbol(),$66$1=Symbol(),$68$4=Symbol(),$69=Symbol();let size=25,running=!1,intervalId=null,fps=5,gridSizePx=500,grid=Array(size).fill(null).map(function(){return Array(size).fill(0)});function countNeighbors(t,e){let r=[-1,0,1],i=0;for(let n=0,s=iterable$(r),a=s.length;n<a;n++){let l=s[n];for(let u=0,p=iterable$(r),f=p.length;u<f;u++){let c=p[u];if(c==0&&l==0)continue;let h=(e+l+size)%size,d=(t+c+size)%size;i+=grid[h][d]}}return i}let c$0$b=Symbol();const ut=class ut extends Component{toggleCell(e,r){return this.stop(),grid[r][e]=grid[r][e]==1?0:1}clearGrid(){return this.stop(),grid=Array(size).fill(null).map(function(){return Array(size).fill(0)})}randomizeGrid(){return this.stop(),grid=Array(size).fill(null).map(function(){return Array(size).fill(null).map(function(){return Math.random()>.7?1:0})})}start(){return running=!0,intervalId=setInterval(this.runStep,1e3/fps)}stop(){return running=!1,clearInterval(intervalId)}toggleRun(){return running?this.stop():this.start()}runStep(){let e=grid.map(function(r){return[...r]});for(let r=size,i=0,n=r-i;n>0?i<r:i>r;n>0?i++:i--)for(let s=size,a=0,l=s-a;l>0?a<s:a>s;l>0?a++:a--){let u=countNeighbors(a,i);grid[i][a]==1?u>3||u<2?e[i][a]=0:e[i][a]=1:e[i][a]=u==3?1:0}return grid=e,commit()}render(){var e=this,r,i,n,s,a=this._ns_||"",l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe;let me=gridSizePx/size;i=this,i[$beforeReconcile$$b](),n=s=1,i[$10$2]===1||(n=s=0,i[$10$2]=1),n||(l=createElement("div",i,`l8og2b-ah ${a}`,null)),(u=i[$14$4])||(i[$14$4]=u=createElement("div",l,`l8og2b-ai ${a}`,null)),gridSizePx===i[$17$4]||u.css$var("--l8og2b_aj",i[$17$4]=gridSizePx,"px","s"),size===i[$18$3]||u.css$var("--l8og2b_ak",i[$18$3]=size,null,"gtc"),p=me*.9,p===i[$19$5]||u.css$var("--l8og2b_al",i[$19$5]=p,"px","gtc"),p=me/10,p===i[$21$1]||u.css$var("--l8og2b_am",i[$21$1]=p,"px","g"),(f=i[$22$5])||(i[$22$5]=f=createIndexedList(2432,u)),c=0,h=f.$;for(let le=size,ce=0,se=le-ce;se>0?ce<le:ce>le;se>0?ce++:ce--){(d=h[c])||(h[c]=d=createIndexedList(0,f)),m=0,_=d.$;for(let de=size,fe=0,X=de-fe;X>0?fe<de:fe>de;X>0?fe++:fe--)b=1,(g=_[m])||(b=0,_[m]=g=createElement("div",d,`l8og2b-an ${a}`,null)),b||(g[$$up$$a]=d),x=g[$32$5]||(g[$32$5]={$_:[function(he,ne,ge,Ee){return e.toggleCell(ge,Ee)},null,null]}),x.$_[1]=fe,x.$_[2]=ce,b||g.on$("click",x,this),S=grid[ce][fe]==1?"#4caf50":"#fff",S===g[$34$2]||g.css$var("--l8og2b_ao",g[$34$2]=S,null,"bg"),S=me*.9-2,S===g[$36]||g.css$var("--l8og2b_ap",g[$36]=S,"px","s"),m++;d[$afterVisit$$a](m),c++}return f[$afterVisit$$a](c),n||(T=createElement("div",l,`l8og2b-aq ${a}`,null)),O=1,(I=i[$39$2])||(O=0,i[$39$2]=I=createElement("button",T,`l8og2b-ar ${a}`,null)),O||I.on$("click",{$_:[function(le,ce){return e.toggleRun(le)}]},this),r=null,running?r="Pause":r="Play",i[$43$2]=I[$placeChild$$a](r,0,i[$43$2]),n||(L=createElement("button",T,`l8og2b-as ${a}`,"Random")),n||L.on$("click",{$_:[function(le,ce){return e.randomizeGrid(le)}]},this),n||(P=createElement("button",T,`l8og2b-at ${a}`,"Clear")),n||P.on$("click",{$_:[function(le,ce){return e.clearGrid(le)}]},this),n||(C=createElement("div",T,`l8og2b-au ${a}`,null)),n||createElement("span",C,`${a}`,"FPS: "),B=H=1,(G=i[$49$2])||(B=H=0,i[$49$2]=G=createElement("input",C,`${a}`,null)),B||(G.type="range"),B||(G.min=1),B||(G.max=30),B||G.bind$("data",{get:function(){return fps},set:function(le){fps=le}}),B||G.on$("input",{$_:[function(le,ce){return e.stop(),e.start()}]},this),B||!G.setup||G.setup(H),G[$afterVisit$$a](H),(ee=i[$54$2])||(i[$54$2]=ee=createElement("span",C,`l8og2b-ax ${a}`,null)),j=fps,j===i[$57$3]&&n||(i[$56]=ee[$placeChild$$a](i[$57$3]=j,384,i[$56])),n||(te=createElement("div",T,`l8og2b-ay ${a}`,null)),n||createElement("span",te,`${a}`,"Size: "),Z=pe=1,(J=i[$61$2])||(Z=pe=0,i[$61$2]=J=createElement("input",te,`${a}`,null)),Z||(J.type="range"),Z||(J.min=10),Z||(J.max=50),Z||(J.step=5),Z||J.bind$("data",{get:function(){return size},set:function(le){size=le}}),Z||J.on$("input",{$_:[function(le,ce){return e.stop(),e.clearGrid()}]},this),Z||!J.setup||J.setup(pe),J[$afterVisit$$a](pe),(ae=i[$66$1])||(i[$66$1]=ae=createElement("span",te,`l8og2b-bb ${a}`,null)),oe=size,oe===i[$69]&&n||(i[$68$4]=ae[$placeChild$$a](i[$69]=oe,384,i[$68$4])),i[$afterReconcile$$b](s),i}};register$(ut,c$0$b,"GameOfLife",2),defineTag("game-of-life-l8og2b-bc",ut,{cssid:"l8og2b-af"});let GameOfLife=ut;/*!
 * @kurkle/color v0.3.4
 * https://github.com/kurkle/color#readme
 * (c) 2024 Jukka Kurkela
 * Released under the MIT License
 */function round(t){return t+.5|0}const lim=(t,e,r)=>Math.max(Math.min(t,r),e);function p2b(t){return lim(round(t*2.55),0,255)}function n2b(t){return lim(round(t*255),0,255)}function b2n(t){return lim(round(t/2.55)/100,0,1)}function n2p(t){return lim(round(t*100),0,100)}const map$1={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},hex=[..."0123456789ABCDEF"],h1=t=>hex[t&15],h2=t=>hex[(t&240)>>4]+hex[t&15],eq=t=>(t&240)>>4===(t&15),isShort=t=>eq(t.r)&&eq(t.g)&&eq(t.b)&&eq(t.a);function hexParse(t){var e=t.length,r;return t[0]==="#"&&(e===4||e===5?r={r:255&map$1[t[1]]*17,g:255&map$1[t[2]]*17,b:255&map$1[t[3]]*17,a:e===5?map$1[t[4]]*17:255}:(e===7||e===9)&&(r={r:map$1[t[1]]<<4|map$1[t[2]],g:map$1[t[3]]<<4|map$1[t[4]],b:map$1[t[5]]<<4|map$1[t[6]],a:e===9?map$1[t[7]]<<4|map$1[t[8]]:255})),r}const alpha=(t,e)=>t<255?e(t):"";function hexString(t){var e=isShort(t)?h1:h2;return t?"#"+e(t.r)+e(t.g)+e(t.b)+alpha(t.a,e):void 0}const HUE_RE=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function hsl2rgbn(t,e,r){const i=e*Math.min(r,1-r),n=(s,a=(s+t/30)%12)=>r-i*Math.max(Math.min(a-3,9-a,1),-1);return[n(0),n(8),n(4)]}function hsv2rgbn(t,e,r){const i=(n,s=(n+t/60)%6)=>r-r*e*Math.max(Math.min(s,4-s,1),0);return[i(5),i(3),i(1)]}function hwb2rgbn(t,e,r){const i=hsl2rgbn(t,1,.5);let n;for(e+r>1&&(n=1/(e+r),e*=n,r*=n),n=0;n<3;n++)i[n]*=1-e-r,i[n]+=e;return i}function hueValue(t,e,r,i,n){return t===n?(e-r)/i+(e<r?6:0):e===n?(r-t)/i+2:(t-e)/i+4}function rgb2hsl(t){const r=t.r/255,i=t.g/255,n=t.b/255,s=Math.max(r,i,n),a=Math.min(r,i,n),l=(s+a)/2;let u,p,f;return s!==a&&(f=s-a,p=l>.5?f/(2-s-a):f/(s+a),u=hueValue(r,i,n,f,s),u=u*60+.5),[u|0,p||0,l]}function calln(t,e,r,i){return(Array.isArray(e)?t(e[0],e[1],e[2]):t(e,r,i)).map(n2b)}function hsl2rgb(t,e,r){return calln(hsl2rgbn,t,e,r)}function hwb2rgb(t,e,r){return calln(hwb2rgbn,t,e,r)}function hsv2rgb(t,e,r){return calln(hsv2rgbn,t,e,r)}function hue(t){return(t%360+360)%360}function hueParse(t){const e=HUE_RE.exec(t);let r=255,i;if(!e)return;e[5]!==i&&(r=e[6]?p2b(+e[5]):n2b(+e[5]));const n=hue(+e[2]),s=+e[3]/100,a=+e[4]/100;return e[1]==="hwb"?i=hwb2rgb(n,s,a):e[1]==="hsv"?i=hsv2rgb(n,s,a):i=hsl2rgb(n,s,a),{r:i[0],g:i[1],b:i[2],a:r}}function rotate(t,e){var r=rgb2hsl(t);r[0]=hue(r[0]+e),r=hsl2rgb(r),t.r=r[0],t.g=r[1],t.b=r[2]}function hslString(t){if(!t)return;const e=rgb2hsl(t),r=e[0],i=n2p(e[1]),n=n2p(e[2]);return t.a<255?`hsla(${r}, ${i}%, ${n}%, ${b2n(t.a)})`:`hsl(${r}, ${i}%, ${n}%)`}const map={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},names$1={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function unpack(){const t={},e=Object.keys(names$1),r=Object.keys(map);let i,n,s,a,l;for(i=0;i<e.length;i++){for(a=l=e[i],n=0;n<r.length;n++)s=r[n],l=l.replace(s,map[s]);s=parseInt(names$1[a],16),t[l]=[s>>16&255,s>>8&255,s&255]}return t}let names;function nameParse(t){names||(names=unpack(),names.transparent=[0,0,0,0]);const e=names[t.toLowerCase()];return e&&{r:e[0],g:e[1],b:e[2],a:e.length===4?e[3]:255}}const RGB_RE=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function rgbParse(t){const e=RGB_RE.exec(t);let r=255,i,n,s;if(e){if(e[7]!==i){const a=+e[7];r=e[8]?p2b(a):lim(a*255,0,255)}return i=+e[1],n=+e[3],s=+e[5],i=255&(e[2]?p2b(i):lim(i,0,255)),n=255&(e[4]?p2b(n):lim(n,0,255)),s=255&(e[6]?p2b(s):lim(s,0,255)),{r:i,g:n,b:s,a:r}}}function rgbString(t){return t&&(t.a<255?`rgba(${t.r}, ${t.g}, ${t.b}, ${b2n(t.a)})`:`rgb(${t.r}, ${t.g}, ${t.b})`)}const to=t=>t<=.0031308?t*12.92:Math.pow(t,1/2.4)*1.055-.055,from=t=>t<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4);function interpolate$1(t,e,r){const i=from(b2n(t.r)),n=from(b2n(t.g)),s=from(b2n(t.b));return{r:n2b(to(i+r*(from(b2n(e.r))-i))),g:n2b(to(n+r*(from(b2n(e.g))-n))),b:n2b(to(s+r*(from(b2n(e.b))-s))),a:t.a+r*(e.a-t.a)}}function modHSL(t,e,r){if(t){let i=rgb2hsl(t);i[e]=Math.max(0,Math.min(i[e]+i[e]*r,e===0?360:1)),i=hsl2rgb(i),t.r=i[0],t.g=i[1],t.b=i[2]}}function clone$1(t,e){return t&&Object.assign(e||{},t)}function fromObject(t){var e={r:0,g:0,b:0,a:255};return Array.isArray(t)?t.length>=3&&(e={r:t[0],g:t[1],b:t[2],a:255},t.length>3&&(e.a=n2b(t[3]))):(e=clone$1(t,{r:0,g:0,b:0,a:1}),e.a=n2b(e.a)),e}function functionParse(t){return t.charAt(0)==="r"?rgbParse(t):hueParse(t)}class Color{constructor(e){if(e instanceof Color)return e;const r=typeof e;let i;r==="object"?i=fromObject(e):r==="string"&&(i=hexParse(e)||nameParse(e)||functionParse(e)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var e=clone$1(this._rgb);return e&&(e.a=b2n(e.a)),e}set rgb(e){this._rgb=fromObject(e)}rgbString(){return this._valid?rgbString(this._rgb):void 0}hexString(){return this._valid?hexString(this._rgb):void 0}hslString(){return this._valid?hslString(this._rgb):void 0}mix(e,r){if(e){const i=this.rgb,n=e.rgb;let s;const a=r===s?.5:r,l=2*a-1,u=i.a-n.a,p=((l*u===-1?l:(l+u)/(1+l*u))+1)/2;s=1-p,i.r=255&p*i.r+s*n.r+.5,i.g=255&p*i.g+s*n.g+.5,i.b=255&p*i.b+s*n.b+.5,i.a=a*i.a+(1-a)*n.a,this.rgb=i}return this}interpolate(e,r){return e&&(this._rgb=interpolate$1(this._rgb,e._rgb,r)),this}clone(){return new Color(this.rgb)}alpha(e){return this._rgb.a=n2b(e),this}clearer(e){const r=this._rgb;return r.a*=1-e,this}greyscale(){const e=this._rgb,r=round(e.r*.3+e.g*.59+e.b*.11);return e.r=e.g=e.b=r,this}opaquer(e){const r=this._rgb;return r.a*=1+e,this}negate(){const e=this._rgb;return e.r=255-e.r,e.g=255-e.g,e.b=255-e.b,this}lighten(e){return modHSL(this._rgb,2,e),this}darken(e){return modHSL(this._rgb,2,-e),this}saturate(e){return modHSL(this._rgb,1,e),this}desaturate(e){return modHSL(this._rgb,1,-e),this}rotate(e){return rotate(this._rgb,e),this}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */function noop(){}const uid=(()=>{let t=0;return()=>t++})();function isNullOrUndef(t){return t==null}function isArray(t){if(Array.isArray&&Array.isArray(t))return!0;const e=Object.prototype.toString.call(t);return e.slice(0,7)==="[object"&&e.slice(-6)==="Array]"}function isObject(t){return t!==null&&Object.prototype.toString.call(t)==="[object Object]"}function isNumberFinite(t){return(typeof t=="number"||t instanceof Number)&&isFinite(+t)}function finiteOrDefault(t,e){return isNumberFinite(t)?t:e}function valueOrDefault(t,e){return typeof t>"u"?e:t}const toDimension=(t,e)=>typeof t=="string"&&t.endsWith("%")?parseFloat(t)/100*e:+t;function callback(t,e,r){if(t&&typeof t.call=="function")return t.apply(r,e)}function each(t,e,r,i){let n,s,a;if(isArray(t))for(s=t.length,n=0;n<s;n++)e.call(r,t[n],n);else if(isObject(t))for(a=Object.keys(t),s=a.length,n=0;n<s;n++)e.call(r,t[a[n]],a[n])}function _elementsEqual(t,e){let r,i,n,s;if(!t||!e||t.length!==e.length)return!1;for(r=0,i=t.length;r<i;++r)if(n=t[r],s=e[r],n.datasetIndex!==s.datasetIndex||n.index!==s.index)return!1;return!0}function clone(t){if(isArray(t))return t.map(clone);if(isObject(t)){const e=Object.create(null),r=Object.keys(t),i=r.length;let n=0;for(;n<i;++n)e[r[n]]=clone(t[r[n]]);return e}return t}function isValidKey(t){return["__proto__","prototype","constructor"].indexOf(t)===-1}function _merger(t,e,r,i){if(!isValidKey(t))return;const n=e[t],s=r[t];isObject(n)&&isObject(s)?merge(n,s,i):e[t]=clone(s)}function merge(t,e,r){const i=isArray(e)?e:[e],n=i.length;if(!isObject(t))return t;r=r||{};const s=r.merger||_merger;let a;for(let l=0;l<n;++l){if(a=i[l],!isObject(a))continue;const u=Object.keys(a);for(let p=0,f=u.length;p<f;++p)s(u[p],t,a,r)}return t}function mergeIf(t,e){return merge(t,e,{merger:_mergerIf})}function _mergerIf(t,e,r){if(!isValidKey(t))return;const i=e[t],n=r[t];isObject(i)&&isObject(n)?mergeIf(i,n):Object.prototype.hasOwnProperty.call(e,t)||(e[t]=clone(n))}const keyResolvers={"":t=>t,x:t=>t.x,y:t=>t.y};function _splitKey(t){const e=t.split("."),r=[];let i="";for(const n of e)i+=n,i.endsWith("\\")?i=i.slice(0,-1)+".":(r.push(i),i="");return r}function _getKeyResolver(t){const e=_splitKey(t);return r=>{for(const i of e){if(i==="")break;r=r&&r[i]}return r}}function resolveObjectKey(t,e){return(keyResolvers[e]||(keyResolvers[e]=_getKeyResolver(e)))(t)}function _capitalize(t){return t.charAt(0).toUpperCase()+t.slice(1)}const defined=t=>typeof t<"u",isFunction=t=>typeof t=="function",setsEqual=(t,e)=>{if(t.size!==e.size)return!1;for(const r of t)if(!e.has(r))return!1;return!0};function _isClickEvent(t){return t.type==="mouseup"||t.type==="click"||t.type==="contextmenu"}const PI=Math.PI,TAU=2*PI,PITAU=TAU+PI,INFINITY=Number.POSITIVE_INFINITY,RAD_PER_DEG=PI/180,HALF_PI=PI/2,QUARTER_PI=PI/4,TWO_THIRDS_PI=PI*2/3,log10=Math.log10,sign=Math.sign;function almostEquals(t,e,r){return Math.abs(t-e)<r}function niceNum(t){const e=Math.round(t);t=almostEquals(t,e,t/1e3)?e:t;const r=Math.pow(10,Math.floor(log10(t))),i=t/r;return(i<=1?1:i<=2?2:i<=5?5:10)*r}function _factorize(t){const e=[],r=Math.sqrt(t);let i;for(i=1;i<r;i++)t%i===0&&(e.push(i),e.push(t/i));return r===(r|0)&&e.push(r),e.sort((n,s)=>n-s).pop(),e}function isNonPrimitive(t){return typeof t=="symbol"||typeof t=="object"&&t!==null&&!(Symbol.toPrimitive in t||"toString"in t||"valueOf"in t)}function isNumber(t){return!isNonPrimitive(t)&&!isNaN(parseFloat(t))&&isFinite(t)}function almostWhole(t,e){const r=Math.round(t);return r-e<=t&&r+e>=t}function _setMinAndMaxByKey(t,e,r){let i,n,s;for(i=0,n=t.length;i<n;i++)s=t[i][r],isNaN(s)||(e.min=Math.min(e.min,s),e.max=Math.max(e.max,s))}function toRadians(t){return t*(PI/180)}function toDegrees(t){return t*(180/PI)}function _decimalPlaces(t){if(!isNumberFinite(t))return;let e=1,r=0;for(;Math.round(t*e)/e!==t;)e*=10,r++;return r}function getAngleFromPoint(t,e){const r=e.x-t.x,i=e.y-t.y,n=Math.sqrt(r*r+i*i);let s=Math.atan2(i,r);return s<-.5*PI&&(s+=TAU),{angle:s,distance:n}}function distanceBetweenPoints(t,e){return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}function _angleDiff(t,e){return(t-e+PITAU)%TAU-PI}function _normalizeAngle(t){return(t%TAU+TAU)%TAU}function _angleBetween(t,e,r,i){const n=_normalizeAngle(t),s=_normalizeAngle(e),a=_normalizeAngle(r),l=_normalizeAngle(s-n),u=_normalizeAngle(a-n),p=_normalizeAngle(n-s),f=_normalizeAngle(n-a);return n===s||n===a||i&&s===a||l>u&&p<f}function _limitValue(t,e,r){return Math.max(e,Math.min(r,t))}function _int16Range(t){return _limitValue(t,-32768,32767)}function _isBetween(t,e,r,i=1e-6){return t>=Math.min(e,r)-i&&t<=Math.max(e,r)+i}function _lookup(t,e,r){r=r||(a=>t[a]<e);let i=t.length-1,n=0,s;for(;i-n>1;)s=n+i>>1,r(s)?n=s:i=s;return{lo:n,hi:i}}const _lookupByKey=(t,e,r,i)=>_lookup(t,r,i?n=>{const s=t[n][e];return s<r||s===r&&t[n+1][e]===r}:n=>t[n][e]<r),_rlookupByKey=(t,e,r)=>_lookup(t,r,i=>t[i][e]>=r);function _filterBetween(t,e,r){let i=0,n=t.length;for(;i<n&&t[i]<e;)i++;for(;n>i&&t[n-1]>r;)n--;return i>0||n<t.length?t.slice(i,n):t}const arrayEvents=["push","pop","shift","splice","unshift"];function listenArrayEvents(t,e){if(t._chartjs){t._chartjs.listeners.push(e);return}Object.defineProperty(t,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[e]}}),arrayEvents.forEach(r=>{const i="_onData"+_capitalize(r),n=t[r];Object.defineProperty(t,r,{configurable:!0,enumerable:!1,value(...s){const a=n.apply(this,s);return t._chartjs.listeners.forEach(l=>{typeof l[i]=="function"&&l[i](...s)}),a}})})}function unlistenArrayEvents(t,e){const r=t._chartjs;if(!r)return;const i=r.listeners,n=i.indexOf(e);n!==-1&&i.splice(n,1),!(i.length>0)&&(arrayEvents.forEach(s=>{delete t[s]}),delete t._chartjs)}function _arrayUnique(t){const e=new Set(t);return e.size===t.length?t:Array.from(e)}const requestAnimFrame=function(){return typeof window>"u"?function(t){return t()}:window.requestAnimationFrame}();function throttled(t,e){let r=[],i=!1;return function(...n){r=n,i||(i=!0,requestAnimFrame.call(window,()=>{i=!1,t.apply(e,r)}))}}function debounce(t,e){let r;return function(...i){return e?(clearTimeout(r),r=setTimeout(t,e,i)):t.apply(this,i),e}}const _toLeftRightCenter=t=>t==="start"?"left":t==="end"?"right":"center",_alignStartEnd=(t,e,r)=>t==="start"?e:t==="end"?r:(e+r)/2,_textX=(t,e,r,i)=>t===(i?"left":"right")?r:t==="center"?(e+r)/2:e;function _getStartAndCountOfVisiblePoints(t,e,r){const i=e.length;let n=0,s=i;if(t._sorted){const{iScale:a,vScale:l,_parsed:u}=t,p=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null,f=a.axis,{min:c,max:h,minDefined:d,maxDefined:m}=a.getUserBounds();if(d){if(n=Math.min(_lookupByKey(u,f,c).lo,r?i:_lookupByKey(e,f,a.getPixelForValue(c)).lo),p){const _=u.slice(0,n+1).reverse().findIndex(g=>!isNullOrUndef(g[l.axis]));n-=Math.max(0,_)}n=_limitValue(n,0,i-1)}if(m){let _=Math.max(_lookupByKey(u,a.axis,h,!0).hi+1,r?0:_lookupByKey(e,f,a.getPixelForValue(h),!0).hi+1);if(p){const g=u.slice(_-1).findIndex(b=>!isNullOrUndef(b[l.axis]));_+=Math.max(0,g)}s=_limitValue(_,n,i)-n}else s=i-n}return{start:n,count:s}}function _scaleRangesChanged(t){const{xScale:e,yScale:r,_scaleRanges:i}=t,n={xmin:e.min,xmax:e.max,ymin:r.min,ymax:r.max};if(!i)return t._scaleRanges=n,!0;const s=i.xmin!==e.min||i.xmax!==e.max||i.ymin!==r.min||i.ymax!==r.max;return Object.assign(i,n),s}const atEdge=t=>t===0||t===1,elasticIn=(t,e,r)=>-(Math.pow(2,10*(t-=1))*Math.sin((t-e)*TAU/r)),elasticOut=(t,e,r)=>Math.pow(2,-10*t)*Math.sin((t-e)*TAU/r)+1,effects={linear:t=>t,easeInQuad:t=>t*t,easeOutQuad:t=>-t*(t-2),easeInOutQuad:t=>(t/=.5)<1?.5*t*t:-.5*(--t*(t-2)-1),easeInCubic:t=>t*t*t,easeOutCubic:t=>(t-=1)*t*t+1,easeInOutCubic:t=>(t/=.5)<1?.5*t*t*t:.5*((t-=2)*t*t+2),easeInQuart:t=>t*t*t*t,easeOutQuart:t=>-((t-=1)*t*t*t-1),easeInOutQuart:t=>(t/=.5)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2),easeInQuint:t=>t*t*t*t*t,easeOutQuint:t=>(t-=1)*t*t*t*t+1,easeInOutQuint:t=>(t/=.5)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2),easeInSine:t=>-Math.cos(t*HALF_PI)+1,easeOutSine:t=>Math.sin(t*HALF_PI),easeInOutSine:t=>-.5*(Math.cos(PI*t)-1),easeInExpo:t=>t===0?0:Math.pow(2,10*(t-1)),easeOutExpo:t=>t===1?1:-Math.pow(2,-10*t)+1,easeInOutExpo:t=>atEdge(t)?t:t<.5?.5*Math.pow(2,10*(t*2-1)):.5*(-Math.pow(2,-10*(t*2-1))+2),easeInCirc:t=>t>=1?t:-(Math.sqrt(1-t*t)-1),easeOutCirc:t=>Math.sqrt(1-(t-=1)*t),easeInOutCirc:t=>(t/=.5)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1),easeInElastic:t=>atEdge(t)?t:elasticIn(t,.075,.3),easeOutElastic:t=>atEdge(t)?t:elasticOut(t,.075,.3),easeInOutElastic(t){return atEdge(t)?t:t<.5?.5*elasticIn(t*2,.1125,.45):.5+.5*elasticOut(t*2-1,.1125,.45)},easeInBack(t){return t*t*((1.70158+1)*t-1.70158)},easeOutBack(t){return(t-=1)*t*((1.70158+1)*t+1.70158)+1},easeInOutBack(t){let e=1.70158;return(t/=.5)<1?.5*(t*t*(((e*=1.525)+1)*t-e)):.5*((t-=2)*t*(((e*=1.525)+1)*t+e)+2)},easeInBounce:t=>1-effects.easeOutBounce(1-t),easeOutBounce(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375},easeInOutBounce:t=>t<.5?effects.easeInBounce(t*2)*.5:effects.easeOutBounce(t*2-1)*.5+.5};function isPatternOrGradient(t){if(t&&typeof t=="object"){const e=t.toString();return e==="[object CanvasPattern]"||e==="[object CanvasGradient]"}return!1}function color(t){return isPatternOrGradient(t)?t:new Color(t)}function getHoverColor(t){return isPatternOrGradient(t)?t:new Color(t).saturate(.5).darken(.1).hexString()}const numbers=["x","y","borderWidth","radius","tension"],colors=["color","borderColor","backgroundColor"];function applyAnimationsDefaults(t){t.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),t.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:e=>e!=="onProgress"&&e!=="onComplete"&&e!=="fn"}),t.set("animations",{colors:{type:"color",properties:colors},numbers:{type:"number",properties:numbers}}),t.describe("animations",{_fallback:"animation"}),t.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:e=>e|0}}}})}function applyLayoutsDefaults(t){t.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const intlCache=new Map;function getNumberFormat(t,e){e=e||{};const r=t+JSON.stringify(e);let i=intlCache.get(r);return i||(i=new Intl.NumberFormat(t,e),intlCache.set(r,i)),i}function formatNumber(t,e,r){return getNumberFormat(e,r).format(t)}const formatters={values(t){return isArray(t)?t:""+t},numeric(t,e,r){if(t===0)return"0";const i=this.chart.options.locale;let n,s=t;if(r.length>1){const p=Math.max(Math.abs(r[0].value),Math.abs(r[r.length-1].value));(p<1e-4||p>1e15)&&(n="scientific"),s=calculateDelta(t,r)}const a=log10(Math.abs(s)),l=isNaN(a)?1:Math.max(Math.min(-1*Math.floor(a),20),0),u={notation:n,minimumFractionDigits:l,maximumFractionDigits:l};return Object.assign(u,this.options.ticks.format),formatNumber(t,i,u)}};function calculateDelta(t,e){let r=e.length>3?e[2].value-e[1].value:e[1].value-e[0].value;return Math.abs(r)>=1&&t!==Math.floor(t)&&(r=t-Math.floor(t)),r}var Ticks={formatters};function applyScaleDefaults(t){t.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(e,r)=>r.lineWidth,tickColor:(e,r)=>r.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Ticks.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),t.route("scale.ticks","color","","color"),t.route("scale.grid","color","","borderColor"),t.route("scale.border","color","","borderColor"),t.route("scale.title","color","","color"),t.describe("scale",{_fallback:!1,_scriptable:e=>!e.startsWith("before")&&!e.startsWith("after")&&e!=="callback"&&e!=="parser",_indexable:e=>e!=="borderDash"&&e!=="tickBorderDash"&&e!=="dash"}),t.describe("scales",{_fallback:"scale"}),t.describe("scale.ticks",{_scriptable:e=>e!=="backdropPadding"&&e!=="callback",_indexable:e=>e!=="backdropPadding"})}const overrides=Object.create(null),descriptors=Object.create(null);function getScope$1(t,e){if(!e)return t;const r=e.split(".");for(let i=0,n=r.length;i<n;++i){const s=r[i];t=t[s]||(t[s]=Object.create(null))}return t}function set(t,e,r){return typeof e=="string"?merge(getScope$1(t,e),r):merge(getScope$1(t,""),e)}class Defaults{constructor(e,r){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,n)=>getHoverColor(n.backgroundColor),this.hoverBorderColor=(i,n)=>getHoverColor(n.borderColor),this.hoverColor=(i,n)=>getHoverColor(n.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(e),this.apply(r)}set(e,r){return set(this,e,r)}get(e){return getScope$1(this,e)}describe(e,r){return set(descriptors,e,r)}override(e,r){return set(overrides,e,r)}route(e,r,i,n){const s=getScope$1(this,e),a=getScope$1(this,i),l="_"+r;Object.defineProperties(s,{[l]:{value:s[r],writable:!0},[r]:{enumerable:!0,get(){const u=this[l],p=a[n];return isObject(u)?Object.assign({},p,u):valueOrDefault(u,p)},set(u){this[l]=u}}})}apply(e){e.forEach(r=>r(this))}}var defaults=new Defaults({_scriptable:t=>!t.startsWith("on"),_indexable:t=>t!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[applyAnimationsDefaults,applyLayoutsDefaults,applyScaleDefaults]);function toFontString(t){return!t||isNullOrUndef(t.size)||isNullOrUndef(t.family)?null:(t.style?t.style+" ":"")+(t.weight?t.weight+" ":"")+t.size+"px "+t.family}function _measureText(t,e,r,i,n){let s=e[n];return s||(s=e[n]=t.measureText(n).width,r.push(n)),s>i&&(i=s),i}function _alignPixel(t,e,r){const i=t.currentDevicePixelRatio,n=r!==0?Math.max(r/2,.5):0;return Math.round((e-n)*i)/i+n}function clearCanvas(t,e){!e&&!t||(e=e||t.getContext("2d"),e.save(),e.resetTransform(),e.clearRect(0,0,t.width,t.height),e.restore())}function drawPoint(t,e,r,i){drawPointLegend(t,e,r,i,null)}function drawPointLegend(t,e,r,i,n){let s,a,l,u,p,f,c,h;const d=e.pointStyle,m=e.rotation,_=e.radius;let g=(m||0)*RAD_PER_DEG;if(d&&typeof d=="object"&&(s=d.toString(),s==="[object HTMLImageElement]"||s==="[object HTMLCanvasElement]")){t.save(),t.translate(r,i),t.rotate(g),t.drawImage(d,-d.width/2,-d.height/2,d.width,d.height),t.restore();return}if(!(isNaN(_)||_<=0)){switch(t.beginPath(),d){default:n?t.ellipse(r,i,n/2,_,0,0,TAU):t.arc(r,i,_,0,TAU),t.closePath();break;case"triangle":f=n?n/2:_,t.moveTo(r+Math.sin(g)*f,i-Math.cos(g)*_),g+=TWO_THIRDS_PI,t.lineTo(r+Math.sin(g)*f,i-Math.cos(g)*_),g+=TWO_THIRDS_PI,t.lineTo(r+Math.sin(g)*f,i-Math.cos(g)*_),t.closePath();break;case"rectRounded":p=_*.516,u=_-p,a=Math.cos(g+QUARTER_PI)*u,c=Math.cos(g+QUARTER_PI)*(n?n/2-p:u),l=Math.sin(g+QUARTER_PI)*u,h=Math.sin(g+QUARTER_PI)*(n?n/2-p:u),t.arc(r-c,i-l,p,g-PI,g-HALF_PI),t.arc(r+h,i-a,p,g-HALF_PI,g),t.arc(r+c,i+l,p,g,g+HALF_PI),t.arc(r-h,i+a,p,g+HALF_PI,g+PI),t.closePath();break;case"rect":if(!m){u=Math.SQRT1_2*_,f=n?n/2:u,t.rect(r-f,i-u,2*f,2*u);break}g+=QUARTER_PI;case"rectRot":c=Math.cos(g)*(n?n/2:_),a=Math.cos(g)*_,l=Math.sin(g)*_,h=Math.sin(g)*(n?n/2:_),t.moveTo(r-c,i-l),t.lineTo(r+h,i-a),t.lineTo(r+c,i+l),t.lineTo(r-h,i+a),t.closePath();break;case"crossRot":g+=QUARTER_PI;case"cross":c=Math.cos(g)*(n?n/2:_),a=Math.cos(g)*_,l=Math.sin(g)*_,h=Math.sin(g)*(n?n/2:_),t.moveTo(r-c,i-l),t.lineTo(r+c,i+l),t.moveTo(r+h,i-a),t.lineTo(r-h,i+a);break;case"star":c=Math.cos(g)*(n?n/2:_),a=Math.cos(g)*_,l=Math.sin(g)*_,h=Math.sin(g)*(n?n/2:_),t.moveTo(r-c,i-l),t.lineTo(r+c,i+l),t.moveTo(r+h,i-a),t.lineTo(r-h,i+a),g+=QUARTER_PI,c=Math.cos(g)*(n?n/2:_),a=Math.cos(g)*_,l=Math.sin(g)*_,h=Math.sin(g)*(n?n/2:_),t.moveTo(r-c,i-l),t.lineTo(r+c,i+l),t.moveTo(r+h,i-a),t.lineTo(r-h,i+a);break;case"line":a=n?n/2:Math.cos(g)*_,l=Math.sin(g)*_,t.moveTo(r-a,i-l),t.lineTo(r+a,i+l);break;case"dash":t.moveTo(r,i),t.lineTo(r+Math.cos(g)*(n?n/2:_),i+Math.sin(g)*_);break;case!1:t.closePath();break}t.fill(),e.borderWidth>0&&t.stroke()}}function _isPointInArea(t,e,r){return r=r||.5,!e||t&&t.x>e.left-r&&t.x<e.right+r&&t.y>e.top-r&&t.y<e.bottom+r}function clipArea(t,e){t.save(),t.beginPath(),t.rect(e.left,e.top,e.right-e.left,e.bottom-e.top),t.clip()}function unclipArea(t){t.restore()}function _steppedLineTo(t,e,r,i,n){if(!e)return t.lineTo(r.x,r.y);if(n==="middle"){const s=(e.x+r.x)/2;t.lineTo(s,e.y),t.lineTo(s,r.y)}else n==="after"!=!!i?t.lineTo(e.x,r.y):t.lineTo(r.x,e.y);t.lineTo(r.x,r.y)}function _bezierCurveTo(t,e,r,i){if(!e)return t.lineTo(r.x,r.y);t.bezierCurveTo(i?e.cp1x:e.cp2x,i?e.cp1y:e.cp2y,i?r.cp2x:r.cp1x,i?r.cp2y:r.cp1y,r.x,r.y)}function setRenderOpts(t,e){e.translation&&t.translate(e.translation[0],e.translation[1]),isNullOrUndef(e.rotation)||t.rotate(e.rotation),e.color&&(t.fillStyle=e.color),e.textAlign&&(t.textAlign=e.textAlign),e.textBaseline&&(t.textBaseline=e.textBaseline)}function decorateText(t,e,r,i,n){if(n.strikethrough||n.underline){const s=t.measureText(i),a=e-s.actualBoundingBoxLeft,l=e+s.actualBoundingBoxRight,u=r-s.actualBoundingBoxAscent,p=r+s.actualBoundingBoxDescent,f=n.strikethrough?(u+p)/2:p;t.strokeStyle=t.fillStyle,t.beginPath(),t.lineWidth=n.decorationWidth||2,t.moveTo(a,f),t.lineTo(l,f),t.stroke()}}function drawBackdrop(t,e){const r=t.fillStyle;t.fillStyle=e.color,t.fillRect(e.left,e.top,e.width,e.height),t.fillStyle=r}function renderText(t,e,r,i,n,s={}){const a=isArray(e)?e:[e],l=s.strokeWidth>0&&s.strokeColor!=="";let u,p;for(t.save(),t.font=n.string,setRenderOpts(t,s),u=0;u<a.length;++u)p=a[u],s.backdrop&&drawBackdrop(t,s.backdrop),l&&(s.strokeColor&&(t.strokeStyle=s.strokeColor),isNullOrUndef(s.strokeWidth)||(t.lineWidth=s.strokeWidth),t.strokeText(p,r,i,s.maxWidth)),t.fillText(p,r,i,s.maxWidth),decorateText(t,r,i,p,s),i+=Number(n.lineHeight);t.restore()}function addRoundedRectPath(t,e){const{x:r,y:i,w:n,h:s,radius:a}=e;t.arc(r+a.topLeft,i+a.topLeft,a.topLeft,1.5*PI,PI,!0),t.lineTo(r,i+s-a.bottomLeft),t.arc(r+a.bottomLeft,i+s-a.bottomLeft,a.bottomLeft,PI,HALF_PI,!0),t.lineTo(r+n-a.bottomRight,i+s),t.arc(r+n-a.bottomRight,i+s-a.bottomRight,a.bottomRight,HALF_PI,0,!0),t.lineTo(r+n,i+a.topRight),t.arc(r+n-a.topRight,i+a.topRight,a.topRight,0,-HALF_PI,!0),t.lineTo(r+a.topLeft,i)}const LINE_HEIGHT=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,FONT_STYLE=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function toLineHeight(t,e){const r=(""+t).match(LINE_HEIGHT);if(!r||r[1]==="normal")return e*1.2;switch(t=+r[2],r[3]){case"px":return t;case"%":t/=100;break}return e*t}const numberOrZero=t=>+t||0;function _readValueToProps(t,e){const r={},i=isObject(e),n=i?Object.keys(e):e,s=isObject(t)?i?a=>valueOrDefault(t[a],t[e[a]]):a=>t[a]:()=>t;for(const a of n)r[a]=numberOrZero(s(a));return r}function toTRBL(t){return _readValueToProps(t,{top:"y",right:"x",bottom:"y",left:"x"})}function toTRBLCorners(t){return _readValueToProps(t,["topLeft","topRight","bottomLeft","bottomRight"])}function toPadding(t){const e=toTRBL(t);return e.width=e.left+e.right,e.height=e.top+e.bottom,e}function toFont(t,e){t=t||{},e=e||defaults.font;let r=valueOrDefault(t.size,e.size);typeof r=="string"&&(r=parseInt(r,10));let i=valueOrDefault(t.style,e.style);i&&!(""+i).match(FONT_STYLE)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const n={family:valueOrDefault(t.family,e.family),lineHeight:toLineHeight(valueOrDefault(t.lineHeight,e.lineHeight),r),size:r,style:i,weight:valueOrDefault(t.weight,e.weight),string:""};return n.string=toFontString(n),n}function resolve(t,e,r,i){let n,s,a;for(n=0,s=t.length;n<s;++n)if(a=t[n],a!==void 0&&a!==void 0)return a}function _addGrace(t,e,r){const{min:i,max:n}=t,s=toDimension(e,(n-i)/2),a=(l,u)=>r&&l===0?0:l+u;return{min:a(i,-Math.abs(s)),max:a(n,s)}}function createContext(t,e){return Object.assign(Object.create(t),e)}function _createResolver(t,e=[""],r,i,n=()=>t[0]){const s=r||t;typeof i>"u"&&(i=_resolve("_fallback",t));const a={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:t,_rootScopes:s,_fallback:i,_getTarget:n,override:l=>_createResolver([l,...t],e,s,i)};return new Proxy(a,{deleteProperty(l,u){return delete l[u],delete l._keys,delete t[0][u],!0},get(l,u){return _cached(l,u,()=>_resolveWithPrefixes(u,e,t,l))},getOwnPropertyDescriptor(l,u){return Reflect.getOwnPropertyDescriptor(l._scopes[0],u)},getPrototypeOf(){return Reflect.getPrototypeOf(t[0])},has(l,u){return getKeysFromAllScopes(l).includes(u)},ownKeys(l){return getKeysFromAllScopes(l)},set(l,u,p){const f=l._storage||(l._storage=n());return l[u]=f[u]=p,delete l._keys,!0}})}function _attachContext(t,e,r,i){const n={_cacheable:!1,_proxy:t,_context:e,_subProxy:r,_stack:new Set,_descriptors:_descriptors(t,i),setContext:s=>_attachContext(t,s,r,i),override:s=>_attachContext(t.override(s),e,r,i)};return new Proxy(n,{deleteProperty(s,a){return delete s[a],delete t[a],!0},get(s,a,l){return _cached(s,a,()=>_resolveWithContext(s,a,l))},getOwnPropertyDescriptor(s,a){return s._descriptors.allKeys?Reflect.has(t,a)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(t,a)},getPrototypeOf(){return Reflect.getPrototypeOf(t)},has(s,a){return Reflect.has(t,a)},ownKeys(){return Reflect.ownKeys(t)},set(s,a,l){return t[a]=l,delete s[a],!0}})}function _descriptors(t,e={scriptable:!0,indexable:!0}){const{_scriptable:r=e.scriptable,_indexable:i=e.indexable,_allKeys:n=e.allKeys}=t;return{allKeys:n,scriptable:r,indexable:i,isScriptable:isFunction(r)?r:()=>r,isIndexable:isFunction(i)?i:()=>i}}const readKey=(t,e)=>t?t+_capitalize(e):e,needsSubResolver=(t,e)=>isObject(e)&&t!=="adapters"&&(Object.getPrototypeOf(e)===null||e.constructor===Object);function _cached(t,e,r){if(Object.prototype.hasOwnProperty.call(t,e)||e==="constructor")return t[e];const i=r();return t[e]=i,i}function _resolveWithContext(t,e,r){const{_proxy:i,_context:n,_subProxy:s,_descriptors:a}=t;let l=i[e];return isFunction(l)&&a.isScriptable(e)&&(l=_resolveScriptable(e,l,t,r)),isArray(l)&&l.length&&(l=_resolveArray(e,l,t,a.isIndexable)),needsSubResolver(e,l)&&(l=_attachContext(l,n,s&&s[e],a)),l}function _resolveScriptable(t,e,r,i){const{_proxy:n,_context:s,_subProxy:a,_stack:l}=r;if(l.has(t))throw new Error("Recursion detected: "+Array.from(l).join("->")+"->"+t);l.add(t);let u=e(s,a||i);return l.delete(t),needsSubResolver(t,u)&&(u=createSubResolver(n._scopes,n,t,u)),u}function _resolveArray(t,e,r,i){const{_proxy:n,_context:s,_subProxy:a,_descriptors:l}=r;if(typeof s.index<"u"&&i(t))return e[s.index%e.length];if(isObject(e[0])){const u=e,p=n._scopes.filter(f=>f!==u);e=[];for(const f of u){const c=createSubResolver(p,n,t,f);e.push(_attachContext(c,s,a&&a[t],l))}}return e}function resolveFallback(t,e,r){return isFunction(t)?t(e,r):t}const getScope=(t,e)=>t===!0?e:typeof t=="string"?resolveObjectKey(e,t):void 0;function addScopes(t,e,r,i,n){for(const s of e){const a=getScope(r,s);if(a){t.add(a);const l=resolveFallback(a._fallback,r,n);if(typeof l<"u"&&l!==r&&l!==i)return l}else if(a===!1&&typeof i<"u"&&r!==i)return null}return!1}function createSubResolver(t,e,r,i){const n=e._rootScopes,s=resolveFallback(e._fallback,r,i),a=[...t,...n],l=new Set;l.add(i);let u=addScopesFromKey(l,a,r,s||r,i);return u===null||typeof s<"u"&&s!==r&&(u=addScopesFromKey(l,a,s,u,i),u===null)?!1:_createResolver(Array.from(l),[""],n,s,()=>subGetTarget(e,r,i))}function addScopesFromKey(t,e,r,i,n){for(;r;)r=addScopes(t,e,r,i,n);return r}function subGetTarget(t,e,r){const i=t._getTarget();e in i||(i[e]={});const n=i[e];return isArray(n)&&isObject(r)?r:n||{}}function _resolveWithPrefixes(t,e,r,i){let n;for(const s of e)if(n=_resolve(readKey(s,t),r),typeof n<"u")return needsSubResolver(t,n)?createSubResolver(r,i,t,n):n}function _resolve(t,e){for(const r of e){if(!r)continue;const i=r[t];if(typeof i<"u")return i}}function getKeysFromAllScopes(t){let e=t._keys;return e||(e=t._keys=resolveKeysFromAllScopes(t._scopes)),e}function resolveKeysFromAllScopes(t){const e=new Set;for(const r of t)for(const i of Object.keys(r).filter(n=>!n.startsWith("_")))e.add(i);return Array.from(e)}const EPSILON=Number.EPSILON||1e-14,getPoint=(t,e)=>e<t.length&&!t[e].skip&&t[e],getValueAxis=t=>t==="x"?"y":"x";function splineCurve(t,e,r,i){const n=t.skip?e:t,s=e,a=r.skip?e:r,l=distanceBetweenPoints(s,n),u=distanceBetweenPoints(a,s);let p=l/(l+u),f=u/(l+u);p=isNaN(p)?0:p,f=isNaN(f)?0:f;const c=i*p,h=i*f;return{previous:{x:s.x-c*(a.x-n.x),y:s.y-c*(a.y-n.y)},next:{x:s.x+h*(a.x-n.x),y:s.y+h*(a.y-n.y)}}}function monotoneAdjust(t,e,r){const i=t.length;let n,s,a,l,u,p=getPoint(t,0);for(let f=0;f<i-1;++f)if(u=p,p=getPoint(t,f+1),!(!u||!p)){if(almostEquals(e[f],0,EPSILON)){r[f]=r[f+1]=0;continue}n=r[f]/e[f],s=r[f+1]/e[f],l=Math.pow(n,2)+Math.pow(s,2),!(l<=9)&&(a=3/Math.sqrt(l),r[f]=n*a*e[f],r[f+1]=s*a*e[f])}}function monotoneCompute(t,e,r="x"){const i=getValueAxis(r),n=t.length;let s,a,l,u=getPoint(t,0);for(let p=0;p<n;++p){if(a=l,l=u,u=getPoint(t,p+1),!l)continue;const f=l[r],c=l[i];a&&(s=(f-a[r])/3,l[`cp1${r}`]=f-s,l[`cp1${i}`]=c-s*e[p]),u&&(s=(u[r]-f)/3,l[`cp2${r}`]=f+s,l[`cp2${i}`]=c+s*e[p])}}function splineCurveMonotone(t,e="x"){const r=getValueAxis(e),i=t.length,n=Array(i).fill(0),s=Array(i);let a,l,u,p=getPoint(t,0);for(a=0;a<i;++a)if(l=u,u=p,p=getPoint(t,a+1),!!u){if(p){const f=p[e]-u[e];n[a]=f!==0?(p[r]-u[r])/f:0}s[a]=l?p?sign(n[a-1])!==sign(n[a])?0:(n[a-1]+n[a])/2:n[a-1]:n[a]}monotoneAdjust(t,n,s),monotoneCompute(t,s,e)}function capControlPoint(t,e,r){return Math.max(Math.min(t,r),e)}function capBezierPoints(t,e){let r,i,n,s,a,l=_isPointInArea(t[0],e);for(r=0,i=t.length;r<i;++r)a=s,s=l,l=r<i-1&&_isPointInArea(t[r+1],e),s&&(n=t[r],a&&(n.cp1x=capControlPoint(n.cp1x,e.left,e.right),n.cp1y=capControlPoint(n.cp1y,e.top,e.bottom)),l&&(n.cp2x=capControlPoint(n.cp2x,e.left,e.right),n.cp2y=capControlPoint(n.cp2y,e.top,e.bottom)))}function _updateBezierControlPoints(t,e,r,i,n){let s,a,l,u;if(e.spanGaps&&(t=t.filter(p=>!p.skip)),e.cubicInterpolationMode==="monotone")splineCurveMonotone(t,n);else{let p=i?t[t.length-1]:t[0];for(s=0,a=t.length;s<a;++s)l=t[s],u=splineCurve(p,l,t[Math.min(s+1,a-(i?0:1))%a],e.tension),l.cp1x=u.previous.x,l.cp1y=u.previous.y,l.cp2x=u.next.x,l.cp2y=u.next.y,p=l}e.capBezierPoints&&capBezierPoints(t,r)}function _isDomSupported(){return typeof window<"u"&&typeof document<"u"}function _getParentNode(t){let e=t.parentNode;return e&&e.toString()==="[object ShadowRoot]"&&(e=e.host),e}function parseMaxStyle(t,e,r){let i;return typeof t=="string"?(i=parseInt(t,10),t.indexOf("%")!==-1&&(i=i/100*e.parentNode[r])):i=t,i}const getComputedStyle=t=>t.ownerDocument.defaultView.getComputedStyle(t,null);function getStyle(t,e){return getComputedStyle(t).getPropertyValue(e)}const positions=["top","right","bottom","left"];function getPositionedStyle(t,e,r){const i={};r=r?"-"+r:"";for(let n=0;n<4;n++){const s=positions[n];i[s]=parseFloat(t[e+"-"+s+r])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const useOffsetPos=(t,e,r)=>(t>0||e>0)&&(!r||!r.shadowRoot);function getCanvasPosition(t,e){const r=t.touches,i=r&&r.length?r[0]:t,{offsetX:n,offsetY:s}=i;let a=!1,l,u;if(useOffsetPos(n,s,t.target))l=n,u=s;else{const p=e.getBoundingClientRect();l=i.clientX-p.left,u=i.clientY-p.top,a=!0}return{x:l,y:u,box:a}}function getRelativePosition(t,e){if("native"in t)return t;const{canvas:r,currentDevicePixelRatio:i}=e,n=getComputedStyle(r),s=n.boxSizing==="border-box",a=getPositionedStyle(n,"padding"),l=getPositionedStyle(n,"border","width"),{x:u,y:p,box:f}=getCanvasPosition(t,r),c=a.left+(f&&l.left),h=a.top+(f&&l.top);let{width:d,height:m}=e;return s&&(d-=a.width+l.width,m-=a.height+l.height),{x:Math.round((u-c)/d*r.width/i),y:Math.round((p-h)/m*r.height/i)}}function getContainerSize(t,e,r){let i,n;if(e===void 0||r===void 0){const s=t&&_getParentNode(t);if(!s)e=t.clientWidth,r=t.clientHeight;else{const a=s.getBoundingClientRect(),l=getComputedStyle(s),u=getPositionedStyle(l,"border","width"),p=getPositionedStyle(l,"padding");e=a.width-p.width-u.width,r=a.height-p.height-u.height,i=parseMaxStyle(l.maxWidth,s,"clientWidth"),n=parseMaxStyle(l.maxHeight,s,"clientHeight")}}return{width:e,height:r,maxWidth:i||INFINITY,maxHeight:n||INFINITY}}const round1=t=>Math.round(t*10)/10;function getMaximumSize(t,e,r,i){const n=getComputedStyle(t),s=getPositionedStyle(n,"margin"),a=parseMaxStyle(n.maxWidth,t,"clientWidth")||INFINITY,l=parseMaxStyle(n.maxHeight,t,"clientHeight")||INFINITY,u=getContainerSize(t,e,r);let{width:p,height:f}=u;if(n.boxSizing==="content-box"){const h=getPositionedStyle(n,"border","width"),d=getPositionedStyle(n,"padding");p-=d.width+h.width,f-=d.height+h.height}return p=Math.max(0,p-s.width),f=Math.max(0,i?p/i:f-s.height),p=round1(Math.min(p,a,u.maxWidth)),f=round1(Math.min(f,l,u.maxHeight)),p&&!f&&(f=round1(p/2)),(e!==void 0||r!==void 0)&&i&&u.height&&f>u.height&&(f=u.height,p=round1(Math.floor(f*i))),{width:p,height:f}}function retinaScale(t,e,r){const i=e||1,n=Math.floor(t.height*i),s=Math.floor(t.width*i);t.height=Math.floor(t.height),t.width=Math.floor(t.width);const a=t.canvas;return a.style&&(r||!a.style.height&&!a.style.width)&&(a.style.height=`${t.height}px`,a.style.width=`${t.width}px`),t.currentDevicePixelRatio!==i||a.height!==n||a.width!==s?(t.currentDevicePixelRatio=i,a.height=n,a.width=s,t.ctx.setTransform(i,0,0,i,0,0),!0):!1}const supportsEventListenerOptions=function(){let t=!1;try{const e={get passive(){return t=!0,!1}};_isDomSupported()&&(window.addEventListener("test",null,e),window.removeEventListener("test",null,e))}catch{}return t}();function readUsedSize(t,e){const r=getStyle(t,e),i=r&&r.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function _pointInLine(t,e,r,i){return{x:t.x+r*(e.x-t.x),y:t.y+r*(e.y-t.y)}}function _steppedInterpolation(t,e,r,i){return{x:t.x+r*(e.x-t.x),y:i==="middle"?r<.5?t.y:e.y:i==="after"?r<1?t.y:e.y:r>0?e.y:t.y}}function _bezierInterpolation(t,e,r,i){const n={x:t.cp2x,y:t.cp2y},s={x:e.cp1x,y:e.cp1y},a=_pointInLine(t,n,r),l=_pointInLine(n,s,r),u=_pointInLine(s,e,r),p=_pointInLine(a,l,r),f=_pointInLine(l,u,r);return _pointInLine(p,f,r)}const getRightToLeftAdapter=function(t,e){return{x(r){return t+t+e-r},setWidth(r){e=r},textAlign(r){return r==="center"?r:r==="right"?"left":"right"},xPlus(r,i){return r-i},leftForLtr(r,i){return r-i}}},getLeftToRightAdapter=function(){return{x(t){return t},setWidth(t){},textAlign(t){return t},xPlus(t,e){return t+e},leftForLtr(t,e){return t}}};function getRtlAdapter(t,e,r){return t?getRightToLeftAdapter(e,r):getLeftToRightAdapter()}function overrideTextDirection(t,e){let r,i;(e==="ltr"||e==="rtl")&&(r=t.canvas.style,i=[r.getPropertyValue("direction"),r.getPropertyPriority("direction")],r.setProperty("direction",e,"important"),t.prevTextDirection=i)}function restoreTextDirection(t,e){e!==void 0&&(delete t.prevTextDirection,t.canvas.style.setProperty("direction",e[0],e[1]))}function propertyFn(t){return t==="angle"?{between:_angleBetween,compare:_angleDiff,normalize:_normalizeAngle}:{between:_isBetween,compare:(e,r)=>e-r,normalize:e=>e}}function normalizeSegment({start:t,end:e,count:r,loop:i,style:n}){return{start:t%r,end:e%r,loop:i&&(e-t+1)%r===0,style:n}}function getSegment(t,e,r){const{property:i,start:n,end:s}=r,{between:a,normalize:l}=propertyFn(i),u=e.length;let{start:p,end:f,loop:c}=t,h,d;if(c){for(p+=u,f+=u,h=0,d=u;h<d&&a(l(e[p%u][i]),n,s);++h)p--,f--;p%=u,f%=u}return f<p&&(f+=u),{start:p,end:f,loop:c,style:t.style}}function _boundSegment(t,e,r){if(!r)return[t];const{property:i,start:n,end:s}=r,a=e.length,{compare:l,between:u,normalize:p}=propertyFn(i),{start:f,end:c,loop:h,style:d}=getSegment(t,e,r),m=[];let _=!1,g=null,b,x,S;const T=()=>u(n,S,b)&&l(n,S)!==0,I=()=>l(s,b)===0||u(s,S,b),O=()=>_||T(),L=()=>!_||I();for(let P=f,C=f;P<=c;++P)x=e[P%a],!x.skip&&(b=p(x[i]),b!==S&&(_=u(b,n,s),g===null&&O()&&(g=l(b,n)===0?P:C),g!==null&&L()&&(m.push(normalizeSegment({start:g,end:P,loop:h,count:a,style:d})),g=null),C=P,S=b));return g!==null&&m.push(normalizeSegment({start:g,end:c,loop:h,count:a,style:d})),m}function _boundSegments(t,e){const r=[],i=t.segments;for(let n=0;n<i.length;n++){const s=_boundSegment(i[n],t.points,e);s.length&&r.push(...s)}return r}function findStartAndEnd(t,e,r,i){let n=0,s=e-1;if(r&&!i)for(;n<e&&!t[n].skip;)n++;for(;n<e&&t[n].skip;)n++;for(n%=e,r&&(s+=n);s>n&&t[s%e].skip;)s--;return s%=e,{start:n,end:s}}function solidSegments(t,e,r,i){const n=t.length,s=[];let a=e,l=t[e],u;for(u=e+1;u<=r;++u){const p=t[u%n];p.skip||p.stop?l.skip||(i=!1,s.push({start:e%n,end:(u-1)%n,loop:i}),e=a=p.stop?u:null):(a=u,l.skip&&(e=u)),l=p}return a!==null&&s.push({start:e%n,end:a%n,loop:i}),s}function _computeSegments(t,e){const r=t.points,i=t.options.spanGaps,n=r.length;if(!n)return[];const s=!!t._loop,{start:a,end:l}=findStartAndEnd(r,n,s,i);if(i===!0)return splitByStyles(t,[{start:a,end:l,loop:s}],r,e);const u=l<a?l+n:l,p=!!t._fullLoop&&a===0&&l===n-1;return splitByStyles(t,solidSegments(r,a,u,p),r,e)}function splitByStyles(t,e,r,i){return!i||!i.setContext||!r?e:doSplitByStyles(t,e,r,i)}function doSplitByStyles(t,e,r,i){const n=t._chart.getContext(),s=readStyle(t.options),{_datasetIndex:a,options:{spanGaps:l}}=t,u=r.length,p=[];let f=s,c=e[0].start,h=c;function d(m,_,g,b){const x=l?-1:1;if(m!==_){for(m+=u;r[m%u].skip;)m-=x;for(;r[_%u].skip;)_+=x;m%u!==_%u&&(p.push({start:m%u,end:_%u,loop:g,style:b}),f=b,c=_%u)}}for(const m of e){c=l?c:m.start;let _=r[c%u],g;for(h=c+1;h<=m.end;h++){const b=r[h%u];g=readStyle(i.setContext(createContext(n,{type:"segment",p0:_,p1:b,p0DataIndex:(h-1)%u,p1DataIndex:h%u,datasetIndex:a}))),styleChanged(g,f)&&d(c,h-1,m.loop,f),_=b,f=g}c<h-1&&d(c,h-1,m.loop,f)}return p}function readStyle(t){return{backgroundColor:t.backgroundColor,borderCapStyle:t.borderCapStyle,borderDash:t.borderDash,borderDashOffset:t.borderDashOffset,borderJoinStyle:t.borderJoinStyle,borderWidth:t.borderWidth,borderColor:t.borderColor}}function styleChanged(t,e){if(!e)return!1;const r=[],i=function(n,s){return isPatternOrGradient(s)?(r.includes(s)||r.push(s),r.indexOf(s)):s};return JSON.stringify(t,i)!==JSON.stringify(e,i)}function getSizeForArea(t,e,r){return t.options.clip?t[r]:e[r]}function getDatasetArea(t,e){const{xScale:r,yScale:i}=t;return r&&i?{left:getSizeForArea(r,e,"left"),right:getSizeForArea(r,e,"right"),top:getSizeForArea(i,e,"top"),bottom:getSizeForArea(i,e,"bottom")}:e}function getDatasetClipArea(t,e){const r=e._clip;if(r.disabled)return!1;const i=getDatasetArea(e,t.chartArea);return{left:r.left===!1?0:i.left-(r.left===!0?0:r.left),right:r.right===!1?t.width:i.right+(r.right===!0?0:r.right),top:r.top===!1?0:i.top-(r.top===!0?0:r.top),bottom:r.bottom===!1?t.height:i.bottom+(r.bottom===!0?0:r.bottom)}}/*!
 * Chart.js v4.4.9
 * https://www.chartjs.org
 * (c) 2025 Chart.js Contributors
 * Released under the MIT License
 */class Animator{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(e,r,i,n){const s=r.listeners[n],a=r.duration;s.forEach(l=>l({chart:e,initial:r.initial,numSteps:a,currentStep:Math.min(i-r.start,a)}))}_refresh(){this._request||(this._running=!0,this._request=requestAnimFrame.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(e=Date.now()){let r=0;this._charts.forEach((i,n)=>{if(!i.running||!i.items.length)return;const s=i.items;let a=s.length-1,l=!1,u;for(;a>=0;--a)u=s[a],u._active?(u._total>i.duration&&(i.duration=u._total),u.tick(e),l=!0):(s[a]=s[s.length-1],s.pop());l&&(n.draw(),this._notify(n,i,e,"progress")),s.length||(i.running=!1,this._notify(n,i,e,"complete"),i.initial=!1),r+=s.length}),this._lastDate=e,r===0&&(this._running=!1)}_getAnims(e){const r=this._charts;let i=r.get(e);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},r.set(e,i)),i}listen(e,r,i){this._getAnims(e).listeners[r].push(i)}add(e,r){!r||!r.length||this._getAnims(e).items.push(...r)}has(e){return this._getAnims(e).items.length>0}start(e){const r=this._charts.get(e);r&&(r.running=!0,r.start=Date.now(),r.duration=r.items.reduce((i,n)=>Math.max(i,n._duration),0),this._refresh())}running(e){if(!this._running)return!1;const r=this._charts.get(e);return!(!r||!r.running||!r.items.length)}stop(e){const r=this._charts.get(e);if(!r||!r.items.length)return;const i=r.items;let n=i.length-1;for(;n>=0;--n)i[n].cancel();r.items=[],this._notify(e,r,Date.now(),"complete")}remove(e){return this._charts.delete(e)}}var animator=new Animator;const transparent="transparent",interpolators={boolean(t,e,r){return r>.5?e:t},color(t,e,r){const i=color(t||transparent),n=i.valid&&color(e||transparent);return n&&n.valid?n.mix(i,r).hexString():e},number(t,e,r){return t+(e-t)*r}};class Animation{constructor(e,r,i,n){const s=r[i];n=resolve([e.to,n,s,e.from]);const a=resolve([e.from,s,n]);this._active=!0,this._fn=e.fn||interpolators[e.type||typeof a],this._easing=effects[e.easing]||effects.linear,this._start=Math.floor(Date.now()+(e.delay||0)),this._duration=this._total=Math.floor(e.duration),this._loop=!!e.loop,this._target=r,this._prop=i,this._from=a,this._to=n,this._promises=void 0}active(){return this._active}update(e,r,i){if(this._active){this._notify(!1);const n=this._target[this._prop],s=i-this._start,a=this._duration-s;this._start=i,this._duration=Math.floor(Math.max(a,e.duration)),this._total+=s,this._loop=!!e.loop,this._to=resolve([e.to,r,n,e.from]),this._from=resolve([e.from,n,r])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(e){const r=e-this._start,i=this._duration,n=this._prop,s=this._from,a=this._loop,l=this._to;let u;if(this._active=s!==l&&(a||r<i),!this._active){this._target[n]=l,this._notify(!0);return}if(r<0){this._target[n]=s;return}u=r/i%2,u=a&&u>1?2-u:u,u=this._easing(Math.min(1,Math.max(0,u))),this._target[n]=this._fn(s,l,u)}wait(){const e=this._promises||(this._promises=[]);return new Promise((r,i)=>{e.push({res:r,rej:i})})}_notify(e){const r=e?"res":"rej",i=this._promises||[];for(let n=0;n<i.length;n++)i[n][r]()}}class Animations{constructor(e,r){this._chart=e,this._properties=new Map,this.configure(r)}configure(e){if(!isObject(e))return;const r=Object.keys(defaults.animation),i=this._properties;Object.getOwnPropertyNames(e).forEach(n=>{const s=e[n];if(!isObject(s))return;const a={};for(const l of r)a[l]=s[l];(isArray(s.properties)&&s.properties||[n]).forEach(l=>{(l===n||!i.has(l))&&i.set(l,a)})})}_animateOptions(e,r){const i=r.options,n=resolveTargetOptions(e,i);if(!n)return[];const s=this._createAnimations(n,i);return i.$shared&&awaitAll(e.options.$animations,i).then(()=>{e.options=i},()=>{}),s}_createAnimations(e,r){const i=this._properties,n=[],s=e.$animations||(e.$animations={}),a=Object.keys(r),l=Date.now();let u;for(u=a.length-1;u>=0;--u){const p=a[u];if(p.charAt(0)==="$")continue;if(p==="options"){n.push(...this._animateOptions(e,r));continue}const f=r[p];let c=s[p];const h=i.get(p);if(c)if(h&&c.active()){c.update(h,f,l);continue}else c.cancel();if(!h||!h.duration){e[p]=f;continue}s[p]=c=new Animation(h,e,p,f),n.push(c)}return n}update(e,r){if(this._properties.size===0){Object.assign(e,r);return}const i=this._createAnimations(e,r);if(i.length)return animator.add(this._chart,i),!0}}function awaitAll(t,e){const r=[],i=Object.keys(e);for(let n=0;n<i.length;n++){const s=t[i[n]];s&&s.active()&&r.push(s.wait())}return Promise.all(r)}function resolveTargetOptions(t,e){if(!e)return;let r=t.options;if(!r){t.options=e;return}return r.$shared&&(t.options=r=Object.assign({},r,{$shared:!1,$animations:{}})),r}function scaleClip(t,e){const r=t&&t.options||{},i=r.reverse,n=r.min===void 0?e:0,s=r.max===void 0?e:0;return{start:i?s:n,end:i?n:s}}function defaultClip(t,e,r){if(r===!1)return!1;const i=scaleClip(t,r),n=scaleClip(e,r);return{top:n.end,right:i.end,bottom:n.start,left:i.start}}function toClip(t){let e,r,i,n;return isObject(t)?(e=t.top,r=t.right,i=t.bottom,n=t.left):e=r=i=n=t,{top:e,right:r,bottom:i,left:n,disabled:t===!1}}function getSortedDatasetIndices(t,e){const r=[],i=t._getSortedDatasetMetas(e);let n,s;for(n=0,s=i.length;n<s;++n)r.push(i[n].index);return r}function applyStack(t,e,r,i={}){const n=t.keys,s=i.mode==="single";let a,l,u,p;if(e===null)return;let f=!1;for(a=0,l=n.length;a<l;++a){if(u=+n[a],u===r){if(f=!0,i.all)continue;break}p=t.values[u],isNumberFinite(p)&&(s||e===0||sign(e)===sign(p))&&(e+=p)}return!f&&!i.all?0:e}function convertObjectDataToArray(t,e){const{iScale:r,vScale:i}=e,n=r.axis==="x"?"x":"y",s=i.axis==="x"?"x":"y",a=Object.keys(t),l=new Array(a.length);let u,p,f;for(u=0,p=a.length;u<p;++u)f=a[u],l[u]={[n]:f,[s]:t[f]};return l}function isStacked(t,e){const r=t&&t.options.stacked;return r||r===void 0&&e.stack!==void 0}function getStackKey(t,e,r){return`${t.id}.${e.id}.${r.stack||r.type}`}function getUserBounds(t){const{min:e,max:r,minDefined:i,maxDefined:n}=t.getUserBounds();return{min:i?e:Number.NEGATIVE_INFINITY,max:n?r:Number.POSITIVE_INFINITY}}function getOrCreateStack(t,e,r){const i=t[e]||(t[e]={});return i[r]||(i[r]={})}function getLastIndexInStack(t,e,r,i){for(const n of e.getMatchingVisibleMetas(i).reverse()){const s=t[n.index];if(r&&s>0||!r&&s<0)return n.index}return null}function updateStacks(t,e){const{chart:r,_cachedMeta:i}=t,n=r._stacks||(r._stacks={}),{iScale:s,vScale:a,index:l}=i,u=s.axis,p=a.axis,f=getStackKey(s,a,i),c=e.length;let h;for(let d=0;d<c;++d){const m=e[d],{[u]:_,[p]:g}=m,b=m._stacks||(m._stacks={});h=b[p]=getOrCreateStack(n,f,_),h[l]=g,h._top=getLastIndexInStack(h,a,!0,i.type),h._bottom=getLastIndexInStack(h,a,!1,i.type);const x=h._visualValues||(h._visualValues={});x[l]=g}}function getFirstScaleId(t,e){const r=t.scales;return Object.keys(r).filter(i=>r[i].axis===e).shift()}function createDatasetContext(t,e){return createContext(t,{active:!1,dataset:void 0,datasetIndex:e,index:e,mode:"default",type:"dataset"})}function createDataContext(t,e,r){return createContext(t,{active:!1,dataIndex:e,parsed:void 0,raw:void 0,element:r,index:e,mode:"default",type:"data"})}function clearStacks(t,e){const r=t.controller.index,i=t.vScale&&t.vScale.axis;if(i){e=e||t._parsed;for(const n of e){const s=n._stacks;if(!s||s[i]===void 0||s[i][r]===void 0)return;delete s[i][r],s[i]._visualValues!==void 0&&s[i]._visualValues[r]!==void 0&&delete s[i]._visualValues[r]}}}const isDirectUpdateMode=t=>t==="reset"||t==="none",cloneIfNotShared=(t,e)=>e?t:Object.assign({},t),createStack=(t,e,r)=>t&&!e.hidden&&e._stacked&&{keys:getSortedDatasetIndices(r,!0),values:null};class DatasetController{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(e,r){this.chart=e,this._ctx=e.ctx,this.index=r,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const e=this._cachedMeta;this.configure(),this.linkScales(),e._stacked=isStacked(e.vScale,e),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(e){this.index!==e&&clearStacks(this._cachedMeta),this.index=e}linkScales(){const e=this.chart,r=this._cachedMeta,i=this.getDataset(),n=(c,h,d,m)=>c==="x"?h:c==="r"?m:d,s=r.xAxisID=valueOrDefault(i.xAxisID,getFirstScaleId(e,"x")),a=r.yAxisID=valueOrDefault(i.yAxisID,getFirstScaleId(e,"y")),l=r.rAxisID=valueOrDefault(i.rAxisID,getFirstScaleId(e,"r")),u=r.indexAxis,p=r.iAxisID=n(u,s,a,l),f=r.vAxisID=n(u,a,s,l);r.xScale=this.getScaleForId(s),r.yScale=this.getScaleForId(a),r.rScale=this.getScaleForId(l),r.iScale=this.getScaleForId(p),r.vScale=this.getScaleForId(f)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(e){return this.chart.scales[e]}_getOtherScale(e){const r=this._cachedMeta;return e===r.iScale?r.vScale:r.iScale}reset(){this._update("reset")}_destroy(){const e=this._cachedMeta;this._data&&unlistenArrayEvents(this._data,this),e._stacked&&clearStacks(e)}_dataCheck(){const e=this.getDataset(),r=e.data||(e.data=[]),i=this._data;if(isObject(r)){const n=this._cachedMeta;this._data=convertObjectDataToArray(r,n)}else if(i!==r){if(i){unlistenArrayEvents(i,this);const n=this._cachedMeta;clearStacks(n),n._parsed=[]}r&&Object.isExtensible(r)&&listenArrayEvents(r,this),this._syncList=[],this._data=r}}addElements(){const e=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(e.dataset=new this.datasetElementType)}buildOrUpdateElements(e){const r=this._cachedMeta,i=this.getDataset();let n=!1;this._dataCheck();const s=r._stacked;r._stacked=isStacked(r.vScale,r),r.stack!==i.stack&&(n=!0,clearStacks(r),r.stack=i.stack),this._resyncElements(e),(n||s!==r._stacked)&&(updateStacks(this,r._parsed),r._stacked=isStacked(r.vScale,r))}configure(){const e=this.chart.config,r=e.datasetScopeKeys(this._type),i=e.getOptionScopes(this.getDataset(),r,!0);this.options=e.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(e,r){const{_cachedMeta:i,_data:n}=this,{iScale:s,_stacked:a}=i,l=s.axis;let u=e===0&&r===n.length?!0:i._sorted,p=e>0&&i._parsed[e-1],f,c,h;if(this._parsing===!1)i._parsed=n,i._sorted=!0,h=n;else{isArray(n[e])?h=this.parseArrayData(i,n,e,r):isObject(n[e])?h=this.parseObjectData(i,n,e,r):h=this.parsePrimitiveData(i,n,e,r);const d=()=>c[l]===null||p&&c[l]<p[l];for(f=0;f<r;++f)i._parsed[f+e]=c=h[f],u&&(d()&&(u=!1),p=c);i._sorted=u}a&&updateStacks(this,h)}parsePrimitiveData(e,r,i,n){const{iScale:s,vScale:a}=e,l=s.axis,u=a.axis,p=s.getLabels(),f=s===a,c=new Array(n);let h,d,m;for(h=0,d=n;h<d;++h)m=h+i,c[h]={[l]:f||s.parse(p[m],m),[u]:a.parse(r[m],m)};return c}parseArrayData(e,r,i,n){const{xScale:s,yScale:a}=e,l=new Array(n);let u,p,f,c;for(u=0,p=n;u<p;++u)f=u+i,c=r[f],l[u]={x:s.parse(c[0],f),y:a.parse(c[1],f)};return l}parseObjectData(e,r,i,n){const{xScale:s,yScale:a}=e,{xAxisKey:l="x",yAxisKey:u="y"}=this._parsing,p=new Array(n);let f,c,h,d;for(f=0,c=n;f<c;++f)h=f+i,d=r[h],p[f]={x:s.parse(resolveObjectKey(d,l),h),y:a.parse(resolveObjectKey(d,u),h)};return p}getParsed(e){return this._cachedMeta._parsed[e]}getDataElement(e){return this._cachedMeta.data[e]}applyStack(e,r,i){const n=this.chart,s=this._cachedMeta,a=r[e.axis],l={keys:getSortedDatasetIndices(n,!0),values:r._stacks[e.axis]._visualValues};return applyStack(l,a,s.index,{mode:i})}updateRangeFromParsed(e,r,i,n){const s=i[r.axis];let a=s===null?NaN:s;const l=n&&i._stacks[r.axis];n&&l&&(n.values=l,a=applyStack(n,s,this._cachedMeta.index)),e.min=Math.min(e.min,a),e.max=Math.max(e.max,a)}getMinMax(e,r){const i=this._cachedMeta,n=i._parsed,s=i._sorted&&e===i.iScale,a=n.length,l=this._getOtherScale(e),u=createStack(r,i,this.chart),p={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:f,max:c}=getUserBounds(l);let h,d;function m(){d=n[h];const _=d[l.axis];return!isNumberFinite(d[e.axis])||f>_||c<_}for(h=0;h<a&&!(!m()&&(this.updateRangeFromParsed(p,e,d,u),s));++h);if(s){for(h=a-1;h>=0;--h)if(!m()){this.updateRangeFromParsed(p,e,d,u);break}}return p}getAllParsedValues(e){const r=this._cachedMeta._parsed,i=[];let n,s,a;for(n=0,s=r.length;n<s;++n)a=r[n][e.axis],isNumberFinite(a)&&i.push(a);return i}getMaxOverflow(){return!1}getLabelAndValue(e){const r=this._cachedMeta,i=r.iScale,n=r.vScale,s=this.getParsed(e);return{label:i?""+i.getLabelForValue(s[i.axis]):"",value:n?""+n.getLabelForValue(s[n.axis]):""}}_update(e){const r=this._cachedMeta;this.update(e||"default"),r._clip=toClip(valueOrDefault(this.options.clip,defaultClip(r.xScale,r.yScale,this.getMaxOverflow())))}update(e){}draw(){const e=this._ctx,r=this.chart,i=this._cachedMeta,n=i.data||[],s=r.chartArea,a=[],l=this._drawStart||0,u=this._drawCount||n.length-l,p=this.options.drawActiveElementsOnTop;let f;for(i.dataset&&i.dataset.draw(e,s,l,u),f=l;f<l+u;++f){const c=n[f];c.hidden||(c.active&&p?a.push(c):c.draw(e,s))}for(f=0;f<a.length;++f)a[f].draw(e,s)}getStyle(e,r){const i=r?"active":"default";return e===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(e||0,i)}getContext(e,r,i){const n=this.getDataset();let s;if(e>=0&&e<this._cachedMeta.data.length){const a=this._cachedMeta.data[e];s=a.$context||(a.$context=createDataContext(this.getContext(),e,a)),s.parsed=this.getParsed(e),s.raw=n.data[e],s.index=s.dataIndex=e}else s=this.$context||(this.$context=createDatasetContext(this.chart.getContext(),this.index)),s.dataset=n,s.index=s.datasetIndex=this.index;return s.active=!!r,s.mode=i,s}resolveDatasetElementOptions(e){return this._resolveElementOptions(this.datasetElementType.id,e)}resolveDataElementOptions(e,r){return this._resolveElementOptions(this.dataElementType.id,r,e)}_resolveElementOptions(e,r="default",i){const n=r==="active",s=this._cachedDataOpts,a=e+"-"+r,l=s[a],u=this.enableOptionSharing&&defined(i);if(l)return cloneIfNotShared(l,u);const p=this.chart.config,f=p.datasetElementScopeKeys(this._type,e),c=n?[`${e}Hover`,"hover",e,""]:[e,""],h=p.getOptionScopes(this.getDataset(),f),d=Object.keys(defaults.elements[e]),m=()=>this.getContext(i,n,r),_=p.resolveNamedOptions(h,d,m,c);return _.$shared&&(_.$shared=u,s[a]=Object.freeze(cloneIfNotShared(_,u))),_}_resolveAnimations(e,r,i){const n=this.chart,s=this._cachedDataOpts,a=`animation-${r}`,l=s[a];if(l)return l;let u;if(n.options.animation!==!1){const f=this.chart.config,c=f.datasetAnimationScopeKeys(this._type,r),h=f.getOptionScopes(this.getDataset(),c);u=f.createResolver(h,this.getContext(e,i,r))}const p=new Animations(n,u&&u.animations);return u&&u._cacheable&&(s[a]=Object.freeze(p)),p}getSharedOptions(e){if(e.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},e))}includeOptions(e,r){return!r||isDirectUpdateMode(e)||this.chart._animationsDisabled}_getSharedOptions(e,r){const i=this.resolveDataElementOptions(e,r),n=this._sharedOptions,s=this.getSharedOptions(i),a=this.includeOptions(r,s)||s!==n;return this.updateSharedOptions(s,r,i),{sharedOptions:s,includeOptions:a}}updateElement(e,r,i,n){isDirectUpdateMode(n)?Object.assign(e,i):this._resolveAnimations(r,n).update(e,i)}updateSharedOptions(e,r,i){e&&!isDirectUpdateMode(r)&&this._resolveAnimations(void 0,r).update(e,i)}_setStyle(e,r,i,n){e.active=n;const s=this.getStyle(r,n);this._resolveAnimations(r,i,n).update(e,{options:!n&&this.getSharedOptions(s)||s})}removeHoverStyle(e,r,i){this._setStyle(e,i,"active",!1)}setHoverStyle(e,r,i){this._setStyle(e,i,"active",!0)}_removeDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!1)}_setDatasetHoverStyle(){const e=this._cachedMeta.dataset;e&&this._setStyle(e,void 0,"active",!0)}_resyncElements(e){const r=this._data,i=this._cachedMeta.data;for(const[l,u,p]of this._syncList)this[l](u,p);this._syncList=[];const n=i.length,s=r.length,a=Math.min(s,n);a&&this.parse(0,a),s>n?this._insertElements(n,s-n,e):s<n&&this._removeElements(s,n-s)}_insertElements(e,r,i=!0){const n=this._cachedMeta,s=n.data,a=e+r;let l;const u=p=>{for(p.length+=r,l=p.length-1;l>=a;l--)p[l]=p[l-r]};for(u(s),l=e;l<a;++l)s[l]=new this.dataElementType;this._parsing&&u(n._parsed),this.parse(e,r),i&&this.updateElements(s,e,r,"reset")}updateElements(e,r,i,n){}_removeElements(e,r){const i=this._cachedMeta;if(this._parsing){const n=i._parsed.splice(e,r);i._stacked&&clearStacks(i,n)}i.data.splice(e,r)}_sync(e){if(this._parsing)this._syncList.push(e);else{const[r,i,n]=e;this[r](i,n)}this.chart._dataChanges.push([this.index,...e])}_onDataPush(){const e=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-e,e])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(e,r){r&&this._sync(["_removeElements",e,r]);const i=arguments.length-2;i&&this._sync(["_insertElements",e,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}class LineController extends DatasetController{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(e){const r=this._cachedMeta,{dataset:i,data:n=[],_dataset:s}=r,a=this.chart._animationsDisabled;let{start:l,count:u}=_getStartAndCountOfVisiblePoints(r,n,a);this._drawStart=l,this._drawCount=u,_scaleRangesChanged(r)&&(l=0,u=n.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!s._decimated,i.points=n;const p=this.resolveDatasetElementOptions(e);this.options.showLine||(p.borderWidth=0),p.segment=this.options.segment,this.updateElement(i,void 0,{animated:!a,options:p},e),this.updateElements(n,l,u,e)}updateElements(e,r,i,n){const s=n==="reset",{iScale:a,vScale:l,_stacked:u,_dataset:p}=this._cachedMeta,{sharedOptions:f,includeOptions:c}=this._getSharedOptions(r,n),h=a.axis,d=l.axis,{spanGaps:m,segment:_}=this.options,g=isNumber(m)?m:Number.POSITIVE_INFINITY,b=this.chart._animationsDisabled||s||n==="none",x=r+i,S=e.length;let T=r>0&&this.getParsed(r-1);for(let I=0;I<S;++I){const O=e[I],L=b?O:{};if(I<r||I>=x){L.skip=!0;continue}const P=this.getParsed(I),C=isNullOrUndef(P[d]),G=L[h]=a.getPixelForValue(P[h],I),B=L[d]=s||C?l.getBasePixel():l.getPixelForValue(u?this.applyStack(l,P,u):P[d],I);L.skip=isNaN(G)||isNaN(B)||C,L.stop=I>0&&Math.abs(P[h]-T[h])>g,_&&(L.parsed=P,L.raw=p.data[I]),c&&(L.options=f||this.resolveDataElementOptions(I,O.active?"active":n)),b||this.updateElement(O,I,L,n),T=P}}getMaxOverflow(){const e=this._cachedMeta,r=e.dataset,i=r.options&&r.options.borderWidth||0,n=e.data||[];if(!n.length)return i;const s=n[0].size(this.resolveDataElementOptions(0)),a=n[n.length-1].size(this.resolveDataElementOptions(n.length-1));return Math.max(i,s,a)/2}draw(){const e=this._cachedMeta;e.dataset.updateControlPoints(this.chart.chartArea,e.iScale.axis),super.draw()}}function abstract(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class DateAdapterBase{static override(e){Object.assign(DateAdapterBase.prototype,e)}options;constructor(e){this.options=e||{}}init(){}formats(){return abstract()}parse(){return abstract()}format(){return abstract()}add(){return abstract()}diff(){return abstract()}startOf(){return abstract()}endOf(){return abstract()}}var adapters={_date:DateAdapterBase};function binarySearch(t,e,r,i){const{controller:n,data:s,_sorted:a}=t,l=n._cachedMeta.iScale,u=t.dataset&&t.dataset.options?t.dataset.options.spanGaps:null;if(l&&e===l.axis&&e!=="r"&&a&&s.length){const p=l._reversePixels?_rlookupByKey:_lookupByKey;if(i){if(n._sharedOptions){const f=s[0],c=typeof f.getRange=="function"&&f.getRange(e);if(c){const h=p(s,e,r-c),d=p(s,e,r+c);return{lo:h.lo,hi:d.hi}}}}else{const f=p(s,e,r);if(u){const{vScale:c}=n._cachedMeta,{_parsed:h}=t,d=h.slice(0,f.lo+1).reverse().findIndex(_=>!isNullOrUndef(_[c.axis]));f.lo-=Math.max(0,d);const m=h.slice(f.hi).findIndex(_=>!isNullOrUndef(_[c.axis]));f.hi+=Math.max(0,m)}return f}}return{lo:0,hi:s.length-1}}function evaluateInteractionItems(t,e,r,i,n){const s=t.getSortedVisibleDatasetMetas(),a=r[e];for(let l=0,u=s.length;l<u;++l){const{index:p,data:f}=s[l],{lo:c,hi:h}=binarySearch(s[l],e,a,n);for(let d=c;d<=h;++d){const m=f[d];m.skip||i(m,p,d)}}}function getDistanceMetricForAxis(t){const e=t.indexOf("x")!==-1,r=t.indexOf("y")!==-1;return function(i,n){const s=e?Math.abs(i.x-n.x):0,a=r?Math.abs(i.y-n.y):0;return Math.sqrt(Math.pow(s,2)+Math.pow(a,2))}}function getIntersectItems(t,e,r,i,n){const s=[];return!n&&!t.isPointInArea(e)||evaluateInteractionItems(t,r,e,function(l,u,p){!n&&!_isPointInArea(l,t.chartArea,0)||l.inRange(e.x,e.y,i)&&s.push({element:l,datasetIndex:u,index:p})},!0),s}function getNearestRadialItems(t,e,r,i){let n=[];function s(a,l,u){const{startAngle:p,endAngle:f}=a.getProps(["startAngle","endAngle"],i),{angle:c}=getAngleFromPoint(a,{x:e.x,y:e.y});_angleBetween(c,p,f)&&n.push({element:a,datasetIndex:l,index:u})}return evaluateInteractionItems(t,r,e,s),n}function getNearestCartesianItems(t,e,r,i,n,s){let a=[];const l=getDistanceMetricForAxis(r);let u=Number.POSITIVE_INFINITY;function p(f,c,h){const d=f.inRange(e.x,e.y,n);if(i&&!d)return;const m=f.getCenterPoint(n);if(!(!!s||t.isPointInArea(m))&&!d)return;const g=l(e,m);g<u?(a=[{element:f,datasetIndex:c,index:h}],u=g):g===u&&a.push({element:f,datasetIndex:c,index:h})}return evaluateInteractionItems(t,r,e,p),a}function getNearestItems(t,e,r,i,n,s){return!s&&!t.isPointInArea(e)?[]:r==="r"&&!i?getNearestRadialItems(t,e,r,n):getNearestCartesianItems(t,e,r,i,n,s)}function getAxisItems(t,e,r,i,n){const s=[],a=r==="x"?"inXRange":"inYRange";let l=!1;return evaluateInteractionItems(t,r,e,(u,p,f)=>{u[a]&&u[a](e[r],n)&&(s.push({element:u,datasetIndex:p,index:f}),l=l||u.inRange(e.x,e.y,n))}),i&&!l?[]:s}var Interaction={modes:{index(t,e,r,i){const n=getRelativePosition(e,t),s=r.axis||"x",a=r.includeInvisible||!1,l=r.intersect?getIntersectItems(t,n,s,i,a):getNearestItems(t,n,s,!1,i,a),u=[];return l.length?(t.getSortedVisibleDatasetMetas().forEach(p=>{const f=l[0].index,c=p.data[f];c&&!c.skip&&u.push({element:c,datasetIndex:p.index,index:f})}),u):[]},dataset(t,e,r,i){const n=getRelativePosition(e,t),s=r.axis||"xy",a=r.includeInvisible||!1;let l=r.intersect?getIntersectItems(t,n,s,i,a):getNearestItems(t,n,s,!1,i,a);if(l.length>0){const u=l[0].datasetIndex,p=t.getDatasetMeta(u).data;l=[];for(let f=0;f<p.length;++f)l.push({element:p[f],datasetIndex:u,index:f})}return l},point(t,e,r,i){const n=getRelativePosition(e,t),s=r.axis||"xy",a=r.includeInvisible||!1;return getIntersectItems(t,n,s,i,a)},nearest(t,e,r,i){const n=getRelativePosition(e,t),s=r.axis||"xy",a=r.includeInvisible||!1;return getNearestItems(t,n,s,r.intersect,i,a)},x(t,e,r,i){const n=getRelativePosition(e,t);return getAxisItems(t,n,"x",r.intersect,i)},y(t,e,r,i){const n=getRelativePosition(e,t);return getAxisItems(t,n,"y",r.intersect,i)}}};const STATIC_POSITIONS=["left","top","right","bottom"];function filterByPosition(t,e){return t.filter(r=>r.pos===e)}function filterDynamicPositionByAxis(t,e){return t.filter(r=>STATIC_POSITIONS.indexOf(r.pos)===-1&&r.box.axis===e)}function sortByWeight(t,e){return t.sort((r,i)=>{const n=e?i:r,s=e?r:i;return n.weight===s.weight?n.index-s.index:n.weight-s.weight})}function wrapBoxes(t){const e=[];let r,i,n,s,a,l;for(r=0,i=(t||[]).length;r<i;++r)n=t[r],{position:s,options:{stack:a,stackWeight:l=1}}=n,e.push({index:r,box:n,pos:s,horizontal:n.isHorizontal(),weight:n.weight,stack:a&&s+a,stackWeight:l});return e}function buildStacks(t){const e={};for(const r of t){const{stack:i,pos:n,stackWeight:s}=r;if(!i||!STATIC_POSITIONS.includes(n))continue;const a=e[i]||(e[i]={count:0,placed:0,weight:0,size:0});a.count++,a.weight+=s}return e}function setLayoutDims(t,e){const r=buildStacks(t),{vBoxMaxWidth:i,hBoxMaxHeight:n}=e;let s,a,l;for(s=0,a=t.length;s<a;++s){l=t[s];const{fullSize:u}=l.box,p=r[l.stack],f=p&&l.stackWeight/p.weight;l.horizontal?(l.width=f?f*i:u&&e.availableWidth,l.height=n):(l.width=i,l.height=f?f*n:u&&e.availableHeight)}return r}function buildLayoutBoxes(t){const e=wrapBoxes(t),r=sortByWeight(e.filter(p=>p.box.fullSize),!0),i=sortByWeight(filterByPosition(e,"left"),!0),n=sortByWeight(filterByPosition(e,"right")),s=sortByWeight(filterByPosition(e,"top"),!0),a=sortByWeight(filterByPosition(e,"bottom")),l=filterDynamicPositionByAxis(e,"x"),u=filterDynamicPositionByAxis(e,"y");return{fullSize:r,leftAndTop:i.concat(s),rightAndBottom:n.concat(u).concat(a).concat(l),chartArea:filterByPosition(e,"chartArea"),vertical:i.concat(n).concat(u),horizontal:s.concat(a).concat(l)}}function getCombinedMax(t,e,r,i){return Math.max(t[r],e[r])+Math.max(t[i],e[i])}function updateMaxPadding(t,e){t.top=Math.max(t.top,e.top),t.left=Math.max(t.left,e.left),t.bottom=Math.max(t.bottom,e.bottom),t.right=Math.max(t.right,e.right)}function updateDims(t,e,r,i){const{pos:n,box:s}=r,a=t.maxPadding;if(!isObject(n)){r.size&&(t[n]-=r.size);const c=i[r.stack]||{size:0,count:1};c.size=Math.max(c.size,r.horizontal?s.height:s.width),r.size=c.size/c.count,t[n]+=r.size}s.getPadding&&updateMaxPadding(a,s.getPadding());const l=Math.max(0,e.outerWidth-getCombinedMax(a,t,"left","right")),u=Math.max(0,e.outerHeight-getCombinedMax(a,t,"top","bottom")),p=l!==t.w,f=u!==t.h;return t.w=l,t.h=u,r.horizontal?{same:p,other:f}:{same:f,other:p}}function handleMaxPadding(t){const e=t.maxPadding;function r(i){const n=Math.max(e[i]-t[i],0);return t[i]+=n,n}t.y+=r("top"),t.x+=r("left"),r("right"),r("bottom")}function getMargins(t,e){const r=e.maxPadding;function i(n){const s={left:0,top:0,right:0,bottom:0};return n.forEach(a=>{s[a]=Math.max(e[a],r[a])}),s}return i(t?["left","right"]:["top","bottom"])}function fitBoxes(t,e,r,i){const n=[];let s,a,l,u,p,f;for(s=0,a=t.length,p=0;s<a;++s){l=t[s],u=l.box,u.update(l.width||e.w,l.height||e.h,getMargins(l.horizontal,e));const{same:c,other:h}=updateDims(e,r,l,i);p|=c&&n.length,f=f||h,u.fullSize||n.push(l)}return p&&fitBoxes(n,e,r,i)||f}function setBoxDims(t,e,r,i,n){t.top=r,t.left=e,t.right=e+i,t.bottom=r+n,t.width=i,t.height=n}function placeBoxes(t,e,r,i){const n=r.padding;let{x:s,y:a}=e;for(const l of t){const u=l.box,p=i[l.stack]||{placed:0,weight:1},f=l.stackWeight/p.weight||1;if(l.horizontal){const c=e.w*f,h=p.size||u.height;defined(p.start)&&(a=p.start),u.fullSize?setBoxDims(u,n.left,a,r.outerWidth-n.right-n.left,h):setBoxDims(u,e.left+p.placed,a,c,h),p.start=a,p.placed+=c,a=u.bottom}else{const c=e.h*f,h=p.size||u.width;defined(p.start)&&(s=p.start),u.fullSize?setBoxDims(u,s,n.top,h,r.outerHeight-n.bottom-n.top):setBoxDims(u,s,e.top+p.placed,h,c),p.start=s,p.placed+=c,s=u.right}}e.x=s,e.y=a}var layouts={addBox(t,e){t.boxes||(t.boxes=[]),e.fullSize=e.fullSize||!1,e.position=e.position||"top",e.weight=e.weight||0,e._layers=e._layers||function(){return[{z:0,draw(r){e.draw(r)}}]},t.boxes.push(e)},removeBox(t,e){const r=t.boxes?t.boxes.indexOf(e):-1;r!==-1&&t.boxes.splice(r,1)},configure(t,e,r){e.fullSize=r.fullSize,e.position=r.position,e.weight=r.weight},update(t,e,r,i){if(!t)return;const n=toPadding(t.options.layout.padding),s=Math.max(e-n.width,0),a=Math.max(r-n.height,0),l=buildLayoutBoxes(t.boxes),u=l.vertical,p=l.horizontal;each(t.boxes,_=>{typeof _.beforeLayout=="function"&&_.beforeLayout()});const f=u.reduce((_,g)=>g.box.options&&g.box.options.display===!1?_:_+1,0)||1,c=Object.freeze({outerWidth:e,outerHeight:r,padding:n,availableWidth:s,availableHeight:a,vBoxMaxWidth:s/2/f,hBoxMaxHeight:a/2}),h=Object.assign({},n);updateMaxPadding(h,toPadding(i));const d=Object.assign({maxPadding:h,w:s,h:a,x:n.left,y:n.top},n),m=setLayoutDims(u.concat(p),c);fitBoxes(l.fullSize,d,c,m),fitBoxes(u,d,c,m),fitBoxes(p,d,c,m)&&fitBoxes(u,d,c,m),handleMaxPadding(d),placeBoxes(l.leftAndTop,d,c,m),d.x+=d.w,d.y+=d.h,placeBoxes(l.rightAndBottom,d,c,m),t.chartArea={left:d.left,top:d.top,right:d.left+d.w,bottom:d.top+d.h,height:d.h,width:d.w},each(l.chartArea,_=>{const g=_.box;Object.assign(g,t.chartArea),g.update(d.w,d.h,{left:0,top:0,right:0,bottom:0})})}};class BasePlatform{acquireContext(e,r){}releaseContext(e){return!1}addEventListener(e,r,i){}removeEventListener(e,r,i){}getDevicePixelRatio(){return 1}getMaximumSize(e,r,i,n){return r=Math.max(0,r||e.width),i=i||e.height,{width:r,height:Math.max(0,n?Math.floor(r/n):i)}}isAttached(e){return!0}updateConfig(e){}}class BasicPlatform extends BasePlatform{acquireContext(e){return e&&e.getContext&&e.getContext("2d")||null}updateConfig(e){e.options.animation=!1}}const EXPANDO_KEY="$chartjs",EVENT_TYPES={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},isNullOrEmpty=t=>t===null||t==="";function initCanvas(t,e){const r=t.style,i=t.getAttribute("height"),n=t.getAttribute("width");if(t[EXPANDO_KEY]={initial:{height:i,width:n,style:{display:r.display,height:r.height,width:r.width}}},r.display=r.display||"block",r.boxSizing=r.boxSizing||"border-box",isNullOrEmpty(n)){const s=readUsedSize(t,"width");s!==void 0&&(t.width=s)}if(isNullOrEmpty(i))if(t.style.height==="")t.height=t.width/(e||2);else{const s=readUsedSize(t,"height");s!==void 0&&(t.height=s)}return t}const eventListenerOptions=supportsEventListenerOptions?{passive:!0}:!1;function addListener(t,e,r){t&&t.addEventListener(e,r,eventListenerOptions)}function removeListener(t,e,r){t&&t.canvas&&t.canvas.removeEventListener(e,r,eventListenerOptions)}function fromNativeEvent(t,e){const r=EVENT_TYPES[t.type]||t.type,{x:i,y:n}=getRelativePosition(t,e);return{type:r,chart:e,native:t,x:i!==void 0?i:null,y:n!==void 0?n:null}}function nodeListContains(t,e){for(const r of t)if(r===e||r.contains(e))return!0}function createAttachObserver(t,e,r){const i=t.canvas,n=new MutationObserver(s=>{let a=!1;for(const l of s)a=a||nodeListContains(l.addedNodes,i),a=a&&!nodeListContains(l.removedNodes,i);a&&r()});return n.observe(document,{childList:!0,subtree:!0}),n}function createDetachObserver(t,e,r){const i=t.canvas,n=new MutationObserver(s=>{let a=!1;for(const l of s)a=a||nodeListContains(l.removedNodes,i),a=a&&!nodeListContains(l.addedNodes,i);a&&r()});return n.observe(document,{childList:!0,subtree:!0}),n}const drpListeningCharts=new Map;let oldDevicePixelRatio=0;function onWindowResize(){const t=window.devicePixelRatio;t!==oldDevicePixelRatio&&(oldDevicePixelRatio=t,drpListeningCharts.forEach((e,r)=>{r.currentDevicePixelRatio!==t&&e()}))}function listenDevicePixelRatioChanges(t,e){drpListeningCharts.size||window.addEventListener("resize",onWindowResize),drpListeningCharts.set(t,e)}function unlistenDevicePixelRatioChanges(t){drpListeningCharts.delete(t),drpListeningCharts.size||window.removeEventListener("resize",onWindowResize)}function createResizeObserver(t,e,r){const i=t.canvas,n=i&&_getParentNode(i);if(!n)return;const s=throttled((l,u)=>{const p=n.clientWidth;r(l,u),p<n.clientWidth&&r()},window),a=new ResizeObserver(l=>{const u=l[0],p=u.contentRect.width,f=u.contentRect.height;p===0&&f===0||s(p,f)});return a.observe(n),listenDevicePixelRatioChanges(t,s),a}function releaseObserver(t,e,r){r&&r.disconnect(),e==="resize"&&unlistenDevicePixelRatioChanges(t)}function createProxyAndListen(t,e,r){const i=t.canvas,n=throttled(s=>{t.ctx!==null&&r(fromNativeEvent(s,t))},t);return addListener(i,e,n),n}class DomPlatform extends BasePlatform{acquireContext(e,r){const i=e&&e.getContext&&e.getContext("2d");return i&&i.canvas===e?(initCanvas(e,r),i):null}releaseContext(e){const r=e.canvas;if(!r[EXPANDO_KEY])return!1;const i=r[EXPANDO_KEY].initial;["height","width"].forEach(s=>{const a=i[s];isNullOrUndef(a)?r.removeAttribute(s):r.setAttribute(s,a)});const n=i.style||{};return Object.keys(n).forEach(s=>{r.style[s]=n[s]}),r.width=r.width,delete r[EXPANDO_KEY],!0}addEventListener(e,r,i){this.removeEventListener(e,r);const n=e.$proxies||(e.$proxies={}),a={attach:createAttachObserver,detach:createDetachObserver,resize:createResizeObserver}[r]||createProxyAndListen;n[r]=a(e,r,i)}removeEventListener(e,r){const i=e.$proxies||(e.$proxies={}),n=i[r];if(!n)return;({attach:releaseObserver,detach:releaseObserver,resize:releaseObserver}[r]||removeListener)(e,r,n),i[r]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(e,r,i,n){return getMaximumSize(e,r,i,n)}isAttached(e){const r=e&&_getParentNode(e);return!!(r&&r.isConnected)}}function _detectPlatform(t){return!_isDomSupported()||typeof OffscreenCanvas<"u"&&t instanceof OffscreenCanvas?BasicPlatform:DomPlatform}let Element$1=class{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(e){const{x:r,y:i}=this.getProps(["x","y"],e);return{x:r,y:i}}hasValue(){return isNumber(this.x)&&isNumber(this.y)}getProps(e,r){const i=this.$animations;if(!r||!i)return this;const n={};return e.forEach(s=>{n[s]=i[s]&&i[s].active()?i[s]._to:this[s]}),n}};function autoSkip(t,e){const r=t.options.ticks,i=determineMaxTicks(t),n=Math.min(r.maxTicksLimit||i,i),s=r.major.enabled?getMajorIndices(e):[],a=s.length,l=s[0],u=s[a-1],p=[];if(a>n)return skipMajors(e,p,s,a/n),p;const f=calculateSpacing(s,e,n);if(a>0){let c,h;const d=a>1?Math.round((u-l)/(a-1)):null;for(skip(e,p,f,isNullOrUndef(d)?0:l-d,l),c=0,h=a-1;c<h;c++)skip(e,p,f,s[c],s[c+1]);return skip(e,p,f,u,isNullOrUndef(d)?e.length:u+d),p}return skip(e,p,f),p}function determineMaxTicks(t){const e=t.options.offset,r=t._tickSize(),i=t._length/r+(e?0:1),n=t._maxLength/r;return Math.floor(Math.min(i,n))}function calculateSpacing(t,e,r){const i=getEvenSpacing(t),n=e.length/r;if(!i)return Math.max(n,1);const s=_factorize(i);for(let a=0,l=s.length-1;a<l;a++){const u=s[a];if(u>n)return u}return Math.max(n,1)}function getMajorIndices(t){const e=[];let r,i;for(r=0,i=t.length;r<i;r++)t[r].major&&e.push(r);return e}function skipMajors(t,e,r,i){let n=0,s=r[0],a;for(i=Math.ceil(i),a=0;a<t.length;a++)a===s&&(e.push(t[a]),n++,s=r[n*i])}function skip(t,e,r,i,n){const s=valueOrDefault(i,0),a=Math.min(valueOrDefault(n,t.length),t.length);let l=0,u,p,f;for(r=Math.ceil(r),n&&(u=n-i,r=u/Math.floor(u/r)),f=s;f<0;)l++,f=Math.round(s+l*r);for(p=Math.max(s,0);p<a;p++)p===f&&(e.push(t[p]),l++,f=Math.round(s+l*r))}function getEvenSpacing(t){const e=t.length;let r,i;if(e<2)return!1;for(i=t[0],r=1;r<e;++r)if(t[r]-t[r-1]!==i)return!1;return i}const reverseAlign=t=>t==="left"?"right":t==="right"?"left":t,offsetFromEdge=(t,e,r)=>e==="top"||e==="left"?t[e]+r:t[e]-r,getTicksLimit=(t,e)=>Math.min(e||t,t);function sample(t,e){const r=[],i=t.length/e,n=t.length;let s=0;for(;s<n;s+=i)r.push(t[Math.floor(s)]);return r}function getPixelForGridLine(t,e,r){const i=t.ticks.length,n=Math.min(e,i-1),s=t._startPixel,a=t._endPixel,l=1e-6;let u=t.getPixelForTick(n),p;if(!(r&&(i===1?p=Math.max(u-s,a-u):e===0?p=(t.getPixelForTick(1)-u)/2:p=(u-t.getPixelForTick(n-1))/2,u+=n<e?p:-p,u<s-l||u>a+l)))return u}function garbageCollect(t,e){each(t,r=>{const i=r.gc,n=i.length/2;let s;if(n>e){for(s=0;s<n;++s)delete r.data[i[s]];i.splice(0,n)}})}function getTickMarkLength(t){return t.drawTicks?t.tickLength:0}function getTitleHeight(t,e){if(!t.display)return 0;const r=toFont(t.font,e),i=toPadding(t.padding);return(isArray(t.text)?t.text.length:1)*r.lineHeight+i.height}function createScaleContext(t,e){return createContext(t,{scale:e,type:"scale"})}function createTickContext(t,e,r){return createContext(t,{tick:r,index:e,type:"tick"})}function titleAlign(t,e,r){let i=_toLeftRightCenter(t);return(r&&e!=="right"||!r&&e==="right")&&(i=reverseAlign(i)),i}function titleArgs(t,e,r,i){const{top:n,left:s,bottom:a,right:l,chart:u}=t,{chartArea:p,scales:f}=u;let c=0,h,d,m;const _=a-n,g=l-s;if(t.isHorizontal()){if(d=_alignStartEnd(i,s,l),isObject(r)){const b=Object.keys(r)[0],x=r[b];m=f[b].getPixelForValue(x)+_-e}else r==="center"?m=(p.bottom+p.top)/2+_-e:m=offsetFromEdge(t,r,e);h=l-s}else{if(isObject(r)){const b=Object.keys(r)[0],x=r[b];d=f[b].getPixelForValue(x)-g+e}else r==="center"?d=(p.left+p.right)/2-g+e:d=offsetFromEdge(t,r,e);m=_alignStartEnd(i,a,n),c=r==="left"?-HALF_PI:HALF_PI}return{titleX:d,titleY:m,maxWidth:h,rotation:c}}class Scale extends Element$1{constructor(e){super(),this.id=e.id,this.type=e.type,this.options=void 0,this.ctx=e.ctx,this.chart=e.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(e){this.options=e.setContext(this.getContext()),this.axis=e.axis,this._userMin=this.parse(e.min),this._userMax=this.parse(e.max),this._suggestedMin=this.parse(e.suggestedMin),this._suggestedMax=this.parse(e.suggestedMax)}parse(e,r){return e}getUserBounds(){let{_userMin:e,_userMax:r,_suggestedMin:i,_suggestedMax:n}=this;return e=finiteOrDefault(e,Number.POSITIVE_INFINITY),r=finiteOrDefault(r,Number.NEGATIVE_INFINITY),i=finiteOrDefault(i,Number.POSITIVE_INFINITY),n=finiteOrDefault(n,Number.NEGATIVE_INFINITY),{min:finiteOrDefault(e,i),max:finiteOrDefault(r,n),minDefined:isNumberFinite(e),maxDefined:isNumberFinite(r)}}getMinMax(e){let{min:r,max:i,minDefined:n,maxDefined:s}=this.getUserBounds(),a;if(n&&s)return{min:r,max:i};const l=this.getMatchingVisibleMetas();for(let u=0,p=l.length;u<p;++u)a=l[u].controller.getMinMax(this,e),n||(r=Math.min(r,a.min)),s||(i=Math.max(i,a.max));return r=s&&r>i?i:r,i=n&&r>i?r:i,{min:finiteOrDefault(r,finiteOrDefault(i,r)),max:finiteOrDefault(i,finiteOrDefault(r,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const e=this.chart.data;return this.options.labels||(this.isHorizontal()?e.xLabels:e.yLabels)||e.labels||[]}getLabelItems(e=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(e))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){callback(this.options.beforeUpdate,[this])}update(e,r,i){const{beginAtZero:n,grace:s,ticks:a}=this.options,l=a.sampleSize;this.beforeUpdate(),this.maxWidth=e,this.maxHeight=r,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=_addGrace(this,s,n),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const u=l<this.ticks.length;this._convertTicksToLabels(u?sample(this.ticks,l):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),a.display&&(a.autoSkip||a.source==="auto")&&(this.ticks=autoSkip(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),u&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let e=this.options.reverse,r,i;this.isHorizontal()?(r=this.left,i=this.right):(r=this.top,i=this.bottom,e=!e),this._startPixel=r,this._endPixel=i,this._reversePixels=e,this._length=i-r,this._alignToPixels=this.options.alignToPixels}afterUpdate(){callback(this.options.afterUpdate,[this])}beforeSetDimensions(){callback(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){callback(this.options.afterSetDimensions,[this])}_callHooks(e){this.chart.notifyPlugins(e,this.getContext()),callback(this.options[e],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){callback(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(e){const r=this.options.ticks;let i,n,s;for(i=0,n=e.length;i<n;i++)s=e[i],s.label=callback(r.callback,[s.value,i,e],this)}afterTickToLabelConversion(){callback(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){callback(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const e=this.options,r=e.ticks,i=getTicksLimit(this.ticks.length,e.ticks.maxTicksLimit),n=r.minRotation||0,s=r.maxRotation;let a=n,l,u,p;if(!this._isVisible()||!r.display||n>=s||i<=1||!this.isHorizontal()){this.labelRotation=n;return}const f=this._getLabelSizes(),c=f.widest.width,h=f.highest.height,d=_limitValue(this.chart.width-c,0,this.maxWidth);l=e.offset?this.maxWidth/i:d/(i-1),c+6>l&&(l=d/(i-(e.offset?.5:1)),u=this.maxHeight-getTickMarkLength(e.grid)-r.padding-getTitleHeight(e.title,this.chart.options.font),p=Math.sqrt(c*c+h*h),a=toDegrees(Math.min(Math.asin(_limitValue((f.highest.height+6)/l,-1,1)),Math.asin(_limitValue(u/p,-1,1))-Math.asin(_limitValue(h/p,-1,1)))),a=Math.max(n,Math.min(s,a))),this.labelRotation=a}afterCalculateLabelRotation(){callback(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){callback(this.options.beforeFit,[this])}fit(){const e={width:0,height:0},{chart:r,options:{ticks:i,title:n,grid:s}}=this,a=this._isVisible(),l=this.isHorizontal();if(a){const u=getTitleHeight(n,r.options.font);if(l?(e.width=this.maxWidth,e.height=getTickMarkLength(s)+u):(e.height=this.maxHeight,e.width=getTickMarkLength(s)+u),i.display&&this.ticks.length){const{first:p,last:f,widest:c,highest:h}=this._getLabelSizes(),d=i.padding*2,m=toRadians(this.labelRotation),_=Math.cos(m),g=Math.sin(m);if(l){const b=i.mirror?0:g*c.width+_*h.height;e.height=Math.min(this.maxHeight,e.height+b+d)}else{const b=i.mirror?0:_*c.width+g*h.height;e.width=Math.min(this.maxWidth,e.width+b+d)}this._calculatePadding(p,f,g,_)}}this._handleMargins(),l?(this.width=this._length=r.width-this._margins.left-this._margins.right,this.height=e.height):(this.width=e.width,this.height=this._length=r.height-this._margins.top-this._margins.bottom)}_calculatePadding(e,r,i,n){const{ticks:{align:s,padding:a},position:l}=this.options,u=this.labelRotation!==0,p=l!=="top"&&this.axis==="x";if(this.isHorizontal()){const f=this.getPixelForTick(0)-this.left,c=this.right-this.getPixelForTick(this.ticks.length-1);let h=0,d=0;u?p?(h=n*e.width,d=i*r.height):(h=i*e.height,d=n*r.width):s==="start"?d=r.width:s==="end"?h=e.width:s!=="inner"&&(h=e.width/2,d=r.width/2),this.paddingLeft=Math.max((h-f+a)*this.width/(this.width-f),0),this.paddingRight=Math.max((d-c+a)*this.width/(this.width-c),0)}else{let f=r.height/2,c=e.height/2;s==="start"?(f=0,c=e.height):s==="end"&&(f=r.height,c=0),this.paddingTop=f+a,this.paddingBottom=c+a}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){callback(this.options.afterFit,[this])}isHorizontal(){const{axis:e,position:r}=this.options;return r==="top"||r==="bottom"||e==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(e){this.beforeTickToLabelConversion(),this.generateTickLabels(e);let r,i;for(r=0,i=e.length;r<i;r++)isNullOrUndef(e[r].label)&&(e.splice(r,1),i--,r--);this.afterTickToLabelConversion()}_getLabelSizes(){let e=this._labelSizes;if(!e){const r=this.options.ticks.sampleSize;let i=this.ticks;r<i.length&&(i=sample(i,r)),this._labelSizes=e=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return e}_computeLabelSizes(e,r,i){const{ctx:n,_longestTextCache:s}=this,a=[],l=[],u=Math.floor(r/getTicksLimit(r,i));let p=0,f=0,c,h,d,m,_,g,b,x,S,T,I;for(c=0;c<r;c+=u){if(m=e[c].label,_=this._resolveTickFontOptions(c),n.font=g=_.string,b=s[g]=s[g]||{data:{},gc:[]},x=_.lineHeight,S=T=0,!isNullOrUndef(m)&&!isArray(m))S=_measureText(n,b.data,b.gc,S,m),T=x;else if(isArray(m))for(h=0,d=m.length;h<d;++h)I=m[h],!isNullOrUndef(I)&&!isArray(I)&&(S=_measureText(n,b.data,b.gc,S,I),T+=x);a.push(S),l.push(T),p=Math.max(S,p),f=Math.max(T,f)}garbageCollect(s,r);const O=a.indexOf(p),L=l.indexOf(f),P=C=>({width:a[C]||0,height:l[C]||0});return{first:P(0),last:P(r-1),widest:P(O),highest:P(L),widths:a,heights:l}}getLabelForValue(e){return e}getPixelForValue(e,r){return NaN}getValueForPixel(e){}getPixelForTick(e){const r=this.ticks;return e<0||e>r.length-1?null:this.getPixelForValue(r[e].value)}getPixelForDecimal(e){this._reversePixels&&(e=1-e);const r=this._startPixel+e*this._length;return _int16Range(this._alignToPixels?_alignPixel(this.chart,r,0):r)}getDecimalForPixel(e){const r=(e-this._startPixel)/this._length;return this._reversePixels?1-r:r}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:e,max:r}=this;return e<0&&r<0?r:e>0&&r>0?e:0}getContext(e){const r=this.ticks||[];if(e>=0&&e<r.length){const i=r[e];return i.$context||(i.$context=createTickContext(this.getContext(),e,i))}return this.$context||(this.$context=createScaleContext(this.chart.getContext(),this))}_tickSize(){const e=this.options.ticks,r=toRadians(this.labelRotation),i=Math.abs(Math.cos(r)),n=Math.abs(Math.sin(r)),s=this._getLabelSizes(),a=e.autoSkipPadding||0,l=s?s.widest.width+a:0,u=s?s.highest.height+a:0;return this.isHorizontal()?u*i>l*n?l/i:u/n:u*n<l*i?u/i:l/n}_isVisible(){const e=this.options.display;return e!=="auto"?!!e:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(e){const r=this.axis,i=this.chart,n=this.options,{grid:s,position:a,border:l}=n,u=s.offset,p=this.isHorizontal(),c=this.ticks.length+(u?1:0),h=getTickMarkLength(s),d=[],m=l.setContext(this.getContext()),_=m.display?m.width:0,g=_/2,b=function(J){return _alignPixel(i,J,_)};let x,S,T,I,O,L,P,C,G,B,H,ee;if(a==="top")x=b(this.bottom),L=this.bottom-h,C=x-g,B=b(e.top)+g,ee=e.bottom;else if(a==="bottom")x=b(this.top),B=e.top,ee=b(e.bottom)-g,L=x+g,C=this.top+h;else if(a==="left")x=b(this.right),O=this.right-h,P=x-g,G=b(e.left)+g,H=e.right;else if(a==="right")x=b(this.left),G=e.left,H=b(e.right)-g,O=x+g,P=this.left+h;else if(r==="x"){if(a==="center")x=b((e.top+e.bottom)/2+.5);else if(isObject(a)){const J=Object.keys(a)[0],Z=a[J];x=b(this.chart.scales[J].getPixelForValue(Z))}B=e.top,ee=e.bottom,L=x+g,C=L+h}else if(r==="y"){if(a==="center")x=b((e.left+e.right)/2);else if(isObject(a)){const J=Object.keys(a)[0],Z=a[J];x=b(this.chart.scales[J].getPixelForValue(Z))}O=x-g,P=O-h,G=e.left,H=e.right}const j=valueOrDefault(n.ticks.maxTicksLimit,c),te=Math.max(1,Math.ceil(c/j));for(S=0;S<c;S+=te){const J=this.getContext(S),Z=s.setContext(J),pe=l.setContext(J),ae=Z.lineWidth,oe=Z.color,me=pe.dash||[],le=pe.dashOffset,ce=Z.tickWidth,se=Z.tickColor,de=Z.tickBorderDash||[],fe=Z.tickBorderDashOffset;T=getPixelForGridLine(this,S,u),T!==void 0&&(I=_alignPixel(i,T,ae),p?O=P=G=H=I:L=C=B=ee=I,d.push({tx1:O,ty1:L,tx2:P,ty2:C,x1:G,y1:B,x2:H,y2:ee,width:ae,color:oe,borderDash:me,borderDashOffset:le,tickWidth:ce,tickColor:se,tickBorderDash:de,tickBorderDashOffset:fe}))}return this._ticksLength=c,this._borderValue=x,d}_computeLabelItems(e){const r=this.axis,i=this.options,{position:n,ticks:s}=i,a=this.isHorizontal(),l=this.ticks,{align:u,crossAlign:p,padding:f,mirror:c}=s,h=getTickMarkLength(i.grid),d=h+f,m=c?-f:d,_=-toRadians(this.labelRotation),g=[];let b,x,S,T,I,O,L,P,C,G,B,H,ee="middle";if(n==="top")O=this.bottom-m,L=this._getXAxisLabelAlignment();else if(n==="bottom")O=this.top+m,L=this._getXAxisLabelAlignment();else if(n==="left"){const te=this._getYAxisLabelAlignment(h);L=te.textAlign,I=te.x}else if(n==="right"){const te=this._getYAxisLabelAlignment(h);L=te.textAlign,I=te.x}else if(r==="x"){if(n==="center")O=(e.top+e.bottom)/2+d;else if(isObject(n)){const te=Object.keys(n)[0],J=n[te];O=this.chart.scales[te].getPixelForValue(J)+d}L=this._getXAxisLabelAlignment()}else if(r==="y"){if(n==="center")I=(e.left+e.right)/2-d;else if(isObject(n)){const te=Object.keys(n)[0],J=n[te];I=this.chart.scales[te].getPixelForValue(J)}L=this._getYAxisLabelAlignment(h).textAlign}r==="y"&&(u==="start"?ee="top":u==="end"&&(ee="bottom"));const j=this._getLabelSizes();for(b=0,x=l.length;b<x;++b){S=l[b],T=S.label;const te=s.setContext(this.getContext(b));P=this.getPixelForTick(b)+s.labelOffset,C=this._resolveTickFontOptions(b),G=C.lineHeight,B=isArray(T)?T.length:1;const J=B/2,Z=te.color,pe=te.textStrokeColor,ae=te.textStrokeWidth;let oe=L;a?(I=P,L==="inner"&&(b===x-1?oe=this.options.reverse?"left":"right":b===0?oe=this.options.reverse?"right":"left":oe="center"),n==="top"?p==="near"||_!==0?H=-B*G+G/2:p==="center"?H=-j.highest.height/2-J*G+G:H=-j.highest.height+G/2:p==="near"||_!==0?H=G/2:p==="center"?H=j.highest.height/2-J*G:H=j.highest.height-B*G,c&&(H*=-1),_!==0&&!te.showLabelBackdrop&&(I+=G/2*Math.sin(_))):(O=P,H=(1-B)*G/2);let me;if(te.showLabelBackdrop){const le=toPadding(te.backdropPadding),ce=j.heights[b],se=j.widths[b];let de=H-le.top,fe=0-le.left;switch(ee){case"middle":de-=ce/2;break;case"bottom":de-=ce;break}switch(L){case"center":fe-=se/2;break;case"right":fe-=se;break;case"inner":b===x-1?fe-=se:b>0&&(fe-=se/2);break}me={left:fe,top:de,width:se+le.width,height:ce+le.height,color:te.backdropColor}}g.push({label:T,font:C,textOffset:H,options:{rotation:_,color:Z,strokeColor:pe,strokeWidth:ae,textAlign:oe,textBaseline:ee,translation:[I,O],backdrop:me}})}return g}_getXAxisLabelAlignment(){const{position:e,ticks:r}=this.options;if(-toRadians(this.labelRotation))return e==="top"?"left":"right";let n="center";return r.align==="start"?n="left":r.align==="end"?n="right":r.align==="inner"&&(n="inner"),n}_getYAxisLabelAlignment(e){const{position:r,ticks:{crossAlign:i,mirror:n,padding:s}}=this.options,a=this._getLabelSizes(),l=e+s,u=a.widest.width;let p,f;return r==="left"?n?(f=this.right+s,i==="near"?p="left":i==="center"?(p="center",f+=u/2):(p="right",f+=u)):(f=this.right-l,i==="near"?p="right":i==="center"?(p="center",f-=u/2):(p="left",f=this.left)):r==="right"?n?(f=this.left+s,i==="near"?p="right":i==="center"?(p="center",f-=u/2):(p="left",f-=u)):(f=this.left+l,i==="near"?p="left":i==="center"?(p="center",f+=u/2):(p="right",f=this.right)):p="right",{textAlign:p,x:f}}_computeLabelArea(){if(this.options.ticks.mirror)return;const e=this.chart,r=this.options.position;if(r==="left"||r==="right")return{top:0,left:this.left,bottom:e.height,right:this.right};if(r==="top"||r==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:e.width}}drawBackground(){const{ctx:e,options:{backgroundColor:r},left:i,top:n,width:s,height:a}=this;r&&(e.save(),e.fillStyle=r,e.fillRect(i,n,s,a),e.restore())}getLineWidthForValue(e){const r=this.options.grid;if(!this._isVisible()||!r.display)return 0;const n=this.ticks.findIndex(s=>s.value===e);return n>=0?r.setContext(this.getContext(n)).lineWidth:0}drawGrid(e){const r=this.options.grid,i=this.ctx,n=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(e));let s,a;const l=(u,p,f)=>{!f.width||!f.color||(i.save(),i.lineWidth=f.width,i.strokeStyle=f.color,i.setLineDash(f.borderDash||[]),i.lineDashOffset=f.borderDashOffset,i.beginPath(),i.moveTo(u.x,u.y),i.lineTo(p.x,p.y),i.stroke(),i.restore())};if(r.display)for(s=0,a=n.length;s<a;++s){const u=n[s];r.drawOnChartArea&&l({x:u.x1,y:u.y1},{x:u.x2,y:u.y2},u),r.drawTicks&&l({x:u.tx1,y:u.ty1},{x:u.tx2,y:u.ty2},{color:u.tickColor,width:u.tickWidth,borderDash:u.tickBorderDash,borderDashOffset:u.tickBorderDashOffset})}}drawBorder(){const{chart:e,ctx:r,options:{border:i,grid:n}}=this,s=i.setContext(this.getContext()),a=i.display?s.width:0;if(!a)return;const l=n.setContext(this.getContext(0)).lineWidth,u=this._borderValue;let p,f,c,h;this.isHorizontal()?(p=_alignPixel(e,this.left,a)-a/2,f=_alignPixel(e,this.right,l)+l/2,c=h=u):(c=_alignPixel(e,this.top,a)-a/2,h=_alignPixel(e,this.bottom,l)+l/2,p=f=u),r.save(),r.lineWidth=s.width,r.strokeStyle=s.color,r.beginPath(),r.moveTo(p,c),r.lineTo(f,h),r.stroke(),r.restore()}drawLabels(e){if(!this.options.ticks.display)return;const i=this.ctx,n=this._computeLabelArea();n&&clipArea(i,n);const s=this.getLabelItems(e);for(const a of s){const l=a.options,u=a.font,p=a.label,f=a.textOffset;renderText(i,p,0,f,u,l)}n&&unclipArea(i)}drawTitle(){const{ctx:e,options:{position:r,title:i,reverse:n}}=this;if(!i.display)return;const s=toFont(i.font),a=toPadding(i.padding),l=i.align;let u=s.lineHeight/2;r==="bottom"||r==="center"||isObject(r)?(u+=a.bottom,isArray(i.text)&&(u+=s.lineHeight*(i.text.length-1))):u+=a.top;const{titleX:p,titleY:f,maxWidth:c,rotation:h}=titleArgs(this,u,r,l);renderText(e,i.text,0,0,s,{color:i.color,maxWidth:c,rotation:h,textAlign:titleAlign(l,r,n),textBaseline:"middle",translation:[p,f]})}draw(e){this._isVisible()&&(this.drawBackground(),this.drawGrid(e),this.drawBorder(),this.drawTitle(),this.drawLabels(e))}_layers(){const e=this.options,r=e.ticks&&e.ticks.z||0,i=valueOrDefault(e.grid&&e.grid.z,-1),n=valueOrDefault(e.border&&e.border.z,0);return!this._isVisible()||this.draw!==Scale.prototype.draw?[{z:r,draw:s=>{this.draw(s)}}]:[{z:i,draw:s=>{this.drawBackground(),this.drawGrid(s),this.drawTitle()}},{z:n,draw:()=>{this.drawBorder()}},{z:r,draw:s=>{this.drawLabels(s)}}]}getMatchingVisibleMetas(e){const r=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",n=[];let s,a;for(s=0,a=r.length;s<a;++s){const l=r[s];l[i]===this.id&&(!e||l.type===e)&&n.push(l)}return n}_resolveTickFontOptions(e){const r=this.options.ticks.setContext(this.getContext(e));return toFont(r.font)}_maxDigits(){const e=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/e}}class TypedRegistry{constructor(e,r,i){this.type=e,this.scope=r,this.override=i,this.items=Object.create(null)}isForType(e){return Object.prototype.isPrototypeOf.call(this.type.prototype,e.prototype)}register(e){const r=Object.getPrototypeOf(e);let i;isIChartComponent(r)&&(i=this.register(r));const n=this.items,s=e.id,a=this.scope+"."+s;if(!s)throw new Error("class does not have id: "+e);return s in n||(n[s]=e,registerDefaults(e,a,i),this.override&&defaults.override(e.id,e.overrides)),a}get(e){return this.items[e]}unregister(e){const r=this.items,i=e.id,n=this.scope;i in r&&delete r[i],n&&i in defaults[n]&&(delete defaults[n][i],this.override&&delete overrides[i])}}function registerDefaults(t,e,r){const i=merge(Object.create(null),[r?defaults.get(r):{},defaults.get(e),t.defaults]);defaults.set(e,i),t.defaultRoutes&&routeDefaults(e,t.defaultRoutes),t.descriptors&&defaults.describe(e,t.descriptors)}function routeDefaults(t,e){Object.keys(e).forEach(r=>{const i=r.split("."),n=i.pop(),s=[t].concat(i).join("."),a=e[r].split("."),l=a.pop(),u=a.join(".");defaults.route(s,n,u,l)})}function isIChartComponent(t){return"id"in t&&"defaults"in t}class Registry{constructor(){this.controllers=new TypedRegistry(DatasetController,"datasets",!0),this.elements=new TypedRegistry(Element$1,"elements"),this.plugins=new TypedRegistry(Object,"plugins"),this.scales=new TypedRegistry(Scale,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...e){this._each("register",e)}remove(...e){this._each("unregister",e)}addControllers(...e){this._each("register",e,this.controllers)}addElements(...e){this._each("register",e,this.elements)}addPlugins(...e){this._each("register",e,this.plugins)}addScales(...e){this._each("register",e,this.scales)}getController(e){return this._get(e,this.controllers,"controller")}getElement(e){return this._get(e,this.elements,"element")}getPlugin(e){return this._get(e,this.plugins,"plugin")}getScale(e){return this._get(e,this.scales,"scale")}removeControllers(...e){this._each("unregister",e,this.controllers)}removeElements(...e){this._each("unregister",e,this.elements)}removePlugins(...e){this._each("unregister",e,this.plugins)}removeScales(...e){this._each("unregister",e,this.scales)}_each(e,r,i){[...r].forEach(n=>{const s=i||this._getRegistryForType(n);i||s.isForType(n)||s===this.plugins&&n.id?this._exec(e,s,n):each(n,a=>{const l=i||this._getRegistryForType(a);this._exec(e,l,a)})})}_exec(e,r,i){const n=_capitalize(e);callback(i["before"+n],[],i),r[e](i),callback(i["after"+n],[],i)}_getRegistryForType(e){for(let r=0;r<this._typedRegistries.length;r++){const i=this._typedRegistries[r];if(i.isForType(e))return i}return this.plugins}_get(e,r,i){const n=r.get(e);if(n===void 0)throw new Error('"'+e+'" is not a registered '+i+".");return n}}var registry=new Registry;class PluginService{constructor(){this._init=[]}notify(e,r,i,n){r==="beforeInit"&&(this._init=this._createDescriptors(e,!0),this._notify(this._init,e,"install"));const s=n?this._descriptors(e).filter(n):this._descriptors(e),a=this._notify(s,e,r,i);return r==="afterDestroy"&&(this._notify(s,e,"stop"),this._notify(this._init,e,"uninstall")),a}_notify(e,r,i,n){n=n||{};for(const s of e){const a=s.plugin,l=a[i],u=[r,n,s.options];if(callback(l,u,a)===!1&&n.cancelable)return!1}return!0}invalidate(){isNullOrUndef(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(e){if(this._cache)return this._cache;const r=this._cache=this._createDescriptors(e);return this._notifyStateChanges(e),r}_createDescriptors(e,r){const i=e&&e.config,n=valueOrDefault(i.options&&i.options.plugins,{}),s=allPlugins(i);return n===!1&&!r?[]:createDescriptors(e,s,n,r)}_notifyStateChanges(e){const r=this._oldCache||[],i=this._cache,n=(s,a)=>s.filter(l=>!a.some(u=>l.plugin.id===u.plugin.id));this._notify(n(r,i),e,"stop"),this._notify(n(i,r),e,"start")}}function allPlugins(t){const e={},r=[],i=Object.keys(registry.plugins.items);for(let s=0;s<i.length;s++)r.push(registry.getPlugin(i[s]));const n=t.plugins||[];for(let s=0;s<n.length;s++){const a=n[s];r.indexOf(a)===-1&&(r.push(a),e[a.id]=!0)}return{plugins:r,localIds:e}}function getOpts(t,e){return!e&&t===!1?null:t===!0?{}:t}function createDescriptors(t,{plugins:e,localIds:r},i,n){const s=[],a=t.getContext();for(const l of e){const u=l.id,p=getOpts(i[u],n);p!==null&&s.push({plugin:l,options:pluginOpts(t.config,{plugin:l,local:r[u]},p,a)})}return s}function pluginOpts(t,{plugin:e,local:r},i,n){const s=t.pluginScopeKeys(e),a=t.getOptionScopes(i,s);return r&&e.defaults&&a.push(e.defaults),t.createResolver(a,n,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function getIndexAxis(t,e){const r=defaults.datasets[t]||{};return((e.datasets||{})[t]||{}).indexAxis||e.indexAxis||r.indexAxis||"x"}function getAxisFromDefaultScaleID(t,e){let r=t;return t==="_index_"?r=e:t==="_value_"&&(r=e==="x"?"y":"x"),r}function getDefaultScaleIDFromAxis(t,e){return t===e?"_index_":"_value_"}function idMatchesAxis(t){if(t==="x"||t==="y"||t==="r")return t}function axisFromPosition(t){if(t==="top"||t==="bottom")return"x";if(t==="left"||t==="right")return"y"}function determineAxis(t,...e){if(idMatchesAxis(t))return t;for(const r of e){const i=r.axis||axisFromPosition(r.position)||t.length>1&&idMatchesAxis(t[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${t}' axis. Please provide 'axis' or 'position' option.`)}function getAxisFromDataset(t,e,r){if(r[e+"AxisID"]===t)return{axis:e}}function retrieveAxisFromDatasets(t,e){if(e.data&&e.data.datasets){const r=e.data.datasets.filter(i=>i.xAxisID===t||i.yAxisID===t);if(r.length)return getAxisFromDataset(t,"x",r[0])||getAxisFromDataset(t,"y",r[0])}return{}}function mergeScaleConfig(t,e){const r=overrides[t.type]||{scales:{}},i=e.scales||{},n=getIndexAxis(t.type,e),s=Object.create(null);return Object.keys(i).forEach(a=>{const l=i[a];if(!isObject(l))return console.error(`Invalid scale configuration for scale: ${a}`);if(l._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${a}`);const u=determineAxis(a,l,retrieveAxisFromDatasets(a,t),defaults.scales[l.type]),p=getDefaultScaleIDFromAxis(u,n),f=r.scales||{};s[a]=mergeIf(Object.create(null),[{axis:u},l,f[u],f[p]])}),t.data.datasets.forEach(a=>{const l=a.type||t.type,u=a.indexAxis||getIndexAxis(l,e),f=(overrides[l]||{}).scales||{};Object.keys(f).forEach(c=>{const h=getAxisFromDefaultScaleID(c,u),d=a[h+"AxisID"]||h;s[d]=s[d]||Object.create(null),mergeIf(s[d],[{axis:h},i[d],f[c]])})}),Object.keys(s).forEach(a=>{const l=s[a];mergeIf(l,[defaults.scales[l.type],defaults.scale])}),s}function initOptions(t){const e=t.options||(t.options={});e.plugins=valueOrDefault(e.plugins,{}),e.scales=mergeScaleConfig(t,e)}function initData(t){return t=t||{},t.datasets=t.datasets||[],t.labels=t.labels||[],t}function initConfig(t){return t=t||{},t.data=initData(t.data),initOptions(t),t}const keyCache=new Map,keysCached=new Set;function cachedKeys(t,e){let r=keyCache.get(t);return r||(r=e(),keyCache.set(t,r),keysCached.add(r)),r}const addIfFound=(t,e,r)=>{const i=resolveObjectKey(e,r);i!==void 0&&t.add(i)};class Config{constructor(e){this._config=initConfig(e),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(e){this._config.type=e}get data(){return this._config.data}set data(e){this._config.data=initData(e)}get options(){return this._config.options}set options(e){this._config.options=e}get plugins(){return this._config.plugins}update(){const e=this._config;this.clearCache(),initOptions(e)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(e){return cachedKeys(e,()=>[[`datasets.${e}`,""]])}datasetAnimationScopeKeys(e,r){return cachedKeys(`${e}.transition.${r}`,()=>[[`datasets.${e}.transitions.${r}`,`transitions.${r}`],[`datasets.${e}`,""]])}datasetElementScopeKeys(e,r){return cachedKeys(`${e}-${r}`,()=>[[`datasets.${e}.elements.${r}`,`datasets.${e}`,`elements.${r}`,""]])}pluginScopeKeys(e){const r=e.id,i=this.type;return cachedKeys(`${i}-plugin-${r}`,()=>[[`plugins.${r}`,...e.additionalOptionScopes||[]]])}_cachedScopes(e,r){const i=this._scopeCache;let n=i.get(e);return(!n||r)&&(n=new Map,i.set(e,n)),n}getOptionScopes(e,r,i){const{options:n,type:s}=this,a=this._cachedScopes(e,i),l=a.get(r);if(l)return l;const u=new Set;r.forEach(f=>{e&&(u.add(e),f.forEach(c=>addIfFound(u,e,c))),f.forEach(c=>addIfFound(u,n,c)),f.forEach(c=>addIfFound(u,overrides[s]||{},c)),f.forEach(c=>addIfFound(u,defaults,c)),f.forEach(c=>addIfFound(u,descriptors,c))});const p=Array.from(u);return p.length===0&&p.push(Object.create(null)),keysCached.has(r)&&a.set(r,p),p}chartOptionScopes(){const{options:e,type:r}=this;return[e,overrides[r]||{},defaults.datasets[r]||{},{type:r},defaults,descriptors]}resolveNamedOptions(e,r,i,n=[""]){const s={$shared:!0},{resolver:a,subPrefixes:l}=getResolver(this._resolverCache,e,n);let u=a;if(needContext(a,r)){s.$shared=!1,i=isFunction(i)?i():i;const p=this.createResolver(e,i,l);u=_attachContext(a,i,p)}for(const p of r)s[p]=u[p];return s}createResolver(e,r,i=[""],n){const{resolver:s}=getResolver(this._resolverCache,e,i);return isObject(r)?_attachContext(s,r,void 0,n):s}}function getResolver(t,e,r){let i=t.get(e);i||(i=new Map,t.set(e,i));const n=r.join();let s=i.get(n);return s||(s={resolver:_createResolver(e,r),subPrefixes:r.filter(l=>!l.toLowerCase().includes("hover"))},i.set(n,s)),s}const hasFunction=t=>isObject(t)&&Object.getOwnPropertyNames(t).some(e=>isFunction(t[e]));function needContext(t,e){const{isScriptable:r,isIndexable:i}=_descriptors(t);for(const n of e){const s=r(n),a=i(n),l=(a||s)&&t[n];if(s&&(isFunction(l)||hasFunction(l))||a&&isArray(l))return!0}return!1}var version="4.4.9";const KNOWN_POSITIONS=["top","bottom","left","right","chartArea"];function positionIsHorizontal(t,e){return t==="top"||t==="bottom"||KNOWN_POSITIONS.indexOf(t)===-1&&e==="x"}function compare2Level(t,e){return function(r,i){return r[t]===i[t]?r[e]-i[e]:r[t]-i[t]}}function onAnimationsComplete(t){const e=t.chart,r=e.options.animation;e.notifyPlugins("afterRender"),callback(r&&r.onComplete,[t],e)}function onAnimationProgress(t){const e=t.chart,r=e.options.animation;callback(r&&r.onProgress,[t],e)}function getCanvas(t){return _isDomSupported()&&typeof t=="string"?t=document.getElementById(t):t&&t.length&&(t=t[0]),t&&t.canvas&&(t=t.canvas),t}const instances={},getChart=t=>{const e=getCanvas(t);return Object.values(instances).filter(r=>r.canvas===e).pop()};function moveNumericKeys(t,e,r){const i=Object.keys(t);for(const n of i){const s=+n;if(s>=e){const a=t[n];delete t[n],(r>0||s>e)&&(t[s+r]=a)}}}function determineLastEvent(t,e,r,i){return!r||t.type==="mouseout"?null:i?e:t}class Chart{static defaults=defaults;static instances=instances;static overrides=overrides;static registry=registry;static version=version;static getChart=getChart;static register(...e){registry.add(...e),invalidatePlugins()}static unregister(...e){registry.remove(...e),invalidatePlugins()}constructor(e,r){const i=this.config=new Config(r),n=getCanvas(e),s=getChart(n);if(s)throw new Error("Canvas is already in use. Chart with ID '"+s.id+"' must be destroyed before the canvas with ID '"+s.canvas.id+"' can be reused.");const a=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||_detectPlatform(n)),this.platform.updateConfig(i);const l=this.platform.acquireContext(n,a.aspectRatio),u=l&&l.canvas,p=u&&u.height,f=u&&u.width;if(this.id=uid(),this.ctx=l,this.canvas=u,this.width=f,this.height=p,this._options=a,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new PluginService,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=debounce(c=>this.update(c),a.resizeDelay||0),this._dataChanges=[],instances[this.id]=this,!l||!u){console.error("Failed to create chart: can't acquire context from the given item");return}animator.listen(this,"complete",onAnimationsComplete),animator.listen(this,"progress",onAnimationProgress),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:e,maintainAspectRatio:r},width:i,height:n,_aspectRatio:s}=this;return isNullOrUndef(e)?r&&s?s:n?i/n:null:e}get data(){return this.config.data}set data(e){this.config.data=e}get options(){return this._options}set options(e){this.config.options=e}get registry(){return registry}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():retinaScale(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return clearCanvas(this.canvas,this.ctx),this}stop(){return animator.stop(this),this}resize(e,r){animator.running(this)?this._resizeBeforeDraw={width:e,height:r}:this._resize(e,r)}_resize(e,r){const i=this.options,n=this.canvas,s=i.maintainAspectRatio&&this.aspectRatio,a=this.platform.getMaximumSize(n,e,r,s),l=i.devicePixelRatio||this.platform.getDevicePixelRatio(),u=this.width?"resize":"attach";this.width=a.width,this.height=a.height,this._aspectRatio=this.aspectRatio,retinaScale(this,l,!0)&&(this.notifyPlugins("resize",{size:a}),callback(i.onResize,[this,a],this),this.attached&&this._doResize(u)&&this.render())}ensureScalesHaveIDs(){const r=this.options.scales||{};each(r,(i,n)=>{i.id=n})}buildOrUpdateScales(){const e=this.options,r=e.scales,i=this.scales,n=Object.keys(i).reduce((a,l)=>(a[l]=!1,a),{});let s=[];r&&(s=s.concat(Object.keys(r).map(a=>{const l=r[a],u=determineAxis(a,l),p=u==="r",f=u==="x";return{options:l,dposition:p?"chartArea":f?"bottom":"left",dtype:p?"radialLinear":f?"category":"linear"}}))),each(s,a=>{const l=a.options,u=l.id,p=determineAxis(u,l),f=valueOrDefault(l.type,a.dtype);(l.position===void 0||positionIsHorizontal(l.position,p)!==positionIsHorizontal(a.dposition))&&(l.position=a.dposition),n[u]=!0;let c=null;if(u in i&&i[u].type===f)c=i[u];else{const h=registry.getScale(f);c=new h({id:u,type:f,ctx:this.ctx,chart:this}),i[c.id]=c}c.init(l,e)}),each(n,(a,l)=>{a||delete i[l]}),each(i,a=>{layouts.configure(this,a,a.options),layouts.addBox(this,a)})}_updateMetasets(){const e=this._metasets,r=this.data.datasets.length,i=e.length;if(e.sort((n,s)=>n.index-s.index),i>r){for(let n=r;n<i;++n)this._destroyDatasetMeta(n);e.splice(r,i-r)}this._sortedMetasets=e.slice(0).sort(compare2Level("order","index"))}_removeUnreferencedMetasets(){const{_metasets:e,data:{datasets:r}}=this;e.length>r.length&&delete this._stacks,e.forEach((i,n)=>{r.filter(s=>s===i._dataset).length===0&&this._destroyDatasetMeta(n)})}buildOrUpdateControllers(){const e=[],r=this.data.datasets;let i,n;for(this._removeUnreferencedMetasets(),i=0,n=r.length;i<n;i++){const s=r[i];let a=this.getDatasetMeta(i);const l=s.type||this.config.type;if(a.type&&a.type!==l&&(this._destroyDatasetMeta(i),a=this.getDatasetMeta(i)),a.type=l,a.indexAxis=s.indexAxis||getIndexAxis(l,this.options),a.order=s.order||0,a.index=i,a.label=""+s.label,a.visible=this.isDatasetVisible(i),a.controller)a.controller.updateIndex(i),a.controller.linkScales();else{const u=registry.getController(l),{datasetElementType:p,dataElementType:f}=defaults.datasets[l];Object.assign(u,{dataElementType:registry.getElement(f),datasetElementType:p&&registry.getElement(p)}),a.controller=new u(this,i),e.push(a.controller)}}return this._updateMetasets(),e}_resetElements(){each(this.data.datasets,(e,r)=>{this.getDatasetMeta(r).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(e){const r=this.config;r.update();const i=this._options=r.createResolver(r.chartOptionScopes(),this.getContext()),n=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:e,cancelable:!0})===!1)return;const s=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let a=0;for(let p=0,f=this.data.datasets.length;p<f;p++){const{controller:c}=this.getDatasetMeta(p),h=!n&&s.indexOf(c)===-1;c.buildOrUpdateElements(h),a=Math.max(+c.getMaxOverflow(),a)}a=this._minPadding=i.layout.autoPadding?a:0,this._updateLayout(a),n||each(s,p=>{p.reset()}),this._updateDatasets(e),this.notifyPlugins("afterUpdate",{mode:e}),this._layers.sort(compare2Level("z","_idx"));const{_active:l,_lastEvent:u}=this;u?this._eventHandler(u,!0):l.length&&this._updateHoverStyles(l,l,!0),this.render()}_updateScales(){each(this.scales,e=>{layouts.removeBox(this,e)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const e=this.options,r=new Set(Object.keys(this._listeners)),i=new Set(e.events);(!setsEqual(r,i)||!!this._responsiveListeners!==e.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:e}=this,r=this._getUniformDataChanges()||[];for(const{method:i,start:n,count:s}of r){const a=i==="_removeElements"?-s:s;moveNumericKeys(e,n,a)}}_getUniformDataChanges(){const e=this._dataChanges;if(!e||!e.length)return;this._dataChanges=[];const r=this.data.datasets.length,i=s=>new Set(e.filter(a=>a[0]===s).map((a,l)=>l+","+a.splice(1).join(","))),n=i(0);for(let s=1;s<r;s++)if(!setsEqual(n,i(s)))return;return Array.from(n).map(s=>s.split(",")).map(s=>({method:s[1],start:+s[2],count:+s[3]}))}_updateLayout(e){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;layouts.update(this,this.width,this.height,e);const r=this.chartArea,i=r.width<=0||r.height<=0;this._layers=[],each(this.boxes,n=>{i&&n.position==="chartArea"||(n.configure&&n.configure(),this._layers.push(...n._layers()))},this),this._layers.forEach((n,s)=>{n._idx=s}),this.notifyPlugins("afterLayout")}_updateDatasets(e){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:e,cancelable:!0})!==!1){for(let r=0,i=this.data.datasets.length;r<i;++r)this.getDatasetMeta(r).controller.configure();for(let r=0,i=this.data.datasets.length;r<i;++r)this._updateDataset(r,isFunction(e)?e({datasetIndex:r}):e);this.notifyPlugins("afterDatasetsUpdate",{mode:e})}}_updateDataset(e,r){const i=this.getDatasetMeta(e),n={meta:i,index:e,mode:r,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",n)!==!1&&(i.controller._update(r),n.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",n))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(animator.has(this)?this.attached&&!animator.running(this)&&animator.start(this):(this.draw(),onAnimationsComplete({chart:this})))}draw(){let e;if(this._resizeBeforeDraw){const{width:i,height:n}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,n)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const r=this._layers;for(e=0;e<r.length&&r[e].z<=0;++e)r[e].draw(this.chartArea);for(this._drawDatasets();e<r.length;++e)r[e].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(e){const r=this._sortedMetasets,i=[];let n,s;for(n=0,s=r.length;n<s;++n){const a=r[n];(!e||a.visible)&&i.push(a)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const e=this.getSortedVisibleDatasetMetas();for(let r=e.length-1;r>=0;--r)this._drawDataset(e[r]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(e){const r=this.ctx,i={meta:e,index:e.index,cancelable:!0},n=getDatasetClipArea(this,e);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(n&&clipArea(r,n),e.controller.draw(),n&&unclipArea(r),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(e){return _isPointInArea(e,this.chartArea,this._minPadding)}getElementsAtEventForMode(e,r,i,n){const s=Interaction.modes[r];return typeof s=="function"?s(this,e,i,n):[]}getDatasetMeta(e){const r=this.data.datasets[e],i=this._metasets;let n=i.filter(s=>s&&s._dataset===r).pop();return n||(n={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:r&&r.order||0,index:e,_dataset:r,_parsed:[],_sorted:!1},i.push(n)),n}getContext(){return this.$context||(this.$context=createContext(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(e){const r=this.data.datasets[e];if(!r)return!1;const i=this.getDatasetMeta(e);return typeof i.hidden=="boolean"?!i.hidden:!r.hidden}setDatasetVisibility(e,r){const i=this.getDatasetMeta(e);i.hidden=!r}toggleDataVisibility(e){this._hiddenIndices[e]=!this._hiddenIndices[e]}getDataVisibility(e){return!this._hiddenIndices[e]}_updateVisibility(e,r,i){const n=i?"show":"hide",s=this.getDatasetMeta(e),a=s.controller._resolveAnimations(void 0,n);defined(r)?(s.data[r].hidden=!i,this.update()):(this.setDatasetVisibility(e,i),a.update(s,{visible:i}),this.update(l=>l.datasetIndex===e?n:void 0))}hide(e,r){this._updateVisibility(e,r,!1)}show(e,r){this._updateVisibility(e,r,!0)}_destroyDatasetMeta(e){const r=this._metasets[e];r&&r.controller&&r.controller._destroy(),delete this._metasets[e]}_stop(){let e,r;for(this.stop(),animator.remove(this),e=0,r=this.data.datasets.length;e<r;++e)this._destroyDatasetMeta(e)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:e,ctx:r}=this;this._stop(),this.config.clearCache(),e&&(this.unbindEvents(),clearCanvas(e,r),this.platform.releaseContext(r),this.canvas=null,this.ctx=null),delete instances[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...e){return this.canvas.toDataURL(...e)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const e=this._listeners,r=this.platform,i=(s,a)=>{r.addEventListener(this,s,a),e[s]=a},n=(s,a,l)=>{s.offsetX=a,s.offsetY=l,this._eventHandler(s)};each(this.options.events,s=>i(s,n))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const e=this._responsiveListeners,r=this.platform,i=(u,p)=>{r.addEventListener(this,u,p),e[u]=p},n=(u,p)=>{e[u]&&(r.removeEventListener(this,u,p),delete e[u])},s=(u,p)=>{this.canvas&&this.resize(u,p)};let a;const l=()=>{n("attach",l),this.attached=!0,this.resize(),i("resize",s),i("detach",a)};a=()=>{this.attached=!1,n("resize",s),this._stop(),this._resize(0,0),i("attach",l)},r.isAttached(this.canvas)?l():a()}unbindEvents(){each(this._listeners,(e,r)=>{this.platform.removeEventListener(this,r,e)}),this._listeners={},each(this._responsiveListeners,(e,r)=>{this.platform.removeEventListener(this,r,e)}),this._responsiveListeners=void 0}updateHoverStyle(e,r,i){const n=i?"set":"remove";let s,a,l,u;for(r==="dataset"&&(s=this.getDatasetMeta(e[0].datasetIndex),s.controller["_"+n+"DatasetHoverStyle"]()),l=0,u=e.length;l<u;++l){a=e[l];const p=a&&this.getDatasetMeta(a.datasetIndex).controller;p&&p[n+"HoverStyle"](a.element,a.datasetIndex,a.index)}}getActiveElements(){return this._active||[]}setActiveElements(e){const r=this._active||[],i=e.map(({datasetIndex:s,index:a})=>{const l=this.getDatasetMeta(s);if(!l)throw new Error("No dataset found at index "+s);return{datasetIndex:s,element:l.data[a],index:a}});!_elementsEqual(i,r)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,r))}notifyPlugins(e,r,i){return this._plugins.notify(this,e,r,i)}isPluginEnabled(e){return this._plugins._cache.filter(r=>r.plugin.id===e).length===1}_updateHoverStyles(e,r,i){const n=this.options.hover,s=(u,p)=>u.filter(f=>!p.some(c=>f.datasetIndex===c.datasetIndex&&f.index===c.index)),a=s(r,e),l=i?e:s(e,r);a.length&&this.updateHoverStyle(a,n.mode,!1),l.length&&n.mode&&this.updateHoverStyle(l,n.mode,!0)}_eventHandler(e,r){const i={event:e,replay:r,cancelable:!0,inChartArea:this.isPointInArea(e)},n=a=>(a.options.events||this.options.events).includes(e.native.type);if(this.notifyPlugins("beforeEvent",i,n)===!1)return;const s=this._handleEvent(e,r,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,n),(s||i.changed)&&this.render(),this}_handleEvent(e,r,i){const{_active:n=[],options:s}=this,a=r,l=this._getActiveElements(e,n,i,a),u=_isClickEvent(e),p=determineLastEvent(e,this._lastEvent,i,u);i&&(this._lastEvent=null,callback(s.onHover,[e,l,this],this),u&&callback(s.onClick,[e,l,this],this));const f=!_elementsEqual(l,n);return(f||r)&&(this._active=l,this._updateHoverStyles(l,n,r)),this._lastEvent=p,f}_getActiveElements(e,r,i,n){if(e.type==="mouseout")return[];if(!i)return r;const s=this.options.hover;return this.getElementsAtEventForMode(e,s.mode,s,n)}}function invalidatePlugins(){return each(Chart.instances,t=>t._plugins.invalidate())}function setStyle(t,e,r=e){t.lineCap=valueOrDefault(r.borderCapStyle,e.borderCapStyle),t.setLineDash(valueOrDefault(r.borderDash,e.borderDash)),t.lineDashOffset=valueOrDefault(r.borderDashOffset,e.borderDashOffset),t.lineJoin=valueOrDefault(r.borderJoinStyle,e.borderJoinStyle),t.lineWidth=valueOrDefault(r.borderWidth,e.borderWidth),t.strokeStyle=valueOrDefault(r.borderColor,e.borderColor)}function lineTo(t,e,r){t.lineTo(r.x,r.y)}function getLineMethod(t){return t.stepped?_steppedLineTo:t.tension||t.cubicInterpolationMode==="monotone"?_bezierCurveTo:lineTo}function pathVars(t,e,r={}){const i=t.length,{start:n=0,end:s=i-1}=r,{start:a,end:l}=e,u=Math.max(n,a),p=Math.min(s,l),f=n<a&&s<a||n>l&&s>l;return{count:i,start:u,loop:e.loop,ilen:p<u&&!f?i+p-u:p-u}}function pathSegment(t,e,r,i){const{points:n,options:s}=e,{count:a,start:l,loop:u,ilen:p}=pathVars(n,r,i),f=getLineMethod(s);let{move:c=!0,reverse:h}=i||{},d,m,_;for(d=0;d<=p;++d)m=n[(l+(h?p-d:d))%a],!m.skip&&(c?(t.moveTo(m.x,m.y),c=!1):f(t,_,m,h,s.stepped),_=m);return u&&(m=n[(l+(h?p:0))%a],f(t,_,m,h,s.stepped)),!!u}function fastPathSegment(t,e,r,i){const n=e.points,{count:s,start:a,ilen:l}=pathVars(n,r,i),{move:u=!0,reverse:p}=i||{};let f=0,c=0,h,d,m,_,g,b;const x=T=>(a+(p?l-T:T))%s,S=()=>{_!==g&&(t.lineTo(f,g),t.lineTo(f,_),t.lineTo(f,b))};for(u&&(d=n[x(0)],t.moveTo(d.x,d.y)),h=0;h<=l;++h){if(d=n[x(h)],d.skip)continue;const T=d.x,I=d.y,O=T|0;O===m?(I<_?_=I:I>g&&(g=I),f=(c*f+T)/++c):(S(),t.lineTo(T,I),m=O,c=0,_=g=I),b=I}S()}function _getSegmentMethod(t){const e=t.options,r=e.borderDash&&e.borderDash.length;return!t._decimated&&!t._loop&&!e.tension&&e.cubicInterpolationMode!=="monotone"&&!e.stepped&&!r?fastPathSegment:pathSegment}function _getInterpolationMethod(t){return t.stepped?_steppedInterpolation:t.tension||t.cubicInterpolationMode==="monotone"?_bezierInterpolation:_pointInLine}function strokePathWithCache(t,e,r,i){let n=e._path;n||(n=e._path=new Path2D,e.path(n,r,i)&&n.closePath()),setStyle(t,e.options),t.stroke(n)}function strokePathDirect(t,e,r,i){const{segments:n,options:s}=e,a=_getSegmentMethod(e);for(const l of n)setStyle(t,s,l.style),t.beginPath(),a(t,e,l,{start:r,end:r+i-1})&&t.closePath(),t.stroke()}const usePath2D=typeof Path2D=="function";function draw(t,e,r,i){usePath2D&&!e.options.segment?strokePathWithCache(t,e,r,i):strokePathDirect(t,e,r,i)}class LineElement extends Element$1{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:e=>e!=="borderDash"&&e!=="fill"};constructor(e){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,e&&Object.assign(this,e)}updateControlPoints(e,r){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const n=i.spanGaps?this._loop:this._fullLoop;_updateBezierControlPoints(this._points,i,e,n,r),this._pointsUpdated=!0}}set points(e){this._points=e,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=_computeSegments(this,this.options.segment))}first(){const e=this.segments,r=this.points;return e.length&&r[e[0].start]}last(){const e=this.segments,r=this.points,i=e.length;return i&&r[e[i-1].end]}interpolate(e,r){const i=this.options,n=e[r],s=this.points,a=_boundSegments(this,{property:r,start:n,end:n});if(!a.length)return;const l=[],u=_getInterpolationMethod(i);let p,f;for(p=0,f=a.length;p<f;++p){const{start:c,end:h}=a[p],d=s[c],m=s[h];if(d===m){l.push(d);continue}const _=Math.abs((n-d[r])/(m[r]-d[r])),g=u(d,m,_,i.stepped);g[r]=e[r],l.push(g)}return l.length===1?l[0]:l}pathSegment(e,r,i){return _getSegmentMethod(this)(e,this,r,i)}path(e,r,i){const n=this.segments,s=_getSegmentMethod(this);let a=this._loop;r=r||0,i=i||this.points.length-r;for(const l of n)a&=s(e,this,l,{start:r,end:r+i-1});return!!a}draw(e,r,i,n){const s=this.options||{};(this.points||[]).length&&s.borderWidth&&(e.save(),draw(e,this,i,n),e.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function inRange$1(t,e,r,i){const n=t.options,{[r]:s}=t.getProps([r],i);return Math.abs(e-s)<n.radius+n.hitRadius}class PointElement extends Element$1{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(e){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,e&&Object.assign(this,e)}inRange(e,r,i){const n=this.options,{x:s,y:a}=this.getProps(["x","y"],i);return Math.pow(e-s,2)+Math.pow(r-a,2)<Math.pow(n.hitRadius+n.radius,2)}inXRange(e,r){return inRange$1(this,e,"x",r)}inYRange(e,r){return inRange$1(this,e,"y",r)}getCenterPoint(e){const{x:r,y:i}=this.getProps(["x","y"],e);return{x:r,y:i}}size(e){e=e||this.options||{};let r=e.radius||0;r=Math.max(r,r&&e.hoverRadius||0);const i=r&&e.borderWidth||0;return(r+i)*2}draw(e,r){const i=this.options;this.skip||i.radius<.1||!_isPointInArea(this,r,this.size(i)/2)||(e.strokeStyle=i.borderColor,e.lineWidth=i.borderWidth,e.fillStyle=i.backgroundColor,drawPoint(e,i,this.x,this.y))}getRange(){const e=this.options||{};return e.radius+e.hitRadius}}function _segments(t,e,r){const i=t.segments,n=t.points,s=e.points,a=[];for(const l of i){let{start:u,end:p}=l;p=_findSegmentEnd(u,p,n);const f=_getBounds(r,n[u],n[p],l.loop);if(!e.segments){a.push({source:l,target:f,start:n[u],end:n[p]});continue}const c=_boundSegments(e,f);for(const h of c){const d=_getBounds(r,s[h.start],s[h.end],h.loop),m=_boundSegment(l,n,d);for(const _ of m)a.push({source:_,target:h,start:{[r]:_getEdge(f,d,"start",Math.max)},end:{[r]:_getEdge(f,d,"end",Math.min)}})}}return a}function _getBounds(t,e,r,i){if(i)return;let n=e[t],s=r[t];return t==="angle"&&(n=_normalizeAngle(n),s=_normalizeAngle(s)),{property:t,start:n,end:s}}function _pointsFromSegments(t,e){const{x:r=null,y:i=null}=t||{},n=e.points,s=[];return e.segments.forEach(({start:a,end:l})=>{l=_findSegmentEnd(a,l,n);const u=n[a],p=n[l];i!==null?(s.push({x:u.x,y:i}),s.push({x:p.x,y:i})):r!==null&&(s.push({x:r,y:u.y}),s.push({x:r,y:p.y}))}),s}function _findSegmentEnd(t,e,r){for(;e>t;e--){const i=r[e];if(!isNaN(i.x)&&!isNaN(i.y))break}return e}function _getEdge(t,e,r,i){return t&&e?i(t[r],e[r]):t?t[r]:e?e[r]:0}function _createBoundaryLine(t,e){let r=[],i=!1;return isArray(t)?(i=!0,r=t):r=_pointsFromSegments(t,e),r.length?new LineElement({points:r,options:{tension:0},_loop:i,_fullLoop:i}):null}function _shouldApplyFill(t){return t&&t.fill!==!1}function _resolveTarget(t,e,r){let n=t[e].fill;const s=[e];let a;if(!r)return n;for(;n!==!1&&s.indexOf(n)===-1;){if(!isNumberFinite(n))return n;if(a=t[n],!a)return!1;if(a.visible)return n;s.push(n),n=a.fill}return!1}function _decodeFill(t,e,r){const i=parseFillOption(t);if(isObject(i))return isNaN(i.value)?!1:i;let n=parseFloat(i);return isNumberFinite(n)&&Math.floor(n)===n?decodeTargetIndex(i[0],e,n,r):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function decodeTargetIndex(t,e,r,i){return(t==="-"||t==="+")&&(r=e+r),r===e||r<0||r>=i?!1:r}function _getTargetPixel(t,e){let r=null;return t==="start"?r=e.bottom:t==="end"?r=e.top:isObject(t)?r=e.getPixelForValue(t.value):e.getBasePixel&&(r=e.getBasePixel()),r}function _getTargetValue(t,e,r){let i;return t==="start"?i=r:t==="end"?i=e.options.reverse?e.min:e.max:isObject(t)?i=t.value:i=e.getBaseValue(),i}function parseFillOption(t){const e=t.options,r=e.fill;let i=valueOrDefault(r&&r.target,r);return i===void 0&&(i=!!e.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function _buildStackLine(t){const{scale:e,index:r,line:i}=t,n=[],s=i.segments,a=i.points,l=getLinesBelow(e,r);l.push(_createBoundaryLine({x:null,y:e.bottom},i));for(let u=0;u<s.length;u++){const p=s[u];for(let f=p.start;f<=p.end;f++)addPointsBelow(n,a[f],l)}return new LineElement({points:n,options:{}})}function getLinesBelow(t,e){const r=[],i=t.getMatchingVisibleMetas("line");for(let n=0;n<i.length;n++){const s=i[n];if(s.index===e)break;s.hidden||r.unshift(s.dataset)}return r}function addPointsBelow(t,e,r){const i=[];for(let n=0;n<r.length;n++){const s=r[n],{first:a,last:l,point:u}=findPoint(s,e,"x");if(!(!u||a&&l)){if(a)i.unshift(u);else if(t.push(u),!l)break}}t.push(...i)}function findPoint(t,e,r){const i=t.interpolate(e,r);if(!i)return{};const n=i[r],s=t.segments,a=t.points;let l=!1,u=!1;for(let p=0;p<s.length;p++){const f=s[p],c=a[f.start][r],h=a[f.end][r];if(_isBetween(n,c,h)){l=n===c,u=n===h;break}}return{first:l,last:u,point:i}}class simpleArc{constructor(e){this.x=e.x,this.y=e.y,this.radius=e.radius}pathSegment(e,r,i){const{x:n,y:s,radius:a}=this;return r=r||{start:0,end:TAU},e.arc(n,s,a,r.end,r.start,!0),!i.bounds}interpolate(e){const{x:r,y:i,radius:n}=this,s=e.angle;return{x:r+Math.cos(s)*n,y:i+Math.sin(s)*n,angle:s}}}function _getTarget(t){const{chart:e,fill:r,line:i}=t;if(isNumberFinite(r))return getLineByIndex(e,r);if(r==="stack")return _buildStackLine(t);if(r==="shape")return!0;const n=computeBoundary(t);return n instanceof simpleArc?n:_createBoundaryLine(n,i)}function getLineByIndex(t,e){const r=t.getDatasetMeta(e);return r&&t.isDatasetVisible(e)?r.dataset:null}function computeBoundary(t){return(t.scale||{}).getPointPositionForValue?computeCircularBoundary(t):computeLinearBoundary(t)}function computeLinearBoundary(t){const{scale:e={},fill:r}=t,i=_getTargetPixel(r,e);if(isNumberFinite(i)){const n=e.isHorizontal();return{x:n?i:null,y:n?null:i}}return null}function computeCircularBoundary(t){const{scale:e,fill:r}=t,i=e.options,n=e.getLabels().length,s=i.reverse?e.max:e.min,a=_getTargetValue(r,e,s),l=[];if(i.grid.circular){const u=e.getPointPositionForValue(0,s);return new simpleArc({x:u.x,y:u.y,radius:e.getDistanceFromCenterForValue(a)})}for(let u=0;u<n;++u)l.push(e.getPointPositionForValue(u,a));return l}function _drawfill(t,e,r){const i=_getTarget(e),{chart:n,index:s,line:a,scale:l,axis:u}=e,p=a.options,f=p.fill,c=p.backgroundColor,{above:h=c,below:d=c}=f||{},m=n.getDatasetMeta(s),_=getDatasetClipArea(n,m);i&&a.points.length&&(clipArea(t,r),doFill(t,{line:a,target:i,above:h,below:d,area:r,scale:l,axis:u,clip:_}),unclipArea(t))}function doFill(t,e){const{line:r,target:i,above:n,below:s,area:a,scale:l,clip:u}=e,p=r._loop?"angle":e.axis;t.save(),p==="x"&&s!==n&&(clipVertical(t,i,a.top),fill(t,{line:r,target:i,color:n,scale:l,property:p,clip:u}),t.restore(),t.save(),clipVertical(t,i,a.bottom)),fill(t,{line:r,target:i,color:s,scale:l,property:p,clip:u}),t.restore()}function clipVertical(t,e,r){const{segments:i,points:n}=e;let s=!0,a=!1;t.beginPath();for(const l of i){const{start:u,end:p}=l,f=n[u],c=n[_findSegmentEnd(u,p,n)];s?(t.moveTo(f.x,f.y),s=!1):(t.lineTo(f.x,r),t.lineTo(f.x,f.y)),a=!!e.pathSegment(t,l,{move:a}),a?t.closePath():t.lineTo(c.x,r)}t.lineTo(e.first().x,r),t.closePath(),t.clip()}function fill(t,e){const{line:r,target:i,property:n,color:s,scale:a,clip:l}=e,u=_segments(r,i,n);for(const{source:p,target:f,start:c,end:h}of u){const{style:{backgroundColor:d=s}={}}=p,m=i!==!0;t.save(),t.fillStyle=d,clipBounds(t,a,l,m&&_getBounds(n,c,h)),t.beginPath();const _=!!r.pathSegment(t,p);let g;if(m){_?t.closePath():interpolatedLineTo(t,i,h,n);const b=!!i.pathSegment(t,f,{move:_,reverse:!0});g=_&&b,g||interpolatedLineTo(t,i,c,n)}t.closePath(),t.fill(g?"evenodd":"nonzero"),t.restore()}}function clipBounds(t,e,r,i){const n=e.chart.chartArea,{property:s,start:a,end:l}=i||{};if(s==="x"||s==="y"){let u,p,f,c;s==="x"?(u=a,p=n.top,f=l,c=n.bottom):(u=n.left,p=a,f=n.right,c=l),t.beginPath(),r&&(u=Math.max(u,r.left),f=Math.min(f,r.right),p=Math.max(p,r.top),c=Math.min(c,r.bottom)),t.rect(u,p,f-u,c-p),t.clip()}}function interpolatedLineTo(t,e,r,i){const n=e.interpolate(r,i);n&&t.lineTo(n.x,n.y)}var index={id:"filler",afterDatasetsUpdate(t,e,r){const i=(t.data.datasets||[]).length,n=[];let s,a,l,u;for(a=0;a<i;++a)s=t.getDatasetMeta(a),l=s.dataset,u=null,l&&l.options&&l instanceof LineElement&&(u={visible:t.isDatasetVisible(a),index:a,fill:_decodeFill(l,a,i),chart:t,axis:s.controller.options.indexAxis,scale:s.vScale,line:l}),s.$filler=u,n.push(u);for(a=0;a<i;++a)u=n[a],!(!u||u.fill===!1)&&(u.fill=_resolveTarget(n,a,r.propagate))},beforeDraw(t,e,r){const i=r.drawTime==="beforeDraw",n=t.getSortedVisibleDatasetMetas(),s=t.chartArea;for(let a=n.length-1;a>=0;--a){const l=n[a].$filler;l&&(l.line.updateControlPoints(s,l.axis),i&&l.fill&&_drawfill(t.ctx,l,s))}},beforeDatasetsDraw(t,e,r){if(r.drawTime!=="beforeDatasetsDraw")return;const i=t.getSortedVisibleDatasetMetas();for(let n=i.length-1;n>=0;--n){const s=i[n].$filler;_shouldApplyFill(s)&&_drawfill(t.ctx,s,t.chartArea)}},beforeDatasetDraw(t,e,r){const i=e.meta.$filler;!_shouldApplyFill(i)||r.drawTime!=="beforeDatasetDraw"||_drawfill(t.ctx,i,t.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const getBoxSize=(t,e)=>{let{boxHeight:r=e,boxWidth:i=e}=t;return t.usePointStyle&&(r=Math.min(r,e),i=t.pointStyleWidth||Math.min(i,e)),{boxWidth:i,boxHeight:r,itemHeight:Math.max(e,r)}},itemsEqual=(t,e)=>t!==null&&e!==null&&t.datasetIndex===e.datasetIndex&&t.index===e.index;class Legend extends Element$1{constructor(e){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,r,i){this.maxWidth=e,this.maxHeight=r,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const e=this.options.labels||{};let r=callback(e.generateLabels,[this.chart],this)||[];e.filter&&(r=r.filter(i=>e.filter(i,this.chart.data))),e.sort&&(r=r.sort((i,n)=>e.sort(i,n,this.chart.data))),this.options.reverse&&r.reverse(),this.legendItems=r}fit(){const{options:e,ctx:r}=this;if(!e.display){this.width=this.height=0;return}const i=e.labels,n=toFont(i.font),s=n.size,a=this._computeTitleHeight(),{boxWidth:l,itemHeight:u}=getBoxSize(i,s);let p,f;r.font=n.string,this.isHorizontal()?(p=this.maxWidth,f=this._fitRows(a,s,l,u)+10):(f=this.maxHeight,p=this._fitCols(a,n,l,u)+10),this.width=Math.min(p,e.maxWidth||this.maxWidth),this.height=Math.min(f,e.maxHeight||this.maxHeight)}_fitRows(e,r,i,n){const{ctx:s,maxWidth:a,options:{labels:{padding:l}}}=this,u=this.legendHitBoxes=[],p=this.lineWidths=[0],f=n+l;let c=e;s.textAlign="left",s.textBaseline="middle";let h=-1,d=-f;return this.legendItems.forEach((m,_)=>{const g=i+r/2+s.measureText(m.text).width;(_===0||p[p.length-1]+g+2*l>a)&&(c+=f,p[p.length-(_>0?0:1)]=0,d+=f,h++),u[_]={left:0,top:d,row:h,width:g,height:n},p[p.length-1]+=g+l}),c}_fitCols(e,r,i,n){const{ctx:s,maxHeight:a,options:{labels:{padding:l}}}=this,u=this.legendHitBoxes=[],p=this.columnSizes=[],f=a-e;let c=l,h=0,d=0,m=0,_=0;return this.legendItems.forEach((g,b)=>{const{itemWidth:x,itemHeight:S}=calculateItemSize(i,r,s,g,n);b>0&&d+S+2*l>f&&(c+=h+l,p.push({width:h,height:d}),m+=h+l,_++,h=d=0),u[b]={left:m,top:d,col:_,width:x,height:S},h=Math.max(h,x),d+=S+l}),c+=h,p.push({width:h,height:d}),c}adjustHitBoxes(){if(!this.options.display)return;const e=this._computeTitleHeight(),{legendHitBoxes:r,options:{align:i,labels:{padding:n},rtl:s}}=this,a=getRtlAdapter(s,this.left,this.width);if(this.isHorizontal()){let l=0,u=_alignStartEnd(i,this.left+n,this.right-this.lineWidths[l]);for(const p of r)l!==p.row&&(l=p.row,u=_alignStartEnd(i,this.left+n,this.right-this.lineWidths[l])),p.top+=this.top+e+n,p.left=a.leftForLtr(a.x(u),p.width),u+=p.width+n}else{let l=0,u=_alignStartEnd(i,this.top+e+n,this.bottom-this.columnSizes[l].height);for(const p of r)p.col!==l&&(l=p.col,u=_alignStartEnd(i,this.top+e+n,this.bottom-this.columnSizes[l].height)),p.top=u,p.left+=this.left+n,p.left=a.leftForLtr(a.x(p.left),p.width),u+=p.height+n}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const e=this.ctx;clipArea(e,this),this._draw(),unclipArea(e)}}_draw(){const{options:e,columnSizes:r,lineWidths:i,ctx:n}=this,{align:s,labels:a}=e,l=defaults.color,u=getRtlAdapter(e.rtl,this.left,this.width),p=toFont(a.font),{padding:f}=a,c=p.size,h=c/2;let d;this.drawTitle(),n.textAlign=u.textAlign("left"),n.textBaseline="middle",n.lineWidth=.5,n.font=p.string;const{boxWidth:m,boxHeight:_,itemHeight:g}=getBoxSize(a,c),b=function(O,L,P){if(isNaN(m)||m<=0||isNaN(_)||_<0)return;n.save();const C=valueOrDefault(P.lineWidth,1);if(n.fillStyle=valueOrDefault(P.fillStyle,l),n.lineCap=valueOrDefault(P.lineCap,"butt"),n.lineDashOffset=valueOrDefault(P.lineDashOffset,0),n.lineJoin=valueOrDefault(P.lineJoin,"miter"),n.lineWidth=C,n.strokeStyle=valueOrDefault(P.strokeStyle,l),n.setLineDash(valueOrDefault(P.lineDash,[])),a.usePointStyle){const G={radius:_*Math.SQRT2/2,pointStyle:P.pointStyle,rotation:P.rotation,borderWidth:C},B=u.xPlus(O,m/2),H=L+h;drawPointLegend(n,G,B,H,a.pointStyleWidth&&m)}else{const G=L+Math.max((c-_)/2,0),B=u.leftForLtr(O,m),H=toTRBLCorners(P.borderRadius);n.beginPath(),Object.values(H).some(ee=>ee!==0)?addRoundedRectPath(n,{x:B,y:G,w:m,h:_,radius:H}):n.rect(B,G,m,_),n.fill(),C!==0&&n.stroke()}n.restore()},x=function(O,L,P){renderText(n,P.text,O,L+g/2,p,{strikethrough:P.hidden,textAlign:u.textAlign(P.textAlign)})},S=this.isHorizontal(),T=this._computeTitleHeight();S?d={x:_alignStartEnd(s,this.left+f,this.right-i[0]),y:this.top+f+T,line:0}:d={x:this.left+f,y:_alignStartEnd(s,this.top+T+f,this.bottom-r[0].height),line:0},overrideTextDirection(this.ctx,e.textDirection);const I=g+f;this.legendItems.forEach((O,L)=>{n.strokeStyle=O.fontColor,n.fillStyle=O.fontColor;const P=n.measureText(O.text).width,C=u.textAlign(O.textAlign||(O.textAlign=a.textAlign)),G=m+h+P;let B=d.x,H=d.y;u.setWidth(this.width),S?L>0&&B+G+f>this.right&&(H=d.y+=I,d.line++,B=d.x=_alignStartEnd(s,this.left+f,this.right-i[d.line])):L>0&&H+I>this.bottom&&(B=d.x=B+r[d.line].width+f,d.line++,H=d.y=_alignStartEnd(s,this.top+T+f,this.bottom-r[d.line].height));const ee=u.x(B);if(b(ee,H,O),B=_textX(C,B+m+h,S?B+G:this.right,e.rtl),x(u.x(B),H,O),S)d.x+=G+f;else if(typeof O.text!="string"){const j=p.lineHeight;d.y+=calculateLegendItemHeight(O,j)+f}else d.y+=I}),restoreTextDirection(this.ctx,e.textDirection)}drawTitle(){const e=this.options,r=e.title,i=toFont(r.font),n=toPadding(r.padding);if(!r.display)return;const s=getRtlAdapter(e.rtl,this.left,this.width),a=this.ctx,l=r.position,u=i.size/2,p=n.top+u;let f,c=this.left,h=this.width;if(this.isHorizontal())h=Math.max(...this.lineWidths),f=this.top+p,c=_alignStartEnd(e.align,c,this.right-h);else{const m=this.columnSizes.reduce((_,g)=>Math.max(_,g.height),0);f=p+_alignStartEnd(e.align,this.top,this.bottom-m-e.labels.padding-this._computeTitleHeight())}const d=_alignStartEnd(l,c,c+h);a.textAlign=s.textAlign(_toLeftRightCenter(l)),a.textBaseline="middle",a.strokeStyle=r.color,a.fillStyle=r.color,a.font=i.string,renderText(a,r.text,d,f,i)}_computeTitleHeight(){const e=this.options.title,r=toFont(e.font),i=toPadding(e.padding);return e.display?r.lineHeight+i.height:0}_getLegendItemAt(e,r){let i,n,s;if(_isBetween(e,this.left,this.right)&&_isBetween(r,this.top,this.bottom)){for(s=this.legendHitBoxes,i=0;i<s.length;++i)if(n=s[i],_isBetween(e,n.left,n.left+n.width)&&_isBetween(r,n.top,n.top+n.height))return this.legendItems[i]}return null}handleEvent(e){const r=this.options;if(!isListened(e.type,r))return;const i=this._getLegendItemAt(e.x,e.y);if(e.type==="mousemove"||e.type==="mouseout"){const n=this._hoveredItem,s=itemsEqual(n,i);n&&!s&&callback(r.onLeave,[e,n,this],this),this._hoveredItem=i,i&&!s&&callback(r.onHover,[e,i,this],this)}else i&&callback(r.onClick,[e,i,this],this)}}function calculateItemSize(t,e,r,i,n){const s=calculateItemWidth(i,t,e,r),a=calculateItemHeight(n,i,e.lineHeight);return{itemWidth:s,itemHeight:a}}function calculateItemWidth(t,e,r,i){let n=t.text;return n&&typeof n!="string"&&(n=n.reduce((s,a)=>s.length>a.length?s:a)),e+r.size/2+i.measureText(n).width}function calculateItemHeight(t,e,r){let i=t;return typeof e.text!="string"&&(i=calculateLegendItemHeight(e,r)),i}function calculateLegendItemHeight(t,e){const r=t.text?t.text.length:0;return e*r}function isListened(t,e){return!!((t==="mousemove"||t==="mouseout")&&(e.onHover||e.onLeave)||e.onClick&&(t==="click"||t==="mouseup"))}var plugin_legend={id:"legend",_element:Legend,start(t,e,r){const i=t.legend=new Legend({ctx:t.ctx,options:r,chart:t});layouts.configure(t,i,r),layouts.addBox(t,i)},stop(t){layouts.removeBox(t,t.legend),delete t.legend},beforeUpdate(t,e,r){const i=t.legend;layouts.configure(t,i,r),i.options=r},afterUpdate(t){const e=t.legend;e.buildLabels(),e.adjustHitBoxes()},afterEvent(t,e){e.replay||t.legend.handleEvent(e.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(t,e,r){const i=e.datasetIndex,n=r.chart;n.isDatasetVisible(i)?(n.hide(i),e.hidden=!0):(n.show(i),e.hidden=!1)},onHover:null,onLeave:null,labels:{color:t=>t.chart.options.color,boxWidth:40,padding:10,generateLabels(t){const e=t.data.datasets,{labels:{usePointStyle:r,pointStyle:i,textAlign:n,color:s,useBorderRadius:a,borderRadius:l}}=t.legend.options;return t._getSortedDatasetMetas().map(u=>{const p=u.controller.getStyle(r?0:void 0),f=toPadding(p.borderWidth);return{text:e[u.index].label,fillStyle:p.backgroundColor,fontColor:s,hidden:!u.visible,lineCap:p.borderCapStyle,lineDash:p.borderDash,lineDashOffset:p.borderDashOffset,lineJoin:p.borderJoinStyle,lineWidth:(f.width+f.height)/4,strokeStyle:p.borderColor,pointStyle:i||p.pointStyle,rotation:p.rotation,textAlign:n||p.textAlign,borderRadius:a&&(l||p.borderRadius),datasetIndex:u.index}},this)}},title:{color:t=>t.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:t=>!t.startsWith("on"),labels:{_scriptable:t=>!["generateLabels","filter","sort"].includes(t)}}};class Title extends Element$1{constructor(e){super(),this.chart=e.chart,this.options=e.options,this.ctx=e.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(e,r){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=e,this.height=this.bottom=r;const n=isArray(i.text)?i.text.length:1;this._padding=toPadding(i.padding);const s=n*toFont(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=s:this.width=s}isHorizontal(){const e=this.options.position;return e==="top"||e==="bottom"}_drawArgs(e){const{top:r,left:i,bottom:n,right:s,options:a}=this,l=a.align;let u=0,p,f,c;return this.isHorizontal()?(f=_alignStartEnd(l,i,s),c=r+e,p=s-i):(a.position==="left"?(f=i+e,c=_alignStartEnd(l,n,r),u=PI*-.5):(f=s-e,c=_alignStartEnd(l,r,n),u=PI*.5),p=n-r),{titleX:f,titleY:c,maxWidth:p,rotation:u}}draw(){const e=this.ctx,r=this.options;if(!r.display)return;const i=toFont(r.font),s=i.lineHeight/2+this._padding.top,{titleX:a,titleY:l,maxWidth:u,rotation:p}=this._drawArgs(s);renderText(e,r.text,0,0,i,{color:r.color,maxWidth:u,rotation:p,textAlign:_toLeftRightCenter(r.align),textBaseline:"middle",translation:[a,l]})}}function createTitle(t,e){const r=new Title({ctx:t.ctx,options:e,chart:t});layouts.configure(t,r,e),layouts.addBox(t,r),t.titleBlock=r}var plugin_title={id:"title",_element:Title,start(t,e,r){createTitle(t,r)},stop(t){const e=t.titleBlock;layouts.removeBox(t,e),delete t.titleBlock},beforeUpdate(t,e,r){const i=t.titleBlock;layouts.configure(t,i,r),i.options=r},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const positioners={average(t){if(!t.length)return!1;let e,r,i=new Set,n=0,s=0;for(e=0,r=t.length;e<r;++e){const l=t[e].element;if(l&&l.hasValue()){const u=l.tooltipPosition();i.add(u.x),n+=u.y,++s}}return s===0||i.size===0?!1:{x:[...i].reduce((l,u)=>l+u)/i.size,y:n/s}},nearest(t,e){if(!t.length)return!1;let r=e.x,i=e.y,n=Number.POSITIVE_INFINITY,s,a,l;for(s=0,a=t.length;s<a;++s){const u=t[s].element;if(u&&u.hasValue()){const p=u.getCenterPoint(),f=distanceBetweenPoints(e,p);f<n&&(n=f,l=u)}}if(l){const u=l.tooltipPosition();r=u.x,i=u.y}return{x:r,y:i}}};function pushOrConcat(t,e){return e&&(isArray(e)?Array.prototype.push.apply(t,e):t.push(e)),t}function splitNewlines(t){return(typeof t=="string"||t instanceof String)&&t.indexOf(`
`)>-1?t.split(`
`):t}function createTooltipItem(t,e){const{element:r,datasetIndex:i,index:n}=e,s=t.getDatasetMeta(i).controller,{label:a,value:l}=s.getLabelAndValue(n);return{chart:t,label:a,parsed:s.getParsed(n),raw:t.data.datasets[i].data[n],formattedValue:l,dataset:s.getDataset(),dataIndex:n,datasetIndex:i,element:r}}function getTooltipSize(t,e){const r=t.chart.ctx,{body:i,footer:n,title:s}=t,{boxWidth:a,boxHeight:l}=e,u=toFont(e.bodyFont),p=toFont(e.titleFont),f=toFont(e.footerFont),c=s.length,h=n.length,d=i.length,m=toPadding(e.padding);let _=m.height,g=0,b=i.reduce((T,I)=>T+I.before.length+I.lines.length+I.after.length,0);if(b+=t.beforeBody.length+t.afterBody.length,c&&(_+=c*p.lineHeight+(c-1)*e.titleSpacing+e.titleMarginBottom),b){const T=e.displayColors?Math.max(l,u.lineHeight):u.lineHeight;_+=d*T+(b-d)*u.lineHeight+(b-1)*e.bodySpacing}h&&(_+=e.footerMarginTop+h*f.lineHeight+(h-1)*e.footerSpacing);let x=0;const S=function(T){g=Math.max(g,r.measureText(T).width+x)};return r.save(),r.font=p.string,each(t.title,S),r.font=u.string,each(t.beforeBody.concat(t.afterBody),S),x=e.displayColors?a+2+e.boxPadding:0,each(i,T=>{each(T.before,S),each(T.lines,S),each(T.after,S)}),x=0,r.font=f.string,each(t.footer,S),r.restore(),g+=m.width,{width:g,height:_}}function determineYAlign(t,e){const{y:r,height:i}=e;return r<i/2?"top":r>t.height-i/2?"bottom":"center"}function doesNotFitWithAlign(t,e,r,i){const{x:n,width:s}=i,a=r.caretSize+r.caretPadding;if(t==="left"&&n+s+a>e.width||t==="right"&&n-s-a<0)return!0}function determineXAlign(t,e,r,i){const{x:n,width:s}=r,{width:a,chartArea:{left:l,right:u}}=t;let p="center";return i==="center"?p=n<=(l+u)/2?"left":"right":n<=s/2?p="left":n>=a-s/2&&(p="right"),doesNotFitWithAlign(p,t,e,r)&&(p="center"),p}function determineAlignment(t,e,r){const i=r.yAlign||e.yAlign||determineYAlign(t,r);return{xAlign:r.xAlign||e.xAlign||determineXAlign(t,e,r,i),yAlign:i}}function alignX(t,e){let{x:r,width:i}=t;return e==="right"?r-=i:e==="center"&&(r-=i/2),r}function alignY(t,e,r){let{y:i,height:n}=t;return e==="top"?i+=r:e==="bottom"?i-=n+r:i-=n/2,i}function getBackgroundPoint(t,e,r,i){const{caretSize:n,caretPadding:s,cornerRadius:a}=t,{xAlign:l,yAlign:u}=r,p=n+s,{topLeft:f,topRight:c,bottomLeft:h,bottomRight:d}=toTRBLCorners(a);let m=alignX(e,l);const _=alignY(e,u,p);return u==="center"?l==="left"?m+=p:l==="right"&&(m-=p):l==="left"?m-=Math.max(f,h)+n:l==="right"&&(m+=Math.max(c,d)+n),{x:_limitValue(m,0,i.width-e.width),y:_limitValue(_,0,i.height-e.height)}}function getAlignedX(t,e,r){const i=toPadding(r.padding);return e==="center"?t.x+t.width/2:e==="right"?t.x+t.width-i.right:t.x+i.left}function getBeforeAfterBodyLines(t){return pushOrConcat([],splitNewlines(t))}function createTooltipContext(t,e,r){return createContext(t,{tooltip:e,tooltipItems:r,type:"tooltip"})}function overrideCallbacks(t,e){const r=e&&e.dataset&&e.dataset.tooltip&&e.dataset.tooltip.callbacks;return r?t.override(r):t}const defaultCallbacks={beforeTitle:noop,title(t){if(t.length>0){const e=t[0],r=e.chart.data.labels,i=r?r.length:0;if(this&&this.options&&this.options.mode==="dataset")return e.dataset.label||"";if(e.label)return e.label;if(i>0&&e.dataIndex<i)return r[e.dataIndex]}return""},afterTitle:noop,beforeBody:noop,beforeLabel:noop,label(t){if(this&&this.options&&this.options.mode==="dataset")return t.label+": "+t.formattedValue||t.formattedValue;let e=t.dataset.label||"";e&&(e+=": ");const r=t.formattedValue;return isNullOrUndef(r)||(e+=r),e},labelColor(t){const r=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{borderColor:r.borderColor,backgroundColor:r.backgroundColor,borderWidth:r.borderWidth,borderDash:r.borderDash,borderDashOffset:r.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(t){const r=t.chart.getDatasetMeta(t.datasetIndex).controller.getStyle(t.dataIndex);return{pointStyle:r.pointStyle,rotation:r.rotation}},afterLabel:noop,afterBody:noop,beforeFooter:noop,footer:noop,afterFooter:noop};function invokeCallbackWithFallback(t,e,r,i){const n=t[e].call(r,i);return typeof n>"u"?defaultCallbacks[e].call(r,i):n}class Tooltip extends Element$1{static positioners=positioners;constructor(e){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=e.chart,this.options=e.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(e){this.options=e,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const e=this._cachedAnimations;if(e)return e;const r=this.chart,i=this.options.setContext(this.getContext()),n=i.enabled&&r.options.animation&&i.animations,s=new Animations(this.chart,n);return n._cacheable&&(this._cachedAnimations=Object.freeze(s)),s}getContext(){return this.$context||(this.$context=createTooltipContext(this.chart.getContext(),this,this._tooltipItems))}getTitle(e,r){const{callbacks:i}=r,n=invokeCallbackWithFallback(i,"beforeTitle",this,e),s=invokeCallbackWithFallback(i,"title",this,e),a=invokeCallbackWithFallback(i,"afterTitle",this,e);let l=[];return l=pushOrConcat(l,splitNewlines(n)),l=pushOrConcat(l,splitNewlines(s)),l=pushOrConcat(l,splitNewlines(a)),l}getBeforeBody(e,r){return getBeforeAfterBodyLines(invokeCallbackWithFallback(r.callbacks,"beforeBody",this,e))}getBody(e,r){const{callbacks:i}=r,n=[];return each(e,s=>{const a={before:[],lines:[],after:[]},l=overrideCallbacks(i,s);pushOrConcat(a.before,splitNewlines(invokeCallbackWithFallback(l,"beforeLabel",this,s))),pushOrConcat(a.lines,invokeCallbackWithFallback(l,"label",this,s)),pushOrConcat(a.after,splitNewlines(invokeCallbackWithFallback(l,"afterLabel",this,s))),n.push(a)}),n}getAfterBody(e,r){return getBeforeAfterBodyLines(invokeCallbackWithFallback(r.callbacks,"afterBody",this,e))}getFooter(e,r){const{callbacks:i}=r,n=invokeCallbackWithFallback(i,"beforeFooter",this,e),s=invokeCallbackWithFallback(i,"footer",this,e),a=invokeCallbackWithFallback(i,"afterFooter",this,e);let l=[];return l=pushOrConcat(l,splitNewlines(n)),l=pushOrConcat(l,splitNewlines(s)),l=pushOrConcat(l,splitNewlines(a)),l}_createItems(e){const r=this._active,i=this.chart.data,n=[],s=[],a=[];let l=[],u,p;for(u=0,p=r.length;u<p;++u)l.push(createTooltipItem(this.chart,r[u]));return e.filter&&(l=l.filter((f,c,h)=>e.filter(f,c,h,i))),e.itemSort&&(l=l.sort((f,c)=>e.itemSort(f,c,i))),each(l,f=>{const c=overrideCallbacks(e.callbacks,f);n.push(invokeCallbackWithFallback(c,"labelColor",this,f)),s.push(invokeCallbackWithFallback(c,"labelPointStyle",this,f)),a.push(invokeCallbackWithFallback(c,"labelTextColor",this,f))}),this.labelColors=n,this.labelPointStyles=s,this.labelTextColors=a,this.dataPoints=l,l}update(e,r){const i=this.options.setContext(this.getContext()),n=this._active;let s,a=[];if(!n.length)this.opacity!==0&&(s={opacity:0});else{const l=positioners[i.position].call(this,n,this._eventPosition);a=this._createItems(i),this.title=this.getTitle(a,i),this.beforeBody=this.getBeforeBody(a,i),this.body=this.getBody(a,i),this.afterBody=this.getAfterBody(a,i),this.footer=this.getFooter(a,i);const u=this._size=getTooltipSize(this,i),p=Object.assign({},l,u),f=determineAlignment(this.chart,i,p),c=getBackgroundPoint(i,p,f,this.chart);this.xAlign=f.xAlign,this.yAlign=f.yAlign,s={opacity:1,x:c.x,y:c.y,width:u.width,height:u.height,caretX:l.x,caretY:l.y}}this._tooltipItems=a,this.$context=void 0,s&&this._resolveAnimations().update(this,s),e&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:r})}drawCaret(e,r,i,n){const s=this.getCaretPosition(e,i,n);r.lineTo(s.x1,s.y1),r.lineTo(s.x2,s.y2),r.lineTo(s.x3,s.y3)}getCaretPosition(e,r,i){const{xAlign:n,yAlign:s}=this,{caretSize:a,cornerRadius:l}=i,{topLeft:u,topRight:p,bottomLeft:f,bottomRight:c}=toTRBLCorners(l),{x:h,y:d}=e,{width:m,height:_}=r;let g,b,x,S,T,I;return s==="center"?(T=d+_/2,n==="left"?(g=h,b=g-a,S=T+a,I=T-a):(g=h+m,b=g+a,S=T-a,I=T+a),x=g):(n==="left"?b=h+Math.max(u,f)+a:n==="right"?b=h+m-Math.max(p,c)-a:b=this.caretX,s==="top"?(S=d,T=S-a,g=b-a,x=b+a):(S=d+_,T=S+a,g=b+a,x=b-a),I=S),{x1:g,x2:b,x3:x,y1:S,y2:T,y3:I}}drawTitle(e,r,i){const n=this.title,s=n.length;let a,l,u;if(s){const p=getRtlAdapter(i.rtl,this.x,this.width);for(e.x=getAlignedX(this,i.titleAlign,i),r.textAlign=p.textAlign(i.titleAlign),r.textBaseline="middle",a=toFont(i.titleFont),l=i.titleSpacing,r.fillStyle=i.titleColor,r.font=a.string,u=0;u<s;++u)r.fillText(n[u],p.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+l,u+1===s&&(e.y+=i.titleMarginBottom-l)}}_drawColorBox(e,r,i,n,s){const a=this.labelColors[i],l=this.labelPointStyles[i],{boxHeight:u,boxWidth:p}=s,f=toFont(s.bodyFont),c=getAlignedX(this,"left",s),h=n.x(c),d=u<f.lineHeight?(f.lineHeight-u)/2:0,m=r.y+d;if(s.usePointStyle){const _={radius:Math.min(p,u)/2,pointStyle:l.pointStyle,rotation:l.rotation,borderWidth:1},g=n.leftForLtr(h,p)+p/2,b=m+u/2;e.strokeStyle=s.multiKeyBackground,e.fillStyle=s.multiKeyBackground,drawPoint(e,_,g,b),e.strokeStyle=a.borderColor,e.fillStyle=a.backgroundColor,drawPoint(e,_,g,b)}else{e.lineWidth=isObject(a.borderWidth)?Math.max(...Object.values(a.borderWidth)):a.borderWidth||1,e.strokeStyle=a.borderColor,e.setLineDash(a.borderDash||[]),e.lineDashOffset=a.borderDashOffset||0;const _=n.leftForLtr(h,p),g=n.leftForLtr(n.xPlus(h,1),p-2),b=toTRBLCorners(a.borderRadius);Object.values(b).some(x=>x!==0)?(e.beginPath(),e.fillStyle=s.multiKeyBackground,addRoundedRectPath(e,{x:_,y:m,w:p,h:u,radius:b}),e.fill(),e.stroke(),e.fillStyle=a.backgroundColor,e.beginPath(),addRoundedRectPath(e,{x:g,y:m+1,w:p-2,h:u-2,radius:b}),e.fill()):(e.fillStyle=s.multiKeyBackground,e.fillRect(_,m,p,u),e.strokeRect(_,m,p,u),e.fillStyle=a.backgroundColor,e.fillRect(g,m+1,p-2,u-2))}e.fillStyle=this.labelTextColors[i]}drawBody(e,r,i){const{body:n}=this,{bodySpacing:s,bodyAlign:a,displayColors:l,boxHeight:u,boxWidth:p,boxPadding:f}=i,c=toFont(i.bodyFont);let h=c.lineHeight,d=0;const m=getRtlAdapter(i.rtl,this.x,this.width),_=function(P){r.fillText(P,m.x(e.x+d),e.y+h/2),e.y+=h+s},g=m.textAlign(a);let b,x,S,T,I,O,L;for(r.textAlign=a,r.textBaseline="middle",r.font=c.string,e.x=getAlignedX(this,g,i),r.fillStyle=i.bodyColor,each(this.beforeBody,_),d=l&&g!=="right"?a==="center"?p/2+f:p+2+f:0,T=0,O=n.length;T<O;++T){for(b=n[T],x=this.labelTextColors[T],r.fillStyle=x,each(b.before,_),S=b.lines,l&&S.length&&(this._drawColorBox(r,e,T,m,i),h=Math.max(c.lineHeight,u)),I=0,L=S.length;I<L;++I)_(S[I]),h=c.lineHeight;each(b.after,_)}d=0,h=c.lineHeight,each(this.afterBody,_),e.y-=s}drawFooter(e,r,i){const n=this.footer,s=n.length;let a,l;if(s){const u=getRtlAdapter(i.rtl,this.x,this.width);for(e.x=getAlignedX(this,i.footerAlign,i),e.y+=i.footerMarginTop,r.textAlign=u.textAlign(i.footerAlign),r.textBaseline="middle",a=toFont(i.footerFont),r.fillStyle=i.footerColor,r.font=a.string,l=0;l<s;++l)r.fillText(n[l],u.x(e.x),e.y+a.lineHeight/2),e.y+=a.lineHeight+i.footerSpacing}}drawBackground(e,r,i,n){const{xAlign:s,yAlign:a}=this,{x:l,y:u}=e,{width:p,height:f}=i,{topLeft:c,topRight:h,bottomLeft:d,bottomRight:m}=toTRBLCorners(n.cornerRadius);r.fillStyle=n.backgroundColor,r.strokeStyle=n.borderColor,r.lineWidth=n.borderWidth,r.beginPath(),r.moveTo(l+c,u),a==="top"&&this.drawCaret(e,r,i,n),r.lineTo(l+p-h,u),r.quadraticCurveTo(l+p,u,l+p,u+h),a==="center"&&s==="right"&&this.drawCaret(e,r,i,n),r.lineTo(l+p,u+f-m),r.quadraticCurveTo(l+p,u+f,l+p-m,u+f),a==="bottom"&&this.drawCaret(e,r,i,n),r.lineTo(l+d,u+f),r.quadraticCurveTo(l,u+f,l,u+f-d),a==="center"&&s==="left"&&this.drawCaret(e,r,i,n),r.lineTo(l,u+c),r.quadraticCurveTo(l,u,l+c,u),r.closePath(),r.fill(),n.borderWidth>0&&r.stroke()}_updateAnimationTarget(e){const r=this.chart,i=this.$animations,n=i&&i.x,s=i&&i.y;if(n||s){const a=positioners[e.position].call(this,this._active,this._eventPosition);if(!a)return;const l=this._size=getTooltipSize(this,e),u=Object.assign({},a,this._size),p=determineAlignment(r,e,u),f=getBackgroundPoint(e,u,p,r);(n._to!==f.x||s._to!==f.y)&&(this.xAlign=p.xAlign,this.yAlign=p.yAlign,this.width=l.width,this.height=l.height,this.caretX=a.x,this.caretY=a.y,this._resolveAnimations().update(this,f))}}_willRender(){return!!this.opacity}draw(e){const r=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(r);const n={width:this.width,height:this.height},s={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const a=toPadding(r.padding),l=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;r.enabled&&l&&(e.save(),e.globalAlpha=i,this.drawBackground(s,e,n,r),overrideTextDirection(e,r.textDirection),s.y+=a.top,this.drawTitle(s,e,r),this.drawBody(s,e,r),this.drawFooter(s,e,r),restoreTextDirection(e,r.textDirection),e.restore())}getActiveElements(){return this._active||[]}setActiveElements(e,r){const i=this._active,n=e.map(({datasetIndex:l,index:u})=>{const p=this.chart.getDatasetMeta(l);if(!p)throw new Error("Cannot find a dataset at index "+l);return{datasetIndex:l,element:p.data[u],index:u}}),s=!_elementsEqual(i,n),a=this._positionChanged(n,r);(s||a)&&(this._active=n,this._eventPosition=r,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(e,r,i=!0){if(r&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const n=this.options,s=this._active||[],a=this._getActiveElements(e,s,r,i),l=this._positionChanged(a,e),u=r||!_elementsEqual(a,s)||l;return u&&(this._active=a,(n.enabled||n.external)&&(this._eventPosition={x:e.x,y:e.y},this.update(!0,r))),u}_getActiveElements(e,r,i,n){const s=this.options;if(e.type==="mouseout")return[];if(!n)return r.filter(l=>this.chart.data.datasets[l.datasetIndex]&&this.chart.getDatasetMeta(l.datasetIndex).controller.getParsed(l.index)!==void 0);const a=this.chart.getElementsAtEventForMode(e,s.mode,s,i);return s.reverse&&a.reverse(),a}_positionChanged(e,r){const{caretX:i,caretY:n,options:s}=this,a=positioners[s.position].call(this,e,r);return a!==!1&&(i!==a.x||n!==a.y)}}var plugin_tooltip={id:"tooltip",_element:Tooltip,positioners,afterInit(t,e,r){r&&(t.tooltip=new Tooltip({chart:t,options:r}))},beforeUpdate(t,e,r){t.tooltip&&t.tooltip.initialize(r)},reset(t,e,r){t.tooltip&&t.tooltip.initialize(r)},afterDraw(t){const e=t.tooltip;if(e&&e._willRender()){const r={tooltip:e};if(t.notifyPlugins("beforeTooltipDraw",{...r,cancelable:!0})===!1)return;e.draw(t.ctx),t.notifyPlugins("afterTooltipDraw",r)}},afterEvent(t,e){if(t.tooltip){const r=e.replay;t.tooltip.handleEvent(e.event,r,e.inChartArea)&&(e.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(t,e)=>e.bodyFont.size,boxWidth:(t,e)=>e.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:defaultCallbacks},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:t=>t!=="filter"&&t!=="itemSort"&&t!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]};const addIfString=(t,e,r,i)=>(typeof e=="string"?(r=t.push(e)-1,i.unshift({index:r,label:e})):isNaN(e)&&(r=null),r);function findOrAddLabel(t,e,r,i){const n=t.indexOf(e);if(n===-1)return addIfString(t,e,r,i);const s=t.lastIndexOf(e);return n!==s?r:n}const validIndex=(t,e)=>t===null?null:_limitValue(Math.round(t),0,e);function _getLabelForValue(t){const e=this.getLabels();return t>=0&&t<e.length?e[t]:t}class CategoryScale extends Scale{static id="category";static defaults={ticks:{callback:_getLabelForValue}};constructor(e){super(e),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(e){const r=this._addedLabels;if(r.length){const i=this.getLabels();for(const{index:n,label:s}of r)i[n]===s&&i.splice(n,1);this._addedLabels=[]}super.init(e)}parse(e,r){if(isNullOrUndef(e))return null;const i=this.getLabels();return r=isFinite(r)&&i[r]===e?r:findOrAddLabel(i,e,valueOrDefault(r,e),this._addedLabels),validIndex(r,i.length-1)}determineDataLimits(){const{minDefined:e,maxDefined:r}=this.getUserBounds();let{min:i,max:n}=this.getMinMax(!0);this.options.bounds==="ticks"&&(e||(i=0),r||(n=this.getLabels().length-1)),this.min=i,this.max=n}buildTicks(){const e=this.min,r=this.max,i=this.options.offset,n=[];let s=this.getLabels();s=e===0&&r===s.length-1?s:s.slice(e,r+1),this._valueRange=Math.max(s.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let a=e;a<=r;a++)n.push({value:a});return n}getLabelForValue(e){return _getLabelForValue.call(this,e)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(e){return typeof e!="number"&&(e=this.parse(e)),e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getPixelForTick(e){const r=this.ticks;return e<0||e>r.length-1?null:this.getPixelForValue(r[e].value)}getValueForPixel(e){return Math.round(this._startValue+this.getDecimalForPixel(e)*this._valueRange)}getBasePixel(){return this.bottom}}function generateTicks$1(t,e){const r=[],{bounds:n,step:s,min:a,max:l,precision:u,count:p,maxTicks:f,maxDigits:c,includeBounds:h}=t,d=s||1,m=f-1,{min:_,max:g}=e,b=!isNullOrUndef(a),x=!isNullOrUndef(l),S=!isNullOrUndef(p),T=(g-_)/(c+1);let I=niceNum((g-_)/m/d)*d,O,L,P,C;if(I<1e-14&&!b&&!x)return[{value:_},{value:g}];C=Math.ceil(g/I)-Math.floor(_/I),C>m&&(I=niceNum(C*I/m/d)*d),isNullOrUndef(u)||(O=Math.pow(10,u),I=Math.ceil(I*O)/O),n==="ticks"?(L=Math.floor(_/I)*I,P=Math.ceil(g/I)*I):(L=_,P=g),b&&x&&s&&almostWhole((l-a)/s,I/1e3)?(C=Math.round(Math.min((l-a)/I,f)),I=(l-a)/C,L=a,P=l):S?(L=b?a:L,P=x?l:P,C=p-1,I=(P-L)/C):(C=(P-L)/I,almostEquals(C,Math.round(C),I/1e3)?C=Math.round(C):C=Math.ceil(C));const G=Math.max(_decimalPlaces(I),_decimalPlaces(L));O=Math.pow(10,isNullOrUndef(u)?G:u),L=Math.round(L*O)/O,P=Math.round(P*O)/O;let B=0;for(b&&(h&&L!==a?(r.push({value:a}),L<a&&B++,almostEquals(Math.round((L+B*I)*O)/O,a,relativeLabelSize(a,T,t))&&B++):L<a&&B++);B<C;++B){const H=Math.round((L+B*I)*O)/O;if(x&&H>l)break;r.push({value:H})}return x&&h&&P!==l?r.length&&almostEquals(r[r.length-1].value,l,relativeLabelSize(l,T,t))?r[r.length-1].value=l:r.push({value:l}):(!x||P===l)&&r.push({value:P}),r}function relativeLabelSize(t,e,{horizontal:r,minRotation:i}){const n=toRadians(i),s=(r?Math.sin(n):Math.cos(n))||.001,a=.75*e*(""+t).length;return Math.min(e/s,a)}class LinearScaleBase extends Scale{constructor(e){super(e),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(e,r){return isNullOrUndef(e)||(typeof e=="number"||e instanceof Number)&&!isFinite(+e)?null:+e}handleTickRangeOptions(){const{beginAtZero:e}=this.options,{minDefined:r,maxDefined:i}=this.getUserBounds();let{min:n,max:s}=this;const a=u=>n=r?n:u,l=u=>s=i?s:u;if(e){const u=sign(n),p=sign(s);u<0&&p<0?l(0):u>0&&p>0&&a(0)}if(n===s){let u=s===0?1:Math.abs(s*.05);l(s+u),e||a(n-u)}this.min=n,this.max=s}getTickLimit(){const e=this.options.ticks;let{maxTicksLimit:r,stepSize:i}=e,n;return i?(n=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,n>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${n} ticks. Limiting to 1000.`),n=1e3)):(n=this.computeTickLimit(),r=r||11),r&&(n=Math.min(r,n)),n}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const e=this.options,r=e.ticks;let i=this.getTickLimit();i=Math.max(2,i);const n={maxTicks:i,bounds:e.bounds,min:e.min,max:e.max,precision:r.precision,step:r.stepSize,count:r.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:r.minRotation||0,includeBounds:r.includeBounds!==!1},s=this._range||this,a=generateTicks$1(n,s);return e.bounds==="ticks"&&_setMinAndMaxByKey(a,this,"value"),e.reverse?(a.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),a}configure(){const e=this.ticks;let r=this.min,i=this.max;if(super.configure(),this.options.offset&&e.length){const n=(i-r)/Math.max(e.length-1,1)/2;r-=n,i+=n}this._startValue=r,this._endValue=i,this._valueRange=i-r}getLabelForValue(e){return formatNumber(e,this.chart.options.locale,this.options.ticks.format)}}class LinearScale extends LinearScaleBase{static id="linear";static defaults={ticks:{callback:Ticks.formatters.numeric}};determineDataLimits(){const{min:e,max:r}=this.getMinMax(!0);this.min=isNumberFinite(e)?e:0,this.max=isNumberFinite(r)?r:1,this.handleTickRangeOptions()}computeTickLimit(){const e=this.isHorizontal(),r=e?this.width:this.height,i=toRadians(this.options.ticks.minRotation),n=(e?Math.sin(i):Math.cos(i))||.001,s=this._resolveTickFontOptions(0);return Math.ceil(r/Math.min(40,s.lineHeight/n))}getPixelForValue(e){return e===null?NaN:this.getPixelForDecimal((e-this._startValue)/this._valueRange)}getValueForPixel(e){return this._startValue+this.getDecimalForPixel(e)*this._valueRange}}const INTERVALS={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},UNITS=Object.keys(INTERVALS);function sorter(t,e){return t-e}function parse(t,e){if(isNullOrUndef(e))return null;const r=t._adapter,{parser:i,round:n,isoWeekday:s}=t._parseOpts;let a=e;return typeof i=="function"&&(a=i(a)),isNumberFinite(a)||(a=typeof i=="string"?r.parse(a,i):r.parse(a)),a===null?null:(n&&(a=n==="week"&&(isNumber(s)||s===!0)?r.startOf(a,"isoWeek",s):r.startOf(a,n)),+a)}function determineUnitForAutoTicks(t,e,r,i){const n=UNITS.length;for(let s=UNITS.indexOf(t);s<n-1;++s){const a=INTERVALS[UNITS[s]],l=a.steps?a.steps:Number.MAX_SAFE_INTEGER;if(a.common&&Math.ceil((r-e)/(l*a.size))<=i)return UNITS[s]}return UNITS[n-1]}function determineUnitForFormatting(t,e,r,i,n){for(let s=UNITS.length-1;s>=UNITS.indexOf(r);s--){const a=UNITS[s];if(INTERVALS[a].common&&t._adapter.diff(n,i,a)>=e-1)return a}return UNITS[r?UNITS.indexOf(r):0]}function determineMajorUnit(t){for(let e=UNITS.indexOf(t)+1,r=UNITS.length;e<r;++e)if(INTERVALS[UNITS[e]].common)return UNITS[e]}function addTick(t,e,r){if(!r)t[e]=!0;else if(r.length){const{lo:i,hi:n}=_lookup(r,e),s=r[i]>=e?r[i]:r[n];t[s]=!0}}function setMajorTicks(t,e,r,i){const n=t._adapter,s=+n.startOf(e[0].value,i),a=e[e.length-1].value;let l,u;for(l=s;l<=a;l=+n.add(l,1,i))u=r[l],u>=0&&(e[u].major=!0);return e}function ticksFromTimestamps(t,e,r){const i=[],n={},s=e.length;let a,l;for(a=0;a<s;++a)l=e[a],n[l]=a,i.push({value:l,major:!1});return s===0||!r?i:setMajorTicks(t,i,n,r)}class TimeScale extends Scale{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(e){super(e),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(e,r={}){const i=e.time||(e.time={}),n=this._adapter=new adapters._date(e.adapters.date);n.init(r),mergeIf(i.displayFormats,n.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(e),this._normalized=r.normalized}parse(e,r){return e===void 0?null:parse(this,e)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const e=this.options,r=this._adapter,i=e.time.unit||"day";let{min:n,max:s,minDefined:a,maxDefined:l}=this.getUserBounds();function u(p){!a&&!isNaN(p.min)&&(n=Math.min(n,p.min)),!l&&!isNaN(p.max)&&(s=Math.max(s,p.max))}(!a||!l)&&(u(this._getLabelBounds()),(e.bounds!=="ticks"||e.ticks.source!=="labels")&&u(this.getMinMax(!1))),n=isNumberFinite(n)&&!isNaN(n)?n:+r.startOf(Date.now(),i),s=isNumberFinite(s)&&!isNaN(s)?s:+r.endOf(Date.now(),i)+1,this.min=Math.min(n,s-1),this.max=Math.max(n+1,s)}_getLabelBounds(){const e=this.getLabelTimestamps();let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return e.length&&(r=e[0],i=e[e.length-1]),{min:r,max:i}}buildTicks(){const e=this.options,r=e.time,i=e.ticks,n=i.source==="labels"?this.getLabelTimestamps():this._generate();e.bounds==="ticks"&&n.length&&(this.min=this._userMin||n[0],this.max=this._userMax||n[n.length-1]);const s=this.min,a=this.max,l=_filterBetween(n,s,a);return this._unit=r.unit||(i.autoSkip?determineUnitForAutoTicks(r.minUnit,this.min,this.max,this._getLabelCapacity(s)):determineUnitForFormatting(this,l.length,r.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:determineMajorUnit(this._unit),this.initOffsets(n),e.reverse&&l.reverse(),ticksFromTimestamps(this,l,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(e=>+e.value))}initOffsets(e=[]){let r=0,i=0,n,s;this.options.offset&&e.length&&(n=this.getDecimalForValue(e[0]),e.length===1?r=1-n:r=(this.getDecimalForValue(e[1])-n)/2,s=this.getDecimalForValue(e[e.length-1]),e.length===1?i=s:i=(s-this.getDecimalForValue(e[e.length-2]))/2);const a=e.length<3?.5:.25;r=_limitValue(r,0,a),i=_limitValue(i,0,a),this._offsets={start:r,end:i,factor:1/(r+1+i)}}_generate(){const e=this._adapter,r=this.min,i=this.max,n=this.options,s=n.time,a=s.unit||determineUnitForAutoTicks(s.minUnit,r,i,this._getLabelCapacity(r)),l=valueOrDefault(n.ticks.stepSize,1),u=a==="week"?s.isoWeekday:!1,p=isNumber(u)||u===!0,f={};let c=r,h,d;if(p&&(c=+e.startOf(c,"isoWeek",u)),c=+e.startOf(c,p?"day":a),e.diff(i,r,a)>1e5*l)throw new Error(r+" and "+i+" are too far apart with stepSize of "+l+" "+a);const m=n.ticks.source==="data"&&this.getDataTimestamps();for(h=c,d=0;h<i;h=+e.add(h,l,a),d++)addTick(f,h,m);return(h===i||n.bounds==="ticks"||d===1)&&addTick(f,h,m),Object.keys(f).sort(sorter).map(_=>+_)}getLabelForValue(e){const r=this._adapter,i=this.options.time;return i.tooltipFormat?r.format(e,i.tooltipFormat):r.format(e,i.displayFormats.datetime)}format(e,r){const n=this.options.time.displayFormats,s=this._unit,a=r||n[s];return this._adapter.format(e,a)}_tickFormatFunction(e,r,i,n){const s=this.options,a=s.ticks.callback;if(a)return callback(a,[e,r,i],this);const l=s.time.displayFormats,u=this._unit,p=this._majorUnit,f=u&&l[u],c=p&&l[p],h=i[r],d=p&&c&&h&&h.major;return this._adapter.format(e,n||(d?c:f))}generateTickLabels(e){let r,i,n;for(r=0,i=e.length;r<i;++r)n=e[r],n.label=this._tickFormatFunction(n.value,r,e)}getDecimalForValue(e){return e===null?NaN:(e-this.min)/(this.max-this.min)}getPixelForValue(e){const r=this._offsets,i=this.getDecimalForValue(e);return this.getPixelForDecimal((r.start+i)*r.factor)}getValueForPixel(e){const r=this._offsets,i=this.getDecimalForPixel(e)/r.factor-r.end;return this.min+i*(this.max-this.min)}_getLabelSize(e){const r=this.options.ticks,i=this.ctx.measureText(e).width,n=toRadians(this.isHorizontal()?r.maxRotation:r.minRotation),s=Math.cos(n),a=Math.sin(n),l=this._resolveTickFontOptions(0).size;return{w:i*s+l*a,h:i*a+l*s}}_getLabelCapacity(e){const r=this.options.time,i=r.displayFormats,n=i[r.unit]||i.millisecond,s=this._tickFormatFunction(e,0,ticksFromTimestamps(this,[e],this._majorUnit),n),a=this._getLabelSize(s),l=Math.floor(this.isHorizontal()?this.width/a.w:this.height/a.h)-1;return l>0?l:1}getDataTimestamps(){let e=this._cache.data||[],r,i;if(e.length)return e;const n=this.getMatchingVisibleMetas();if(this._normalized&&n.length)return this._cache.data=n[0].controller.getAllParsedValues(this);for(r=0,i=n.length;r<i;++r)e=e.concat(n[r].controller.getAllParsedValues(this));return this._cache.data=this.normalize(e)}getLabelTimestamps(){const e=this._cache.labels||[];let r,i;if(e.length)return e;const n=this.getLabels();for(r=0,i=n.length;r<i;++r)e.push(parse(this,n[r]));return this._cache.labels=this._normalized?e:this.normalize(e)}normalize(e){return _arrayUnique(e.sort(sorter))}}function interpolate(t,e,r){let i=0,n=t.length-1,s,a,l,u;r?(e>=t[i].pos&&e<=t[n].pos&&({lo:i,hi:n}=_lookupByKey(t,"pos",e)),{pos:s,time:l}=t[i],{pos:a,time:u}=t[n]):(e>=t[i].time&&e<=t[n].time&&({lo:i,hi:n}=_lookupByKey(t,"time",e)),{time:s,pos:l}=t[i],{time:a,pos:u}=t[n]);const p=a-s;return p?l+(u-l)*(e-s)/p:l}class TimeSeriesScale extends TimeScale{static id="timeseries";static defaults=TimeScale.defaults;constructor(e){super(e),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const e=this._getTimestampsForTable(),r=this._table=this.buildLookupTable(e);this._minPos=interpolate(r,this.min),this._tableRange=interpolate(r,this.max)-this._minPos,super.initOffsets(e)}buildLookupTable(e){const{min:r,max:i}=this,n=[],s=[];let a,l,u,p,f;for(a=0,l=e.length;a<l;++a)p=e[a],p>=r&&p<=i&&n.push(p);if(n.length<2)return[{time:r,pos:0},{time:i,pos:1}];for(a=0,l=n.length;a<l;++a)f=n[a+1],u=n[a-1],p=n[a],Math.round((f+u)/2)!==p&&s.push({time:p,pos:a/(l-1)});return s}_generate(){const e=this.min,r=this.max;let i=super.getDataTimestamps();return(!i.includes(e)||!i.length)&&i.splice(0,0,e),(!i.includes(r)||i.length===1)&&i.push(r),i.sort((n,s)=>n-s)}_getTimestampsForTable(){let e=this._cache.all||[];if(e.length)return e;const r=this.getDataTimestamps(),i=this.getLabelTimestamps();return r.length&&i.length?e=this.normalize(r.concat(i)):e=r.length?r:i,e=this._cache.all=e,e}getDecimalForValue(e){return(interpolate(this._table,e)-this._minPos)/this._tableRange}getValueForPixel(e){const r=this._offsets,i=this.getDecimalForPixel(e)/r.factor-r.end;return interpolate(this._table,i*this._tableRange+this._minPos,!0)}}use_dom_bind(),use_events(),use_events_mouse();const $beforeReconcile$$a=Symbol.for("#beforeReconcile"),$afterVisit$$9=Symbol.for("#afterVisit"),$$up$$9=Symbol.for("##up"),$placeChild$$9=Symbol.for("#placeChild"),$appendChild$$3=Symbol.for("#appendChild"),$afterReconcile$$a=Symbol.for("#afterReconcile");var $4$5=Symbol(),$7$1=Symbol(),$12=Symbol(),$15$2=Symbol(),$19$4=Symbol(),$23=Symbol(),$24$2=Symbol(),$25$4=Symbol(),$29$4=Symbol(),$30$2=Symbol();Chart.register(LineController,LineElement,PointElement,LinearScale,CategoryScale,plugin_title,plugin_tooltip,plugin_legend,index);let c$0$a=Symbol();const ct=class ct extends Component{get $canvas(){let e=createElement("canvas",null,`${this._ns_||""} $canvas`,null);return Object.defineProperty(this,"$canvas",{value:e}),e}[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.expression=e&&(n=e.expression)!==void 0?n:"",this.chart=e&&(n=e.chart)!==void 0?n:null,this.errorMessage=e&&(n=e.errorMessage)!==void 0?n:null}plot(){try{const r=new Parser().parse(this.expression),i=[],n=[];for(let s=-10;s<=10;s++)i.push(s),n.push(r.evaluate({x:s}));return this.updateChart(i,n),this.errorMessage=null}catch(e){return this.errorMessage=e.message,console.log("Invalid expression",e)}}updateChart(e,r){if(this.chart)return this.chart.data.labels=e,this.chart.data.datasets[0].data=r,this.chart.options.plugins.title.text="f(x) = "+this.expression,this.chart.update();{const i=this.$canvas.getContext("2d");return this.chart=new Chart(i,{type:"line",data:{labels:e,datasets:[{label:"f(x)",data:r,borderColor:"#4CAF50",backgroundColor:"rgba(76, 175, 80, 0.2)",tension:.3,fill:!0,pointRadius:3,pointHoverRadius:6}]},options:{responsive:!0,plugins:{title:{display:!0,text:"f(x) = "+this.expression,font:{size:18,weight:"bold"},color:"#333"},tooltip:{enabled:!0,callbacks:{title:function(n){return"x = "+n[0].label+`
f(x) = `+n[0].formattedValue},label:function(n){return""}}},legend:{display:!1}},interaction:{mode:"nearest",axis:"x",intersect:!0},scales:{x:{title:{display:!0,text:"x",color:"#666",font:{weight:"bold"}},grid:{color:"rgba(0,0,0,0.05)"}},y:{title:{display:!0,text:"f(x)",color:"#666",font:{weight:"bold"}},grid:{color:"rgba(0,0,0,0.05)"}}}}})}}render(){var e=this,r,i,n,s,a=this._ns_||"",l,u,p,f,c,h,d,m,_,g;return i=this,i[$beforeReconcile$$a](),n=s=1,i[$4$5]===1||(n=s=0,i[$4$5]=1),(l=i[$7$1])||(i[$7$1]=l=createElement("div",i,`z8436gn-ag ${a}`,null)),n||createElement("div",l,`z8436gn-ah ${a}`,"Graph Calculator"),n||(u=createElement("div",l,`z8436gn-ai ${a}`,null)),n||createElement("p",u,`z8436gn-aj ${a}`,"f(x) = "),f=c=1,(p=i[$12])||(f=c=0,i[$12]=p=createElement("input",u,`z8436gn-ak ${a}`,null)),i[$15$2]||(i[$15$2]=p.bind$("data",[this,"expression"])),f||(p.placeholder="Enter expression in x"),f||!p.setup||p.setup(c),p[$afterVisit$$9](c),n||(h=createElement("button",l,`z8436gn-al ${a}`,"Plot")),n||h.on$("click",{$_:[function(b,x){return e.plot(b)}]},this),r=null,this.errorMessage?(d=1,(r=i[$19$4])||(d=0,i[$19$4]=r=createElement("div",null,`z8436gn-am ${a}`,null)),d||(r[$$up$$9]=l),m=this.errorMessage,m===r[$24$2]&&d||(r[$23]=r[$placeChild$$9](r[$24$2]=m,384,r[$23]))):(_=1,(r=i[$25$4])||(_=0,i[$25$4]=r=createElement("div",null,`z8436gn-an ${a}`,null)),_||(r[$$up$$9]=l),(g=r[$29$4])||(r[$29$4]=(g=this.$canvas,g[$$up$$9]=r,g)),_||r[$appendChild$$3](g)),i[$30$2]=l[$placeChild$$9](r,0,i[$30$2]),i[$afterReconcile$$a](s),i}};register$(ct,c$0$a,"GraphCalculator",2),defineTag("graph-calculator-z8436gn-ap",ct,{});let GraphCalculator=ct;use_events(),use_events_mouse(),use_styles();const $beforeReconcile$$9=Symbol.for("#beforeReconcile"),$placeChild$$8=Symbol.for("#placeChild"),$$up$$8=Symbol.for("##up"),$afterVisit$$8=Symbol.for("#afterVisit"),$afterReconcile$$9=Symbol.for("#afterReconcile");var $4$4=Symbol(),$11$3=Symbol(),$13$3=Symbol(),$14$3=Symbol(),$16$1=Symbol(),$18$2=Symbol(),$19$3=Symbol(),$22$4=Symbol(),$25$3=Symbol(),$28$2=Symbol(),$31$1=Symbol(),$34$1=Symbol(),$37$2=Symbol(),$41$2=Symbol(),$45$2=Symbol(),$47=Symbol(),$48$2=Symbol(),$57$2=Symbol(),$60$2=Symbol(),$64$2=Symbol(),$68$3=Symbol(),$70$2=Symbol(),$71$3=Symbol();let c$0$9=Symbol();const pt=class pt extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.cards=e&&(n=e.cards)!==void 0?n:[],this.flipped=e&&(n=e.flipped)!==void 0?n:[],this.matched=e&&(n=e.matched)!==void 0?n:[],this.level=e&&(n=e.level)!==void 0?n:"easy",this.pairCount=e?e.pairCount:void 0,this.moves=e?e.moves:void 0,this.score=e?e.score:void 0,this.combo=e&&(n=e.combo)!==void 0?n:1,this.reset=e&&(n=e.reset)!==void 0?n:!1,this.symbols=e&&(n=e.symbols)!==void 0?n:["🍎","🍌","🍇","🍉","🍍","🍓","🥝","🍑","🥥","🍋","🍊","🍈","🍏","🥭","🫐","🍅"]}shuffle(e){let r=e.slice();for(let i=r.length-1,n=1,s=i-n;s>0?n<=i:n>=i;s>0?n++:n--){let a=Math.floor(Math.random()*(n+1)),l=r[n];r[n]=r[a],r[a]=l}return r}setup(){var e=this;this.reset=!0,this.moves=this.score=0,this.combo=1,this.pairCount=this.level=="easy"?8:this.level=="medium"?12:16;let r=this.symbols.slice(0,this.pairCount),i=this.shuffle(r.concat(r)).map(function(n){return{id:nanoid(),symbol:n,flipped:!1}});return this.cards=i,this.flipped=[],this.matched=[],setTimeout(function(){return e.reset=!1,commit()},500)}flipCard(e){var r=this;let i=this.cards.find(function(n){return n.id==e});if(!(i.flipped||this.matched.includes(i.id)||this.flipped.length==2)&&(i.flipped=!0,this.flipped.push(i),this.flipped.length==2)){let[n,s]=this.flipped;return n.symbol==s.symbol?(this.matched.push(n.id),this.matched.push(s.id),this.flipped=[],this.score+=10*this.combo,this.combo+=1,this.checkwin()):(this.combo=1,setTimeout(function(){return n.flipped=!1,s.flipped=!1,r.flipped=[],commit()},800)),this.moves+=1}}changeLevel(e){return this.level=e}checkwin(){var e=this;if(this.matched.length==this.pairCount*2)return setTimeout(function(){return window.alert("You won the game in "+e.moves+" moves with an score of "+e.score+" points!")},800)}render(){var e=this,r,i,n,s=this._ns_||"",a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le;r=this,r[$beforeReconcile$$9](),i=n=1,r[$4$4]===1||(i=n=0,r[$4$4]=1),i||(a=createElement("div",r,`z1q48m4k-ah ${s}`,null)),i||createElement("h2",a,`z1q48m4k-ai ${s}`,"Memory Game"),i||(l=createElement("div",a,`z1q48m4k-aj ${s}`,null)),i||(u=createElement("div",l,`z1q48m4k-ak ${s}`,null)),(p=r[$11$3])||(r[$11$3]=p=createElement("p",u,`${s}`,null)),i||p[$placeChild$$8]("Score: "),f=this.score,f===r[$14$3]&&i||(r[$13$3]=p[$placeChild$$8](r[$14$3]=f,256,r[$13$3])),(c=r[$16$1])||(r[$16$1]=c=createElement("p",u,`${s}`,null)),i||c[$placeChild$$8]("Moves: "),h=this.moves,h===r[$19$3]&&i||(r[$18$2]=c[$placeChild$$8](r[$19$3]=h,256,r[$18$2])),i||(d=createElement("div",l,`z1q48m4k-an ${s}`,null)),_=1,(m=r[$22$4])||(_=0,r[$22$4]=m=createElement("button",d,`z1q48m4k-ao ${s}`,"Easy")),_||m.on$("click",{$_:[function(ce,se){return e.changeLevel("easy")}]},this),g=this.level=="easy"?"#2196F3":"#90CAF9",g===r[$25$3]||m.css$var("--z1q48m4k_ap",r[$25$3]=g,null,"bg"),x=1,(b=r[$28$2])||(x=0,r[$28$2]=b=createElement("button",d,`z1q48m4k-aq ${s}`,"Medium")),x||b.on$("click",{$_:[function(ce,se){return e.changeLevel("medium")}]},this),S=this.level=="medium"?"#2196F3":"#90CAF9",S===r[$31$1]||b.css$var("--z1q48m4k_ar",r[$31$1]=S,null,"bg"),I=1,(T=r[$34$1])||(I=0,r[$34$1]=T=createElement("button",d,`z1q48m4k-as ${s}`,"Hard")),I||T.on$("click",{$_:[function(ce,se){return e.changeLevel("hard")}]},this),O=this.level=="hard"?"#2196F3":"#90CAF9",O===r[$37$2]||T.css$var("--z1q48m4k_at",r[$37$2]=O,null,"bg"),i||(L=createElement("button",d,`z1q48m4k-au ${s}`,"New Game")),i||L.on$("click",{$_:[function(ce,se){return e.setup(ce)}]},this),C=1,(P=r[$41$2])||(C=0,r[$41$2]=P=createElement("div",a,`z1q48m4k-av ${s}`,null)),G=this.reset||void 0,G===r[$45$2]||(C|=2,r[$45$2]=G),G=this.pairCount/2,G===r[$47]||P.css$var("--z1q48m4k_aw",r[$47]=G,null,"gtc"),C&2&&P.flag$(`z1q48m4k-av ${s} `+(r[$45$2]?"reset":"")),(B=r[$48$2])||(r[$48$2]=B=createIndexedList(384,P)),H=0,ee=B.$;for(let ce=0,se=iterable$(this.cards),de=se.length;ce<de;ce++){let fe=se[ce];te=1,(j=ee[H])||(te=0,ee[H]=j=createElement("div",B,`card-container ${s}`,null)),te||(j[$$up$$8]=B),J=j[$57$2]||(j[$57$2]={$_:[function(X,he,ne){return e.flipCard(ne.id)},null]}),J.$_[1]=fe,te||j.on$("click",J,this),pe=ae=1,(Z=j[$60$2])||(pe=ae=0,j[$60$2]=Z=createElement("div",j,`card-inner ${s}`,null)),oe=fe.flipped||this.matched.includes(fe.id)||void 0,oe===j[$64$2]||(ae|=2,j[$64$2]=oe),ae&2&&Z.flag$(`card-inner ${s} `+(j[$64$2]?"flipped":"")),pe||createElement("div",Z,`card-front ${s}`,"? "),(me=j[$68$3])||(j[$68$3]=me=createElement("div",Z,`card-back ${s}`,null)),le=fe.symbol,le===j[$71$3]&&pe||(j[$70$2]=me[$placeChild$$8](j[$71$3]=le,384,j[$70$2])),H++}return B[$afterVisit$$8](H),r[$afterReconcile$$9](n),r}};register$(pt,c$0$9,"MemoryGame",2),defineTag("memory-game-z1q48m4k-bb",pt,{cssns:"z1q48m4k_af",cssid:"z1q48m4k-af"});let MemoryGame=pt;var howler={};/*!
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */var hasRequiredHowler;function requireHowler(){return hasRequiredHowler||(hasRequiredHowler=1,function(t){(function(){var e=function(){this.init()};e.prototype={init:function(){var c=this||r;return c._counter=1e3,c._html5AudioPool=[],c.html5PoolSize=10,c._codecs={},c._howls=[],c._muted=!1,c._volume=1,c._canPlayEvent="canplaythrough",c._navigator=typeof window<"u"&&window.navigator?window.navigator:null,c.masterGain=null,c.noAudio=!1,c.usingWebAudio=!0,c.autoSuspend=!0,c.ctx=null,c.autoUnlock=!0,c._setup(),c},volume:function(c){var h=this||r;if(c=parseFloat(c),h.ctx||f(),typeof c<"u"&&c>=0&&c<=1){if(h._volume=c,h._muted)return h;h.usingWebAudio&&h.masterGain.gain.setValueAtTime(c,r.ctx.currentTime);for(var d=0;d<h._howls.length;d++)if(!h._howls[d]._webAudio)for(var m=h._howls[d]._getSoundIds(),_=0;_<m.length;_++){var g=h._howls[d]._soundById(m[_]);g&&g._node&&(g._node.volume=g._volume*c)}return h}return h._volume},mute:function(c){var h=this||r;h.ctx||f(),h._muted=c,h.usingWebAudio&&h.masterGain.gain.setValueAtTime(c?0:h._volume,r.ctx.currentTime);for(var d=0;d<h._howls.length;d++)if(!h._howls[d]._webAudio)for(var m=h._howls[d]._getSoundIds(),_=0;_<m.length;_++){var g=h._howls[d]._soundById(m[_]);g&&g._node&&(g._node.muted=c?!0:g._muted)}return h},stop:function(){for(var c=this||r,h=0;h<c._howls.length;h++)c._howls[h].stop();return c},unload:function(){for(var c=this||r,h=c._howls.length-1;h>=0;h--)c._howls[h].unload();return c.usingWebAudio&&c.ctx&&typeof c.ctx.close<"u"&&(c.ctx.close(),c.ctx=null,f()),c},codecs:function(c){return(this||r)._codecs[c.replace(/^x-/,"")]},_setup:function(){var c=this||r;if(c.state=c.ctx&&c.ctx.state||"suspended",c._autoSuspend(),!c.usingWebAudio)if(typeof Audio<"u")try{var h=new Audio;typeof h.oncanplaythrough>"u"&&(c._canPlayEvent="canplay")}catch{c.noAudio=!0}else c.noAudio=!0;try{var h=new Audio;h.muted&&(c.noAudio=!0)}catch{}return c.noAudio||c._setupCodecs(),c},_setupCodecs:function(){var c=this||r,h=null;try{h=typeof Audio<"u"?new Audio:null}catch{return c}if(!h||typeof h.canPlayType!="function")return c;var d=h.canPlayType("audio/mpeg;").replace(/^no$/,""),m=c._navigator?c._navigator.userAgent:"",_=m.match(/OPR\/(\d+)/g),g=_&&parseInt(_[0].split("/")[1],10)<33,b=m.indexOf("Safari")!==-1&&m.indexOf("Chrome")===-1,x=m.match(/Version\/(.*?) /),S=b&&x&&parseInt(x[1],10)<15;return c._codecs={mp3:!!(!g&&(d||h.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!d,opus:!!h.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!h.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(h.canPlayType('audio/wav; codecs="1"')||h.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!h.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!h.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(h.canPlayType("audio/x-m4a;")||h.canPlayType("audio/m4a;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(h.canPlayType("audio/x-m4b;")||h.canPlayType("audio/m4b;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(h.canPlayType("audio/x-mp4;")||h.canPlayType("audio/mp4;")||h.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!S&&h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!S&&h.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!h.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(h.canPlayType("audio/x-flac;")||h.canPlayType("audio/flac;")).replace(/^no$/,"")},c},_unlockAudio:function(){var c=this||r;if(!(c._audioUnlocked||!c.ctx)){c._audioUnlocked=!1,c.autoUnlock=!1,!c._mobileUnloaded&&c.ctx.sampleRate!==44100&&(c._mobileUnloaded=!0,c.unload()),c._scratchBuffer=c.ctx.createBuffer(1,1,22050);var h=function(d){for(;c._html5AudioPool.length<c.html5PoolSize;)try{var m=new Audio;m._unlocked=!0,c._releaseHtml5Audio(m)}catch{c.noAudio=!0;break}for(var _=0;_<c._howls.length;_++)if(!c._howls[_]._webAudio)for(var g=c._howls[_]._getSoundIds(),b=0;b<g.length;b++){var x=c._howls[_]._soundById(g[b]);x&&x._node&&!x._node._unlocked&&(x._node._unlocked=!0,x._node.load())}c._autoResume();var S=c.ctx.createBufferSource();S.buffer=c._scratchBuffer,S.connect(c.ctx.destination),typeof S.start>"u"?S.noteOn(0):S.start(0),typeof c.ctx.resume=="function"&&c.ctx.resume(),S.onended=function(){S.disconnect(0),c._audioUnlocked=!0,document.removeEventListener("touchstart",h,!0),document.removeEventListener("touchend",h,!0),document.removeEventListener("click",h,!0),document.removeEventListener("keydown",h,!0);for(var T=0;T<c._howls.length;T++)c._howls[T]._emit("unlock")}};return document.addEventListener("touchstart",h,!0),document.addEventListener("touchend",h,!0),document.addEventListener("click",h,!0),document.addEventListener("keydown",h,!0),c}},_obtainHtml5Audio:function(){var c=this||r;if(c._html5AudioPool.length)return c._html5AudioPool.pop();var h=new Audio().play();return h&&typeof Promise<"u"&&(h instanceof Promise||typeof h.then=="function")&&h.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(c){var h=this||r;return c._unlocked&&h._html5AudioPool.push(c),h},_autoSuspend:function(){var c=this;if(!(!c.autoSuspend||!c.ctx||typeof c.ctx.suspend>"u"||!r.usingWebAudio)){for(var h=0;h<c._howls.length;h++)if(c._howls[h]._webAudio){for(var d=0;d<c._howls[h]._sounds.length;d++)if(!c._howls[h]._sounds[d]._paused)return c}return c._suspendTimer&&clearTimeout(c._suspendTimer),c._suspendTimer=setTimeout(function(){if(c.autoSuspend){c._suspendTimer=null,c.state="suspending";var m=function(){c.state="suspended",c._resumeAfterSuspend&&(delete c._resumeAfterSuspend,c._autoResume())};c.ctx.suspend().then(m,m)}},3e4),c}},_autoResume:function(){var c=this;if(!(!c.ctx||typeof c.ctx.resume>"u"||!r.usingWebAudio))return c.state==="running"&&c.ctx.state!=="interrupted"&&c._suspendTimer?(clearTimeout(c._suspendTimer),c._suspendTimer=null):c.state==="suspended"||c.state==="running"&&c.ctx.state==="interrupted"?(c.ctx.resume().then(function(){c.state="running";for(var h=0;h<c._howls.length;h++)c._howls[h]._emit("resume")}),c._suspendTimer&&(clearTimeout(c._suspendTimer),c._suspendTimer=null)):c.state==="suspending"&&(c._resumeAfterSuspend=!0),c}};var r=new e,i=function(c){var h=this;if(!c.src||c.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}h.init(c)};i.prototype={init:function(c){var h=this;return r.ctx||f(),h._autoplay=c.autoplay||!1,h._format=typeof c.format!="string"?c.format:[c.format],h._html5=c.html5||!1,h._muted=c.mute||!1,h._loop=c.loop||!1,h._pool=c.pool||5,h._preload=typeof c.preload=="boolean"||c.preload==="metadata"?c.preload:!0,h._rate=c.rate||1,h._sprite=c.sprite||{},h._src=typeof c.src!="string"?c.src:[c.src],h._volume=c.volume!==void 0?c.volume:1,h._xhr={method:c.xhr&&c.xhr.method?c.xhr.method:"GET",headers:c.xhr&&c.xhr.headers?c.xhr.headers:null,withCredentials:c.xhr&&c.xhr.withCredentials?c.xhr.withCredentials:!1},h._duration=0,h._state="unloaded",h._sounds=[],h._endTimers={},h._queue=[],h._playLock=!1,h._onend=c.onend?[{fn:c.onend}]:[],h._onfade=c.onfade?[{fn:c.onfade}]:[],h._onload=c.onload?[{fn:c.onload}]:[],h._onloaderror=c.onloaderror?[{fn:c.onloaderror}]:[],h._onplayerror=c.onplayerror?[{fn:c.onplayerror}]:[],h._onpause=c.onpause?[{fn:c.onpause}]:[],h._onplay=c.onplay?[{fn:c.onplay}]:[],h._onstop=c.onstop?[{fn:c.onstop}]:[],h._onmute=c.onmute?[{fn:c.onmute}]:[],h._onvolume=c.onvolume?[{fn:c.onvolume}]:[],h._onrate=c.onrate?[{fn:c.onrate}]:[],h._onseek=c.onseek?[{fn:c.onseek}]:[],h._onunlock=c.onunlock?[{fn:c.onunlock}]:[],h._onresume=[],h._webAudio=r.usingWebAudio&&!h._html5,typeof r.ctx<"u"&&r.ctx&&r.autoUnlock&&r._unlockAudio(),r._howls.push(h),h._autoplay&&h._queue.push({event:"play",action:function(){h.play()}}),h._preload&&h._preload!=="none"&&h.load(),h},load:function(){var c=this,h=null;if(r.noAudio){c._emit("loaderror",null,"No audio support.");return}typeof c._src=="string"&&(c._src=[c._src]);for(var d=0;d<c._src.length;d++){var m,_;if(c._format&&c._format[d])m=c._format[d];else{if(_=c._src[d],typeof _!="string"){c._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}m=/^data:audio\/([^;,]+);/i.exec(_),m||(m=/\.([^.]+)$/.exec(_.split("?",1)[0])),m&&(m=m[1].toLowerCase())}if(m||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),m&&r.codecs(m)){h=c._src[d];break}}if(!h){c._emit("loaderror",null,"No codec support for selected audio sources.");return}return c._src=h,c._state="loading",window.location.protocol==="https:"&&h.slice(0,5)==="http:"&&(c._html5=!0,c._webAudio=!1),new n(c),c._webAudio&&a(c),c},play:function(c,h){var d=this,m=null;if(typeof c=="number")m=c,c=null;else{if(typeof c=="string"&&d._state==="loaded"&&!d._sprite[c])return null;if(typeof c>"u"&&(c="__default",!d._playLock)){for(var _=0,g=0;g<d._sounds.length;g++)d._sounds[g]._paused&&!d._sounds[g]._ended&&(_++,m=d._sounds[g]._id);_===1?c=null:m=null}}var b=m?d._soundById(m):d._inactiveSound();if(!b)return null;if(m&&!c&&(c=b._sprite||"__default"),d._state!=="loaded"){b._sprite=c,b._ended=!1;var x=b._id;return d._queue.push({event:"play",action:function(){d.play(x)}}),x}if(m&&!b._paused)return h||d._loadQueue("play"),b._id;d._webAudio&&r._autoResume();var S=Math.max(0,b._seek>0?b._seek:d._sprite[c][0]/1e3),T=Math.max(0,(d._sprite[c][0]+d._sprite[c][1])/1e3-S),I=T*1e3/Math.abs(b._rate),O=d._sprite[c][0]/1e3,L=(d._sprite[c][0]+d._sprite[c][1])/1e3;b._sprite=c,b._ended=!1;var P=function(){b._paused=!1,b._seek=S,b._start=O,b._stop=L,b._loop=!!(b._loop||d._sprite[c][2])};if(S>=L){d._ended(b);return}var C=b._node;if(d._webAudio){var G=function(){d._playLock=!1,P(),d._refreshBuffer(b);var j=b._muted||d._muted?0:b._volume;C.gain.setValueAtTime(j,r.ctx.currentTime),b._playStart=r.ctx.currentTime,typeof C.bufferSource.start>"u"?b._loop?C.bufferSource.noteGrainOn(0,S,86400):C.bufferSource.noteGrainOn(0,S,T):b._loop?C.bufferSource.start(0,S,86400):C.bufferSource.start(0,S,T),I!==1/0&&(d._endTimers[b._id]=setTimeout(d._ended.bind(d,b),I)),h||setTimeout(function(){d._emit("play",b._id),d._loadQueue()},0)};r.state==="running"&&r.ctx.state!=="interrupted"?G():(d._playLock=!0,d.once("resume",G),d._clearTimer(b._id))}else{var B=function(){C.currentTime=S,C.muted=b._muted||d._muted||r._muted||C.muted,C.volume=b._volume*r.volume(),C.playbackRate=b._rate;try{var j=C.play();if(j&&typeof Promise<"u"&&(j instanceof Promise||typeof j.then=="function")?(d._playLock=!0,P(),j.then(function(){d._playLock=!1,C._unlocked=!0,h?d._loadQueue():d._emit("play",b._id)}).catch(function(){d._playLock=!1,d._emit("playerror",b._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),b._ended=!0,b._paused=!0})):h||(d._playLock=!1,P(),d._emit("play",b._id)),C.playbackRate=b._rate,C.paused){d._emit("playerror",b._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}c!=="__default"||b._loop?d._endTimers[b._id]=setTimeout(d._ended.bind(d,b),I):(d._endTimers[b._id]=function(){d._ended(b),C.removeEventListener("ended",d._endTimers[b._id],!1)},C.addEventListener("ended",d._endTimers[b._id],!1))}catch(te){d._emit("playerror",b._id,te)}};C.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(C.src=d._src,C.load());var H=window&&window.ejecta||!C.readyState&&r._navigator.isCocoonJS;if(C.readyState>=3||H)B();else{d._playLock=!0,d._state="loading";var ee=function(){d._state="loaded",B(),C.removeEventListener(r._canPlayEvent,ee,!1)};C.addEventListener(r._canPlayEvent,ee,!1),d._clearTimer(b._id)}}return b._id},pause:function(c){var h=this;if(h._state!=="loaded"||h._playLock)return h._queue.push({event:"pause",action:function(){h.pause(c)}}),h;for(var d=h._getSoundIds(c),m=0;m<d.length;m++){h._clearTimer(d[m]);var _=h._soundById(d[m]);if(_&&!_._paused&&(_._seek=h.seek(d[m]),_._rateSeek=0,_._paused=!0,h._stopFade(d[m]),_._node))if(h._webAudio){if(!_._node.bufferSource)continue;typeof _._node.bufferSource.stop>"u"?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),h._cleanBuffer(_._node)}else(!isNaN(_._node.duration)||_._node.duration===1/0)&&_._node.pause();arguments[1]||h._emit("pause",_?_._id:null)}return h},stop:function(c,h){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"stop",action:function(){d.stop(c)}}),d;for(var m=d._getSoundIds(c),_=0;_<m.length;_++){d._clearTimer(m[_]);var g=d._soundById(m[_]);g&&(g._seek=g._start||0,g._rateSeek=0,g._paused=!0,g._ended=!0,d._stopFade(m[_]),g._node&&(d._webAudio?g._node.bufferSource&&(typeof g._node.bufferSource.stop>"u"?g._node.bufferSource.noteOff(0):g._node.bufferSource.stop(0),d._cleanBuffer(g._node)):(!isNaN(g._node.duration)||g._node.duration===1/0)&&(g._node.currentTime=g._start||0,g._node.pause(),g._node.duration===1/0&&d._clearSound(g._node))),h||d._emit("stop",g._id))}return d},mute:function(c,h){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"mute",action:function(){d.mute(c,h)}}),d;if(typeof h>"u")if(typeof c=="boolean")d._muted=c;else return d._muted;for(var m=d._getSoundIds(h),_=0;_<m.length;_++){var g=d._soundById(m[_]);g&&(g._muted=c,g._interval&&d._stopFade(g._id),d._webAudio&&g._node?g._node.gain.setValueAtTime(c?0:g._volume,r.ctx.currentTime):g._node&&(g._node.muted=r._muted?!0:c),d._emit("mute",g._id))}return d},volume:function(){var c=this,h=arguments,d,m;if(h.length===0)return c._volume;if(h.length===1||h.length===2&&typeof h[1]>"u"){var _=c._getSoundIds(),g=_.indexOf(h[0]);g>=0?m=parseInt(h[0],10):d=parseFloat(h[0])}else h.length>=2&&(d=parseFloat(h[0]),m=parseInt(h[1],10));var b;if(typeof d<"u"&&d>=0&&d<=1){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"volume",action:function(){c.volume.apply(c,h)}}),c;typeof m>"u"&&(c._volume=d),m=c._getSoundIds(m);for(var x=0;x<m.length;x++)b=c._soundById(m[x]),b&&(b._volume=d,h[2]||c._stopFade(m[x]),c._webAudio&&b._node&&!b._muted?b._node.gain.setValueAtTime(d,r.ctx.currentTime):b._node&&!b._muted&&(b._node.volume=d*r.volume()),c._emit("volume",b._id))}else return b=m?c._soundById(m):c._sounds[0],b?b._volume:0;return c},fade:function(c,h,d,m){var _=this;if(_._state!=="loaded"||_._playLock)return _._queue.push({event:"fade",action:function(){_.fade(c,h,d,m)}}),_;c=Math.min(Math.max(0,parseFloat(c)),1),h=Math.min(Math.max(0,parseFloat(h)),1),d=parseFloat(d),_.volume(c,m);for(var g=_._getSoundIds(m),b=0;b<g.length;b++){var x=_._soundById(g[b]);if(x){if(m||_._stopFade(g[b]),_._webAudio&&!x._muted){var S=r.ctx.currentTime,T=S+d/1e3;x._volume=c,x._node.gain.setValueAtTime(c,S),x._node.gain.linearRampToValueAtTime(h,T)}_._startFadeInterval(x,c,h,d,g[b],typeof m>"u")}}return _},_startFadeInterval:function(c,h,d,m,_,g){var b=this,x=h,S=d-h,T=Math.abs(S/.01),I=Math.max(4,T>0?m/T:m),O=Date.now();c._fadeTo=d,c._interval=setInterval(function(){var L=(Date.now()-O)/m;O=Date.now(),x+=S*L,x=Math.round(x*100)/100,S<0?x=Math.max(d,x):x=Math.min(d,x),b._webAudio?c._volume=x:b.volume(x,c._id,!0),g&&(b._volume=x),(d<h&&x<=d||d>h&&x>=d)&&(clearInterval(c._interval),c._interval=null,c._fadeTo=null,b.volume(d,c._id),b._emit("fade",c._id))},I)},_stopFade:function(c){var h=this,d=h._soundById(c);return d&&d._interval&&(h._webAudio&&d._node.gain.cancelScheduledValues(r.ctx.currentTime),clearInterval(d._interval),d._interval=null,h.volume(d._fadeTo,c),d._fadeTo=null,h._emit("fade",c)),h},loop:function(){var c=this,h=arguments,d,m,_;if(h.length===0)return c._loop;if(h.length===1)if(typeof h[0]=="boolean")d=h[0],c._loop=d;else return _=c._soundById(parseInt(h[0],10)),_?_._loop:!1;else h.length===2&&(d=h[0],m=parseInt(h[1],10));for(var g=c._getSoundIds(m),b=0;b<g.length;b++)_=c._soundById(g[b]),_&&(_._loop=d,c._webAudio&&_._node&&_._node.bufferSource&&(_._node.bufferSource.loop=d,d&&(_._node.bufferSource.loopStart=_._start||0,_._node.bufferSource.loopEnd=_._stop,c.playing(g[b])&&(c.pause(g[b],!0),c.play(g[b],!0)))));return c},rate:function(){var c=this,h=arguments,d,m;if(h.length===0)m=c._sounds[0]._id;else if(h.length===1){var _=c._getSoundIds(),g=_.indexOf(h[0]);g>=0?m=parseInt(h[0],10):d=parseFloat(h[0])}else h.length===2&&(d=parseFloat(h[0]),m=parseInt(h[1],10));var b;if(typeof d=="number"){if(c._state!=="loaded"||c._playLock)return c._queue.push({event:"rate",action:function(){c.rate.apply(c,h)}}),c;typeof m>"u"&&(c._rate=d),m=c._getSoundIds(m);for(var x=0;x<m.length;x++)if(b=c._soundById(m[x]),b){c.playing(m[x])&&(b._rateSeek=c.seek(m[x]),b._playStart=c._webAudio?r.ctx.currentTime:b._playStart),b._rate=d,c._webAudio&&b._node&&b._node.bufferSource?b._node.bufferSource.playbackRate.setValueAtTime(d,r.ctx.currentTime):b._node&&(b._node.playbackRate=d);var S=c.seek(m[x]),T=(c._sprite[b._sprite][0]+c._sprite[b._sprite][1])/1e3-S,I=T*1e3/Math.abs(b._rate);(c._endTimers[m[x]]||!b._paused)&&(c._clearTimer(m[x]),c._endTimers[m[x]]=setTimeout(c._ended.bind(c,b),I)),c._emit("rate",b._id)}}else return b=c._soundById(m),b?b._rate:c._rate;return c},seek:function(){var c=this,h=arguments,d,m;if(h.length===0)c._sounds.length&&(m=c._sounds[0]._id);else if(h.length===1){var _=c._getSoundIds(),g=_.indexOf(h[0]);g>=0?m=parseInt(h[0],10):c._sounds.length&&(m=c._sounds[0]._id,d=parseFloat(h[0]))}else h.length===2&&(d=parseFloat(h[0]),m=parseInt(h[1],10));if(typeof m>"u")return 0;if(typeof d=="number"&&(c._state!=="loaded"||c._playLock))return c._queue.push({event:"seek",action:function(){c.seek.apply(c,h)}}),c;var b=c._soundById(m);if(b)if(typeof d=="number"&&d>=0){var x=c.playing(m);x&&c.pause(m,!0),b._seek=d,b._ended=!1,c._clearTimer(m),!c._webAudio&&b._node&&!isNaN(b._node.duration)&&(b._node.currentTime=d);var S=function(){x&&c.play(m,!0),c._emit("seek",m)};if(x&&!c._webAudio){var T=function(){c._playLock?setTimeout(T,0):S()};setTimeout(T,0)}else S()}else if(c._webAudio){var I=c.playing(m)?r.ctx.currentTime-b._playStart:0,O=b._rateSeek?b._rateSeek-b._seek:0;return b._seek+(O+I*Math.abs(b._rate))}else return b._node.currentTime;return c},playing:function(c){var h=this;if(typeof c=="number"){var d=h._soundById(c);return d?!d._paused:!1}for(var m=0;m<h._sounds.length;m++)if(!h._sounds[m]._paused)return!0;return!1},duration:function(c){var h=this,d=h._duration,m=h._soundById(c);return m&&(d=h._sprite[m._sprite][1]/1e3),d},state:function(){return this._state},unload:function(){for(var c=this,h=c._sounds,d=0;d<h.length;d++)h[d]._paused||c.stop(h[d]._id),c._webAudio||(c._clearSound(h[d]._node),h[d]._node.removeEventListener("error",h[d]._errorFn,!1),h[d]._node.removeEventListener(r._canPlayEvent,h[d]._loadFn,!1),h[d]._node.removeEventListener("ended",h[d]._endFn,!1),r._releaseHtml5Audio(h[d]._node)),delete h[d]._node,c._clearTimer(h[d]._id);var m=r._howls.indexOf(c);m>=0&&r._howls.splice(m,1);var _=!0;for(d=0;d<r._howls.length;d++)if(r._howls[d]._src===c._src||c._src.indexOf(r._howls[d]._src)>=0){_=!1;break}return s&&_&&delete s[c._src],r.noAudio=!1,c._state="unloaded",c._sounds=[],c=null,null},on:function(c,h,d,m){var _=this,g=_["_on"+c];return typeof h=="function"&&g.push(m?{id:d,fn:h,once:m}:{id:d,fn:h}),_},off:function(c,h,d){var m=this,_=m["_on"+c],g=0;if(typeof h=="number"&&(d=h,h=null),h||d)for(g=0;g<_.length;g++){var b=d===_[g].id;if(h===_[g].fn&&b||!h&&b){_.splice(g,1);break}}else if(c)m["_on"+c]=[];else{var x=Object.keys(m);for(g=0;g<x.length;g++)x[g].indexOf("_on")===0&&Array.isArray(m[x[g]])&&(m[x[g]]=[])}return m},once:function(c,h,d){var m=this;return m.on(c,h,d,1),m},_emit:function(c,h,d){for(var m=this,_=m["_on"+c],g=_.length-1;g>=0;g--)(!_[g].id||_[g].id===h||c==="load")&&(setTimeout((function(b){b.call(this,h,d)}).bind(m,_[g].fn),0),_[g].once&&m.off(c,_[g].fn,_[g].id));return m._loadQueue(c),m},_loadQueue:function(c){var h=this;if(h._queue.length>0){var d=h._queue[0];d.event===c&&(h._queue.shift(),h._loadQueue()),c||d.action()}return h},_ended:function(c){var h=this,d=c._sprite;if(!h._webAudio&&c._node&&!c._node.paused&&!c._node.ended&&c._node.currentTime<c._stop)return setTimeout(h._ended.bind(h,c),100),h;var m=!!(c._loop||h._sprite[d][2]);if(h._emit("end",c._id),!h._webAudio&&m&&h.stop(c._id,!0).play(c._id),h._webAudio&&m){h._emit("play",c._id),c._seek=c._start||0,c._rateSeek=0,c._playStart=r.ctx.currentTime;var _=(c._stop-c._start)*1e3/Math.abs(c._rate);h._endTimers[c._id]=setTimeout(h._ended.bind(h,c),_)}return h._webAudio&&!m&&(c._paused=!0,c._ended=!0,c._seek=c._start||0,c._rateSeek=0,h._clearTimer(c._id),h._cleanBuffer(c._node),r._autoSuspend()),!h._webAudio&&!m&&h.stop(c._id,!0),h},_clearTimer:function(c){var h=this;if(h._endTimers[c]){if(typeof h._endTimers[c]!="function")clearTimeout(h._endTimers[c]);else{var d=h._soundById(c);d&&d._node&&d._node.removeEventListener("ended",h._endTimers[c],!1)}delete h._endTimers[c]}return h},_soundById:function(c){for(var h=this,d=0;d<h._sounds.length;d++)if(c===h._sounds[d]._id)return h._sounds[d];return null},_inactiveSound:function(){var c=this;c._drain();for(var h=0;h<c._sounds.length;h++)if(c._sounds[h]._ended)return c._sounds[h].reset();return new n(c)},_drain:function(){var c=this,h=c._pool,d=0,m=0;if(!(c._sounds.length<h)){for(m=0;m<c._sounds.length;m++)c._sounds[m]._ended&&d++;for(m=c._sounds.length-1;m>=0;m--){if(d<=h)return;c._sounds[m]._ended&&(c._webAudio&&c._sounds[m]._node&&c._sounds[m]._node.disconnect(0),c._sounds.splice(m,1),d--)}}},_getSoundIds:function(c){var h=this;if(typeof c>"u"){for(var d=[],m=0;m<h._sounds.length;m++)d.push(h._sounds[m]._id);return d}else return[c]},_refreshBuffer:function(c){var h=this;return c._node.bufferSource=r.ctx.createBufferSource(),c._node.bufferSource.buffer=s[h._src],c._panner?c._node.bufferSource.connect(c._panner):c._node.bufferSource.connect(c._node),c._node.bufferSource.loop=c._loop,c._loop&&(c._node.bufferSource.loopStart=c._start||0,c._node.bufferSource.loopEnd=c._stop||0),c._node.bufferSource.playbackRate.setValueAtTime(c._rate,r.ctx.currentTime),h},_cleanBuffer:function(c){var h=this,d=r._navigator&&r._navigator.vendor.indexOf("Apple")>=0;if(!c.bufferSource)return h;if(r._scratchBuffer&&c.bufferSource&&(c.bufferSource.onended=null,c.bufferSource.disconnect(0),d))try{c.bufferSource.buffer=r._scratchBuffer}catch{}return c.bufferSource=null,h},_clearSound:function(c){var h=/MSIE |Trident\//.test(r._navigator&&r._navigator.userAgent);h||(c.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var n=function(c){this._parent=c,this.init()};n.prototype={init:function(){var c=this,h=c._parent;return c._muted=h._muted,c._loop=h._loop,c._volume=h._volume,c._rate=h._rate,c._seek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++r._counter,h._sounds.push(c),c.create(),c},create:function(){var c=this,h=c._parent,d=r._muted||c._muted||c._parent._muted?0:c._volume;return h._webAudio?(c._node=typeof r.ctx.createGain>"u"?r.ctx.createGainNode():r.ctx.createGain(),c._node.gain.setValueAtTime(d,r.ctx.currentTime),c._node.paused=!0,c._node.connect(r.masterGain)):r.noAudio||(c._node=r._obtainHtml5Audio(),c._errorFn=c._errorListener.bind(c),c._node.addEventListener("error",c._errorFn,!1),c._loadFn=c._loadListener.bind(c),c._node.addEventListener(r._canPlayEvent,c._loadFn,!1),c._endFn=c._endListener.bind(c),c._node.addEventListener("ended",c._endFn,!1),c._node.src=h._src,c._node.preload=h._preload===!0?"auto":h._preload,c._node.volume=d*r.volume(),c._node.load()),c},reset:function(){var c=this,h=c._parent;return c._muted=h._muted,c._loop=h._loop,c._volume=h._volume,c._rate=h._rate,c._seek=0,c._rateSeek=0,c._paused=!0,c._ended=!0,c._sprite="__default",c._id=++r._counter,c},_errorListener:function(){var c=this;c._parent._emit("loaderror",c._id,c._node.error?c._node.error.code:0),c._node.removeEventListener("error",c._errorFn,!1)},_loadListener:function(){var c=this,h=c._parent;h._duration=Math.ceil(c._node.duration*10)/10,Object.keys(h._sprite).length===0&&(h._sprite={__default:[0,h._duration*1e3]}),h._state!=="loaded"&&(h._state="loaded",h._emit("load"),h._loadQueue()),c._node.removeEventListener(r._canPlayEvent,c._loadFn,!1)},_endListener:function(){var c=this,h=c._parent;h._duration===1/0&&(h._duration=Math.ceil(c._node.duration*10)/10,h._sprite.__default[1]===1/0&&(h._sprite.__default[1]=h._duration*1e3),h._ended(c)),c._node.removeEventListener("ended",c._endFn,!1)}};var s={},a=function(c){var h=c._src;if(s[h]){c._duration=s[h].duration,p(c);return}if(/^data:[^;]+;base64,/.test(h)){for(var d=atob(h.split(",")[1]),m=new Uint8Array(d.length),_=0;_<d.length;++_)m[_]=d.charCodeAt(_);u(m.buffer,c)}else{var g=new XMLHttpRequest;g.open(c._xhr.method,h,!0),g.withCredentials=c._xhr.withCredentials,g.responseType="arraybuffer",c._xhr.headers&&Object.keys(c._xhr.headers).forEach(function(b){g.setRequestHeader(b,c._xhr.headers[b])}),g.onload=function(){var b=(g.status+"")[0];if(b!=="0"&&b!=="2"&&b!=="3"){c._emit("loaderror",null,"Failed loading audio file with status: "+g.status+".");return}u(g.response,c)},g.onerror=function(){c._webAudio&&(c._html5=!0,c._webAudio=!1,c._sounds=[],delete s[h],c.load())},l(g)}},l=function(c){try{c.send()}catch{c.onerror()}},u=function(c,h){var d=function(){h._emit("loaderror",null,"Decoding audio data failed.")},m=function(_){_&&h._sounds.length>0?(s[h._src]=_,p(h,_)):d()};typeof Promise<"u"&&r.ctx.decodeAudioData.length===1?r.ctx.decodeAudioData(c).then(m).catch(d):r.ctx.decodeAudioData(c,m,d)},p=function(c,h){h&&!c._duration&&(c._duration=h.duration),Object.keys(c._sprite).length===0&&(c._sprite={__default:[0,c._duration*1e3]}),c._state!=="loaded"&&(c._state="loaded",c._emit("load"),c._loadQueue())},f=function(){if(r.usingWebAudio){try{typeof AudioContext<"u"?r.ctx=new AudioContext:typeof webkitAudioContext<"u"?r.ctx=new webkitAudioContext:r.usingWebAudio=!1}catch{r.usingWebAudio=!1}r.ctx||(r.usingWebAudio=!1);var c=/iP(hone|od|ad)/.test(r._navigator&&r._navigator.platform),h=r._navigator&&r._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),d=h?parseInt(h[1],10):null;if(c&&d&&d<9){var m=/safari/.test(r._navigator&&r._navigator.userAgent.toLowerCase());r._navigator&&!m&&(r.usingWebAudio=!1)}r.usingWebAudio&&(r.masterGain=typeof r.ctx.createGain>"u"?r.ctx.createGainNode():r.ctx.createGain(),r.masterGain.gain.setValueAtTime(r._muted?0:r._volume,r.ctx.currentTime),r.masterGain.connect(r.ctx.destination)),r._setup()}};t.Howler=r,t.Howl=i,typeof commonjsGlobal<"u"?(commonjsGlobal.HowlerGlobal=e,commonjsGlobal.Howler=r,commonjsGlobal.Howl=i,commonjsGlobal.Sound=n):typeof window<"u"&&(window.HowlerGlobal=e,window.Howler=r,window.Howl=i,window.Sound=n)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.4
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(r){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var n=i._howls.length-1;n>=0;n--)i._howls[n].stereo(r);return i},HowlerGlobal.prototype.pos=function(r,i,n){var s=this;if(!s.ctx||!s.ctx.listener)return s;if(i=typeof i!="number"?s._pos[1]:i,n=typeof n!="number"?s._pos[2]:n,typeof r=="number")s._pos=[r,i,n],typeof s.ctx.listener.positionX<"u"?(s.ctx.listener.positionX.setTargetAtTime(s._pos[0],Howler.ctx.currentTime,.1),s.ctx.listener.positionY.setTargetAtTime(s._pos[1],Howler.ctx.currentTime,.1),s.ctx.listener.positionZ.setTargetAtTime(s._pos[2],Howler.ctx.currentTime,.1)):s.ctx.listener.setPosition(s._pos[0],s._pos[1],s._pos[2]);else return s._pos;return s},HowlerGlobal.prototype.orientation=function(r,i,n,s,a,l){var u=this;if(!u.ctx||!u.ctx.listener)return u;var p=u._orientation;if(i=typeof i!="number"?p[1]:i,n=typeof n!="number"?p[2]:n,s=typeof s!="number"?p[3]:s,a=typeof a!="number"?p[4]:a,l=typeof l!="number"?p[5]:l,typeof r=="number")u._orientation=[r,i,n,s,a,l],typeof u.ctx.listener.forwardX<"u"?(u.ctx.listener.forwardX.setTargetAtTime(r,Howler.ctx.currentTime,.1),u.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),u.ctx.listener.forwardZ.setTargetAtTime(n,Howler.ctx.currentTime,.1),u.ctx.listener.upX.setTargetAtTime(s,Howler.ctx.currentTime,.1),u.ctx.listener.upY.setTargetAtTime(a,Howler.ctx.currentTime,.1),u.ctx.listener.upZ.setTargetAtTime(l,Howler.ctx.currentTime,.1)):u.ctx.listener.setOrientation(r,i,n,s,a,l);else return p;return u},Howl.prototype.init=function(r){return function(i){var n=this;return n._orientation=i.orientation||[1,0,0],n._stereo=i.stereo||null,n._pos=i.pos||null,n._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},n._onstereo=i.onstereo?[{fn:i.onstereo}]:[],n._onpos=i.onpos?[{fn:i.onpos}]:[],n._onorientation=i.onorientation?[{fn:i.onorientation}]:[],r.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(r,i){var n=this;if(!n._webAudio)return n;if(n._state!=="loaded")return n._queue.push({event:"stereo",action:function(){n.stereo(r,i)}}),n;var s=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof r=="number")n._stereo=r,n._pos=[r,0,0];else return n._stereo;for(var a=n._getSoundIds(i),l=0;l<a.length;l++){var u=n._soundById(a[l]);if(u)if(typeof r=="number")u._stereo=r,u._pos=[r,0,0],u._node&&(u._pannerAttr.panningModel="equalpower",(!u._panner||!u._panner.pan)&&e(u,s),s==="spatial"?typeof u._panner.positionX<"u"?(u._panner.positionX.setValueAtTime(r,Howler.ctx.currentTime),u._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),u._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):u._panner.setPosition(r,0,0):u._panner.pan.setValueAtTime(r,Howler.ctx.currentTime)),n._emit("stereo",u._id);else return u._stereo}return n},Howl.prototype.pos=function(r,i,n,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"pos",action:function(){a.pos(r,i,n,s)}}),a;if(i=typeof i!="number"?0:i,n=typeof n!="number"?-.5:n,typeof s>"u")if(typeof r=="number")a._pos=[r,i,n];else return a._pos;for(var l=a._getSoundIds(s),u=0;u<l.length;u++){var p=a._soundById(l[u]);if(p)if(typeof r=="number")p._pos=[r,i,n],p._node&&((!p._panner||p._panner.pan)&&e(p,"spatial"),typeof p._panner.positionX<"u"?(p._panner.positionX.setValueAtTime(r,Howler.ctx.currentTime),p._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),p._panner.positionZ.setValueAtTime(n,Howler.ctx.currentTime)):p._panner.setPosition(r,i,n)),a._emit("pos",p._id);else return p._pos}return a},Howl.prototype.orientation=function(r,i,n,s){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"orientation",action:function(){a.orientation(r,i,n,s)}}),a;if(i=typeof i!="number"?a._orientation[1]:i,n=typeof n!="number"?a._orientation[2]:n,typeof s>"u")if(typeof r=="number")a._orientation=[r,i,n];else return a._orientation;for(var l=a._getSoundIds(s),u=0;u<l.length;u++){var p=a._soundById(l[u]);if(p)if(typeof r=="number")p._orientation=[r,i,n],p._node&&(p._panner||(p._pos||(p._pos=a._pos||[0,0,-.5]),e(p,"spatial")),typeof p._panner.orientationX<"u"?(p._panner.orientationX.setValueAtTime(r,Howler.ctx.currentTime),p._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),p._panner.orientationZ.setValueAtTime(n,Howler.ctx.currentTime)):p._panner.setOrientation(r,i,n)),a._emit("orientation",p._id);else return p._orientation}return a},Howl.prototype.pannerAttr=function(){var r=this,i=arguments,n,s,a;if(!r._webAudio)return r;if(i.length===0)return r._pannerAttr;if(i.length===1)if(typeof i[0]=="object")n=i[0],typeof s>"u"&&(n.pannerAttr||(n.pannerAttr={coneInnerAngle:n.coneInnerAngle,coneOuterAngle:n.coneOuterAngle,coneOuterGain:n.coneOuterGain,distanceModel:n.distanceModel,maxDistance:n.maxDistance,refDistance:n.refDistance,rolloffFactor:n.rolloffFactor,panningModel:n.panningModel}),r._pannerAttr={coneInnerAngle:typeof n.pannerAttr.coneInnerAngle<"u"?n.pannerAttr.coneInnerAngle:r._coneInnerAngle,coneOuterAngle:typeof n.pannerAttr.coneOuterAngle<"u"?n.pannerAttr.coneOuterAngle:r._coneOuterAngle,coneOuterGain:typeof n.pannerAttr.coneOuterGain<"u"?n.pannerAttr.coneOuterGain:r._coneOuterGain,distanceModel:typeof n.pannerAttr.distanceModel<"u"?n.pannerAttr.distanceModel:r._distanceModel,maxDistance:typeof n.pannerAttr.maxDistance<"u"?n.pannerAttr.maxDistance:r._maxDistance,refDistance:typeof n.pannerAttr.refDistance<"u"?n.pannerAttr.refDistance:r._refDistance,rolloffFactor:typeof n.pannerAttr.rolloffFactor<"u"?n.pannerAttr.rolloffFactor:r._rolloffFactor,panningModel:typeof n.pannerAttr.panningModel<"u"?n.pannerAttr.panningModel:r._panningModel});else return a=r._soundById(parseInt(i[0],10)),a?a._pannerAttr:r._pannerAttr;else i.length===2&&(n=i[0],s=parseInt(i[1],10));for(var l=r._getSoundIds(s),u=0;u<l.length;u++)if(a=r._soundById(l[u]),a){var p=a._pannerAttr;p={coneInnerAngle:typeof n.coneInnerAngle<"u"?n.coneInnerAngle:p.coneInnerAngle,coneOuterAngle:typeof n.coneOuterAngle<"u"?n.coneOuterAngle:p.coneOuterAngle,coneOuterGain:typeof n.coneOuterGain<"u"?n.coneOuterGain:p.coneOuterGain,distanceModel:typeof n.distanceModel<"u"?n.distanceModel:p.distanceModel,maxDistance:typeof n.maxDistance<"u"?n.maxDistance:p.maxDistance,refDistance:typeof n.refDistance<"u"?n.refDistance:p.refDistance,rolloffFactor:typeof n.rolloffFactor<"u"?n.rolloffFactor:p.rolloffFactor,panningModel:typeof n.panningModel<"u"?n.panningModel:p.panningModel};var f=a._panner;f||(a._pos||(a._pos=r._pos||[0,0,-.5]),e(a,"spatial"),f=a._panner),f.coneInnerAngle=p.coneInnerAngle,f.coneOuterAngle=p.coneOuterAngle,f.coneOuterGain=p.coneOuterGain,f.distanceModel=p.distanceModel,f.maxDistance=p.maxDistance,f.refDistance=p.refDistance,f.rolloffFactor=p.rolloffFactor,f.panningModel=p.panningModel}return r},Sound.prototype.init=function(r){return function(){var i=this,n=i._parent;i._orientation=n._orientation,i._stereo=n._stereo,i._pos=n._pos,i._pannerAttr=n._pannerAttr,r.call(this),i._stereo?n.stereo(i._stereo):i._pos&&n.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(r){return function(){var i=this,n=i._parent;return i._orientation=n._orientation,i._stereo=n._stereo,i._pos=n._pos,i._pannerAttr=n._pannerAttr,i._stereo?n.stereo(i._stereo):i._pos?n.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,n._refreshBuffer(i)),r.call(this)}}(Sound.prototype.reset);var e=function(r,i){i=i||"spatial",i==="spatial"?(r._panner=Howler.ctx.createPanner(),r._panner.coneInnerAngle=r._pannerAttr.coneInnerAngle,r._panner.coneOuterAngle=r._pannerAttr.coneOuterAngle,r._panner.coneOuterGain=r._pannerAttr.coneOuterGain,r._panner.distanceModel=r._pannerAttr.distanceModel,r._panner.maxDistance=r._pannerAttr.maxDistance,r._panner.refDistance=r._pannerAttr.refDistance,r._panner.rolloffFactor=r._pannerAttr.rolloffFactor,r._panner.panningModel=r._pannerAttr.panningModel,typeof r._panner.positionX<"u"?(r._panner.positionX.setValueAtTime(r._pos[0],Howler.ctx.currentTime),r._panner.positionY.setValueAtTime(r._pos[1],Howler.ctx.currentTime),r._panner.positionZ.setValueAtTime(r._pos[2],Howler.ctx.currentTime)):r._panner.setPosition(r._pos[0],r._pos[1],r._pos[2]),typeof r._panner.orientationX<"u"?(r._panner.orientationX.setValueAtTime(r._orientation[0],Howler.ctx.currentTime),r._panner.orientationY.setValueAtTime(r._orientation[1],Howler.ctx.currentTime),r._panner.orientationZ.setValueAtTime(r._orientation[2],Howler.ctx.currentTime)):r._panner.setOrientation(r._orientation[0],r._orientation[1],r._orientation[2])):(r._panner=Howler.ctx.createStereoPanner(),r._panner.pan.setValueAtTime(r._stereo,Howler.ctx.currentTime)),r._panner.connect(r._node),r._paused||r._parent.pause(r._id,!0).play(r._id,!0)}})()}(howler)),howler}var howlerExports=requireHowler();use_events(),use_events_mouse(),use_dom_bind(),use_styles();const $beforeReconcile$$8=Symbol.for("#beforeReconcile"),$placeChild$$7=Symbol.for("#placeChild"),$$up$$7=Symbol.for("##up"),$appendChild$$2=Symbol.for("#appendChild"),$afterVisit$$7=Symbol.for("#afterVisit"),$getRenderContext$$1=Symbol.for("#getRenderContext"),$afterReconcile$$8=Symbol.for("#afterReconcile");var $7=Symbol(),$13$2=Symbol(),$15$1=Symbol(),$18$1=Symbol(),$20$2=Symbol(),$22$3=Symbol(),$25$2=Symbol(),$27$2=Symbol(),$31=Symbol(),$35$3=Symbol(),$39$1=Symbol(),$42=Symbol(),$45$1=Symbol(),$48$1=Symbol(),$54$1=Symbol(),$57$1=Symbol(),$60$1=Symbol(),$62=Symbol(),$63$3=Symbol(),$64$1=Symbol(),$68$2=Symbol(),$71$2=Symbol(),$74$1=Symbol(),$76$2=Symbol(),$77=Symbol(),$79$1=Symbol(),$81=Symbol(),$86=Symbol(),$89=Symbol(),$92=Symbol(),$93$1=Symbol(),$100=Symbol(),$103=Symbol(),$104=Symbol(),$106=Symbol(),$108=Symbol(),$109=Symbol(),$110=Symbol(),$112=Symbol(),$117=Symbol();let c$0$8=Symbol();const ht=class ht extends Component{get $vol(){let e=createElement("input",null,`f247qv-ba ${this._ns_||""} $vol`,null);return Object.defineProperty(this,"$vol",{value:e}),e}get $sp(){let e=createElement("input",null,`f247qv-be ${this._ns_||""} $sp`,null);return Object.defineProperty(this,"$sp",{value:e}),e}[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.isPlaying=e&&(n=e.isPlaying)!==void 0?n:!1,this.currentTrack=e&&(n=e.currentTrack)!==void 0?n:0,this.tracks=e&&(n=e.tracks)!==void 0?n:[],this.sound=e&&(n=e.sound)!==void 0?n:null,this.volume=e&&(n=e.volume)!==void 0?n:1,this.progress=e&&(n=e.progress)!==void 0?n:0,this.repeat=e&&(n=e.repeat)!==void 0?n:!1,this.shuffle=e&&(n=e.shuffle)!==void 0?n:!1,this.speed=e&&(n=e.speed)!==void 0?n:1,this.interval=e&&(n=e.interval)!==void 0?n:null,this.searchTerm=e&&(n=e.searchTerm)!==void 0?n:""}setup(){var e=this;return globalThis.document.addEventListener("keydown",function(r){if(e.sound){if(r.code=="ArrowRight")return e.sound.seek(e.sound.seek()+10);if(r.code=="ArrowLeft")return e.sound.seek(e.sound.seek()<10?0:e.sound.seek()-10)}})}handleFiles(e){this.tracks=[];for(let r=0,i=iterable$(e.target.files),n=i.length;r<n;r++){let s=i[r];this.tracks.push({title:s.name,src:URL.createObjectURL(s)})}if(this.tracks.length>0)return this.playTrack(0)}playTrack(e){var r=this;return this.sound&&(this.sound.unload(),clearInterval(this.interval)),this.currentTrack=e,this.sound=new howlerExports.Howl({src:this.tracks[e].src,html5:!0,volume:this.volume,rate:this.speed,onend:function(){return r.onEnd()}}),this.sound.play(),this.isPlaying=!0,this.updateProgress(),globalThis.document.getElementById(e).scrollIntoView({behavior:"smooth",block:"start"})}togglePlay(){return!this.sound&&this.tracks.length>0?this.playTrack(this.currentTrack):this.isPlaying?(this.sound.pause(),clearInterval(this.interval),this.isPlaying=!1):(this.sound.play(),this.updateProgress(),this.isPlaying=!0)}nextTrack(){if(this.shuffle){let e=Math.floor(Math.random()*this.tracks.length);return this.playTrack(e)}else{let e=(this.currentTrack+1)%this.tracks.length;return this.playTrack(e)}}prevTrack(){let e=(this.currentTrack-1+this.tracks.length)%this.tracks.length;return this.playTrack(e)}updateProgress(){var e=this;return clearInterval(this.interval),this.interval=setInterval(function(){return e.sound&&(e.progress=(e.sound.seek()||0)/e.sound.duration()*100),commit()},100)}seek(e){if(this.sound){let r=e.target.value/100;return this.sound.seek(this.sound.duration()*r)}}setVolume(e){if(this.volume=e.target.value,this.sound)return this.sound.volume(this.volume)}setSpeed(e){if(this.speed=e.target.value,this.sound)return this.sound.rate(this.speed)}toggleRepeat(){if(this.sound)return this.repeat=!this.repeat}toggleShuffle(){if(this.sound)return this.shuffle=!this.shuffle}onEnd(){return this.repeat?this.playTrack(this.currentTrack):this.nextTrack()}secondsToMinutes(e){let r=Math.floor(e/60),i=Math.floor(e%60);return r+":"+(i<10?"0"+i:i)}render(){var e=this,r,i,n,s,a,l,u,p=this._ns_||"",f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le,ce,se,de,fe,X,he,ne,ge,Ee,be,_e,ye,Te,xe,Se,W,ue,w,F,V;if(a=this,a[$beforeReconcile$$8](),l=u=1,a[$7]===1||(l=u=0,a[$7]=1),l||(f=createElement("div",a,`f247qv-ah ${p}`,null)),l||(c=createElement("div",f,`f247qv-ai ${p}`,null)),l||createElement("h1",c,`f247qv-aj ${p}`,"Music Player"),(h=a[$13$2])||(a[$13$2]=h=createElement("div",c,`f247qv-ak trackname ${p}`,null)),r=null,this.tracks.length>0?r=this.tracks[this.currentTrack].title:r="No Track Selected",a[$15$1]=h[$placeChild$$7](r,0,a[$15$1]),l||(d=createElement("div",c,`f247qv-al ${p}`,null)),(m=a[$18$1])||(a[$18$1]=m=createElement("p",d,`${p}`,null)),i=null,this.sound?i=""+this.secondsToMinutes(this.sound.seek()||0)+" / "+this.secondsToMinutes(this.sound.duration()):i="0:00 / 0:00",a[$20$2]=m[$placeChild$$7](i,0,a[$20$2]),g=1,(_=a[$22$3])||(g=0,a[$22$3]=_=createElement("input",d,`f247qv-an ${p}`,null)),g||(_.type="range"),g||(_.min="0"),g||(_.max=100),g||(_.step="0.1"),b=this.progress||0,b===a[$25$2]||(_.richValue=a[$25$2]=b),b=!this.sound,b===a[$27$2]||(_.disabled=a[$27$2]=b),g||_.on$("input",{$_:[function(K,A){return e.seek(K)}]},this),l||(x=createElement("div",c,`f247qv-ao ${p}`,null)),l||(S=createElement("button",x,`f247qv-ap ${p}`,"⏮")),l||S.on$("click",{$_:[function(K,A){return e.prevTrack(K)}]},this),I=1,(T=a[$31])||(I=0,a[$31]=T=createElement("button",x,`f247qv-aq ${p}`,null)),I||T.on$("click",{$_:[function(K,A){return e.togglePlay(K)}]},this),n=null,this.isPlaying?n="⏸":n="▶",a[$35$3]=T[$placeChild$$7](n,0,a[$35$3]),l||(O=createElement("button",x,`f247qv-ar ${p}`,"⏭")),l||O.on$("click",{$_:[function(K,A){return e.nextTrack(K)}]},this),l||(L=createElement("div",c,`f247qv-as ${p}`,null)),C=1,(P=a[$39$1])||(C=0,a[$39$1]=P=createElement("button",L,`f247qv-at ${p}`,"🔁 Repeat")),C||P.on$("click",{$_:[function(K,A){return e.toggleRepeat(K)}]},this),G=this.repeat?"lime":"gray",G===a[$42]||P.css$var("--f247qv_au",a[$42]=G,null,"bd"),H=1,(B=a[$45$1])||(H=0,a[$45$1]=B=createElement("button",L,`f247qv-av ${p}`,"🔀 Shuffle")),H||B.on$("click",{$_:[function(K,A){return e.toggleShuffle(K)}]},this),ee=this.shuffle?"lime":"gray",ee===a[$48$1]||B.css$var("--f247qv_aw",a[$48$1]=ee,null,"bd"),l||(j=createElement("div",c,`f247qv-ax ${p}`,null)),l||(te=createElement("div",j,`f247qv-ay ${p}`,null)),l||createElement("label",te,`${p}`,"Volume"),Z=1,(J=a[$54$1])||(Z=0,a[$54$1]=(J=this.$vol,J[$$up$$7]=te,J)),Z||(J.type="range"),Z||(J.min="0"),Z||(J.max="1"),Z||(J.step="0.01"),pe=this.volume,pe===a[$57$1]||(J.richValue=a[$57$1]=pe),Z||J.on$("input",{$_:[function(K,A){return e.setVolume(K)}]},this),Z||te[$appendChild$$2](J),(ae=a[$60$1])||(a[$60$1]=ae=createElement("p",te,`f247qv-bb ${p}`,null)),renderContext.context=a[$63$3]||(a[$63$3]={_:ae}),oe=Math.round(Number(this.$vol.value)*100),renderContext.context=null,oe===a[$64$1]&&l||(a[$62]=ae[$placeChild$$7](a[$64$1]=oe,384,a[$62])),l||(me=createElement("div",j,`f247qv-bc ${p}`,null)),l||createElement("label",me,`${p}`,"Speed"),ce=1,(le=a[$68$2])||(ce=0,a[$68$2]=(le=this.$sp,le[$$up$$7]=me,le)),ce||(le.type="range"),ce||(le.min="0.5"),ce||(le.max="2"),ce||(le.step="0.1"),se=this.speed,se===a[$71$2]||(le.richValue=a[$71$2]=se),ce||le.on$("input",{$_:[function(K,A){return e.setSpeed(K)}]},this),ce||me[$appendChild$$2](le),(de=a[$74$1])||(a[$74$1]=de=createElement("p",me,`f247qv-bf ${p}`,null)),fe=this.$sp.value,fe===a[$77]&&l||(a[$76$2]=de[$placeChild$$7](a[$77]=fe,384,a[$76$2])),(X=a[$79$1])||(a[$79$1]=X=createElement("div",f,`f247qv-bg ${p}`,null)),s=null,this.tracks.length>0){he=1,(s=a[$81])||(he=0,a[$81]=s=createElement("div",null,`f247qv-bh ${p}`,null)),he||(s[$$up$$7]=X),he||createElement("h2",s,`${p}`,"Music List"),ge=Ee=1,(ne=s[$86])||(ge=Ee=0,s[$86]=ne=createElement("input",s,`f247qv-bj ${p}`,null)),ge||(ne.type="text"),ge||(ne.placeholder="Search..."),s[$89]||(s[$89]=ne.bind$("data",[this,"searchTerm"])),ge||!ne.setup||ne.setup(Ee),ne[$afterVisit$$7](Ee),(be=s[$92])||(s[$92]=be=createElement("div",s,`f247qv-bk ${p}`,null)),(_e=s[$93$1])||(s[$93$1]=_e=createKeyedList(1408,be)),ye=0,Te=_e.$;for(let K=0,A=iterable$(this.tracks),re=A.length;K<re;K++){let y=A[K];y.title.toLowerCase().includes(this.searchTerm)&&(Se=1,(xe=(W=Te[$getRenderContext$$1]($100)).get(ye))||(Se=0,W.set(ye,xe=createElement("div",_e,`f247qv-bl ${p}`,null))),Se||(xe[$$up$$7]=_e),K===xe[$103]||(xe.id=xe[$103]=K),ue=xe[$104]||(xe[$104]={$_:[function(v,k,D){return e.playTrack(D)},null]}),ue.$_[1]=K,Se||xe.on$("click",ue,this),w=this.currentTrack==K?"#d1f2eb":"#fff",w===xe[$106]||xe.css$var("--f247qv_bm",xe[$106]=w,null,"bg"),w=this.currentTrack==K?"#2e7d32":"#333",w===xe[$108]||xe.css$var("--f247qv_bn",xe[$108]=w,null,"c"),w=y.title,w===xe[$110]&&Se||(xe[$109]=xe[$placeChild$$7](xe[$110]=w,384,xe[$109])),_e.push(xe,ye++,W))}_e[$afterVisit$$7](ye)}else F=1,(s=a[$112])||(F=0,a[$112]=s=createElement("div",null,`f247qv-bo ${p}`,null)),F||(s[$$up$$7]=X),F||createElement("div",s,`f247qv-bp ${p}`,"Upload multiple audio files to start the playlist 🎶"),F||(V=createElement("input",s,`f247qv-bq ${p}`,null)),F||(V.type="file"),F||(V.multiple="multiple"),F||(V.accept="audio/*"),F||V.on$("change",{$_:[function(K,A){return e.handleFiles(K)}]},this);return a[$117]=X[$placeChild$$7](s,0,a[$117]),a[$afterReconcile$$8](u),a}};register$(ht,c$0$8,"MusicPlayer",2),defineTag("music-player-f247qv-br",ht,{cssns:"f247qv_af",cssid:"f247qv-af"});let MusicPlayer=ht;use_dom_bind(),use_events(),use_events_mouse();const $beforeReconcile$$7=Symbol.for("#beforeReconcile"),$placeChild$$6=Symbol.for("#placeChild"),$afterVisit$$6=Symbol.for("#afterVisit"),$$up$$6=Symbol.for("##up"),$appendChild$$1=Symbol.for("#appendChild"),$afterReconcile$$7=Symbol.for("#afterReconcile");var $4$3=Symbol(),$9=Symbol(),$11$2=Symbol(),$14$2=Symbol(),$17$3=Symbol(),$19$2=Symbol(),$21=Symbol(),$24$1=Symbol(),$28$1=Symbol(),$32$4=Symbol(),$35$2=Symbol(),$39=Symbol(),$43$1=Symbol();let ctx,c$0$7=Symbol();const ft=class ft extends Component{get $canvas(){let e=createElement("canvas",null,`z17f3xdy-ar ${this._ns_||""} $canvas`,null);return Object.defineProperty(this,"$canvas",{value:e}),e}[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.color=e&&(n=e.color)!==void 0?n:"#000000",this.size=e&&(n=e.size)!==void 0?n:5,this.brushMode=e&&(n=e.brushMode)!==void 0?n:!0,this.brushDown=e&&(n=e.brushDown)!==void 0?n:!1}draw(e){if(!this.brushDown)return;const r=this.$canvas.getBoundingClientRect(),i=e.clientX-r.left,n=e.clientY-r.top;return ctx.lineWidth=this.size,ctx.lineCap="round",ctx.strokeStyle=this.brushMode?this.color:"white",ctx.lineTo(i,n),ctx.stroke(),ctx.beginPath(),ctx.moveTo(i,n)}endDraw(){return ctx.beginPath()}clearCanvas(){return ctx.clearRect(0,0,this.$canvas.width,this.$canvas.height)}setup(){var e=this;const r=window.devicePixelRatio||1;return this.$canvas.width=600*r,this.$canvas.height=400*r,this.$canvas.style.width="600px",this.$canvas.style.height="400px",ctx=this.$canvas.getContext("2d"),ctx.scale(r,r),globalThis.document.addEventListener("mousedown",function(){return e.brushDown=!0}),globalThis.document.addEventListener("mouseup",function(){return e.brushDown=!1})}render(){var e=this,r,i,n,s,a=this._ns_||"",l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H;return i=this,i[$beforeReconcile$$7](),n=s=1,i[$4$3]===1||(n=s=0,i[$4$3]=1),n||(l=createElement("div",i,`z17f3xdy-ah ${a}`,null)),n||(u=createElement("div",l,`z17f3xdy-ai ${a}`,null)),(p=i[$9])||(i[$9]=p=createElement("label",u,`z17f3xdy-aj ${a}`,null)),n||p[$placeChild$$6]("Brush Color: "),c=h=1,(f=i[$11$2])||(c=h=0,i[$11$2]=f=createElement("input",p,`z17f3xdy-ak ${a}`,null)),c||(f.type="color"),i[$14$2]||(i[$14$2]=f.bind$("data",[this,"color"])),c||!f.setup||f.setup(h),f[$afterVisit$$6](h),(d=i[$17$3])||(i[$17$3]=d=createElement("label",u,`z17f3xdy-al ${a}`,null)),r=null,this.brushMode?r="Brush":r="Eraser",i[$19$2]=d[$placeChild$$6](r,0,i[$19$2]),n||d[$placeChild$$6](" Size: "),_=g=1,(m=i[$21])||(_=g=0,i[$21]=m=createElement("input",d,`z17f3xdy-am ${a}`,null)),_||(m.type="range"),_||(m.min=1),_||(m.max=30),i[$24$1]||(i[$24$1]=m.bind$("data",[this,"size"])),_||!m.setup||m.setup(g),m[$afterVisit$$6](g),n||(b=createElement("div",u,`z17f3xdy-an selector ${a}`,null)),S=T=1,(x=i[$28$1])||(S=T=0,i[$28$1]=x=createElement("div",b,`${a}`,"Brush")),I=this.brushMode||void 0,I===i[$32$4]||(T|=2,i[$32$4]=I),S||x.on$("click",{$_:[function(ee,j){return e.brushMode=!0}]},this),T&2&&x.flag$(`${a} `+(i[$32$4]?"selected":"")),L=P=1,(O=i[$35$2])||(L=P=0,i[$35$2]=O=createElement("div",b,`${a}`,"Eraser")),C=!this.brushMode||void 0,C===i[$39]||(P|=2,i[$39]=C),L||O.on$("click",{$_:[function(ee,j){return e.brushMode=!1}]},this),P&2&&O.flag$(`${a} `+(i[$39]?"selected":"")),n||(G=createElement("button",u,`z17f3xdy-aq ${a}`,"Clear Canvas")),n||G.on$("click",{$_:[function(ee,j){return e.clearCanvas(ee)}]},this),H=1,(B=i[$43$1])||(H=0,i[$43$1]=(B=this.$canvas,B[$$up$$6]=l,B)),H||B.on$("mousedown",{$_:[function(ee,j){return e.draw(ee)}]},this),H||B.on$("mouseup",{$_:[function(ee,j){return e.endDraw(ee)}]},this),H||B.on$("mouseleave",{$_:[function(ee,j){return e.endDraw(ee)}]},this),H||B.on$("mousemove",{$_:[function(ee,j){return e.draw(ee)}]},this),H||l[$appendChild$$1](B),i[$afterReconcile$$7](s),i}};register$(ft,c$0$7,"PaintApp",2),defineTag("paint-app-z17f3xdy-as",ft,{cssns:"z17f3xdy_af",cssid:"z17f3xdy-af"});let PaintApp=ft;use_events(),use_dom_bind(),use_events_mouse(),use_styles();const $beforeReconcile$$6=Symbol.for("#beforeReconcile"),$afterVisit$$5=Symbol.for("#afterVisit"),$$up$$5=Symbol.for("##up"),$placeChild$$5=Symbol.for("#placeChild"),$afterReconcile$$6=Symbol.for("#afterReconcile");var $4$2=Symbol(),$14$1=Symbol(),$17$2=Symbol(),$22$2=Symbol(),$25$1=Symbol(),$30$1=Symbol(),$33$2=Symbol(),$38$3=Symbol(),$41$1=Symbol(),$46=Symbol(),$49$1=Symbol(),$54=Symbol(),$57=Symbol(),$63$2=Symbol(),$65$2=Symbol(),$68$1=Symbol(),$70$1=Symbol(),$71$1=Symbol(),$72=Symbol(),$73=Symbol(),$74=Symbol(),$75$1=Symbol(),$76$1=Symbol(),$79=Symbol();let c$0$6=Symbol();const dt=class dt extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.image=e&&(n=e.image)!==void 0?n:"",this.brightness=e&&(n=e.brightness)!==void 0?n:100,this.contrast=e&&(n=e.contrast)!==void 0?n:100,this.saturation=e&&(n=e.saturation)!==void 0?n:100,this.blurness=e&&(n=e.blurness)!==void 0?n:0,this.grayscale=e&&(n=e.grayscale)!==void 0?n:0,this.sepia=e&&(n=e.sepia)!==void 0?n:0}handleImageUpload(e){var r=this;const i=e.target.files[0];if(i){const n=new FileReader;return n.onload=function(s){return r.image=s.target.result.toString(),r.resetFilters(),commit()},n.readAsDataURL(i)}}downloadImage(){var e=this;const r=globalThis.document.createElement("canvas"),i=r.getContext("2d"),n=new Image;return n.src=this.image,n.onload=function(){r.width=n.width,r.height=n.height,i.filter="brightness("+e.brightness+"%) contrast("+e.contrast+"%) saturate("+e.saturation+"%) blur("+e.blurness+"px) grayscale("+e.grayscale+"%) sepia("+e.sepia+"%)",i.drawImage(n,0,0);const s=globalThis.document.createElement("a");return s.download="edited-image.png",s.href=r.toDataURL(),s.click()}}resetFilters(){return this.brightness=this.contrast=this.saturation=100,this.blurness=this.grayscale=this.sepia=0}render(){var e=this,r,i,n,s,a=this._ns_||"",l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le,ce,se,de;return i=this,i[$beforeReconcile$$6](),n=s=1,i[$4$2]===1||(n=s=0,i[$4$2]=1),n||(l=createElement("div",i,`zfob4w-ah ${a}`,null)),n||(u=createElement("div",l,`zfob4w-ai ${a}`,null)),n||createElement("h2",u,`zfob4w-aj ${a}`,"Photo Editor"),n||(p=createElement("input",u,`zfob4w-ak ${a}`,null)),n||(p.type="file"),n||(p.accept="image/*"),n||p.on$("change",{$_:[function(fe,X){return e.handleImageUpload(fe)}]},this),n||(f=createElement("div",u,`zfob4w-al ${a}`,null)),n||(c=createElement("label",f,`${a}`,null)),n||createElement("span",c,`zfob4w-an ${a}`,"Brightness"),d=m=1,(h=i[$14$1])||(d=m=0,i[$14$1]=h=createElement("input",c,`zfob4w-ao ${a}`,null)),d||(h.type="range"),d||(h.min="0"),d||(h.max="200"),i[$17$2]||(i[$17$2]=h.bind$("data",[this,"brightness"])),d||!h.setup||h.setup(m),h[$afterVisit$$5](m),n||(_=createElement("label",f,`${a}`,null)),n||createElement("span",_,`zfob4w-aq ${a}`,"Contrast"),b=x=1,(g=i[$22$2])||(b=x=0,i[$22$2]=g=createElement("input",_,`zfob4w-ar ${a}`,null)),b||(g.type="range"),b||(g.min="0"),b||(g.max="200"),i[$25$1]||(i[$25$1]=g.bind$("data",[this,"contrast"])),b||!g.setup||g.setup(x),g[$afterVisit$$5](x),n||(S=createElement("label",f,`${a}`,null)),n||createElement("span",S,`zfob4w-at ${a}`,"Saturation"),I=O=1,(T=i[$30$1])||(I=O=0,i[$30$1]=T=createElement("input",S,`zfob4w-au ${a}`,null)),I||(T.type="range"),I||(T.min="0"),I||(T.max="200"),i[$33$2]||(i[$33$2]=T.bind$("data",[this,"saturation"])),I||!T.setup||T.setup(O),T[$afterVisit$$5](O),n||(L=createElement("label",f,`${a}`,null)),n||createElement("span",L,`zfob4w-aw ${a}`,"Blur"),C=G=1,(P=i[$38$3])||(C=G=0,i[$38$3]=P=createElement("input",L,`zfob4w-ax ${a}`,null)),C||(P.type="range"),C||(P.min="0"),C||(P.max="10"),C||(P.step="0.1"),i[$41$1]||(i[$41$1]=P.bind$("data",[this,"blurness"])),C||!P.setup||P.setup(G),P[$afterVisit$$5](G),n||(B=createElement("label",f,`${a}`,null)),n||createElement("span",B,`zfob4w-az ${a}`,"Grayscale"),ee=j=1,(H=i[$46])||(ee=j=0,i[$46]=H=createElement("input",B,`zfob4w-ba ${a}`,null)),ee||(H.type="range"),ee||(H.min="0"),ee||(H.max="100"),i[$49$1]||(i[$49$1]=H.bind$("data",[this,"grayscale"])),ee||!H.setup||H.setup(j),H[$afterVisit$$5](j),n||(te=createElement("label",f,`${a}`,null)),n||createElement("span",te,`zfob4w-bc ${a}`,"Sepia"),Z=pe=1,(J=i[$54])||(Z=pe=0,i[$54]=J=createElement("input",te,`zfob4w-bd ${a}`,null)),Z||(J.type="range"),Z||(J.min="0"),Z||(J.max="100"),i[$57]||(i[$57]=J.bind$("data",[this,"sepia"])),Z||!J.setup||J.setup(pe),J[$afterVisit$$5](pe),n||(ae=createElement("div",u,`zfob4w-be ${a}`,null)),n||(oe=createElement("button",ae,`zfob4w-bf ${a}`,"Reset Filters")),n||oe.on$("click",{$_:[function(fe,X){return e.resetFilters(fe)}]},this),n||(me=createElement("button",ae,`zfob4w-bg ${a}`,"Download Image")),n||me.on$("click",{$_:[function(fe,X){return e.downloadImage(fe)}]},this),(le=i[$63$2])||(i[$63$2]=le=createElement("div",l,`${a}`,null)),r=null,this.image?(ce=1,(r=i[$65$2])||(ce=0,i[$65$2]=r=createElement("img",null,`zfob4w-bi ${a}`,null)),ce||(r[$$up$$5]=le),se=this.image,se===r[$68$1]||(r.src=r[$68$1]=se),se=this.brightness,se===r[$70$1]||r.css$var("--zfob4w_bj",r[$70$1]=se,"%","filter"),se=this.contrast,se===r[$71$1]||r.css$var("--zfob4w_bk",r[$71$1]=se,"%","filter"),se=this.saturation,se===r[$72]||r.css$var("--zfob4w_bl",r[$72]=se,"%","filter"),se=this.blurness,se===r[$73]||r.css$var("--zfob4w_bm",r[$73]=se,"px","filter"),se=this.grayscale,se===r[$74]||r.css$var("--zfob4w_bn",r[$74]=se,"%","filter"),se=this.sepia,se===r[$75$1]||r.css$var("--zfob4w_bo",r[$75$1]=se,"%","filter")):(de=1,(r=i[$76$1])||(de=0,i[$76$1]=r=createElement("div",null,`zfob4w-bp ${a}`,"Image Preview")),de||(r[$$up$$5]=le)),i[$79]=le[$placeChild$$5](r,0,i[$79]),i[$afterReconcile$$6](s),i}};register$(dt,c$0$6,"PhotoEditor",2),defineTag("photo-editor-zfob4w-bq",dt,{cssns:"zfob4w_af",cssid:"zfob4w-af"});let PhotoEditor=dt;use_events(),use_events_mouse();const $beforeReconcile$$5=Symbol.for("#beforeReconcile"),$placeChild$$4=Symbol.for("#placeChild"),$afterReconcile$$5=Symbol.for("#afterReconcile");var $13$1=Symbol(),$27$1=Symbol(),$29$3=Symbol(),$30=Symbol();let c$0$5=Symbol();const mt=class mt extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.code=e&&(n=e.code)!==void 0?n:"print('Hello from Python!')",this.output=e&&(n=e.output)!==void 0?n:"Loading Pyodide...",this.pyodide=e&&(n=e.pyodide)!==void 0?n:null,this.editor=e&&(n=e.editor)!==void 0?n:null}loadScript(e){return new Promise(function(r,i){let n=globalThis.document.createElement("script");return n.src=e,n.async=!1,n.onload=r,n.onerror=i,globalThis.document.head.appendChild(n)})}async setup(){var e=this;let r=["codemirror.min.css","theme/monokai.min.css","addon/selection/active-line.min.css","addon/fold/foldgutter.min.css","addon/hint/show-hint.min.css"];for(let s=0,a=iterable$(r),l=a.length;s<l;s++){let u=a[s],p=globalThis.document.createElement("link");p.rel="stylesheet",p.href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/"+u,globalThis.document.head.appendChild(p)}let i=["codemirror.min.js","mode/python/python.min.js","addon/edit/matchbrackets.min.js","addon/edit/closebrackets.min.js","addon/selection/active-line.min.js","addon/fold/foldcode.min.js","addon/fold/foldgutter.min.js","addon/fold/brace-fold.min.js","addon/hint/show-hint.min.js"];for(let s=0,a=iterable$(i),l=a.length;s<l;s++){let u=a[s];await this.loadScript("https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.5/"+u)}this.editor=window.CodeMirror(globalThis.document.getElementById("editor"),{value:this.code,mode:"python",theme:"default",lineNumbers:!0,lineWrapping:!0,styleActiveLine:!0,matchBrackets:!0,autoCloseBrackets:!0,showCursorWhenSelecting:!0,scrollbarStyle:"native",indentUnit:4,tabSize:4,indentWithTabs:!1,smartIndent:!0,extraKeys:{"Ctrl-Space":"autocomplete",Tab:"indentMore","Shift-Tab":"indentLess"},gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],foldGutter:!0,readOnly:!1,hintOptions:{completeSingle:!1},autofocus:!1,cursorBlinkRate:530,cursorScrollMargin:2,historyEventDelay:1250}),this.editor.on("change",function(){return e.code=e.editor.getValue()});let n=globalThis.document.createElement("script");return n.src="https://cdn.jsdelivr.net/pyodide/v0.23.4/full/pyodide.js",n.onload=function(){return globalThis.loadPyodide().then(function(s){return e.pyodide=s,e.pyodide.registerJsModule("jsinput",{prompt:function(a){return window.prompt(a)}}),e.output="Ready to run Python code",commit()})},globalThis.document.head.appendChild(n)}runCode(){if(this.pyodide)try{let e=`import sys
from io import StringIO
import jsinput

buffer = StringIO()
sys.stdout = buffer
sys.stderr = buffer

def input(prompt=''):
	return jsinput.prompt(prompt) or ''`;e+=`
try:
`;for(let i=0,n=iterable$(this.code.split(`
`)),s=n.length;i<s;i++){let a=n[i];e+="  "+a+`
`}e+=`except Exception as e:
	print("Error:", e)
buffer.getvalue()`;let r=this.pyodide.runPython(e);return this.output=r.toString()}catch(e){return this.output="Error: "+e.message}}render(){var e=this,r,i,n,s=this._ns_||"",a,l,u,p,f,c,h,d,m,_,g;return r=this,r[$beforeReconcile$$5](),i=n=1,r[$13$1]===1||(i=n=0,r[$13$1]=1),i||(a=createElement("div",r,`yoj2cw-ah ${s}`,null)),i||(l=createElement("div",a,`yoj2cw-ai ${s}`,null)),i||(u=createElement("div",l,`yoj2cw-aj ${s}`,null)),i||createElement("h2",u,`yoj2cw-ak ${s}`,"Python Compiler"),i||(p=createElement("button",u,`yoj2cw-al ${s}`,"Run")),i||p.on$("click",{$_:[function(b,x){return e.runCode(b)}]},this),i||(f=createElement("div",l,`yoj2cw-am ${s}`,null)),i||(f.id="editor"),i||(c=createElement("div",a,`yoj2cw-an ${s}`,null)),i||(h=createElement("div",c,`yoj2cw-ao ${s}`,null)),i||createElement("h2",h,`yoj2cw-ap ${s}`,"Output"),i||(d=createElement("button",h,`yoj2cw-aq ${s}`,"Clear")),i||d.on$("click",{$_:[function(b,x){return e.output=""}]},this),i||(m=createElement("div",c,`yoj2cw-ar ${s}`,null)),(_=r[$27$1])||(r[$27$1]=_=createElement("pre",m,`${s}`,null)),g=this.output,g===r[$30]&&i||(r[$29$3]=_[$placeChild$$4](r[$30]=g,384,r[$29$3])),r[$afterReconcile$$5](n),r}};register$(mt,c$0$5,"PythonCompiler",2),defineTag("python-compiler-yoj2cw-at",mt,{cssid:"yoj2cw-af"});let PythonCompiler=mt;use_dom_bind(),use_events(),use_events_mouse();const $beforeReconcile$$4=Symbol.for("#beforeReconcile"),$afterVisit$$4=Symbol.for("#afterVisit"),$$up$$4=Symbol.for("##up"),$afterReconcile$$4=Symbol.for("#afterReconcile");var $4$1=Symbol(),$11$1=Symbol(),$14=Symbol(),$18=Symbol(),$19$1=Symbol(),$29$2=Symbol(),$32$3=Symbol(),$35$1=Symbol(),$38$2=Symbol();let c$0$4=Symbol();const _t=class _t extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.notes=e&&(n=e.notes)!==void 0?n:JSON.parse(window.localStorage.getItem("imba_notes"))||[],this.newNote=e&&(n=e.newNote)!==void 0?n:""}addNote(){if(this.newNote.trim().length>0)return this.notes.push({id:nanoid(),content:this.newNote}),this.saveLocal(),this.newNote="",commit()}deleteNote(e){return this.notes=this.notes.filter(function(r){return r.id!==e}),this.saveLocal()}saveLocal(){return window.localStorage.setItem("imba_notes",JSON.stringify(this.notes))}render(){var e=this,r,i,n,s=this._ns_||"",a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C;r=this,r[$beforeReconcile$$4](),i=n=1,r[$4$1]===1||(i=n=0,r[$4$1]=1),i||(a=createElement("div",r,`z1tsox7n-ah ${s}`,null)),i||(l=createElement("div",a,`z1tsox7n-ai ${s}`,null)),i||createElement("h2",l,`z1tsox7n-aj ${s}`,"Sticky Notes"),i||(u=createElement("div",l,`z1tsox7n-ak ${s}`,null)),f=c=1,(p=r[$11$1])||(f=c=0,r[$11$1]=p=createElement("textarea",u,`z1tsox7n-al ${s}`,null)),r[$14]||(r[$14]=p.bind$("data",[this,"newNote"])),f||p.set$("spellcheck",!1),f||!p.setup||p.setup(c),p[$afterVisit$$4](c),i||(h=createElement("button",u,`z1tsox7n-am ${s}`,"ADD NOTE")),i||h.on$("click",{$_:[function(G,B){return e.addNote(G)}]},this),(d=r[$18])||(r[$18]=d=createElement("div",a,`z1tsox7n-an container ${s}`,null)),(m=r[$19$1])||(r[$19$1]=m=createIndexedList(384,d)),_=0,g=m.$;for(let G=0,B=iterable$(this.notes),H=B.length;G<H;G++){let ee=B[G];x=1,(b=g[_])||(x=0,g[_]=b=createElement("div",m,`z1tsox7n-ao ${s}`,null)),x||(b[$$up$$4]=m),T=I=1,(S=b[$29$2])||(T=I=0,b[$29$2]=S=createElement("textarea",b,`z1tsox7n-ap ${s}`,null)),O=b[$32$3]||(b[$32$3]=S.bind$("data",[null,"content"])),O[0]=ee,T||S.on$("input",{$_:[function(j,te){return e.saveLocal(j)}]},this),T||S.set$("spellcheck",!1),T||!S.setup||S.setup(I),S[$afterVisit$$4](I),P=1,(L=b[$35$1])||(P=0,b[$35$1]=L=createElement("button",b,`z1tsox7n-aq ${s}`,"✕")),C=b[$38$2]||(b[$38$2]={$_:[function(j,te,J){return e.deleteNote(J.id)},null]}),C.$_[1]=ee,P||L.on$("click",C,this),_++}return m[$afterVisit$$4](_),r[$afterReconcile$$4](n),r}};register$(_t,c$0$4,"StickyNotes",2),defineTag("sticky-notes-z1tsox7n-ar",_t,{cssns:"z1tsox7n_af",cssid:"z1tsox7n-af"});let StickyNotes=_t;use_events(),use_events_mouse();const $beforeReconcile$$3=Symbol.for("#beforeReconcile"),$placeChild$$3=Symbol.for("#placeChild"),$$up$$3=Symbol.for("##up"),$afterVisit$$3=Symbol.for("#afterVisit"),$afterReconcile$$3=Symbol.for("#afterReconcile");var $10$1=Symbol(),$17$1=Symbol(),$26$1=Symbol(),$29$1=Symbol(),$32$2=Symbol(),$35=Symbol(),$38$1=Symbol(),$41=Symbol(),$44=Symbol(),$45=Symbol(),$58$1=Symbol(),$61$1=Symbol(),$63$1=Symbol(),$65$1=Symbol(),$67$1=Symbol(),$68=Symbol(),$70=Symbol(),$71=Symbol(),$75=Symbol(),$76=Symbol(),$83=Symbol(),$85=Symbol(),$87=Symbol(),$88=Symbol(),$90=Symbol(),$93=Symbol();let difficulty=46,selected,emptyCells=[],checktimeout,c$0$3=Symbol();const gt=class gt extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.board=e&&(n=e.board)!==void 0?n:this.generateSudoku(difficulty),this.checkcell=e&&(n=e.checkcell)!==void 0?n:!1,this.gameover=e&&(n=e.gameover)!==void 0?n:!1}selectCell(e,r){if(!this.isFilledCell(e,r)&&!this.gameover)return is$(selected.row,e)&&is$(selected.col,r)?selected={row:null,col:null}:selected={row:e,col:r}}isFilledCell(e,r){return!emptyCells.find(function(i){return is$(i.row,e)&&is$(i.col,r)})}inputNumber(e){if(e=parseInt(e),!is$(selected.row,null)&&!is$(selected.col,null))return this.board[selected.row][selected.col]=e,this.checkwin()}clearCell(){if(!is$(selected.row,null)&&!is$(selected.col,null))return this.board[selected.row][selected.col]=""}reset(){var e,r;r=[];for(let i=0;i<=8;i++){e=[];for(let n=0;n<=8;n++)e.push(!this.isFilledCell(i,n)&&(this.board[i][n]=""));r.push(e)}return r}check(){var e=this;return this.checkcell=!0,checktimeout&&clearTimeout(checktimeout),checktimeout=setTimeout(function(){return e.checkcell=!1,commit()},3e3)}hint(){var e;if(!is$(selected.row,null)&&!is$(selected.col,null)){let r=(e=emptyCells.find(function(i){return is$(i.row,selected.row)&&is$(i.col,selected.col)}))==null?void 0:e.value;return this.board[selected.row][selected.col]=r,this.checkwin()}}isValid(e,r,i){var n;return i==((n=emptyCells.find(function(s){return is$(s.row,e)&&is$(s.col,r)}))==null?void 0:n.value)}emptyOrFilled(e,r){return!!(this.board[e][r]==""||this.isFilledCell(e,r))}generateSudoku(e){selected={row:null,col:null};let r=Array(9).fill(null).map(function(){return Array(9).fill("")});this.fillBoard(r);let i=JSON.parse(JSON.stringify(r));return this.gameover=!1,emptyCells=[],this.removeCells(i,e),i}fillBoard(e){for(let r=0;r<=8;r++)for(let i=0;i<=8;i++)if(e[r][i]===""){let n=[1,2,3,4,5,6,7,8,9].sort(function(){return Math.random()-.5});for(let s=0,a=iterable$(n),l=a.length;s<l;s++){let u=a[s];if(this.isValidFill(e,r,i,u)){if(e[r][i]=u,this.fillBoard(e))return!0;e[r][i]=""}}return!1}return!0}isValidFill(e,r,i,n){for(let l=0;l<=8;l++)if(is$(e[r][l],n)||is$(e[l][i],n))return!1;let s=Math.floor(r/3)*3,a=Math.floor(i/3)*3;for(let l=0;l<=2;l++)for(let u=0;u<=2;u++)if(is$(e[s+l][a+u],n))return!1;return!0}removeCells(e,r){let i=0;for(var n=[];i<r;){let s=Math.floor(Math.random()*9),a=Math.floor(Math.random()*9);n.push(e[s][a]!==""&&(emptyCells.push({row:s,col:a,value:e[s][a]}),e[s][a]="",i+=1))}return n}checkwin(){for(let e=0;e<=8;e++)for(let r=0;r<=8;r++)if(!this.isFilledCell(e,r)){let i=emptyCells.find(function(n){return is$(n.row,e)&&is$(n.col,r)}).value;if(!is$(this.board[e][r],i))return}return selected={row:null,col:null},this.gameover=!0,setTimeout(function(){return window.alert("You win!")},1200)}setup(){var e=this;return globalThis.document.addEventListener("keyup",function(r){if(!isNaN(Number(r.key))&&r.key!="0")return e.inputNumber(r.key),commit()})}render(){var e=this,r,i,n,s=this._ns_||"",a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C,G,B,H,ee,j,te,J,Z,pe,ae,oe,me,le,ce,se,de,fe,X,he,ne,ge,Ee,be;r=this,r[$beforeReconcile$$3](),i=n=1,r[$10$1]===1||(i=n=0,r[$10$1]=1),i||(a=createElement("div",r,`z1jkl1tj-ah ${s}`,null)),i||(l=createElement("div",a,`z1jkl1tj-ai ${s}`,null)),i||createElement("h1",l,`${s}`,"Sudoku"),i||(u=createElement("div",l,`z1jkl1tj-ak ${s}`,null)),(p=r[$17$1])||(r[$17$1]=p=createElement("label",u,`z1jkl1tj-al ${s}`,null)),i||p[$placeChild$$3]("Difficulty: "),i||(f=createElement("select",p,`${s}`,null)),i||f.on$("change",{$_:[function(_e,ye){return difficulty=parseInt(_e.target.value)}]},this),i||(c=createElement("option",f,`${s}`,"Easy")),i||(c.richValue=40),i||(h=createElement("option",f,`${s}`,"Medium")),i||(h.richValue=46),i||(h.selected="selected"),i||(d=createElement("option",f,`${s}`,"Hard")),i||(d.richValue=54),i||(m=createElement("option",f,`${s}`,"Expert")),i||(m.richValue=64),i||(_=createElement("button",u,`z1jkl1tj-ar ${s}`,"New Game")),i||_.on$("click",{$_:[function(_e,ye){return e.board=e.generateSudoku(difficulty)}]},this),i||(g=createElement("div",a,`z1jkl1tj-as ${s}`,null)),x=1,(b=r[$26$1])||(x=0,r[$26$1]=b=createElement("button",g,`z1jkl1tj-at ${s}`,"Check")),S=this.gameover,S===r[$29$1]||(b.disabled=r[$29$1]=S),x||b.on$("click",{$_:[function(_e,ye){return e.check(_e)}]},this),I=1,(T=r[$32$2])||(I=0,r[$32$2]=T=createElement("button",g,`z1jkl1tj-au ${s}`,"Hint")),O=this.gameover,O===r[$35]||(T.disabled=r[$35]=O),I||T.on$("click",{$_:[function(_e,ye){return e.hint(_e)}]},this),P=1,(L=r[$38$1])||(P=0,r[$38$1]=L=createElement("button",g,`z1jkl1tj-av ${s}`,"Reset")),C=this.gameover,C===r[$41]||(L.disabled=r[$41]=C),P||L.on$("click",{$_:[function(_e,ye){return e.reset(_e)}]},this),(G=r[$44])||(r[$44]=G=createElement("div",a,`z1jkl1tj-aw ${s}`,null)),(B=r[$45])||(r[$45]=B=createIndexedList(2432,G)),H=0,ee=B.$;for(let _e=0,ye=iterable$(this.board),Te=ye.length;_e<Te;_e++){let xe=ye[_e];(j=ee[H])||(ee[H]=j=createIndexedList(0,B)),te=0,J=j.$;for(let Se=0,W=iterable$(xe),ue=W.length;Se<ue;Se++){let w=W[Se];pe=ae=1,(Z=J[te])||(pe=ae=0,J[te]=Z=createElement("div",j,`z1jkl1tj-ax ${s}`,null)),pe||(Z[$$up$$3]=j),oe=this.isFilledCell(_e,Se)||void 0,oe===Z[$58$1]||(ae|=2,Z[$58$1]=oe),oe=!this.isFilledCell(_e,Se)||void 0,oe===Z[$61$1]||(ae|=2,Z[$61$1]=oe),oe=is$(selected.row,_e)&&is$(selected.col,Se)||void 0,oe===Z[$63$1]||(ae|=2,Z[$63$1]=oe),oe=this.isValid(_e,Se,this.board[_e][Se])&&this.checkcell&&!this.emptyOrFilled(_e,Se)||void 0,oe===Z[$65$1]||(ae|=2,Z[$65$1]=oe),oe=!this.isValid(_e,Se,this.board[_e][Se])&&this.checkcell&&!this.emptyOrFilled(_e,Se)||void 0,oe===Z[$67$1]||(ae|=2,Z[$67$1]=oe),me=Z[$68]||(Z[$68]={$_:[function(F,V,K,A){return e.selectCell(K,A)},null,null]}),me.$_[1]=_e,me.$_[2]=Se,pe||Z.on$("click",me,this),ae&2&&Z.flag$(`z1jkl1tj-ax ${s} `+(Z[$58$1]?"filled-cell":"")+" "+(Z[$61$1]?"empty-cell":"")+" "+(Z[$63$1]?"selected-cell":"")+" "+(Z[$65$1]?"correct-cell":"")+" "+(Z[$67$1]?"incorrect-cell":"")),oe=w,oe===Z[$71]&&pe||(Z[$70]=Z[$placeChild$$3](Z[$71]=oe,384,Z[$70])),te++}j[$afterVisit$$3](te),H++}B[$afterVisit$$3](H),(le=r[$75])||(r[$75]=le=createElement("div",a,`z1jkl1tj-ay ${s}`,null)),(ce=r[$76])||(r[$76]=ce=createIndexedList(128,le)),se=0,de=ce.$;for(let _e=1;_e<=9;_e++)X=1,(fe=de[se])||(X=0,de[se]=fe=createElement("button",ce,`z1jkl1tj-az ${s}`,null)),X||(fe[$$up$$3]=ce),he=this.gameover,he===fe[$83]||(fe.disabled=fe[$83]=he),ne=fe[$85]||(fe[$85]={$_:[function(ye,Te,xe){return e.inputNumber(xe)},null]}),ne.$_[1]=_e,X||fe.on$("click",ne,this),he=_e,he===fe[$88]&&X||(fe[$87]=fe[$placeChild$$3](fe[$88]=he,384,fe[$87])),se++;return ce[$afterVisit$$3](se),Ee=1,(ge=r[$90])||(Ee=0,r[$90]=ge=createElement("button",le,`z1jkl1tj-ba ${s}`,"Clear")),be=this.gameover,be===r[$93]||(ge.disabled=r[$93]=be),Ee||ge.on$("click",{$_:[function(_e,ye){return e.clearCell(_e)}]},this),r[$afterReconcile$$3](n),r}};register$(gt,c$0$3,"SudokuGame",2),defineTag("sudoku-game-z1jkl1tj-bb",gt,{cssns:"z1jkl1tj_af",cssid:"z1jkl1tj-af"});let SudokuGame=gt;use_events(),use_events_mouse();const $beforeReconcile$$2=Symbol.for("#beforeReconcile"),$placeChild$$2=Symbol.for("#placeChild"),$$up$$2=Symbol.for("##up"),$afterVisit$$2=Symbol.for("#afterVisit"),$afterReconcile$$2=Symbol.for("#afterReconcile");var $11=Symbol(),$15=Symbol(),$17=Symbol(),$19=Symbol(),$20$1=Symbol(),$28=Symbol(),$29=Symbol(),$32$1=Symbol(),$33$1=Symbol();let c$0$2=Symbol();const $t=class $t extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.board=e&&(n=e.board)!==void 0?n:Array(9).fill(""),this.currentPlayer=e&&(n=e.currentPlayer)!==void 0?n:"X",this.winner=e&&(n=e.winner)!==void 0?n:"",this.gameOver=e&&(n=e.gameOver)!==void 0?n:!1,this.combos=e?e.combos:void 0,this.a=e?e.a:void 0,this.b=e?e.b:void 0,this.c=e?e.c:void 0}reset(){var e;this.board=Array(9).fill(""),this.currentPlayer="X",this.winner="",this.gameOver=!1,e=[];for(let r=0;r<9;r++)e.push(globalThis.document.getElementById(r.toString()).classList.remove("line"));return e}checkWinner(){this.combos=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let e=0,r=iterable$(this.combos),i=r.length;e<i;e++){let n=r[e];if([this.a,this.b,this.c]=n,this.board[this.a]!=""&&this.board[this.a]==this.board[this.b]&&this.board[this.b]==this.board[this.c]){this.winner=this.board[this.a];for(let s=0,a=iterable$(n),l=a.length;s<l;s++){let u=a[s];globalThis.document.getElementById(u).classList.add("line")}this.gameOver=!0;return}}if(this.board.every(function(e){return e!=""}))return this.winner="Draw",this.gameOver=!0}makeMove(e){if(this.board[e]==""&&!this.gameOver)return this.board[e]=this.currentPlayer,this.checkWinner(),this.currentPlayer=this.currentPlayer=="X"?"O":"X"}render(){var e=this,r,i,n,s,a=this._ns_||"",l,u,p,f,c,h,d,m,_,g,b;i=this,i[$beforeReconcile$$2](),n=s=1,i[$11]===1||(n=s=0,i[$11]=1),n||(l=createElement("div",i,`z1d1m136-ah ${a}`,null)),(u=i[$15])||(i[$15]=u=createElement("div",l,`z1d1m136-ai ${a}`,null)),r=null,this.winner==""?r="Current Player: "+this.currentPlayer:this.winner=="Draw"?r="It's a Draw!":r="Winner: "+this.winner,i[$17]=u[$placeChild$$2](r,0,i[$17]),(p=i[$19])||(i[$19]=p=createElement("div",l,`z1d1m136-aj ${a}`,null)),(f=i[$20$1])||(i[$20$1]=f=createIndexedList(384,p)),c=0,h=f.$;for(let x=0,S=iterable$(this.board),T=S.length;x<T;x++){let I=S[x];m=1,(d=h[c])||(m=0,h[c]=d=createElement("div",f,`cell ${a}`,null)),m||(d[$$up$$2]=f),x===d[$28]||(d.id=d[$28]=x),_=d[$29]||(d[$29]={$_:[function(O,L,P){return e.makeMove(P)},null]}),_.$_[1]=x,m||d.on$("click",_,this),g=I,g===d[$33$1]&&m||(d[$32$1]=d[$placeChild$$2](d[$33$1]=g,384,d[$32$1])),c++}return f[$afterVisit$$2](c),n||(b=createElement("button",l,`z1d1m136-al ${a}`,"NEW GAME")),n||b.on$("click",{$_:[function(x,S){return e.reset(x)}]},this),i[$afterReconcile$$2](s),i}};register$($t,c$0$2,"Tictactoe",2),defineTag("tictactoe-z1d1m136-am",$t,{cssns:"z1d1m136_af"});let Tictactoe=$t;use_events(),use_events_mouse();const $beforeReconcile$$1=Symbol.for("#beforeReconcile"),$placeChild$$1=Symbol.for("#placeChild"),$$up$$1=Symbol.for("##up"),$afterVisit$$1=Symbol.for("#afterVisit"),$afterReconcile$$1=Symbol.for("#afterReconcile");var $16=Symbol(),$20=Symbol(),$22$1=Symbol(),$24=Symbol(),$25=Symbol(),$33=Symbol(),$34=Symbol(),$37$1=Symbol(),$38=Symbol();let c$0$1=Symbol();const bt=class bt extends Component{[__init__$](e=null,r=!0,i=!0){var n;super[__init__$](...arguments),this.board=e&&(n=e.board)!==void 0?n:Array(9).fill(""),this.currentPlayer=e&&(n=e.currentPlayer)!==void 0?n:"X",this.winner=e&&(n=e.winner)!==void 0?n:"",this.gameOver=e&&(n=e.gameOver)!==void 0?n:!1,this.combos=e?e.combos:void 0,this.a=e?e.a:void 0,this.b=e?e.b:void 0,this.c=e?e.c:void 0}reset(){var e=this;this.board=Array(9).fill(""),this.currentPlayer=Math.random()>.5?"X":"O",this.winner="",this.gameOver=!1;for(let r=0;r<9;r++)globalThis.document.getElementById(r.toString()).classList.remove("line");if(this.currentPlayer=="O")return setTimeout(function(){return e.makeAIMove(),commit()},800)}checkWinner(){this.combos=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let e=0,r=iterable$(this.combos),i=r.length;e<i;e++){let n=r[e];if([this.a,this.b,this.c]=n,this.board[this.a]!=""&&this.board[this.a]==this.board[this.b]&&this.board[this.b]==this.board[this.c]){this.winner=this.board[this.a];for(let s=0,a=iterable$(n),l=a.length;s<l;s++){let u=a[s];globalThis.document.getElementById(u).classList.add("line")}this.gameOver=!0;return}}if(this.board.every(function(e){return e!=""}))return this.winner="Draw",this.gameOver=!0}makeMove(e){var r=this;if(this.board[e]==""&&!this.gameOver&&(this.board[e]=this.currentPlayer,this.checkWinner(),this.currentPlayer=this.currentPlayer=="X"?"O":"X",this.currentPlayer=="O"&&!this.gameOver))return setTimeout(function(){return r.makeAIMove(),commit()},800)}makeAIMove(){let e=this.minimax(this.board,"O");return this.makeMove(e.index)}minimax(e,r){let i=e.map(function(s,a){return s==""?a:null}).filter(function(s){return s!=null});if(this.checkWin(e,"X"))return{score:-10};if(this.checkWin(e,"O"))return{score:10};if(i.length==0)return{score:0};let n=[];for(let s=0,a=iterable$(i),l=a.length;s<l;s++){let u=a[s],p={index:u,score:0};e[u]=r;let f=r=="O"?this.minimax(e,"X"):this.minimax(e,"O");p.score=f.score,e[u]="",n.push(p)}return r=="O"?n.reduce(function(s,a){return a.score>s.score?a:s},{score:-1/0}):n.reduce(function(s,a){return a.score<s.score?a:s},{score:1/0})}checkWin(e,r){let i=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(let n=0,s=iterable$(i),a=s.length;n<a;n++){let l=s[n],[u,p,f]=l;if(e[u]==r&&e[p]==r&&e[f]==r)return!0}return!1}render(){var e=this,r,i,n,s,a=this._ns_||"",l,u,p,f,c,h,d,m,_,g,b;i=this,i[$beforeReconcile$$1](),n=s=1,i[$16]===1||(n=s=0,i[$16]=1),n||(l=createElement("div",i,`z1skh9qt-ah ${a}`,null)),(u=i[$20])||(i[$20]=u=createElement("div",l,`z1skh9qt-ai ${a}`,null)),r=null,this.winner==""?this.currentPlayer=="X"?r="Your turn":r="Computer's turn":this.winner=="Draw"?r="It's a Draw!":this.currentPlayer=="O"?r="You win!":r="Computer wins!",i[$22$1]=u[$placeChild$$1](r,0,i[$22$1]),(p=i[$24])||(i[$24]=p=createElement("div",l,`z1skh9qt-aj ${a}`,null)),(f=i[$25])||(i[$25]=f=createIndexedList(384,p)),c=0,h=f.$;for(let x=0,S=iterable$(this.board),T=S.length;x<T;x++){let I=S[x];m=1,(d=h[c])||(m=0,h[c]=d=createElement("div",f,`cell ${a}`,null)),m||(d[$$up$$1]=f),x===d[$33]||(d.id=d[$33]=x),_=d[$34]||(d[$34]={$_:[function(O,L,P){return e.currentPlayer=="X"&&e.makeMove(P)},null]}),_.$_[1]=x,m||d.on$("click",_,this),g=I,g===d[$38]&&m||(d[$37$1]=d[$placeChild$$1](d[$38]=g,384,d[$37$1])),c++}return f[$afterVisit$$1](c),n||(b=createElement("button",l,`z1skh9qt-al ${a}`,"NEW GAME")),n||b.on$("click",{$_:[function(x,S){return e.reset(x)}]},this),i[$afterReconcile$$1](s),i}};register$(bt,c$0$1,"TictactoeAI",2),defineTag("tictactoe-ai-z1skh9qt-am",bt,{cssns:"z1skh9qt_af"});let TictactoeAI=bt;use_router();const $beforeReconcile$=Symbol.for("#beforeReconcile"),$afterVisit$=Symbol.for("#afterVisit"),$appendChild$=Symbol.for("#appendChild"),$$up$=Symbol.for("##up"),$getRenderContext$=Symbol.for("#getRenderContext"),$isRichElement$=Symbol.for("#isRichElement"),$insertInto$=Symbol.for("#insertInto"),$replaceWith$=Symbol.for("#replaceWith"),$afterReconcile$=Symbol.for("#afterReconcile"),$placeChild$=Symbol.for("#placeChild");var $4=Symbol(),$6=Symbol(),$10=Symbol(),$13=Symbol(),$22=Symbol(),$26=Symbol(),$27=Symbol(),$32=Symbol(),$37=Symbol(),$43=Symbol(),$48=Symbol(),$49=Symbol(),$58=Symbol(),$60=Symbol(),$61=Symbol(),$63,$64=getRenderContext(),$65=Symbol(),$66,$67;const projects=[{name:"2048 Game",id:"Game2048",component:Game2048},{name:"Analog Clock",id:"AnalogClock",component:AnalogClock},{name:"Analog Clocks",id:"AnalogClocks",component:AnalogClocks},{name:"Calculator",id:"Calculator",component:Calculator},{name:"Calendar",id:"Calendar",component:Calendar},{name:"Chatbot",id:"Chatbot",component:Chatbot},{name:"Checker Game",id:"CheckerGame",component:CheckerGame},{name:"Chess",id:"Chess",component:Chessboard},{name:"Chess AI",id:"ChessAI",component:ChessboardAI},{name:"Desmos",id:"Desmos",component:DesmosGraph},{name:"Differentiator Integrator",id:"DifferentiatorIntegrator",component:DifferentiatorIntegrator},{name:"Fidget Spinner",id:"FidgetSpinner",component:FidgetSpinner},{name:"Flappy Bird",id:"FlappyBird",component:FlappyBird},{name:"Game of Life",id:"GameOfLife",component:GameOfLife},{name:"Graph Calculator",id:"GraphCalculator",component:GraphCalculator},{name:"Memory Game",id:"MemoryGame",component:MemoryGame},{name:"Music Player",id:"MusicPlayer",component:MusicPlayer},{name:"Paint",id:"Paint",component:PaintApp},{name:"Photo Editor",id:"PhotoEditor",component:PhotoEditor},{name:"Python Compiler",id:"PythonCompiler",component:PythonCompiler},{name:"Sticky Notes",id:"StickyNotes",component:StickyNotes},{name:"Sudoku",id:"Sudoku",component:SudokuGame},{name:"Tic Tac Toe",id:"TicTacToe",component:Tictactoe},{name:"Tic Tac Toe AI",id:"TicTacToeAI",component:TictactoeAI}];let c$0=Symbol();const yt=class yt extends Component{render(){var e,r,i,n,s,a,l,u,p,f,c,h,d,m,_,g,b,x,S,T,I,O,L,P,C;e=this,e[$beforeReconcile$](),r=1,e[$4]===1||(r=0,e[$4]=1),n=s=1,(i=e[$6])||(n=s=0,e[$6]=i=createElement("div",e,null,null)),n||(i.route="/"),l=u=1,(a=e[$10])||(l=u=0,e[$10]=a=createComponent(MainMenu,i,null)),l||!a.setup||a.setup(u),a[$afterVisit$](u),l||i[$appendChild$](a),n||!i.setup||i.setup(s),i[$afterVisit$](s),(p=e[$13])||(e[$13]=p=createIndexedList(0,e)),f=0,c=p.$;for(let G=0,B=iterable$(projects),H=B.length;G<H;G++){let ee=B[G];d=m=1,(h=c[f])||(d=m=0,c[f]=h=createElement("div",p,null,null)),d||(h[$$up$]=p),_="/"+ee.id,_===h[$22]||(h.route=h[$22]=_),g=h[$getRenderContext$]($27),x=S=1,(b=g.run(ee.component))||(x=S=0,g.cache(b=createDynamic(g.value,h,null))),b[$isRichElement$]&&(x||!b.setup||b.setup(S),b[$afterVisit$](S)),b==h[$26]||!h[$26]&&(h[$26]=b)[$insertInto$](h)||h[$26][$replaceWith$](h[$26]=b,h),d||!h.setup||h.setup(m),h[$afterVisit$](m),f++}return p[$afterVisit$](f),I=O=1,(T=e[$32])||(I=O=0,e[$32]=T=createElement("div",e,"z107gw87-ak",null)),I||(T.route="/*"),I||createElement("h1",T,null,"404 - Page Not Found"),P=C=1,(L=e[$37])||(P=C=0,e[$37]=L=createElement("a",T,"z107gw87-am","Back to Menu")),P||(L.routeΞto="/"),P||!L.setup||L.setup(C),L[$afterVisit$](C),I||!T.setup||T.setup(O),T[$afterVisit$](O),e[$afterReconcile$](r),e}};register$(yt,c$0,"Router",2),defineTag("router-z107gw87-an",yt,{});let Router=yt,c$1=Symbol();const vt=class vt extends Component{render(){var e,r,i,n,s,a,l,u,p,f,c,h,d;e=this,e[$beforeReconcile$](),r=i=1,e[$43]===1||(r=i=0,e[$43]=1),r||(n=createElement("div",e,"z107gw87-aq",null)),r||createElement("h1",n,"z107gw87-ar","Imba Project Hub"),r||(s=createElement("div",n,"z107gw87-as",null)),(a=e[$48])||(e[$48]=a=createElement("div",s,"z107gw87-at",null)),(l=e[$49])||(e[$49]=l=createIndexedList(384,a)),u=0,p=l.$;for(let m=0,_=iterable$(projects),g=_.length;m<g;m++){let b=_[m];c=h=1,(f=p[u])||(c=h=0,p[u]=f=createElement("a",l,"z107gw87-au",null)),c||(f[$$up$]=l),d="/"+b.id,d===f[$58]||(f.routeΞto=f[$58]=d),d=b.name,d===f[$61]&&c||(f[$60]=f[$placeChild$](f[$61]=d,384,f[$60])),c||!f.setup||f.setup(h),f[$afterVisit$](h),u++}return l[$afterVisit$](u),e[$afterReconcile$](i),e}};register$(vt,c$1,"MainMenu",2),defineTag("main-menu-z107gw87-av",vt,{cssid:"z107gw87-ao"});let MainMenu=vt;mount(($66=$67=1,($63=$64[$65])||($66=$67=0,$63=$64[$65]=$63=createComponent(Router,null,null)),$66||($63[$$up$]=$64._),$66||$64.sym||!$63.setup||$63.setup($67),$64.sym||$63[$afterVisit$]($67),$63));
